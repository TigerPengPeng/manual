<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 6 Security</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="server-administration.html" title="Chapter 5 MySQL Server Administration" />
<link rel="next" href="backup-and-recovery.html" title="Chapter 7 Backup and Recovery" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1438557954*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 6 Security</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="server-administration.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="backup-and-recovery.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="security"></a>Chapter 6 Security</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="security.html#general-security-issues">6.1 General Security Issues</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 Security Guidelines</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 Keeping Passwords Secure</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 Making MySQL Secure Against Attackers</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 Security-Related mysqld Options and Variables</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 How to Run MySQL as a Normal User</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 Security Issues with LOAD DATA LOCAL</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 Client Programming Security Guidelines</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#privilege-system">6.2 The MySQL Access Privilege System</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#privileges-provided">6.2.1 Privileges Provided by MySQL</a></span></dt><dt><span class="section"><a href="security.html#grant-table-structure">6.2.2 Privilege System Grant Tables</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.3 Specifying Account Names</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.4 Access Control, Stage 1: Connection Verification</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.5 Access Control, Stage 2: Request Verification</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.6 When Privilege Changes Take Effect</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.7 Troubleshooting Problems Connecting to MySQL</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#user-account-management">6.3 MySQL User Account Management</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#user-names">6.3.1 User Names and Passwords</a></span></dt><dt><span class="section"><a href="security.html#adding-users">6.3.2 Adding User Accounts</a></span></dt><dt><span class="section"><a href="security.html#removing-users">6.3.3 Removing User Accounts</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.3.4 Setting Account Resource Limits</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.3.5 Assigning Account Passwords</a></span></dt><dt><span class="section"><a href="security.html#password-expiration-sandbox-mode">6.3.6 Password Expiration and Sandbox Mode</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.3.7 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#authentication-plugins-available">6.3.8 Authentication Plugins Available in MySQL</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.3.9 Proxy Users</a></span></dt><dt><span class="section"><a href="security.html#ssl-connections">6.3.10 Using SSL for Secure Connections</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.11 Creating SSL and RSA Certificates and Keys</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.12 Connecting to MySQL Remotely from Windows with SSH</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin">6.3.13 MySQL Enterprise Audit Log Plugin</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.3.14 SQL-Based MySQL Account Activity Auditing</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.3.15 MySQL Enterprise Firewall</a></span></dt></dl></dd></dl>
</div>
<p>
    When thinking about security within a MySQL installation, you should
    consider a wide range of possible topics and how they affect the
    security of your MySQL server and related applications:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        General factors that affect security. These include choosing
        good passwords, not granting unnecessary privileges to users,
        ensuring application security by preventing SQL injections and
        data corruption, and others. See
        <a class="xref" href="security.html#general-security-issues" title="6.1 General Security Issues">Section 6.1, “General Security Issues”</a>.
      </p></li><li class="listitem"><p>
        Security of the installation itself. The data files, log files,
        and the all the application files of your installation should be
        protected to ensure that they are not readable or writable by
        unauthorized parties. For more information, see
        <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
      </p></li><li class="listitem"><p>
        Access control and security within the database system itself,
        including the users and databases granted with access to the
        databases, views and stored programs in use within the database.
        For more information, see <a class="xref" href="security.html#privilege-system" title="6.2 The MySQL Access Privilege System">Section 6.2, “The MySQL Access Privilege System”</a>,
        and <a class="xref" href="security.html#user-account-management" title="6.3 MySQL User Account Management">Section 6.3, “MySQL User Account Management”</a>.
      </p></li><li class="listitem"><p>
        Network security of MySQL and your system. The security is
        related to the grants for individual users, but you may also
        wish to restrict MySQL so that it is available only locally on
        the MySQL server host, or to a limited set of other hosts.
      </p></li><li class="listitem"><p>
        Ensure that you have adequate and appropriate backups of your
        database files, configuration and log files. Also be sure that
        you have a recovery solution in place and test that you are able
        to successfully recover the information from your backups. See
        <a class="xref" href="backup-and-recovery.html" title="Chapter 7 Backup and Recovery">Chapter 7, <i>Backup and Recovery</i></a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="general-security-issues"></a>6.1 General Security Issues</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 Security Guidelines</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 Keeping Passwords Secure</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 Making MySQL Secure Against Attackers</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 Security-Related mysqld Options and Variables</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 How to Run MySQL as a Normal User</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 Security Issues with LOAD DATA LOCAL</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 Client Programming Security Guidelines</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737187975824"></a><p>
    This section describes general security issues to be aware of and
    what you can do to make your MySQL installation more secure against
    attack or misuse. For information specifically about the access
    control system that MySQL uses for setting up user accounts and
    checking database access, see <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
  </p><p>
    For answers to some questions that are often asked about MySQL
    Server security issues, see <a class="xref" href="faqs.html#faqs-security" title="A.9 MySQL 5.6 FAQ: Security">Section A.9, “MySQL 5.6 FAQ: Security”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-guidelines"></a>6.1.1 Security Guidelines</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm139737187970560"></a><a class="indexterm" name="idm139737187969488"></a><p>
      Anyone using MySQL on a computer connected to the Internet should
      read this section to avoid the most common security mistakes.
    </p><p>
      In discussing security, it is necessary to consider fully
      protecting the entire server host (not just the MySQL server)
      against all types of applicable attacks: eavesdropping, altering,
      playback, and denial of service. We do not cover all aspects of
      availability and fault tolerance here.
    </p><p>
      MySQL uses security based on Access Control Lists (ACLs) for all
      connections, queries, and other operations that users can attempt
      to perform. There is also support for SSL-encrypted connections
      between MySQL clients and servers. Many of the concepts discussed
      here are not specific to MySQL at all; the same general ideas
      apply to almost all applications.
    </p><p>
      When running MySQL, follow these guidelines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>Do not ever give anyone (except MySQL
          <code class="literal">root</code> accounts) access to the
          <code class="literal">user</code> table in the <code class="literal">mysql</code>
          database!</strong></span> This is critical.
        </p></li><li class="listitem"><p>
          Learn how the MySQL access privilege system works (see
          <a class="xref" href="security.html#privilege-system" title="6.2 The MySQL Access Privilege System">Section 6.2, “The MySQL Access Privilege System”</a>). Use the
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements to control
          access to MySQL. Do not grant more privileges than necessary.
          Never grant privileges to all hosts.
        </p><p>
          Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Try <code class="literal">mysql -u root</code>. If you are able to
              connect successfully to the server without being asked for
              a password, anyone can connect to your MySQL server as the
              MySQL <code class="literal">root</code> user with full privileges!
              Review the MySQL installation instructions, paying
              particular attention to the information about setting a
              <code class="literal">root</code> password. See
              <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Accounts">Section 2.10.4, “Securing the Initial MySQL Accounts”</a>.
            </p></li><li class="listitem"><p>
              Use the <a class="link" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
              statement to check which accounts have access to what.
              Then use the <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a>
              statement to remove those privileges that are not
              necessary.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Do not store cleartext passwords in your database. If your
          computer becomes compromised, the intruder can take the full
          list of passwords and use them. Instead, use
          <a class="link" href="functions.html#function_sha2"><code class="literal">SHA2()</code></a>,
          <a class="link" href="functions.html#function_sha1"><code class="literal">SHA1()</code></a>,
          <a class="link" href="functions.html#function_md5"><code class="literal">MD5()</code></a>, or some other one-way
          hashing function and store the hash value.
        </p><p>
          To prevent password recovery using rainbow tables, do not use
          these functions on a plain password; instead, choose some
          string to be used as a salt, and use hash(hash(password)+salt)
          values.
        </p></li><li class="listitem"><p>
          Do not choose passwords from dictionaries. Special programs
          exist to break passwords. Even passwords like
          <span class="quote">“<span class="quote">xfish98</span>”</span> are very bad. Much better is
          <span class="quote">“<span class="quote">duag98</span>”</span> which contains the same word
          <span class="quote">“<span class="quote">fish</span>”</span> but typed one key to the left on a
          standard QWERTY keyboard. Another method is to use a password
          that is taken from the first characters of each word in a
          sentence (for example, <span class="quote">“<span class="quote">Four score and seven years
          ago</span>”</span> results in a password of <span class="quote">“<span class="quote">Fsasya</span>”</span>).
          The password is easy to remember and type, but difficult to
          guess for someone who does not know the sentence. In this
          case, you can additionally substitute digits for the number
          words to obtain the phrase <span class="quote">“<span class="quote">4 score and 7 years
          ago</span>”</span>, yielding the password <span class="quote">“<span class="quote">4sa7ya</span>”</span> which
          is even more difficult to guess.
        </p></li><li class="listitem"><p>
          Invest in a firewall. This protects you from at least 50% of
          all types of exploits in any software. Put MySQL behind the
          firewall or in a demilitarized zone (DMZ).
        </p><p>
          Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Try to scan your ports from the Internet using a tool such
              as <code class="literal">nmap</code>. MySQL uses port 3306 by
              default. This port should not be accessible from untrusted
              hosts. As a simple way to check whether your MySQL port is
              open, try the following command from some remote machine,
              where <em class="replaceable"><code>server_host</code></em> is the host
              name or IP address of the host on which your MySQL server
              runs:
            </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>telnet <em class="replaceable"><code>server_host</code></em> 3306</code></strong>
</pre><p>
              If <span class="command"><strong>telnet</strong></span> hangs or the connection is
              refused, the port is blocked, which is how you want it to
              be. If you get a connection and some garbage characters,
              the port is open, and should be closed on your firewall or
              router, unless you really have a good reason to keep it
              open.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Applications that access MySQL should not trust any data
          entered by users, and should be written using proper defensive
          programming techniques. See
          <a class="xref" href="security.html#secure-client-programming" title="6.1.7 Client Programming Security Guidelines">Section 6.1.7, “Client Programming Security Guidelines”</a>.
        </p></li><li class="listitem"><p>
          Do not transmit plain (unencrypted) data over the Internet.
          This information is accessible to everyone who has the time
          and ability to intercept it and use it for their own purposes.
          Instead, use an encrypted protocol such as SSL or SSH. MySQL
          supports internal SSL connections. Another technique is to use
          SSH port-forwarding to create an encrypted (and compressed)
          tunnel for the communication.
        </p></li><li class="listitem"><p>
          Learn to use the <span class="command"><strong>tcpdump</strong></span> and
          <span class="command"><strong>strings</strong></span> utilities. In most cases, you can
          check whether MySQL data streams are unencrypted by issuing a
          command like the following:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>tcpdump -l -i eth0 -w - src or dst port 3306 | strings</code></strong>
</pre><p>
          This works under Linux and should work with small
          modifications under other systems.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            If you do not see cleartext data, this does not always mean
            that the information actually is encrypted. If you need high
            security, consult with a security expert.
</p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-security"></a>6.1.2 Keeping Passwords Secure</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#password-security-user">6.1.2.1 End-User Guidelines for Password Security</a></span></dt><dt><span class="section"><a href="security.html#password-security-admin">6.1.2.2 Administrator Guidelines for Password Security</a></span></dt><dt><span class="section"><a href="security.html#password-logging">6.1.2.3 Passwords and Logging</a></span></dt><dt><span class="section"><a href="security.html#password-hashing">6.1.2.4 Password Hashing in MySQL</a></span></dt><dt><span class="section"><a href="security.html#application-password-use">6.1.2.5 Implications of Password Hashing Changes in MySQL 4.1 for Application
Programs</a></span></dt><dt><span class="section"><a href="security.html#validate-password-plugin">6.1.2.6 The Password Validation Plugin</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737187921744"></a><p>
      Passwords occur in several contexts within MySQL. The following
      sections provide guidelines that enable end users and
      administrators to keep these passwords secure and avoid exposing
      them. There is also a discussion of how MySQL uses password
      hashing internally and of a plugin that you can use to enforce
      stricter passwords.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-user"></a>6.1.2.1 End-User Guidelines for Password Security</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm139737187918352"></a><p>
        MySQL users should use the following guidelines to keep
        passwords secure.
      </p><p>
        When you run a client program to connect to the MySQL server, it
        is inadvisable to specify your password in a way that exposes it
        to discovery by other users. The methods you can use to specify
        your password when you run client programs are listed here,
        along with an assessment of the risks of each method. In short,
        the safest methods are to have the client program prompt for the
        password or to specify the password in a properly protected
        option file.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Use the <a class="link" href="programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor — MySQL Configuration Utility"><span class="command"><strong>mysql_config_editor</strong></span></a> utility,
            which enables you to store authentication credentials in an
            encrypted login path file named
            <code class="filename">.mylogin.cnf</code>. The file can be read
            later by MySQL client programs to obtain authentication
            credentials for connecting to MySQL Server. See
            <a class="xref" href="programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor — MySQL Configuration Utility">Section 4.6.6, “<span class="command"><strong>mysql_config_editor</strong></span> — MySQL Configuration Utility”</a>.
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm139737187911008"></a>

            <a class="indexterm" name="idm139737187909936"></a>

            Use a
            <code class="option">-p<em class="replaceable"><code>your_pass</code></em></code> or
            <code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code>
            option on the command line. For example:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -pfrank <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
            This is convenient <span class="emphasis"><em>but insecure</em></span>. On
            some systems, your password becomes visible to system status
            programs such as <span class="command"><strong>ps</strong></span> that may be invoked
            by other users to display command lines. MySQL clients
            typically overwrite the command-line password argument with
            zeros during their initialization sequence. However, there
            is still a brief interval during which the value is visible.
            Also, on some systems this overwriting strategy is
            ineffective and the password remains visible to
            <span class="command"><strong>ps</strong></span>. (SystemV Unix systems and perhaps
            others are subject to this problem.)
          </p><p>
            If your operating environment is set up to display your
            current command in the title bar of your terminal window,
            the password remains visible as long as the command is
            running, even if the command has scrolled out of view in the
            window content area.
          </p></li><li class="listitem"><p>
            Use the <code class="option">-p</code> or <code class="option">--password</code>
            option on the command line with no password value specified.
            In this case, the client program solicits the password
            interactively:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -p <em class="replaceable"><code>db_name</code></em></code></strong>
Enter password: ********
</pre><p>
            The <span class="quote">“<span class="quote"><code class="literal">*</code></span>”</span> characters indicate
            where you enter your password. The password is not displayed
            as you enter it.
          </p><p>
            It is more secure to enter your password this way than to
            specify it on the command line because it is not visible to
            other users. However, this method of entering a password is
            suitable only for programs that you run interactively. If
            you want to invoke a client from a script that runs
            noninteractively, there is no opportunity to enter the
            password from the keyboard. On some systems, you may even
            find that the first line of your script is read and
            interpreted (incorrectly) as your password.
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm139737187895408"></a>

            Store your password in an option file. For example, on Unix,
            you can list your password in the
            <code class="literal">[client]</code> section of the
            <code class="filename">.my.cnf</code> file in your home directory:
          </p><pre class="programlisting">
[client]
password=your_pass
</pre><p>
            To keep the password safe, the file should not be accessible
            to anyone but yourself. To ensure this, set the file access
            mode to <code class="literal">400</code> or <code class="literal">600</code>.
            For example:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>chmod 600 .my.cnf</code></strong>
</pre><p>
            To name from the command line a specific option file
            containing the password, use the
            <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file=<em class="replaceable"><code>file_name</code></em></code></a>
            option, where <code class="filename">file_name</code> is the full
            path name to the file. For example:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --defaults-file=/home/francis/mysql-opts</code></strong>
</pre><p>
            <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>, discusses option files in
            more detail.
          </p></li><li class="listitem"><p>
            Store your password in the <code class="literal">MYSQL_PWD</code>
            environment variable. See
            <a class="xref" href="installing.html#environment-variables" title="2.12 Environment Variables">Section 2.12, “Environment Variables”</a>.
          </p><p>
            This method of specifying your MySQL password must be
            considered <span class="emphasis"><em>extremely insecure</em></span> and
            should not be used. Some versions of <span class="command"><strong>ps</strong></span>
            include an option to display the environment of running
            processes. On some systems, if you set
            <code class="literal">MYSQL_PWD</code>, your password is exposed to
            any other user who runs <span class="command"><strong>ps</strong></span>. Even on
            systems without such a version of <span class="command"><strong>ps</strong></span>, it
            is unwise to assume that there are no other methods by which
            users can examine process environments.
</p></li></ul>
</div>
<a class="indexterm" name="idm139737187876832"></a><p>
        On Unix, the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client writes a record of
        executed statements to a history file (see
        <a class="xref" href="programs.html#mysql-logging" title="4.5.1.3 mysql Logging">Section 4.5.1.3, “mysql Logging”</a>). By default, this file is named
        <code class="filename">.mysql_history</code> and is created in your home
        directory. Passwords can be written as plain text in SQL
        statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
        <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>, so if you use these
        statements, they are logged in the history file. To keep this
        file safe, use a restrictive access mode, the same way as
        described earlier for the <code class="filename">.my.cnf</code> file.
      </p><p>
        If your command interpreter is configured to maintain a history,
        any file in which the commands are saved will contain MySQL
        passwords entered on the command line. For example,
        <span class="command"><strong>bash</strong></span> uses
        <code class="filename">~/.bash_history</code>. Any such file should have
        a restrictive access mode.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-admin"></a>6.1.2.2 Administrator Guidelines for Password Security</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187864528"></a><p>
        Database administrators should use the following guidelines to
        keep passwords secure.
      </p><p>
        MySQL stores passwords for user accounts in the
        <code class="literal">mysql.user</code> table. Access to this table should
        never be granted to any nonadministrative accounts.
      </p><p>
        Account passwords can be expired so that users must reset them.
        See <a class="xref" href="security.html#password-expiration-sandbox-mode" title="6.3.6 Password Expiration and Sandbox Mode">Section 6.3.6, “Password Expiration and Sandbox Mode”</a>.
      </p><p>
        The <code class="literal">validate_password</code> plugin can be used to
        enforce a policy on acceptable password. See
        <a class="xref" href="security.html#validate-password-plugin" title="6.1.2.6 The Password Validation Plugin">Section 6.1.2.6, “The Password Validation Plugin”</a>.
      </p><p>
        A user who has access to modify the plugin directory (the value
        of the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable) or the <code class="filename">my.cnf</code> file that specifies
        the location of the plugin directory can replace plugins and
        modify the capabilities provided by plugins, including
        authentication plugins.
      </p><p>
        Files such as log files to which passwords might be written
        should be protected. See <a class="xref" href="security.html#password-logging" title="6.1.2.3 Passwords and Logging">Section 6.1.2.3, “Passwords and Logging”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-logging"></a>6.1.2.3 Passwords and Logging</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187853216"></a><a class="indexterm" name="idm139737187851728"></a><p>
        Passwords can be written as plain text in SQL statements such as
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
        PASSWORD</code></a>, and statements that invoke the
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function. If such
        statements are logged by the MySQL server as written, passwords
        in them become visible to anyone with access to the logs.
      </p><p>
        Beginning with MySQL 5.6.3, statement logging is modified to
        avoid writing passwords in cleartext for the following
        statements:
      </p><pre class="programlisting">
CREATE USER ... IDENTIFIED BY ...
GRANT ... IDENTIFIED BY ...
SET PASSWORD ...
SLAVE START ... PASSWORD = ...              (as of 5.6.4)
CREATE SERVER ... OPTIONS(... PASSWORD ...) (as of 5.6.9)
ALTER SERVER ... OPTIONS(... PASSWORD ...)  (as of 5.6.9)
</pre><p>
        Passwords in those statements are rewritten to not appear
        literally in statement text written to the general query log,
        slow query log, and binary log. Rewriting does not apply to
        other statements. In particular,
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements for the
        <code class="literal">mysql.user</code> table that refer to literal
        passwords are logged as is, so you should avoid such statements.
        (Direct manipulation of grant tables is discouraged, anyway.)
      </p><p>
        For the general query log, password rewriting can be suppressed
        by starting the server with the
        <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a> option. For security
        reasons, this option is not recommended for production use. For
        diagnostic purposes, it may be useful to see the exact text of
        statements as received by the server.
      </p><p>
        Contents of the audit log file produced by the audit log plugin
        are not encrypted. For security reasons, this file should be
        written to a directory accessible only to the MySQL server and
        users with a legitimate reason to view the log. See
        <a class="xref" href="security.html#audit-log-security" title="6.3.13.2 Audit Log Plugin Security Considerations">Section 6.3.13.2, “Audit Log Plugin Security Considerations”</a>.
      </p><p>
        To guard log files against unwarranted exposure, locate them in
        a directory that restricts access to the server and the database
        administrator. If the server logs to tables in the
        <code class="literal">mysql</code> database, grant access to those tables
        only to the database administrator.
      </p><p>
        Replication slaves store the password for the replication master
        in the master info repository, which can be either a file or a
        table (see <a class="xref" href="replication.html#slave-logs" title="17.2.2 Replication Relay and Status Logs">Section 17.2.2, “Replication Relay and Status Logs”</a>). Ensure that the
        repository can be accessed only by the database administrator.
        As of MySQL 5.6.4, an alternative to storing the password in a
        file is to use the <a class="link" href="sql-syntax.html#start-slave" title="13.4.2.5 START SLAVE Syntax"><code class="literal">START SLAVE</code></a>
        statement to specify credentials for connecting to the master.
      </p><p>
        Use a restricted access mode to protect database backups that
        include log tables or log files containing passwords.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-hashing"></a>6.1.2.4 Password Hashing in MySQL</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187830016"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The information in this section applies only for accounts that
          use the <code class="literal">mysql_native_password</code> or
          <code class="literal">mysql_old_password</code> authentication plugins.
</p>
</div>
<p>
        MySQL lists user accounts in the <code class="literal">user</code> table
        of the <code class="literal">mysql</code> database. Each MySQL account can
        be assigned a password, although the <code class="literal">user</code>
        table does not store the cleartext version of the password, but
        a hash value computed from it.
      </p><p>
        MySQL uses passwords in two phases of client/server
        communication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When a client attempts to connect to the server, there is an
            initial authentication step in which the client must present
            a password that has a hash value matching the hash value
            stored in the <code class="literal">user</code> table for the account
            the client wants to use.
          </p></li><li class="listitem"><p>
            After the client connects, it can (if it has sufficient
            privileges) set or change the password hash for accounts
            listed in the <code class="literal">user</code> table. The client can
            do this by using the
            <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function to
            generate a password hash, or by using a password-generating
            statement (<a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, or
            <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>).
</p></li></ul>
</div>
<p>
        In other words, the server <span class="emphasis"><em>checks</em></span> hash
        values during authentication when a client first attempts to
        connect. The server <span class="emphasis"><em>generates</em></span> hash values
        if a connected client invokes the
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function or uses a
        password-generating statement to set or change a password.
      </p><p>
        Password hashing methods in MySQL have the history described
        following. These changes are illustrated by changes in the
        result from the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
        function that computes password hash values and in the structure
        of the <code class="literal">user</code> table where passwords are stored.
</p>
<h5><a name="idm139737187808656"></a>The Original (Pre-4.1) Hashing Method</h5>
<p>
        The original hashing method produced a 16-byte string. Such
        hashes look like this:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong>
+--------------------+
| PASSWORD('mypass') |
+--------------------+
| 6f8c114b58f2ce9e   |
+--------------------+
</pre><p>
        To store account passwords, the <code class="literal">Password</code>
        column of the <code class="literal">user</code> table was at this point 16
        bytes long.
</p>
<h5><a name="idm139737187803984"></a>The 4.1 Hashing Method</h5>
<p>
        MySQL 4.1 introduced password hashing that provided better
        security and reduced the risk of passwords being intercepted.
        There were several aspects to this change:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Different format of password values produced by the
            <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function
          </p></li><li class="listitem"><p>
            Widening of the <code class="literal">Password</code> column
          </p></li><li class="listitem"><p>
            Control over the default hashing method
          </p></li><li class="listitem"><p>
            Control over the permitted hashing methods for clients
            attempting to connect to the server
</p></li></ul>
</div>
<p>
        The changes in MySQL 4.1 took place in two stages:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL 4.1.0 used a preliminary version of the 4.1 hashing
            method. This method was short lived and the following
            discussion says nothing more about it.
          </p></li><li class="listitem"><p>
            In MySQL 4.1.1, the hashing method was modified to produce a
            longer 41-byte hash value:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PASSWORD('mypass');</code></strong>
+-------------------------------------------+
| PASSWORD('mypass')                        |
+-------------------------------------------+
| *6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4 |
+-------------------------------------------+
</pre><p>
            The longer password hash format has better cryptographic
            properties, and client authentication based on long hashes
            is more secure than that based on the older short hashes.
          </p><p>
            To accommodate longer password hashes, the
            <code class="literal">Password</code> column in the
            <code class="literal">user</code> table was changed at this point to
            be 41 bytes, its current length.
          </p><p>
            A widened <code class="literal">Password</code> column can store
            password hashes in both the pre-4.1 and 4.1 formats. The
            format of any given hash value can be determined two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                The length: 4.1 and pre-4.1 hashes are 41 and 16 bytes,
                respectively.
              </p></li><li class="listitem"><p>
                Password hashes in the 4.1 format always begin with a
                <span class="quote">“<span class="quote"><code class="literal">*</code></span>”</span> character, whereas
                passwords in the pre-4.1 format never do.
</p></li></ul>
</div>
<p>
            To permit explicit generation of pre-4.1 password hashes,
            two additional changes were made:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                The <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a>
                function was added, which returns hash values in the
                16-byte format.
              </p></li><li class="listitem"><p>
                For compatibility purposes, the
                <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system
                variable was added, to enable DBAs and applications
                control over the hashing method. The default
                <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> value of
                0 causes hashing to use the 4.1 method (41-byte hash
                values), but setting
                <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a> causes
                hashing to use the pre-4.1 method. In this case,
                <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> produces
                16-byte values and is equivalent to
                <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a>
</p></li></ul>
</div>
<p>
            To permit DBAs control over how clients are permitted to
            connect, the <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a>
            system variable was added. Starting the server with this
            variable disabled or enabled permits or prohibits clients to
            connect using the older pre-4.1 password hashing method.
            Before MySQL 5.6.5,
            <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a> is disabled by
            default. As of 5.6.5,
            <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a> is enabled by
            default to promote a more secure default configuration DBAs
            can disable it at their discretion, but this is not
            recommended, and pre-4.1 password hashes are deprecated and
            should be avoided. (For account upgrade instructions, see
            <a class="xref" href="security.html#account-upgrades" title="6.3.8.3 Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password Plugin">Section 6.3.8.3, “Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password
        Plugin”</a>.)
          </p><p>
            In addition, the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client supports a
            <a class="link" href="programs.html#option_mysql_secure-auth"><code class="option">--secure-auth</code></a> option that is
            analogous to <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth</code></a>,
            but from the client side. It can be used to prevent
            connections to less secure accounts that use pre-4.1
            password hashing. This option is disabled by default before
            MySQL 5.6.7, enabled thereafter.
</p></li></ul>
</div>
<h5><a name="idm139737187765568"></a>Compatibility Issues Related to Hashing Methods</h5>
<p>
        The widening of the <code class="literal">Password</code> column in MySQL
        4.1 from 16 bytes to 41 bytes affects installation or upgrade
        operations as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you perform a new installation of MySQL, the
            <code class="literal">Password</code> column is made 41 bytes long
            automatically.
          </p></li><li class="listitem"><p>
            Upgrades from MySQL 4.1 or later to current versions of
            MySQL should not give rise to any issues in regard to the
            <code class="literal">Password</code> column because both versions use
            the same column length and password hashing method.
          </p></li><li class="listitem"><p>
            For upgrades from a pre-4.1 release to 4.1 or later, you
            must upgrade the system tables after upgrading. (See
            <a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables">Section 4.4.7, “<span class="command"><strong>mysql_upgrade</strong></span> — Check and Upgrade MySQL Tables”</a>.)
</p></li></ul>
</div>
<p>
        The 4.1 hashing method is understood only by MySQL 4.1 (and
        newer) servers and clients, which can result in some
        compatibility problems. A 4.1 or newer client can connect to a
        pre-4.1 server, because the client understands both the pre-4.1
        and 4.1 password hashing methods. However, a pre-4.1 client that
        attempts to connect to a 4.1 or newer server may run into
        difficulties. For example, a 4.0 <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client
        may fail with the following error message:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -h localhost -u root</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre><p>
        This phenomenon also occurs for attempts to use the older PHP
        <code class="literal">mysql</code> extension after upgrading to MySQL 4.1
        or newer. (See <a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-problems.html" target="_top">Common Problems with MySQL and PHP</a>.)
      </p><p>
        The following discussion describes the differences between the
        pre-4.1 and 4.1 hashing methods, and what you should do if you
        upgrade your server but need to maintain backward compatibility
        with pre-4.1 clients. (However, permitting connections by old
        clients is not recommended and should be avoided if possible.)
        Additional information can be found in
        <a class="xref" href="error-handling.html#old-client" title="B.5.2.4 Client does not support authentication protocol">Section B.5.2.4, “Client does not support authentication protocol”</a>. This information is of particular
        importance to PHP programmers migrating MySQL databases from
        versions older than 4.1 to 4.1 or higher.
      </p><p>
        The differences between short and long password hashes are
        relevant both for how the server uses passwords during
        authentication and for how it generates password hashes for
        connected clients that perform password-changing operations.
      </p><p>
        The way in which the server uses password hashes during
        authentication is affected by the width of the
        <code class="literal">Password</code> column:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If the column is short, only short-hash authentication is
            used.
          </p></li><li class="listitem"><p>
            If the column is long, it can hold either short or long
            hashes, and the server can use either format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Pre-4.1 clients can connect, but because they know only
                about the pre-4.1 hashing method, they can authenticate
                only using accounts that have short hashes.
              </p></li><li class="listitem"><p>
                4.1 and later clients can authenticate using accounts
                that have short or long hashes.
</p></li></ul>
</div>
</li></ul>
</div>
<p>
        Even for short-hash accounts, the authentication process is
        actually a bit more secure for 4.1 and later clients than for
        older clients. In terms of security, the gradient from least to
        most secure is:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Pre-4.1 client authenticating with short password hash
          </p></li><li class="listitem"><p>
            4.1 or later client authenticating with short password hash
          </p></li><li class="listitem"><p>
            4.1 or later client authenticating with long password hash
</p></li></ul>
</div>
<p>
        The way in which the server generates password hashes for
        connected clients is affected by the width of the
        <code class="literal">Password</code> column and by the
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system variable.
        A 4.1 or later server generates long hashes only if certain
        conditions are met: The <code class="literal">Password</code> column must
        be wide enough to hold long values and
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> must not be set
        to 1.
      </p><p>
        Those conditions apply as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">Password</code> column must be wide enough
            to hold long hashes (41 bytes). If the column has not been
            updated and still has the pre-4.1 width of 16 bytes, the
            server notices that long hashes cannot fit into it and
            generates only short hashes when a client performs
            password-changing operations using the
            <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function or a
            password-generating statement. This is the behavior that
            occurs if you have upgraded from a version of MySQL older
            than 4.1 to 4.1 or later but have not yet run the
            <a class="link" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a> program to widen the
            <code class="literal">Password</code> column.
          </p></li><li class="listitem"><p>
            If the <code class="literal">Password</code> column is wide, it can
            store either short or long password hashes. In this case,
            the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function and
            password-generating statements generate long hashes unless
            the server was started with the
            <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system
            variable set to 1 to force the server to generate short
            password hashes instead.
</p></li></ul>
</div>
<p>
        The purpose of the
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system variable
        is to permit backward compatibility with pre-4.1 clients under
        circumstances where the server would otherwise generate long
        password hashes. The option does not affect authentication (4.1
        and later clients can still use accounts that have long password
        hashes), but it does prevent creation of a long password hash in
        the <code class="literal">user</code> table as the result of a
        password-changing operation. Were that permitted to occur, the
        account could no longer be used by pre-4.1 clients. With
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> disabled, the
        following undesirable scenario is possible:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            An old pre-4.1 client connects to an account that has a
            short password hash.
          </p></li><li class="listitem"><p>
            The client changes its own password. With
            <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> disabled,
            this results in the account having a long password hash.
          </p></li><li class="listitem"><p>
            The next time the old client attempts to connect to the
            account, it cannot, because the account has a long password
            hash that requires the 4.1 hashing method during
            authentication. (Once an account has a long password hash in
            the user table, only 4.1 and later clients can authenticate
            for it because pre-4.1 clients do not understand long
            hashes.)
</p></li></ul>
</div>
<p>
        This scenario illustrates that, if you must support older
        pre-4.1 clients, it is problematic to run a 4.1 or newer server
        without <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> set to 1.
        By running the server with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>,
        password-changing operations do not generate long password
        hashes and thus do not cause accounts to become inaccessible to
        older clients. (Those clients cannot inadvertently lock
        themselves out by changing their password and ending up with a
        long password hash.)
      </p><p>
        The downside of <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>
        is that any passwords created or changed use short hashes, even
        for 4.1 or later clients. Thus, you lose the additional security
        provided by long password hashes. To create an account that has
        a long hash (for example, for use by 4.1 clients) or to change
        an existing account to use a long password hash, an
        administrator can set the session value of
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> set to 0 while
        leaving the global value set to 1:
      </p><pre class="programlisting">

mysql&gt; <strong class="userinput"><code>SET @@session.old_passwords = 0;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT @@session.old_passwords, @@global.old_passwords;</code></strong>
+-------------------------+------------------------+
| @@session.old_passwords | @@global.old_passwords |
+-------------------------+------------------------+
|                       0 |                      1 |
+-------------------------+------------------------+
1 row in set (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'newpass';</code></strong>
Query OK, 0 rows affected (0.03 sec)

mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR 'existinguser'@'localhost' = PASSWORD('existingpass');</code></strong>
Query OK, 0 rows affected (0.00 sec)
</pre><p>
        The following scenarios are possible in MySQL 4.1 or later. The
        factors are whether the <code class="literal">Password</code> column is
        short or long, and, if long, whether the server is started with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> enabled or
        disabled.
      </p><p>
        <span class="bold"><strong>Scenario 1:</strong></span> Short
        <code class="literal">Password</code> column in user table:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Only short hashes can be stored in the
            <code class="literal">Password</code> column.
          </p></li><li class="listitem"><p>
            The server uses only short hashes during client
            authentication.
          </p></li><li class="listitem"><p>
            For connected clients, password hash-generating operations
            involving the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
            function or password-generating statements use short hashes
            exclusively. Any change to an account's password results in
            that account having a short password hash.
          </p></li><li class="listitem"><p>
            The value of <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a>
            is irrelevant because with a short
            <code class="literal">Password</code> column, the server generates
            only short password hashes anyway.
</p></li></ul>
</div>
<p>
        This scenario occurs when a pre-4.1 MySQL installation has been
        upgraded to 4.1 or later but <a class="link" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a>
        has not been run to upgrade the system tables in the
        <code class="literal">mysql</code> database. (This is not a recommended
        configuration because it does not permit use of more secure 4.1
        password hashing.)
      </p><p>
        <span class="bold"><strong>Scenario 2:</strong></span> Long
        <code class="literal">Password</code> column; server started with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Short or long hashes can be stored in the
            <code class="literal">Password</code> column.
          </p></li><li class="listitem"><p>
            4.1 and later clients can authenticate for accounts that
            have short or long hashes.
          </p></li><li class="listitem"><p>
            Pre-4.1 clients can authenticate only for accounts that have
            short hashes.
          </p></li><li class="listitem"><p>
            For connected clients, password hash-generating operations
            involving the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
            function or password-generating statements use short hashes
            exclusively. Any change to an account's password results in
            that account having a short password hash.
</p></li></ul>
</div>
<p>
        In this scenario, newly created accounts have short password
        hashes because <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>
        prevents generation of long hashes. Also, if you create an
        account with a long hash before setting
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> to 1, changing
        the account's password while
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a> results in the
        account being given a short password, causing it to lose the
        security benefits of a longer hash.
      </p><p>
        To create a new account that has a long password hash, or to
        change the password of any existing account to use a long hash,
        first set the session value of
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> set to 0 while
        leaving the global value set to 1, as described previously.
      </p><p>
        In this scenario, the server has an up to date
        <code class="literal">Password</code> column, but is running with the
        default password hashing method set to generate pre-4.1 hash
        values. This is not a recommended configuration but may be
        useful during a transitional period in which pre-4.1 clients and
        passwords are upgraded to 4.1 or later. When that has been done,
        it is preferable to run the server with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a> and
        <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=1</code></a>.
      </p><p>
        <span class="bold"><strong>Scenario 3:</strong></span> Long
        <code class="literal">Password</code> column; server started with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Short or long hashes can be stored in the
            <code class="literal">Password</code> column.
          </p></li><li class="listitem"><p>
            4.1 and later clients can authenticate using accounts that
            have short or long hashes.
          </p></li><li class="listitem"><p>
            Pre-4.1 clients can authenticate only using accounts that
            have short hashes.
          </p></li><li class="listitem"><p>
            For connected clients, password hash-generating operations
            involving the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
            function or password-generating statements use long hashes
            exclusively. A change to an account's password results in
            that account having a long password hash.
</p></li></ul>
</div>
<p>
        As indicated earlier, a danger in this scenario is that it is
        possible for accounts that have a short password hash to become
        inaccessible to pre-4.1 clients. A change to such an account's
        password made using the
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function or a
        password-generating statement results in the account being given
        a long password hash. From that point on, no pre-4.1 client can
        connect to the server using that account. The client must
        upgrade to 4.1 or later.
      </p><p>
        If this is a problem, you can change a password in a special
        way. For example, normally you use <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
        PASSWORD</code></a> as follows to change an account password:
      </p><pre class="programlisting">
SET PASSWORD FOR '<em class="replaceable"><code>some_user</code></em>'@'<em class="replaceable"><code>some_host</code></em>' = PASSWORD('mypass');
</pre><p>
        To change the password but create a short hash, use the
        <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a> function instead:
      </p><pre class="programlisting">
SET PASSWORD FOR '<em class="replaceable"><code>some_user</code></em>'@'<em class="replaceable"><code>some_host</code></em>' = OLD_PASSWORD('mypass');
</pre><p>
        <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a> is useful for
        situations in which you explicitly want to generate a short
        hash.
      </p><p>
        The disadvantages for each of the preceding scenarios may be
        summarized as follows:
      </p><p>
        In scenario 1, you cannot take advantage of longer hashes that
        provide more secure authentication.
      </p><p>
        In scenario 2, <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>
        prevents accounts with short hashes from becoming inaccessible,
        but password-changing operations cause accounts with long hashes
        to revert to short hashes unless you take care to change the
        session value of <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a>
        to 0 first.
      </p><p>
        In scenario 3, accounts with short hashes become inaccessible to
        pre-4.1 clients if you change their passwords without explicitly
        using <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a>.
      </p><p>
        The best way to avoid compatibility problems related to short
        password hashes is to not use them:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Upgrade all client programs to MySQL 4.1 or later.
          </p></li><li class="listitem"><p>
            Run the server with
            <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=0</code></a>.
          </p></li><li class="listitem"><p>
            Reset the password for any account with a short password
            hash to use a long password hash.
          </p></li><li class="listitem"><p>
            For additional security, run the server with
            <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=1</code></a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="application-password-use"></a>6.1.2.5 Implications of Password Hashing Changes in MySQL 4.1 for Application
Programs</h4>
</div>
</div>
</div>
<p>
        An upgrade to MySQL version 4.1 or later can cause compatibility
        issues for applications that use
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> to generate passwords
        for their own purposes. Applications really should not do this,
        because <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> should be used
        only to manage passwords for MySQL accounts. But some
        applications use <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> for
        their own purposes anyway.
      </p><p>
        If you upgrade to 4.1 or later from a pre-4.1 version of MySQL
        and run the server under conditions where it generates long
        password hashes, an application using
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> for its own passwords
        breaks. The recommended course of action in such cases is to
        modify the application to use another function, such as
        <a class="link" href="functions.html#function_sha2"><code class="literal">SHA2()</code></a>,
        <a class="link" href="functions.html#function_sha1"><code class="literal">SHA1()</code></a>, or
        <a class="link" href="functions.html#function_md5"><code class="literal">MD5()</code></a>, to produce hashed values.
        If that is not possible, you can use the
        <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a> function, which is
        provided for generate short hashes in the old format. However,
        you should note that
        <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a> may one day no
        longer be supported.
      </p><p>
        If the server is running with
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords=1</code></a>, it generates
        short hashes and <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a>
        is equivalent to <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>.
      </p><p>
        PHP programmers migrating their MySQL databases from version 4.0
        or lower to version 4.1 or higher should see
        <a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/index.html" target="_top">MySQL and PHP</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-plugin"></a>6.1.2.6 The Password Validation Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187617936"></a><a class="indexterm" name="idm139737187616848"></a><p>
        The <code class="literal">validate_password</code> plugin (available as of
        MySQL 5.6.6) can be used to test passwords and improve security.
        This plugin implements two capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In statements that assign a password supplied as a cleartext
            value, the value is checked against the current password
            policy and rejected if it is weak (the statement returns an
            <a class="link" href="error-handling.html#error_er_not_valid_password"><code class="literal">ER_NOT_VALID_PASSWORD</code></a>
            error). This affects the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE
            USER</code></a>, <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
            <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements.
            Passwords given as arguments to the
            <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> and
            <a class="link" href="functions.html#function_old-password"><code class="literal">OLD_PASSWORD()</code></a> functions are
            checked as well.
          </p></li><li class="listitem"><p>
            The strength of potential passwords can be assessed using
            the
            <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
            SQL function, which takes a password argument and returns an
            integer from 0 (weak) to 100 (strong).
</p></li></ul>
</div>
<p>
        For example, the cleartext password in the following statement
        is checked. Under the default password policy, which requires
        passwords to be at least 8 characters long, the password is weak
        and the statement produces an error:
      </p><a class="indexterm" name="idm139737187602656"></a><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = PASSWORD('abc');</code></strong>
ERROR 1819 (HY000): Your password does not satisfy the current policy
requirements
</pre><p>
        Passwords specified as already hashed values are not checked
        because the original password value is not available:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = '*0D3CED9BEC10A777AEC23CCC353A8C08A633045E';</code></strong>
Query OK, 0 rows affected (0.01 sec)
</pre><p>
        The parameters that control password checking are available as
        the values of the system variables having names of the form
        <code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code>.
        These variables can be modified to configure password checking;
        see <a class="xref" href="security.html#validate-password-options-variables" title="6.1.2.6.2 Password Validation Plugin Options and Variables">Section 6.1.2.6.2, “Password Validation Plugin Options and Variables”</a>.
      </p><p>
        The three levels of password checking are
        <code class="literal">LOW</code>, <code class="literal">MEDIUM</code>, and
        <code class="literal">STRONG</code>. The default is
        <code class="literal">MEDIUM</code>; to change this, modify the value of
        <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>. The
        policies implement increasingly strict password tests. The
        following descriptions refer to default parameter values; these
        can be modified by changing the appropriate system variables.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LOW</code> policy tests password length only.
            Passwords must be at least 8 characters long.
          </p></li><li class="listitem"><p>
            <code class="literal">MEDIUM</code> policy adds the conditions that
            passwords must contain at least 1 numeric character, 1
            lowercase and uppercase character, and 1 special
            (nonalphanumeric) character.
          </p></li><li class="listitem"><p>
            <code class="literal">STRONG</code> policy adds the condition that
            password substrings of length 4 or longer must not match
            words in the dictionary file, if one has been specified.
</p></li></ul>
</div>
<p>
        If the <code class="literal">validate_password</code> plugin is not
        installed, the
        <code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code>
        system variables are not available, passwords in statements are
        not checked, and
        <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
        always returns 0. For example, accounts can be assigned
        passwords shorter than 8 characters.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="validate-password-plugin-installation"></a>6.1.2.6.1 Password Validation Plugin Installation</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm139737187580384"></a><p>
          The password-validation plugin is named
          <code class="literal">validate_password</code>. To be usable by the
          server, the plugin library object file must be located in the
          MySQL plugin directory (the directory named by the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable).
          If necessary, set the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup
          to tell the server the location of the plugin directory.
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option to name
          the object file that contains the plugin. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in your
          <code class="filename">my.cnf</code> file:
        </p><pre class="programlisting">
[mysqld]
plugin-load=validate_password.so
</pre><p>
          If object files have a suffix different from
          <code class="filename">.so</code> on your system, substitute the
          correct suffix (for example, <code class="filename">.dll</code> on
          Windows).
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement (changing the extension as necessary):
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN validate_password SONAME 'validate_password.so';</code></strong>
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the
          plugin, and also registers it in the
          <code class="literal">mysql.plugins</code> table to cause the plugin to
          be loaded for each subsequent normal server startup.
        </p><p>
          If the plugin has been previously registered with
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> or is loaded
          with <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a>, you can use
          the <code class="option">--validate-password</code> option at server
          startup to control plugin activation. For example, to load the
          plugin at startup and prevent it from being removed at
          runtime, use these options:
        </p><pre class="programlisting">
[mysqld]
plugin-load=validate_password.so
validate-password=FORCE_PLUS_PERMANENT
</pre><p>
          If it is desired to prevent the server from running without
          the password-validation plugin, use
          <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password</code></a> with a
          value of <code class="literal">FORCE</code> or
          <code class="literal">FORCE_PLUS_PERMANENT</code> to force server
          startup to fail if the plugin does not initialize
          successfully.
        </p><p>
          For general information about installing or uninstalling
          plugins, see <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>. To
          verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="21.14 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement. See <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="validate-password-options-variables"></a>6.1.2.6.2 Password Validation Plugin Options and Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187552528"></a><a class="indexterm" name="idm139737187551456"></a><a class="indexterm" name="idm139737187550000"></a><p>
          To control the activation of the
          <code class="literal">validate_password</code> plugin, use this option:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_validate-password"></a>
              <a class="indexterm" name="idm139737187546032"></a>

              <a class="indexterm" name="idm139737187544576"></a>

              <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate-password" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--validate-password[=value]</code></td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE_PLUS_PERMANENT</code></td></tr></tbody></table>
</div>
<p>
              This option controls how the server loads the
              <code class="literal">validate_password</code> plugin at startup.
              The value should be one of those available for
              plugin-loading options, as described in
              <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>. For example,
              <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password=FORCE_PLUS_PERMANENT</code></a>
              tells the server to load the plugin at startup and
              prevents it from being removed while the server is
              running.
            </p><p>
              This option is available only if the
              <code class="literal">validate_password</code> plugin has been
              previously registered with <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
              PLUGIN</code></a> or is loaded with
              <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a>. See
              <a class="xref" href="security.html#validate-password-plugin-installation" title="6.1.2.6.1 Password Validation Plugin Installation">Section 6.1.2.6.1, “Password Validation Plugin Installation”</a>.
</p></li></ul>
</div>
<p>
          If the <code class="literal">validate_password</code> plugin is
          installed, it exposes several system variables that indicate
          the parameters that control password checking:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'validate_password%';</code></strong>
+--------------------------------------+--------+
| Variable_name                        | Value  |
+--------------------------------------+--------+
| validate_password_dictionary_file    |        |
| validate_password_length             | 8      |
| validate_password_mixed_case_count   | 1      |
| validate_password_number_count       | 1      |
| validate_password_policy             | MEDIUM |
| validate_password_special_char_count | 1      |
+--------------------------------------+--------+
</pre><p>
          To change how passwords are checked, you can set any of these
          variables at server startup, and most of them at runtime. The
          following list describes the meaning of each variable.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password_dictionary_file"></a>
              <a class="indexterm" name="idm139737187508320"></a>

              <a class="indexterm" name="idm139737187507280"></a>

              <a class="link" href="security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_dictionary_file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&lt;= 5.6.25)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&gt;= 5.6.26)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table>
</div>
<p>
              The path name of the dictionary file used by the
              <code class="literal">validate_password</code> plugin for checking
              passwords. This variable is unavailable unless that plugin
              is installed.
            </p><p>
              By default, this variable has an empty value and
              dictionary checks are not performed. To enable dictionary
              checks, you must set this variable to a nonempty value. If
              the file is named as a relative path, it is interpreted
              relative to the server data directory. Its contents should
              be lowercase, one word per line. Contents are treated as
              having a character set of <code class="literal">utf8</code>. The
              maximum permitted file size is 1MB.
            </p><p>
              For the dictionary file to be used during password
              checking, the password policy must be set to 2
              (<code class="literal">STRONG</code>); see the description of the
              <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
              system variable. Assuming that is true, each substring of
              the password of length 4 up to 100 is compared to the
              words in the dictionary file. Any match causes the
              password to be rejected. Comparisons are not case
              sensitive.
            </p><p>
              For
              <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
              the password is checked against all policies, including
              <code class="literal">STRONG</code>, so the strength assessment
              includes the dictionary check regardless of the
              <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
              value.
            </p><p>
              Before MySQL 5.6.26, changes to the dictionary file while
              the server is running require a restart for the server to
              recognize the changes. As of MySQL 5.6.26,
              <a class="link" href="security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a>
              can be set at runtime and assigning a value causes the
              named file to be read without a restart.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_length"></a>
              <a class="indexterm" name="idm139737187459936"></a>

              <a class="indexterm" name="idm139737187458832"></a>

              <a class="link" href="security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_length" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_length">validate_password_length</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
              The minimum number of characters that passwords checked by
              the <code class="literal">validate_password</code> plugin must have.
              This variable is unavailable unless that plugin is
              installed.
            </p><p>
              The
              <a class="link" href="security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
              minimum value is a function of several other related
              system variables. As of MySQL 5.6.10, the server will not
              set the value less than the value of this expression:
            </p><pre class="programlisting">
validate_password_number_count
+ validate_password_special_char_count
+ (2 * validate_password_mixed_case_count)
</pre><p>
              If the <code class="literal">validate_password</code> plugin adjusts
              the value of
              <a class="link" href="security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
              due to the preceding constraint, it writes a message to
              the error log.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_mixed_case_count"></a>
              <a class="indexterm" name="idm139737187427440"></a>

              <a class="indexterm" name="idm139737187426400"></a>

              <a class="link" href="security.html#sysvar_validate_password_mixed_case_count"><code class="literal">validate_password_mixed_case_count</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_mixed_case_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_mixed_case_count">validate_password_mixed_case_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
              The minimum number of lowercase and uppercase characters
              that passwords checked by the
              <code class="literal">validate_password</code> plugin must have if
              the password policy is <code class="literal">MEDIUM</code> or
              stronger. This variable is unavailable unless that plugin
              is installed.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_number_count"></a>
              <a class="indexterm" name="idm139737187399344"></a>

              <a class="indexterm" name="idm139737187398240"></a>

              <a class="link" href="security.html#sysvar_validate_password_number_count"><code class="literal">validate_password_number_count</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_number_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_number_count">validate_password_number_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
              The minimum number of numeric (digit) characters that
              passwords checked by the
              <code class="literal">validate_password</code> plugin must have if
              the password policy is <code class="literal">MEDIUM</code> or
              stronger. This variable is unavailable unless that plugin
              is installed.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_policy"></a>
              <a class="indexterm" name="idm139737187371296"></a>

              <a class="indexterm" name="idm139737187370192"></a>

              <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_policy">validate_password_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
              The password policy enforced by the
              <code class="literal">validate_password</code> plugin. This variable
              is unavailable unless that plugin is installed.
            </p><p>
              The
              <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
              value can be specified using numeric values 0, 1, 2, or
              the corresponding symbolic values <code class="literal">LOW</code>,
              <code class="literal">MEDIUM</code>, <code class="literal">STRONG</code>. The
              following table describes the tests performed for each
              policy. For the length test, the required length is the
              value of the
              <a class="link" href="security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
              system variable. Similarly, the required values for the
              other tests are given by other
              <code class="literal">validate_password_<em class="replaceable"><code>xxx</code></em></code>
              variables.
</p>
<div class="informaltable">
<table summary="This table lists the password policies enforced
                by the validate_password plugin and
                describes the tests performed for each policy." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Policy</th><th scope="col">Tests Performed</th></tr></thead><tbody><tr><td scope="row"><code class="literal">0</code> or <code class="literal">LOW</code></td><td>Length</td></tr><tr><td scope="row"><code class="literal">1</code> or <code class="literal">MEDIUM</code></td><td>Length; numeric, lowercase/uppercase, and special characters</td></tr><tr><td scope="row"><code class="literal">2</code> or <code class="literal">STRONG</code></td><td>Length; numeric, lowercase/uppercase, and special characters; dictionary
file</td></tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                Before MySQL 5.6.10,
                <code class="literal">validate_password_policy</code> was named
                <code class="literal">validate_password_policy_number</code>.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_validate_password_special_char_count"></a>
              <a class="indexterm" name="idm139737187319392"></a>

              <a class="indexterm" name="idm139737187318352"></a>

              <a class="link" href="security.html#sysvar_validate_password_special_char_count"><code class="literal">validate_password_special_char_count</code></a>
</p>
<div class="informaltable">
<table summary="Options for validate_password_special_char_count" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.6</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_validate_password_special_char_count">validate_password_special_char_count</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
              The minimum number of nonalphanumeric characters that
              passwords checked by the
              <code class="literal">validate_password</code> plugin must have if
              the password policy is <code class="literal">MEDIUM</code> or
              stronger. This variable is unavailable unless that plugin
              is installed.
</p></li></ul>
</div>
<p>
          If the <code class="literal">validate_password</code> plugin is
          installed, it exposes several status variables that provide
          operational information:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'validate_password%';</code></strong>
+-----------------------------------------------+---------------------+
| Variable_name                                 | Value               |
+-----------------------------------------------+---------------------+
| validate_password_dictionary_file_last_parsed | 2015-06-29 11:08:51 |
| validate_password_dictionary_file_words_count | 1902                |
+-----------------------------------------------+---------------------+
</pre><p>
          The following list describes the meaning of each variable.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_last_parsed"></a>
              <a class="indexterm" name="idm139737187287296"></a>

              <a class="indexterm" name="idm139737187286176"></a>

              <a class="link" href="security.html#statvar_validate_password_dictionary_file_last_parsed"><code class="literal">validate_password_dictionary_file_last_parsed</code></a>
            </p><p>
              When the dictionary file was last parsed.
            </p><p>
              This variable was added in MySQL 5.6.26.
            </p></li><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_words_count"></a>
              <a class="indexterm" name="idm139737187281168"></a>

              <a class="indexterm" name="idm139737187280048"></a>

              <a class="link" href="security.html#statvar_validate_password_dictionary_file_words_count"><code class="literal">validate_password_dictionary_file_words_count</code></a>
            </p><p>
              The number of words read from the dictionary file.
            </p><p>
              This variable was added in MySQL 5.6.26.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-against-attack"></a>6.1.3 Making MySQL Secure Against Attackers</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187274448"></a><a class="indexterm" name="idm139737187272992"></a><a class="indexterm" name="idm139737187271504"></a><a class="indexterm" name="idm139737187270432"></a><a class="indexterm" name="idm139737187269344"></a><p>
      When you connect to a MySQL server, you should use a password. The
      password is not transmitted in clear text over the connection.
      Password handling during the client connection sequence was
      upgraded in MySQL 4.1.1 to be very secure. If you are still using
      pre-4.1.1-style passwords, the encryption algorithm is not as
      strong as the newer algorithm. With some effort, a clever attacker
      who can sniff the traffic between the client and the server can
      crack the password. (See <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>, for a
      discussion of the different password handling methods.)
    </p><p>
      All other information is transferred as text, and can be read by
      anyone who is able to watch the connection. If the connection
      between the client and the server goes through an untrusted
      network, and you are concerned about this, you can use the
      compressed protocol to make traffic much more difficult to
      decipher. You can also use MySQL's internal SSL support to make
      the connection even more secure. See
      <a class="xref" href="security.html#ssl-connections" title="6.3.10 Using SSL for Secure Connections">Section 6.3.10, “Using SSL for Secure Connections”</a>. Alternatively, use SSH to get
      an encrypted TCP/IP connection between a MySQL server and a MySQL
      client. You can find an Open Source SSH client at
      <a class="ulink" href="http://www.openssh.org/" target="_top">http://www.openssh.org/</a>, and a comparison of both
      Open Source and Commercial SSH clients at
      <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>.
    </p><p>
      To make a MySQL system secure, you should strongly consider the
      following suggestions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Require all MySQL accounts to have a password. A client
          program does not necessarily know the identity of the person
          running it. It is common for client/server applications that
          the user can specify any user name to the client program. For
          example, anyone can use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> program
          to connect as any other person simply by invoking it as
          <code class="literal">mysql -u <em class="replaceable"><code>other_user</code></em>
          <em class="replaceable"><code>db_name</code></em></code> if
          <em class="replaceable"><code>other_user</code></em> has no password. If all
          accounts have a password, connecting using another user's
          account becomes much more difficult.
        </p><p>
          For a discussion of methods for setting passwords, see
          <a class="xref" href="security.html#assigning-passwords" title="6.3.5 Assigning Account Passwords">Section 6.3.5, “Assigning Account Passwords”</a>.
        </p></li><li class="listitem"><p>
          Make sure that the only Unix user account with read or write
          privileges in the database directories is the account that is
          used for running <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>.
        </p></li><li class="listitem"><p>
          Never run the MySQL server as the Unix <code class="literal">root</code>
          user. This is extremely dangerous, because any user with the
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege is able to cause
          the server to create files as <code class="literal">root</code> (for
          example, <code class="literal">~root/.bashrc</code>). To prevent this,
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> refuses to run as
          <code class="literal">root</code> unless that is specified explicitly
          using the <a class="link" href="server-administration.html#option_mysqld_user"><code class="option">--user=root</code></a> option.
        </p><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can (and should) be run as an
          ordinary, unprivileged user instead. You can create a separate
          Unix account named <code class="literal">mysql</code> to make everything
          even more secure. Use this account only for administering
          MySQL. To start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as a different Unix
          user, add a <code class="literal">user</code> option that specifies the
          user name in the <code class="literal">[mysqld]</code> group of the
          <code class="filename">my.cnf</code> option file where you specify
          server options. For example:
        </p><pre class="programlisting">
[mysqld]
user=mysql
</pre><p>
          This causes the server to start as the designated user whether
          you start it manually or by using
          <a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or
          <a class="link" href="programs.html#mysql-server" title="4.3.3 mysql.server — MySQL Server Startup Script"><span class="command"><strong>mysql.server</strong></span></a>. For more details, see
          <a class="xref" href="security.html#changing-mysql-user" title="6.1.5 How to Run MySQL as a Normal User">Section 6.1.5, “How to Run MySQL as a Normal User”</a>.
        </p><p>
          Running <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as a Unix user other than
          <code class="literal">root</code> does not mean that you need to change
          the <code class="literal">root</code> user name in the
          <code class="literal">user</code> table. <span class="emphasis"><em>User names for MySQL
          accounts have nothing to do with user names for Unix
          accounts</em></span>.
        </p></li><li class="listitem"><p>
          Do not grant the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege
          to nonadministrative users. Any user that has this privilege
          can write a file anywhere in the file system with the
          privileges of the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> daemon. This
          includes the server's data directory containing the files that
          implement the privilege tables. To make
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a>-privilege operations a bit
          safer, files generated with
          <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
          OUTFILE</code></a> do not overwrite existing files and are
          writable by everyone.
        </p><a class="indexterm" name="idm139737187226976"></a><p>
          The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege may also be
          used to read any file that is world-readable or accessible to
          the Unix user that the server runs as. With this privilege,
          you can read any file into a database table. This could be
          abused, for example, by using <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
          DATA</code></a> to load <code class="filename">/etc/passwd</code> into a
          table, which then can be displayed with
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>.
        </p><p>
          To limit the location in which files can be read and written,
          set the <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a>
          system to a specific directory. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>.
        </p></li><li class="listitem"><p>
          Do not grant the <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> or
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege to
          nonadministrative users. The output of <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          processlist</strong></span></a> and <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30 SHOW PROCESSLIST Syntax"><code class="literal">SHOW
          PROCESSLIST</code></a> shows the text of any statements
          currently being executed, so any user who is permitted to see
          the server process list might be able to see statements issued
          by other users such as <code class="literal">UPDATE user SET
          password=PASSWORD('not_secure')</code>.
        </p><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reserves an extra connection for
          users who have the <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>
          privilege, so that a MySQL <code class="literal">root</code> user can
          log in and check server activity even if all normal
          connections are in use.
        </p><p>
          The <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege can be used
          to terminate client connections, change server operation by
          changing the value of system variables, and control
          replication servers.
        </p></li><li class="listitem"><p>
          Do not permit the use of symlinks to tables. (This capability
          can be disabled with the
          <a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
          option.) This is especially important if you run
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as <code class="literal">root</code>, because
          anyone that has write access to the server's data directory
          then could delete any file in the system! See
          <a class="xref" href="optimization.html#symbolic-links-to-tables" title="8.12.4.2 Using Symbolic Links for MyISAM Tables on Unix">Section 8.12.4.2, “Using Symbolic Links for MyISAM Tables on Unix”</a>.
        </p></li><li class="listitem"><p>
          Stored programs and views should be written using the security
          guidelines discussed in
          <a class="xref" href="stored-programs-views.html#stored-programs-security" title="20.6 Access Control for Stored Programs and Views">Section 20.6, “Access Control for Stored Programs and Views”</a>.
        </p></li><li class="listitem"><p>
          If you do not trust your DNS, you should use IP addresses
          rather than host names in the grant tables. In any case, you
          should be very careful about creating grant table entries
          using host name values that contain wildcards.
        </p></li><li class="listitem"><p>
          If you want to restrict the number of connections permitted to
          a single account, you can do so by setting the
          <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> variable
          in <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. The
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement also supports
          resource control options for limiting the extent of server use
          permitted to an account. See <a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax">Section 13.7.1.4, “GRANT Syntax”</a>.
        </p></li><li class="listitem"><p>
          If the plugin directory is writable by the server, it may be
          possible for a user to write executable code to a file in the
          directory using <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT
          ... INTO DUMPFILE</code></a>. This can be prevented by making
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> read only to the
          server or by setting
          <a class="link" href="server-administration.html#option_mysqld_secure-file-priv"><code class="option">--secure-file-priv</code></a> to a
          directory where <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> writes
          can be made safely.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-options"></a>6.1.4 Security-Related mysqld Options and Variables</h3>

</div>

</div>

</div>
<p>
      The following table shows <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> options and
      system variables that affect security. For descriptions of each of
      these, see <a class="xref" href="server-administration.html#server-options" title="5.1.3 Server Command Options">Section 5.1.3, “Server Command Options”</a>, and
      <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>.
</p>
<div class="table">
<a name="idm139737187182576"></a><p class="title"><b>Table 6.1 Security Option/Variable Summary</b></p>
<div class="table-contents">
<table summary="Security Option/Variable Summary" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option File</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_allow-suspicious-udfs">allow-suspicious-udfs</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_automatic_sp_privileges">automatic_sp_privileges</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_chroot">chroot</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_des-key-file">des-key-file</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_local_infile">local_infile</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_old_passwords">old_passwords</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_safe-user-create">safe-user-create</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-auth">secure-auth</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_secure_auth">secure_auth</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-file-priv">secure-file-priv</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_secure_file_priv">secure_file_priv</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-grant-tables">skip-grant-tables</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-name-resolve">skip-name-resolve</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_name_resolve">skip_name_resolve</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-networking">skip-networking</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_networking">skip_networking</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-show-database">skip-show-database</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_show_database">skip_show_database</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="changing-mysql-user"></a>6.1.5 How to Run MySQL as a Normal User</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737187113808"></a><a class="indexterm" name="idm139737187112352"></a><p>
      On Windows, you can run the server as a Windows service using a
      normal user account.
    </p><p>
      On Unix, the MySQL server <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can be started
      and run by any user. However, you should avoid running the server
      as the Unix <code class="literal">root</code> user for security reasons. To
      change <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> to run as a normal unprivileged
      Unix user <em class="replaceable"><code>user_name</code></em>, you must do the
      following:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop the server if it is running (use <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          shutdown</strong></span></a>).
        </p></li><li class="listitem"><p>
          Change the database directories and files so that
          <em class="replaceable"><code>user_name</code></em> has privileges to read
          and write files in them (you might need to do this as the Unix
          <code class="literal">root</code> user):
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>chown -R <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>/path/to/mysql/datadir</code></em></code></strong>
</pre><p>
          If you do not do this, the server will not be able to access
          databases or tables when it runs as
          <em class="replaceable"><code>user_name</code></em>.
        </p><p>
          If directories or files within the MySQL data directory are
          symbolic links, <code class="literal">chown -R</code> might not follow
          symbolic links for you. If it does not, you will also need to
          follow those links and change the directories and files they
          point to.
        </p></li><li class="listitem"><p>
          Start the server as user <em class="replaceable"><code>user_name</code></em>.
          Another alternative is to start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as
          the Unix <code class="literal">root</code> user and use the
          <a class="link" href="server-administration.html#option_mysqld_user"><code class="option">--user=<em class="replaceable"><code>user_name</code></em></code></a>
          option. <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> starts up, then switches to
          run as the Unix user <em class="replaceable"><code>user_name</code></em>
          before accepting any connections.
        </p></li><li class="listitem"><p>
          To start the server as the given user automatically at system
          startup time, specify the user name by adding a
          <code class="literal">user</code> option to the
          <code class="literal">[mysqld]</code> group of the
          <code class="filename">/etc/my.cnf</code> option file or the
          <code class="filename">my.cnf</code> option file in the server's data
          directory. For example:
        </p><pre class="programlisting">
[mysqld]
user=<em class="replaceable"><code>user_name</code></em>
</pre></li></ol>
</div>
<p>
      If your Unix machine itself is not secured, you should assign
      passwords to the MySQL <code class="literal">root</code> accounts in the
      grant tables. Otherwise, any user with a login account on that
      machine can run the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client with a
      <a class="link" href="programs.html#option_mysql_user"><code class="option">--user=root</code></a> option and perform any
      operation. (It is a good idea to assign passwords to MySQL
      accounts in any case, but especially so when other login accounts
      exist on the server host.) See
      <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Accounts">Section 2.10.4, “Securing the Initial MySQL Accounts”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="load-data-local"></a>6.1.6 Security Issues with LOAD DATA LOCAL</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA</code></a> statement can load a
      file that is located on the server host, or it can load a file
      that is located on the client host when the
      <code class="literal">LOCAL</code> keyword is specified.
    </p><p>
      There are two potential security issues with supporting the
      <code class="literal">LOCAL</code> version of <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
      DATA</code></a> statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The transfer of the file from the client host to the server
          host is initiated by the MySQL server. In theory, a patched
          server could be built that would tell the client program to
          transfer a file of the server's choosing rather than the file
          named by the client in the <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
          DATA</code></a> statement. Such a server could access any file
          on the client host to which the client user has read access.
        </p></li><li class="listitem"><p>
          In a Web environment where the clients are connecting from a
          Web server, a user could use
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> to read any files that the Web server process
          has read access to (assuming that a user could run any command
          against the SQL server). In this environment, the client with
          respect to the MySQL server actually is the Web server, not
          the remote program being run by the user who connects to the
          Web server.
</p></li></ul>
</div>
<p>
      To deal with these problems, we changed how
      <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
      LOCAL</code></a> is handled as of MySQL 3.23.49 and MySQL 4.0.2
      (4.0.13 on Windows):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          By default, all MySQL clients and libraries in binary
          distributions are compiled with the
          <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">-DENABLED_LOCAL_INFILE=1</code></a> option,
          to be compatible with MySQL 3.23.48 and before.
        </p></li><li class="listitem"><p>
          If you build MySQL from source but do not invoke
          <span class="command"><strong>CMake</strong></span> with the
          <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">-DENABLED_LOCAL_INFILE=1</code></a> option,
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> cannot be used by any client unless it is
          written explicitly to invoke
          <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options(...
          MYSQL_OPT_LOCAL_INFILE, 0)</code></a>. See
          <a class="xref" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()">Section 23.8.7.49, “mysql_options()”</a>.
        </p></li><li class="listitem"><p>
          You can disable all
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> statements from the server side by starting
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
          <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">--local-infile=0</code></a> option.
        </p></li><li class="listitem"><p>
          For the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> command-line client, enable
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> by specifying the
          <a class="link" href="programs.html#option_mysql_local-infile"><code class="option">--local-infile[=1]</code></a> option, or
          disable it with the
          <a class="link" href="programs.html#option_mysql_local-infile"><code class="option">--local-infile=0</code></a> option. For
          <a class="link" href="programs.html#mysqlimport" title="4.5.5 mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a>, local data file loading is off
          by default; enable it with the
          <a class="link" href="programs.html#option_mysqlimport_local"><code class="option">--local</code></a> or
          <code class="option">-L</code> option. In any case, successful use of a
          local load operation requires that the server permits it.
        </p></li><li class="listitem"><p>
          If you use <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
          DATA LOCAL</code></a> in Perl scripts or other programs that
          read the <code class="literal">[client]</code> group from option files,
          you can add the <code class="literal">local-infile=1</code> option to
          that group. However, to keep this from causing problems for
          programs that do not understand
          <code class="literal">local-infile</code>, specify it using the
          <code class="literal">loose-</code> prefix:
        </p><pre class="programlisting">
[client]
loose-local-infile=1
</pre></li><li class="listitem"><p>
          If <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> is disabled, either in the server or the
          client, a client that attempts to issue such a statement
          receives the following error message:
        </p><pre class="programlisting">
ERROR 1148: The used command is not allowed with this MySQL version
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="secure-client-programming"></a>6.1.7 Client Programming Security Guidelines</h3>

</div>

</div>

</div>
<p>
      Applications that access MySQL should not trust any data entered
      by users, who can try to trick your code by entering special or
      escaped character sequences in Web forms, URLs, or whatever
      application you have built. Be sure that your application remains
      secure if a user enters something like <span class="quote">“<span class="quote"><code class="literal">; DROP
      DATABASE mysql;</code></span>”</span>. This is an extreme example, but
      large security leaks and data loss might occur as a result of
      hackers using similar techniques, if you do not prepare for them.
    </p><p>
      A common mistake is to protect only string data values. Remember
      to check numeric data as well. If an application generates a query
      such as <code class="literal">SELECT * FROM table WHERE ID=234</code> when a
      user enters the value <code class="literal">234</code>, the user can enter
      the value <code class="literal">234 OR 1=1</code> to cause the application
      to generate the query <code class="literal">SELECT * FROM table WHERE ID=234 OR
      1=1</code>. As a result, the server retrieves every row in the
      table. This exposes every row and causes excessive server load.
      The simplest way to protect from this type of attack is to use
      single quotation marks around the numeric constants:
      <code class="literal">SELECT * FROM table WHERE ID='234'</code>. If the user
      enters extra information, it all becomes part of the string. In a
      numeric context, MySQL automatically converts this string to a
      number and strips any trailing nonnumeric characters from it.
    </p><p>
      Sometimes people think that if a database contains only publicly
      available data, it need not be protected. This is incorrect. Even
      if it is permissible to display any row in the database, you
      should still protect against denial of service attacks (for
      example, those that are based on the technique in the preceding
      paragraph that causes the server to waste resources). Otherwise,
      your server becomes unresponsive to legitimate users.
    </p><p>
      Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Enable strict SQL mode to tell the server to be more
          restrictive of what data values it accepts. See
          <a class="xref" href="server-administration.html#sql-mode" title="5.1.7 Server SQL Modes">Section 5.1.7, “Server SQL Modes”</a>.
        </p></li><li class="listitem"><p>
          Try to enter single and double quotation marks
          (<span class="quote">“<span class="quote"><code class="literal">'</code></span>”</span> and
          <span class="quote">“<span class="quote"><code class="literal">"</code></span>”</span>) in all of your Web forms.
          If you get any kind of MySQL error, investigate the problem
          right away.
        </p></li><li class="listitem"><p>
          Try to modify dynamic URLs by adding <code class="literal">%22</code>
          (<span class="quote">“<span class="quote"><code class="literal">"</code></span>”</span>), <code class="literal">%23</code>
          (<span class="quote">“<span class="quote"><code class="literal">#</code></span>”</span>), and
          <code class="literal">%27</code> (<span class="quote">“<span class="quote"><code class="literal">'</code></span>”</span>)
          to them.
        </p></li><li class="listitem"><p>
          Try to modify data types in dynamic URLs from numeric to
          character types using the characters shown in the previous
          examples. Your application should be safe against these and
          similar attacks.
        </p></li><li class="listitem"><p>
          Try to enter characters, spaces, and special symbols rather
          than numbers in numeric fields. Your application should remove
          them before passing them to MySQL or else generate an error.
          Passing unchecked values to MySQL is very dangerous!
        </p></li><li class="listitem"><p>
          Check the size of data before passing it to MySQL.
        </p></li><li class="listitem"><p>
          Have your application connect to the database using a user
          name different from the one you use for administrative
          purposes. Do not give your applications any access privileges
          they do not need.
</p></li></ul>
</div>
<p>
      Many application programming interfaces provide a means of
      escaping special characters in data values. Properly used, this
      prevents application users from entering values that cause the
      application to generate statements that have a different effect
      than you intend:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL C API: Use the
          <a class="link" href="connectors-apis.html#mysql-real-escape-string" title="23.8.7.54 mysql_real_escape_string()"><code class="literal">mysql_real_escape_string()</code></a> API
          call.
        </p></li><li class="listitem"><p>
          MySQL++: Use the <code class="literal">escape</code> and
          <code class="literal">quote</code> modifiers for query streams.
        </p></li><li class="listitem"><p>
          PHP: Use either the <code class="literal">mysqli</code> or
          <code class="literal">pdo_mysql</code> extensions, and not the older
          <code class="literal">ext/mysql</code> extension. The preferred API's
          support the improved MySQL authentication protocol and
          passwords, as well as prepared statements with placeholders.
          See also <a class="ulink" href="http://dev.mysql.com/doc/apis-php/en/apis-php-mysqlinfo.api.choosing.html" target="_top">Choosing an API</a>.
        </p><p>
          If the older <code class="literal">ext/mysql</code> extension must be
          used, then for escaping use the
          <a class="link" href="connectors-apis.html#mysql-real-escape-string" title="23.8.7.54 mysql_real_escape_string()"><code class="literal">mysql_real_escape_string()</code></a>
          function and not
          <a class="link" href="connectors-apis.html#mysql-escape-string" title="23.8.7.16 mysql_escape_string()"><code class="literal">mysql_escape_string()</code></a> or
          <code class="function">addslashes()</code> because only
          <a class="link" href="connectors-apis.html#mysql-real-escape-string" title="23.8.7.54 mysql_real_escape_string()"><code class="literal">mysql_real_escape_string()</code></a> is
          character set-aware; the other functions can be
          <span class="quote">“<span class="quote">bypassed</span>”</span> when using (invalid) multibyte
          character sets.
        </p></li><li class="listitem"><p>
          Perl DBI: Use placeholders or the <code class="literal">quote()</code>
          method.
        </p></li><li class="listitem"><p>
          Ruby DBI: Use placeholders or the <code class="literal">quote()</code>
          method.
        </p></li><li class="listitem"><p>
          Java JDBC: Use a <code class="literal">PreparedStatement</code> object
          and placeholders.
</p></li></ul>
</div>
<p>
      Other programming interfaces might have similar capabilities.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="privilege-system"></a>6.2 The MySQL Access Privilege System</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#privileges-provided">6.2.1 Privileges Provided by MySQL</a></span></dt><dt><span class="section"><a href="security.html#grant-table-structure">6.2.2 Privilege System Grant Tables</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.3 Specifying Account Names</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.4 Access Control, Stage 1: Connection Verification</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.5 Access Control, Stage 2: Request Verification</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.6 When Privilege Changes Take Effect</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.7 Troubleshooting Problems Connecting to MySQL</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737186992304"></a><a class="indexterm" name="idm139737186991264"></a><a class="indexterm" name="idm139737186990192"></a><a class="indexterm" name="idm139737186988704"></a><a class="indexterm" name="idm139737186987632"></a><a class="indexterm" name="idm139737186986560"></a><a class="indexterm" name="idm139737186985072"></a><p>
    The primary function of the MySQL privilege system is to
    authenticate a user who connects from a given host and to associate
    that user with privileges on a database such as
    <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>,
    <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
    <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>. Additional functionality
    includes the ability to have anonymous users and to grant privileges
    for MySQL-specific functions such as
    <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
    INFILE</code></a> and administrative operations.
  </p><p>
    There are some things that you cannot do with the MySQL privilege
    system:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You cannot explicitly specify that a given user should be denied
        access. That is, you cannot explicitly match a user and then
        refuse the connection.
      </p></li><li class="listitem"><p>
        You cannot specify that a user has privileges to create or drop
        tables in a database but not to create or drop the database
        itself.
      </p></li><li class="listitem"><p>
        A password applies globally to an account. You cannot associate
        a password with a specific object such as a database, table, or
        routine.
</p></li></ul>
</div>
<p>
    The user interface to the MySQL privilege system consists of SQL
    statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
    <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
    <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a>. See
    <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>.
  </p><p>
    Internally, the server stores privilege information in the grant
    tables of the <code class="literal">mysql</code> database (that is, in the
    database named <code class="literal">mysql</code>). The MySQL server reads the
    contents of these tables into memory when it starts and bases
    access-control decisions on the in-memory copies of the grant
    tables.
  </p><p>
    The MySQL privilege system ensures that all users may perform only
    the operations permitted to them. As a user, when you connect to a
    MySQL server, your identity is determined by <span class="emphasis"><em>the host from
    which you connect</em></span> and <span class="emphasis"><em>the user name you
    specify</em></span>. When you issue requests after connecting, the
    system grants privileges according to your identity and
    <span class="emphasis"><em>what you want to do</em></span>.
  </p><p>
    MySQL considers both your host name and user name in identifying you
    because there is no reason to assume that a given user name belongs
    to the same person on all hosts. For example, the user
    <code class="literal">joe</code> who connects from
    <code class="literal">office.example.com</code> need not be the same person as
    the user <code class="literal">joe</code> who connects from
    <code class="literal">home.example.com</code>. MySQL handles this by enabling
    you to distinguish users on different hosts that happen to have the
    same name: You can grant one set of privileges for connections by
    <code class="literal">joe</code> from <code class="literal">office.example.com</code>,
    and a different set of privileges for connections by
    <code class="literal">joe</code> from <code class="literal">home.example.com</code>. To
    see what privileges a given account has, use the
    <a class="link" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> statement. For example:
  </p><pre class="programlisting">
SHOW GRANTS FOR 'joe'@'office.example.com';
SHOW GRANTS FOR 'joe'@'home.example.com';
</pre><p>
    MySQL access control involves two stages when you run a client
    program that connects to the server:
  </p><p>
    <span class="bold"><strong>Stage 1:</strong></span> The server accepts or
    rejects the connection based on your identity and whether you can
    verify your identity by supplying the correct password.
  </p><p>
    <span class="bold"><strong>Stage 2:</strong></span> Assuming that you can
    connect, the server checks each statement you issue to determine
    whether you have sufficient privileges to perform it. For example,
    if you try to select rows from a table in a database or drop a table
    from the database, the server verifies that you have the
    <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege for the table or the
    <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege for the database.
  </p><p>
    For a more detailed description of what happens during each stage,
    see <a class="xref" href="security.html#connection-access" title="6.2.4 Access Control, Stage 1: Connection Verification">Section 6.2.4, “Access Control, Stage 1: Connection Verification”</a>, and
    <a class="xref" href="security.html#request-access" title="6.2.5 Access Control, Stage 2: Request Verification">Section 6.2.5, “Access Control, Stage 2: Request Verification”</a>.
  </p><p>
    If your privileges are changed (either by yourself or someone else)
    while you are connected, those changes do not necessarily take
    effect immediately for the next statement that you issue. For
    details about the conditions under which the server reloads the
    grant tables, see <a class="xref" href="security.html#privilege-changes" title="6.2.6 When Privilege Changes Take Effect">Section 6.2.6, “When Privilege Changes Take Effect”</a>.
  </p><p>
    For general security-related advice, see
    <a class="xref" href="security.html#general-security-issues" title="6.1 General Security Issues">Section 6.1, “General Security Issues”</a>. For help in diagnosing
    privilege-related problems, see
    <a class="xref" href="security.html#problems-connecting" title="6.2.7 Troubleshooting Problems Connecting to MySQL">Section 6.2.7, “Troubleshooting Problems Connecting to MySQL”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privileges-provided"></a>6.2.1 Privileges Provided by MySQL</h3>
</div>
</div>
</div>
<p>
      MySQL provides privileges that apply in different contexts and at
      different levels of operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Administrative privileges enable users to manage operation of
          the MySQL server. These privileges are global because they are
          not specific to a particular database.
        </p></li><li class="listitem"><p>
          Database privileges apply to a database and to all objects
          within it. These privileges can be granted for specific
          databases, or globally so that they apply to all databases.
        </p></li><li class="listitem"><p>
          Privileges for database objects such as tables, indexes,
          views, and stored routines can be granted for specific objects
          within a database, for all objects of a given type within a
          database (for example, all tables in a database), or globally
          for all objects of a given type in all databases).
</p></li></ul>
</div>
<p>
      Information about account privileges is stored in the
      <code class="literal">user</code>, <code class="literal">db</code>,
      <code class="literal">tables_priv</code>, <code class="literal">columns_priv</code>,
      and <code class="literal">procs_priv</code> tables in the
      <code class="literal">mysql</code> database (see
      <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>). The MySQL server reads
      the contents of these tables into memory when it starts and
      reloads them under the circumstances indicated in
      <a class="xref" href="security.html#privilege-changes" title="6.2.6 When Privilege Changes Take Effect">Section 6.2.6, “When Privilege Changes Take Effect”</a>. Access-control decisions are
      based on the in-memory copies of the grant tables.
    </p><p>
      Some releases of MySQL introduce changes to the structure of the
      grant tables to add new privileges or features. To make sure that
      you can take advantage of any new capabilities, update your grant
      tables to have the current structure whenever you update to a new
      version of MySQL. See <a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables">Section 4.4.7, “<span class="command"><strong>mysql_upgrade</strong></span> — Check and Upgrade MySQL Tables”</a>.
    </p><p>
      The following table shows the privilege names used at the SQL
      level in the <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements, along with the
      column name associated with each privilege in the grant tables and
      the context in which the privilege applies.
</p>
<div class="table">
<a name="idm139737186927920"></a><p class="title"><b>Table 6.2 Permissible Privileges for GRANT and REVOKE</b></p>
<div class="table-contents">
<table summary="Permissible Privileges for GRANT and REVOKE" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Privilege</th><th scope="col">Column</th><th scope="col">Context</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a></td><td><code class="literal">Create_priv</code></td><td>databases, tables, or indexes</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a></td><td><code class="literal">Drop_priv</code></td><td>databases, tables, or views</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a></td><td><code class="literal">Grant_priv</code></td><td>databases, tables, or stored routines</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a></td><td><code class="literal">Lock_tables_priv</code></td><td>databases</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a></td><td><code class="literal">References_priv</code></td><td>databases or tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_event"><code class="literal">EVENT</code></a></td><td><code class="literal">Event_priv</code></td><td>databases</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a></td><td><code class="literal">Alter_priv</code></td><td>tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a></td><td><code class="literal">Delete_priv</code></td><td>tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a></td><td><code class="literal">Index_priv</code></td><td>tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a></td><td><code class="literal">Insert_priv</code></td><td>tables or columns</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a></td><td><code class="literal">Select_priv</code></td><td>tables or columns</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a></td><td><code class="literal">Update_priv</code></td><td>tables or columns</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a></td><td><code class="literal">Create_tmp_table_priv</code></td><td>tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_trigger"><code class="literal">TRIGGER</code></a></td><td><code class="literal">Trigger_priv</code></td><td>tables</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a></td><td><code class="literal">Create_view_priv</code></td><td>views</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a></td><td><code class="literal">Show_view_priv</code></td><td>views</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a></td><td><code class="literal">Alter_routine_priv</code></td><td>stored routines</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a></td><td><code class="literal">Create_routine_priv</code></td><td>stored routines</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a></td><td><code class="literal">Execute_priv</code></td><td>stored routines</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a></td><td><code class="literal">File_priv</code></td><td>file access on server host</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a></td><td><code class="literal">Create_tablespace_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a></td><td><code class="literal">Create_user_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a></td><td><code class="literal">Process_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a></td><td>see <code class="literal">proxies_priv</code> table</td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a></td><td><code class="literal">Reload_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a></td><td><code class="literal">Repl_client_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a></td><td><code class="literal">Repl_slave_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a></td><td><code class="literal">Show_db_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a></td><td><code class="literal">Shutdown_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a></td><td><code class="literal">Super_priv</code></td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_all"><code class="literal">ALL [PRIVILEGES]</code></a></td><td> </td><td>server administration</td></tr><tr><td scope="row"><a class="link" href="security.html#priv_usage"><code class="literal">USAGE</code></a></td><td> </td><td>server administration</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      The following list provides a general description of each
      privilege available in MySQL. Particular SQL statements might have
      more specific privilege requirements than indicated here. If so,
      the description for the statement in question provides the
      details.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_all"></a>
          The <a class="link" href="security.html#priv_all"><code class="literal">ALL</code></a> or
          <a class="link" href="security.html#priv_all"><code class="literal">ALL PRIVILEGES</code></a>
          privilege specifier is shorthand. It stands for <span class="quote">“<span class="quote">all
          privileges available at a given privilege level</span>”</span>
          (except <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a>). For
          example, granting <a class="link" href="security.html#priv_all"><code class="literal">ALL</code></a> at the
          global or table level grants all global privileges or all
          table-level privileges.
        </p></li><li class="listitem"><p><a name="priv_alter"></a>
          The <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a> privilege enables use
          of <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to change the
          structure of tables. <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> also requires the
          <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a> and
          <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privileges. Renaming a
          table requires <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a> and
          <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> on the old table,
          <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a>, and
          <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> on the new table.
        </p></li><li class="listitem"><p><a name="priv_alter-routine"></a>
          The <a class="link" href="security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a> privilege is
          needed to alter or drop stored routines (procedures and
          functions).
        </p></li><li class="listitem"><p><a name="priv_create"></a>
          The <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a> privilege enables
          creation of new databases and tables.
        </p></li><li class="listitem"><p><a name="priv_create-routine"></a>
          The <a class="link" href="security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a> privilege is
          needed to create stored routines (procedures and functions).
        </p></li><li class="listitem"><p><a name="priv_create-tablespace"></a>
          The <a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a> privilege
          is needed to create, alter, or drop tablespaces and log file
          groups.
        </p></li><li class="listitem"><p><a name="priv_create-temporary-tables"></a>
          The <a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a>
          privilege enables the creation of temporary tables using the
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TEMPORARY
          TABLE</code></a> statement.
        </p><p>
          As of MySQL 5.6.3, after a session has created a temporary
          table, the server performs no further privilege checks on the
          table. The creating session can perform any operation on the
          table, such as <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>,
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>.
        </p><p>
          One implication of this behavior is that a session can
          manipulate its temporary tables even if the current user has
          no privilege to create them. Suppose that the current user
          does not have the <a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY
          TABLES</code></a> privilege but is able to execute a
          <code class="literal">DEFINER</code>-context stored procedure that
          executes with the privileges of a user who does have
          <a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a> and
          that creates a temporary table. While the procedure executes,
          the session uses the privileges of the defining user. After
          the procedure returns, the effective privileges revert to
          those of the current user, which can still see the temporary
          table and perform any operation on it.
        </p><p>
          Before MySQL 5.6.3, other operations on a temporary table,
          such as <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>, require additional
          privileges for those operations for the database containing
          the temporary table, or for the nontemporary table of the same
          name.
        </p><p>
          To keep privileges for temporary and nontemporary tables
          separate, a common workaround for this situation is to create
          a database dedicated to the use of temporary tables. Then for
          that database, a user can be granted the
          <a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a>
          privilege, along with any other privileges required for
          temporary table operations done by that user.
        </p></li><li class="listitem"><p><a name="priv_create-user"></a>
          The <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege
          enables use of <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>,
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
          <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.3 DROP USER Syntax"><code class="literal">DROP USER</code></a>,
          <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER Syntax"><code class="literal">RENAME USER</code></a>, and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE ALL
          PRIVILEGES</code></a>.
        </p></li><li class="listitem"><p><a name="priv_create-view"></a>
          The <a class="link" href="security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a> privilege
          enables use of <a class="link" href="sql-syntax.html#create-view" title="13.1.20 CREATE VIEW Syntax"><code class="literal">CREATE VIEW</code></a>.
        </p></li><li class="listitem"><p><a name="priv_delete"></a>
          The <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> privilege enables
          rows to be deleted from tables in a database.
        </p></li><li class="listitem"><p><a name="priv_drop"></a>
          The <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege enables you
          to drop (remove) existing databases, tables, and views. The
          <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege is required in
          order to use the statement <code class="literal">ALTER TABLE ... DROP
          PARTITION</code> on a partitioned table. The
          <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege is also required
          for <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>.
          <span class="emphasis"><em>If you grant the <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a>
          privilege for the <code class="literal">mysql</code> database to a user,
          that user can drop the database in which the MySQL access
          privileges are stored.</em></span>
        </p></li><li class="listitem"><p><a name="priv_event"></a>
          The <a class="link" href="security.html#priv_event"><code class="literal">EVENT</code></a> privilege is required
          to create, alter, drop, or see events for the Event Scheduler.
        </p></li><li class="listitem"><p><a name="priv_execute"></a>
          The <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege is
          required to execute stored routines (procedures and
          functions).
        </p></li><li class="listitem"><p><a name="priv_file"></a>
          The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege gives you
          permission to read and write files on the server host using
          the <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          INFILE</code></a> and
          <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
          OUTFILE</code></a> statements and the
          <a class="link" href="functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a> function. A user
          who has the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege can
          read any file on the server host that is either world-readable
          or readable by the MySQL server. (This implies the user can
          read any file in any database directory, because the server
          can access any of those files.) The
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege also enables the
          user to create new files in any directory where the MySQL
          server has write access. This includes the server's data
          directory containing the files that implement the privilege
          tables. As a security measure, the server will not overwrite
          existing files.
        </p><p>
          To limit the location in which files can be read and written,
          set the <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a>
          system to a specific directory. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>.
        </p></li><li class="listitem"><p><a name="priv_grant-option"></a>
          The <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a> privilege
          enables you to give to other users or remove from other users
          those privileges that you yourself possess.
        </p></li><li class="listitem"><p><a name="priv_index"></a>
          The <a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a> privilege enables you
          to create or drop (remove) indexes.
          <a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a> applies to existing
          tables. If you have the <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a>
          privilege for a table, you can include index definitions in
          the <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
        </p></li><li class="listitem"><p><a name="priv_insert"></a>
          The <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privilege enables
          rows to be inserted into tables in a database.
          <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> is also required for the
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, and
          <a class="link" href="sql-syntax.html#repair-table" title="13.7.2.5 REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> table-maintenance
          statements.
        </p></li><li class="listitem"><p><a name="priv_lock-tables"></a>
          The <a class="link" href="security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a> privilege
          enables the use of explicit <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a> statements to lock tables for which you have
          the <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege. This
          includes the use of write locks, which prevents other sessions
          from reading the locked table.
        </p></li><li class="listitem"><p><a name="priv_process"></a>
          The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege pertains
          to display of information about the threads executing within
          the server (that is, information about the statements being
          executed by sessions). The privilege enables use of
          <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30 SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a> or
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin processlist</strong></span></a> to see threads
          belonging to other accounts; you can always see your own
          threads. The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege
          also enables use of <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW
          ENGINE</code></a>.
        </p></li><li class="listitem"><p><a name="priv_proxy"></a>
          The <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege enables a
          user to impersonate or become known as another user. See
          <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
        </p></li><li class="listitem"><p><a name="priv_references"></a>
          In MySQL 5.6, the
          <a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a> privilege is unused
          before MySQL 5.6.22. As of 5.6.22, creation of a foreign key
          constraint requires at least one of the
          <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a>,
          <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a>,
          <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>,
          <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a>, or
          <a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a> privileges for the
          parent table.
        </p></li><li class="listitem"><p><a name="priv_reload"></a>
          The <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> privilege enables
          use of the <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH</code></a> statement. It
          also enables <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> commands that are
          equivalent to <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH</code></a> operations:
          <code class="literal">flush-hosts</code>, <code class="literal">flush-logs</code>,
          <code class="literal">flush-privileges</code>,
          <code class="literal">flush-status</code>,
          <code class="literal">flush-tables</code>,
          <code class="literal">flush-threads</code>, <code class="literal">refresh</code>,
          and <code class="literal">reload</code>.
        </p><p>
          The <code class="literal">reload</code> command tells the server to
          reload the grant tables into memory.
          <code class="literal">flush-privileges</code> is a synonym for
          <code class="literal">reload</code>. The <code class="literal">refresh</code>
          command closes and reopens the log files and flushes all
          tables. The other
          <code class="literal">flush-<em class="replaceable"><code>xxx</code></em></code>
          commands perform functions similar to
          <code class="literal">refresh</code>, but are more specific and may be
          preferable in some instances. For example, if you want to
          flush just the log files, <code class="literal">flush-logs</code> is a
          better choice than <code class="literal">refresh</code>.
        </p></li><li class="listitem"><p><a name="priv_replication-client"></a>
          The <a class="link" href="security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a>
          privilege enables the use of <a class="link" href="sql-syntax.html#show-master-status" title="13.7.5.24 SHOW MASTER STATUS Syntax"><code class="literal">SHOW MASTER
          STATUS</code></a> and <a class="link" href="sql-syntax.html#show-slave-status" title="13.7.5.35 SHOW SLAVE STATUS Syntax"><code class="literal">SHOW SLAVE
          STATUS</code></a>. In MySQL 5.6.6 and later, it also enables
          the use of the <a class="link" href="sql-syntax.html#show-binary-logs" title="13.7.5.2 SHOW BINARY LOGS Syntax"><code class="literal">SHOW BINARY LOGS</code></a>
          statement.
        </p></li><li class="listitem"><p><a name="priv_replication-slave"></a>
          The <a class="link" href="security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a> privilege
          should be granted to accounts that are used by slave servers
          to connect to the current server as their master. Without this
          privilege, the slave cannot request updates that have been
          made to databases on the master server.
        </p></li><li class="listitem"><p><a name="priv_select"></a>
          The <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege enables
          you to select rows from tables in a database.
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements require the
          <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege only if they
          actually retrieve rows from a table. Some
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements do not access
          tables and can be executed without permission for any
          database. For example, you can use
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> as a simple calculator
          to evaluate expressions that make no reference to tables:
        </p><pre class="programlisting">
SELECT 1+1;
SELECT PI()*2;
</pre><p>
          The <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege is also
          needed for other statements that read column values. For
          example, <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> is needed for
          columns referenced on the right hand side of
          <em class="replaceable"><code>col_name</code></em>=<em class="replaceable"><code>expr</code></em>
          assignment in <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements
          or for columns named in the <code class="literal">WHERE</code> clause of
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> or
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
        </p></li><li class="listitem"><p><a name="priv_show-databases"></a>
          The <a class="link" href="security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a> privilege
          enables the account to see database names by issuing the
          <code class="literal">SHOW DATABASE</code> statement. Accounts that do
          not have this privilege see only databases for which they have
          some privileges, and cannot use the statement at all if the
          server was started with the
          <a class="link" href="server-administration.html#option_mysqld_skip-show-database"><code class="option">--skip-show-database</code></a> option.
          Note that <span class="emphasis"><em>any</em></span> global privilege is a
          privilege for the database.
        </p></li><li class="listitem"><p><a name="priv_show-view"></a>
          The <a class="link" href="security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a> privilege enables
          use of <a class="link" href="sql-syntax.html#show-create-view" title="13.7.5.14 SHOW CREATE VIEW Syntax"><code class="literal">SHOW CREATE VIEW</code></a>.
        </p></li><li class="listitem"><p><a name="priv_shutdown"></a>
          The <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> privilege enables
          use of the <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin shutdown</strong></span></a> command and
          the <a class="link" href="connectors-apis.html#mysql-shutdown" title="23.8.7.66 mysql_shutdown()"><code class="literal">mysql_shutdown()</code></a> C API
          function. There is no corresponding SQL statement.
        </p></li><li class="listitem"><p><a name="priv_super"></a>
          The <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege enables an
          account to use <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER
          TO</code></a>, <a class="link" href="sql-syntax.html#kill" title="13.7.6.4 KILL Syntax"><code class="literal">KILL</code></a> or
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin kill</strong></span></a> to kill threads belonging
          to other accounts (you can always kill your own threads),
          <a class="link" href="sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS Syntax"><code class="literal">PURGE BINARY LOGS</code></a>,
          configuration changes using
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET
          GLOBAL</code></a> to modify global system variables, the
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin debug</strong></span></a> command, enabling or
          disabling logging, performing updates even if the
          <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a> system variable is
          enabled, starting and stopping replication on slave servers,
          specification of any account in the <code class="literal">DEFINER</code>
          attribute of stored programs and views, and enables you to
          connect (once) even if the connection limit controlled by the
          <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a> system
          variable is reached.
        </p><p>
          To create or alter stored functions if binary logging is
          enabled, you may also need the
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege, as described
          in <a class="xref" href="stored-programs-views.html#stored-programs-logging" title="20.7 Binary Logging of Stored Programs">Section 20.7, “Binary Logging of Stored Programs”</a>.
        </p></li><li class="listitem"><p><a name="priv_trigger"></a>
          The <a class="link" href="security.html#priv_trigger"><code class="literal">TRIGGER</code></a> privilege enables
          trigger operations. You must have this privilege for a table
          to create, drop, or execute triggers for that table.
        </p></li><li class="listitem"><p><a name="priv_update"></a>
          The <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> privilege enables
          rows to be updated in tables in a database.
        </p></li><li class="listitem"><p><a name="priv_usage"></a>
          The <a class="link" href="security.html#priv_usage"><code class="literal">USAGE</code></a> privilege specifier
          stands for <span class="quote">“<span class="quote">no privileges.</span>”</span> It is used at the
          global level with <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> to
          modify account attributes such as resource limits or SSL
          characteristics without affecting existing account privileges.
</p></li></ul>
</div>
<p>
      It is a good idea to grant to an account only those privileges
      that it needs. You should exercise particular caution in granting
      the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> and administrative
      privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege can be
          abused to read into a database table any files that the MySQL
          server can read on the server host. This includes all
          world-readable files and files in the server's data directory.
          The table can then be accessed using
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> to transfer its contents
          to the client host.
        </p></li><li class="listitem"><p>
          The <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a> privilege
          enables users to give their privileges to other users. Two
          users that have different privileges and with the
          <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a> privilege are able
          to combine privileges.
        </p></li><li class="listitem"><p>
          The <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a> privilege may be used
          to subvert the privilege system by renaming tables.
        </p></li><li class="listitem"><p>
          The <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> privilege can be
          abused to deny service to other users entirely by terminating
          the server.
        </p></li><li class="listitem"><p>
          The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege can be
          used to view the plain text of currently executing statements,
          including statements that set or change passwords.
        </p></li><li class="listitem"><p>
          The <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege can be used
          to terminate other sessions or change how the server operates.
        </p></li><li class="listitem"><p>
          Privileges granted for the <code class="literal">mysql</code> database
          itself can be used to change passwords and other access
          privilege information. Passwords are stored encrypted, so a
          malicious user cannot simply read them to know the plain text
          password. However, a user with write access to the
          <code class="literal">user</code> table <code class="literal">Password</code>
          column can change an account's password, and then connect to
          the MySQL server using that account.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="grant-table-structure"></a>6.2.2 Privilege System Grant Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737186587504"></a><a class="indexterm" name="idm139737186586048"></a><p>
      The <code class="literal">mysql</code> system database includes several
      grant tables that contain information about user accounts and the
      privileges held by them.
    </p><p>
      Normally, to manipulate the contents of grant tables, you modify
      them indirectly by using account-management statements such as
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a> to set up accounts and
      control the privileges available to each one. See
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. The discussion here
      describes the underlying structure of the grant tables and how the
      server uses their contents when interacting with clients.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Direct modification of grant tables using statements such as
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> is discouraged. The server
        is free to ignore rows that become malformed as a result of such
        modifications.
</p>
</div>
<p>
      These <code class="literal">mysql</code> database tables contain grant
      information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idm139737186571568"></a>

          <a class="indexterm" name="idm139737186570080"></a>

          <a class="indexterm" name="idm139737186568592"></a>

          <code class="literal">user</code>: User accounts, global privileges, and
          other non-privilege columns.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186565552"></a>

          <a class="indexterm" name="idm139737186564064"></a>

          <a class="indexterm" name="idm139737186562576"></a>

          <code class="literal">db</code>: Database-level privileges.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186559616"></a>

          <a class="indexterm" name="idm139737186558128"></a>

          <a class="indexterm" name="idm139737186556640"></a>

          <code class="literal">host</code>: Obsolete. MySQL install operations do
          not create this table as of MySQL 5.6.7.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186553584"></a>

          <a class="indexterm" name="idm139737186552096"></a>

          <a class="indexterm" name="idm139737186550608"></a>

          <code class="literal">tables_priv</code>: Table-level privileges.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186547616"></a>

          <a class="indexterm" name="idm139737186546128"></a>

          <a class="indexterm" name="idm139737186544640"></a>

          <code class="literal">columns_priv</code>: Column-level privileges.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186541648"></a>

          <a class="indexterm" name="idm139737186540160"></a>

          <a class="indexterm" name="idm139737186538672"></a>

          <code class="literal">procs_priv</code>: Stored procedure and function
          privileges.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186535648"></a>

          <a class="indexterm" name="idm139737186534160"></a>

          <a class="indexterm" name="idm139737186532672"></a>

          <code class="literal">proxies_priv</code>: Proxy-user privileges.
</p></li></ul>
</div>
<p>
      Other tables in the <code class="literal">mysql</code> database do not hold
      grant information and are discussed elsewhere:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idm139737186528080"></a>

          <a class="indexterm" name="idm139737186526592"></a>

          <code class="literal">event</code>: Information about Event Scheduler
          events. See <a class="xref" href="stored-programs-views.html#events" title="20.4 Using the Event Scheduler">Section 20.4, “Using the Event Scheduler”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186522768"></a>

          <a class="indexterm" name="idm139737186521280"></a>

          <code class="literal">func</code>: Information about user-defined
          functions. See <a class="xref" href="extending-mysql.html#adding-functions" title="24.3 Adding New Functions to MySQL">Section 24.3, “Adding New Functions to MySQL”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186517408"></a>

          <a class="indexterm" name="idm139737186515920"></a>

          <a class="indexterm" name="idm139737186514432"></a>

          <a class="indexterm" name="idm139737186512944"></a>

          <code class="literal">general_log</code>, <code class="literal">slow_log</code>:
          Used for logging. See <a class="xref" href="server-administration.html#server-logs" title="5.2 MySQL Server Logs">Section 5.2, “MySQL Server Logs”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186508592"></a>

          <a class="indexterm" name="idm139737186507104"></a>

          <code class="literal">help_<em class="replaceable"><code>xxx</code></em></code>: Used
          for server-side help. See
          <a class="xref" href="server-administration.html#server-side-help-support" title="5.1.10 Server-Side Help">Section 5.1.10, “Server-Side Help”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186503088"></a>

          <a class="indexterm" name="idm139737186501632"></a>

          <a class="indexterm" name="idm139737186500128"></a>

          <a class="indexterm" name="idm139737186498624"></a>

          <code class="literal">innodb_index_stats</code>,
          <code class="literal">innodb_table_stats</code>: Used for
          <code class="literal">InnoDB</code> persistent optimizer statistics. See
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="14.3.11.1 Configuring Persistent Optimizer Statistics Parameters">Section 14.3.11.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186493488"></a>

          <a class="indexterm" name="idm139737186492000"></a>

          <code class="literal">ndb_binlog_index</code>: Used for MySQL Cluster
          replication. See
          <a class="xref" href="mysql-cluster.html#mysql-cluster-replication-schema" title="18.6.4 MySQL Cluster Replication Schema and Tables">Section 18.6.4, “MySQL Cluster Replication Schema and Tables”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186488048"></a>

          <a class="indexterm" name="idm139737186486560"></a>

          <code class="literal">plugin</code>: Information about server plugins.
          See <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>, and
          <a class="xref" href="extending-mysql.html#plugin-api" title="24.2 The MySQL Plugin API">Section 24.2, “The MySQL Plugin API”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186482256"></a>

          <a class="indexterm" name="idm139737186480768"></a>

          <code class="literal">proc</code>: Information about stored procedures
          and functions. See <a class="xref" href="stored-programs-views.html#stored-routines" title="20.2 Using Stored Routines (Procedures and Functions)">Section 20.2, “Using Stored Routines (Procedures and Functions)”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186476960"></a>

          <a class="indexterm" name="idm139737186475472"></a>

          <code class="literal">servers</code>: Used by the
          <code class="literal">FEDERATED</code> storage engine. See
          <a class="xref" href="storage-engines.html#federated-create-server" title="15.8.2.2 Creating a FEDERATED Table Using CREATE SERVER">Section 15.8.2.2, “Creating a FEDERATED Table Using CREATE SERVER”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186470896"></a>

          <a class="indexterm" name="idm139737186469408"></a>

          <a class="indexterm" name="idm139737186467920"></a>

          <a class="indexterm" name="idm139737186466416"></a>

          <a class="indexterm" name="idm139737186464912"></a>

          <a class="indexterm" name="idm139737186463424"></a>

          <code class="literal">slave_master_info</code>,
          <code class="literal">slave_relay_log_info</code>,
          <code class="literal">slave_worker_info</code>: Used for replication.
          See <a class="xref" href="replication.html#slave-logs" title="17.2.2 Replication Relay and Status Logs">Section 17.2.2, “Replication Relay and Status Logs”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186458320"></a>

          <a class="indexterm" name="idm139737186456832"></a>

          <code class="literal">time_zone_<em class="replaceable"><code>xxx</code></em></code>:
          Used for time zone information. See
          <a class="xref" href="globalization.html#time-zone-support" title="10.6 MySQL Server Time Zone Support">Section 10.6, “MySQL Server Time Zone Support”</a>.
</p></li></ul>
</div>
<p>
      Each grant table contains scope columns and privilege columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Scope columns determine the scope of each row in the tables;
          that is, the context in which the row applies. For example, a
          <code class="literal">user</code> table row with <code class="literal">Host</code>
          and <code class="literal">User</code> values of
          <code class="literal">'thomas.loc.gov'</code> and
          <code class="literal">'bob'</code> applies to authenticating connections
          made to the server from the host
          <code class="literal">thomas.loc.gov</code> by a client that specifies a
          user name of <code class="literal">bob</code>. Similarly, a
          <code class="literal">db</code> table row with <code class="literal">Host</code>,
          <code class="literal">User</code>, and <code class="literal">Db</code> column
          values of <code class="literal">'thomas.loc.gov'</code>,
          <code class="literal">'bob'</code> and <code class="literal">'reports'</code>
          applies when <code class="literal">bob</code> connects from the host
          <code class="literal">thomas.loc.gov</code> to access the
          <code class="literal">reports</code> database. The
          <code class="literal">tables_priv</code> and
          <code class="literal">columns_priv</code> tables contain scope columns
          indicating tables or table/column combinations to which each
          row applies. The <code class="literal">procs_priv</code> scope columns
          indicate the stored routine to which each row applies.
        </p></li><li class="listitem"><p>
          Privilege columns indicate which privileges a table row
          grants; that is, which operations it permits to be performed.
          The server combines the information in the various grant
          tables to form a complete description of a user's privileges.
          <a class="xref" href="security.html#request-access" title="6.2.5 Access Control, Stage 2: Request Verification">Section 6.2.5, “Access Control, Stage 2: Request Verification”</a>, describes the rules for
          this.
</p></li></ul>
</div>
<p>
      The server uses the grant tables in the following manner:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">user</code> table scope columns determine
          whether to reject or permit incoming connections. For
          permitted connections, any privileges granted in the
          <code class="literal">user</code> table indicate the user's global
          privileges. Any privileges granted in this table apply to
          <span class="emphasis"><em>all</em></span> databases on the server.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
            Because any global privilege is considered a privilege for
            all databases, any global privilege enables a user to see
            all database names with <a class="link" href="sql-syntax.html#show-databases" title="13.7.5.15 SHOW DATABASES Syntax"><code class="literal">SHOW
            DATABASES</code></a> or by examining the
            <a class="link" href="information-schema.html#schemata-table" title="21.19 The INFORMATION_SCHEMA SCHEMATA Table"><code class="literal">SCHEMATA</code></a> table of
            <code class="literal">INFORMATION_SCHEMA</code>.
</p>
</div>
</li><li class="listitem"><p>
          The <code class="literal">db</code> table scope columns determine which
          users can access which databases from which hosts. The
          privilege columns determine the permitted operations. A
          privilege granted at the database level applies to the
          database and to all objects in the database, such as tables
          and stored programs.
        </p></li><li class="listitem"><p>
          The <code class="literal">tables_priv</code> and
          <code class="literal">columns_priv</code> tables are similar to the
          <code class="literal">db</code> table, but are more fine-grained: They
          apply at the table and column levels rather than at the
          database level. A privilege granted at the table level applies
          to the table and to all its columns. A privilege granted at
          the column level applies only to a specific column.
        </p></li><li class="listitem"><p>
          The <code class="literal">procs_priv</code> table applies to stored
          routines (procedures and functions). A privilege granted at
          the routine level applies only to a single procedure or
          function.
        </p></li><li class="listitem"><p>
          The <code class="literal">proxies_priv</code> table indicates which
          users can act as proxies for other users and whether a user
          can grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege
          to other users.
</p></li></ul>
</div>
<p>
      The server uses the <code class="literal">user</code> and
      <code class="literal">db</code> tables in the <code class="literal">mysql</code>
      database at both the first and second stages of access control
      (see <a class="xref" href="security.html#privilege-system" title="6.2 The MySQL Access Privilege System">Section 6.2, “The MySQL Access Privilege System”</a>). The columns in the
      <code class="literal">user</code> and <code class="literal">db</code> tables are shown
      here.
</p>
<div class="table">
<a name="idm139737186412416"></a><p class="title"><b>Table 6.3 user and db Table Columns</b></p>
<div class="table-contents">
<table summary="user and db Table Columns" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Table Name</th><th scope="col"><code class="literal">user</code></th><th scope="col"><code class="literal">db</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Scope columns</strong></span></td><td><code class="literal">Host</code></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Password</code></td><td><code class="literal">User</code></td></tr><tr><td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td><td><code class="literal">Select_priv</code></td><td><code class="literal">Select_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Insert_priv</code></td><td><code class="literal">Insert_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Update_priv</code></td><td><code class="literal">Update_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Delete_priv</code></td><td><code class="literal">Delete_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Index_priv</code></td><td><code class="literal">Index_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Alter_priv</code></td><td><code class="literal">Alter_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_priv</code></td><td><code class="literal">Create_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Drop_priv</code></td><td><code class="literal">Drop_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grant_priv</code></td><td><code class="literal">Grant_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_view_priv</code></td><td><code class="literal">Create_view_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Show_view_priv</code></td><td><code class="literal">Show_view_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_routine_priv</code></td><td><code class="literal">Create_routine_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Alter_routine_priv</code></td><td><code class="literal">Alter_routine_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Execute_priv</code></td><td><code class="literal">Execute_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Trigger_priv</code></td><td><code class="literal">Trigger_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Event_priv</code></td><td><code class="literal">Event_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Create_tmp_table_priv</code></td><td><code class="literal">Create_tmp_table_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Lock_tables_priv</code></td><td><code class="literal">Lock_tables_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">References_priv</code></td><td><code class="literal">References_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Reload_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Shutdown_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Process_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">File_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Show_db_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Super_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Repl_slave_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Repl_client_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Create_user_priv</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">Create_tablespace_priv</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>Security columns</strong></span></td><td><code class="literal">ssl_type</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">ssl_cipher</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">x509_issuer</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">x509_subject</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">plugin</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">authentication_string</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">password_expired</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>Resource control columns</strong></span></td><td><code class="literal">max_questions</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_updates</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_connections</code></td><td> </td></tr><tr><td scope="row"> </td><td><code class="literal">max_user_connections</code></td><td> </td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      The <code class="literal">user</code> table <code class="literal">plugin</code>,
      <code class="literal">Password</code>, and
      <code class="literal">authentication_string</code> columns store
      authentication plugin and credential information.
    </p><p>
      If an account row names a plugin in the <code class="literal">plugin</code>
      column, the server uses it to authenticate connection attempts for
      the account. It is up to the plugin whether it uses the
      <code class="literal">Password</code> and
      <code class="literal">authentication_string</code> column values.
    </p><p>
      If the <code class="literal">plugin</code> column for an account row is
      empty, the server authenticates the account using the
      <code class="literal">mysql_native_password</code> or
      <code class="literal">mysql_old_password</code> plugin implicitly, depending
      on the format of the password hash in the
      <code class="literal">Password</code> column. If the
      <code class="literal">Password</code> value is empty or a 4.1 password hash
      (41 characters), the server uses
      <code class="literal">mysql_native_password</code>. If the password value is
      a pre-4.1 password hash (16 characters), the server uses
      <code class="literal">mysql_old_password</code>. (For additional information
      about these hash formats, see <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>.)
      Clients must match the password in the <code class="literal">Password</code>
      column of the account row.
    </p><p>
      The <code class="literal">password_expired</code> column was added in MySQL
      5.6.6 to permit DBAs to expire account passwords and require users
      to reset their password. The default
      <code class="literal">password_expired</code> value is
      <code class="literal">'N'</code>, but can be set to <code class="literal">'Y'</code>
      with the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement.
      After an account's password has been expired, all operations
      performed by the account in subsequent connections to the server
      result in an error until the user issues a
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statement to establish
      a new account password.
    </p><p>
      It is possible after password expiration to <span class="quote">“<span class="quote">reset</span>”</span> a
      password by setting it to its current value. As a matter of good
      policy, it is preferable to choose a different password.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
        In MySQL 5.6.6, <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> also
        sets the <code class="literal">Password</code> column to the empty string,
        so do not use this statement until 5.6.7.
</p>
</div>
<p>
      During the second stage of access control, the server performs
      request verification to ensure that each client has sufficient
      privileges for each request that it issues. In addition to the
      <code class="literal">user</code> and <code class="literal">db</code> grant tables,
      the server may also consult the <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code> tables for requests that involve
      tables. The latter tables provide finer privilege control at the
      table and column levels. They have the columns shown in the
      following table.
</p>
<div class="table">
<a name="idm139737186291248"></a><p class="title"><b>Table 6.4 tables_priv and columns_priv Table Columns</b></p>
<div class="table-contents">
<table summary="tables_priv and columns_priv Table Columns" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Table Name</th><th scope="col"><code class="literal">tables_priv</code></th><th scope="col"><code class="literal">columns_priv</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Scope columns</strong></span></td><td><code class="literal">Host</code></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Db</code></td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td><td><code class="literal">User</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Table_name</code></td><td><code class="literal">Table_name</code></td></tr><tr><td scope="row"> </td><td> </td><td><code class="literal">Column_name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td><td><code class="literal">Table_priv</code></td><td><code class="literal">Column_priv</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Column_priv</code></td><td> </td></tr><tr><td scope="row"><span class="bold"><strong>Other columns</strong></span></td><td><code class="literal">Timestamp</code></td><td><code class="literal">Timestamp</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grantor</code></td><td> </td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      The <code class="literal">Timestamp</code> and <code class="literal">Grantor</code>
      columns are set to the current timestamp and the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a> value, respectively,
      but are otherwise unused.
    </p><p>
      For verification of requests that involve stored routines, the
      server may consult the <code class="literal">procs_priv</code> table, which
      has the columns shown in the following table.
</p>
<div class="table">
<a name="idm139737186260272"></a><p class="title"><b>Table 6.5 procs_priv Table Columns</b></p>
<div class="table-contents">
<table summary="procs_priv Table Columns" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Table Name</th><th scope="col"><code class="literal">procs_priv</code></th></tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Scope columns</strong></span></td><td><code class="literal">Host</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Db</code></td></tr><tr><td scope="row"> </td><td><code class="literal">User</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Routine_name</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Routine_type</code></td></tr><tr><td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td><td><code class="literal">Proc_priv</code></td></tr><tr><td scope="row"><span class="bold"><strong>Other columns</strong></span></td><td><code class="literal">Timestamp</code></td></tr><tr><td scope="row"> </td><td><code class="literal">Grantor</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      The <code class="literal">Routine_type</code> column is an
      <a class="link" href="data-types.html#enum" title="11.4.4 The ENUM Type"><code class="literal">ENUM</code></a> column with values of
      <code class="literal">'FUNCTION'</code> or <code class="literal">'PROCEDURE'</code> to
      indicate the type of routine the row refers to. This column
      enables privileges to be granted separately for a function and a
      procedure with the same name.
    </p><p>
      The <code class="literal">Timestamp</code> and <code class="literal">Grantor</code>
      columns are unused.
    </p><p>
      The <code class="literal">proxies_priv</code> table records information
      about proxy accounts. It has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">Host</code>, <code class="literal">User</code>: The proxy
          account; that is, the account that has the
          <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for the proxied
          account.
        </p></li><li class="listitem"><p>
          <code class="literal">Proxied_host</code>,
          <code class="literal">Proxied_user</code>: The proxied account.
        </p></li><li class="listitem"><p>
          <code class="literal">Grantor</code>, <code class="literal">Timestamp</code>:
          Unused.
        </p></li><li class="listitem"><p>
          <code class="literal">With_grant</code>: Whether the proxy account can
          grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to
          other accounts.
</p></li></ul>
</div>
<p>
      For an account to be able to grant the
      <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to other accounts,
      it must have a row in the <code class="literal">proxies_priv</code> table
      with <code class="literal">With_grant</code> set to 1 and
      <code class="literal">Proxied_host</code> and
      <code class="literal">Proxied_user</code> set to indicate the account or
      accounts for which the privilege can be granted. For example, the
      <code class="literal">'root'@'localhost'</code> account created during MySQL
      installation has a row in the <code class="literal">proxies_priv</code>
      table that enables granting the
      <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
      <code class="literal">''@''</code>, that is, for all users and all hosts.
      This enables <code class="literal">root</code> to set up proxy users, as
      well as to delegate to other accounts the authority to set up
      proxy users. See <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
    </p><p>
      Scope columns in the grant tables contain strings. The default
      value for each is the empty string. The following table shows the
      number of characters permitted in each column.
</p>
<div class="table">
<a name="idm139737186213712"></a><p class="title"><b>Table 6.6 Grant Table Scope Column Lengths</b></p>
<div class="table-contents">
<table summary="Grant Table Scope Column Lengths" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Column Name</th><th scope="col">Maximum Permitted Characters</th></tr></thead><tbody><tr><td scope="row"><code class="literal">Host</code>, <code class="literal">Proxied_host</code></td><td>60</td></tr><tr><td scope="row"><code class="literal">User</code>, <code class="literal">Proxied_user</code></td><td>16</td></tr><tr><td scope="row"><code class="literal">Password</code></td><td>41</td></tr><tr><td scope="row"><code class="literal">Db</code></td><td>64</td></tr><tr><td scope="row"><code class="literal">Table_name</code></td><td>64</td></tr><tr><td scope="row"><code class="literal">Column_name</code></td><td>64</td></tr><tr><td scope="row"><code class="literal">Routine_name</code></td><td>64</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><a class="indexterm" name="idm139737186196800"></a><p>
      For access-checking purposes, comparisons of
      <code class="literal">User</code>, <code class="literal">Proxied_user</code>,
      <code class="literal">Password</code>, <code class="literal">Db</code>, and
      <code class="literal">Table_name</code> values are case sensitive.
      Comparisons of <code class="literal">Host</code>,
      <code class="literal">Proxied_host</code>, <code class="literal">Column_name</code>,
      and <code class="literal">Routine_name</code> values are not case sensitive.
    </p><p>
      The <code class="literal">user</code> and <code class="literal">db</code> tables list
      each privilege in a separate column that is declared as
      <code class="literal">ENUM('N','Y') DEFAULT 'N'</code>. In other words, each
      privilege can be disabled or enabled, with the default being
      disabled.
    </p><p>
      The <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, and <code class="literal">procs_priv</code>
      tables declare the privilege columns as
      <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> columns. Values in these
      columns can contain any combination of the privileges controlled
      by the table. Only those privileges listed in the column value are
      enabled.
</p>
<div class="table">
<a name="idm139737186181776"></a><p class="title"><b>Table 6.7 Set-Type Privilege Column Values</b></p>
<div class="table-contents">
<table summary="Set-Type Privilege Column Values" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Table Name</th><th scope="col">Column Name</th><th scope="col">Possible Set Elements</th></tr></thead><tbody><tr><td scope="row"><code class="literal">tables_priv</code></td><td><code class="literal">Table_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop',
              'Grant', 'References', 'Index', 'Alter', 'Create View',
'Show view', 'Trigger'</code></td></tr><tr><td scope="row"><code class="literal">tables_priv</code></td><td><code class="literal">Column_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td></tr><tr><td scope="row"><code class="literal">columns_priv</code></td><td><code class="literal">Column_priv</code></td><td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td></tr><tr><td scope="row"><code class="literal">procs_priv</code></td><td><code class="literal">Proc_priv</code></td><td><code class="literal">'Execute', 'Alter Routine', 'Grant'</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      Only the <code class="literal">user</code> table specifies administrative
      privileges, such as <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> and
      <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a>. Administrative operations
      are operations on the server itself and are not database-specific,
      so there is no reason to list these privileges in the other grant
      tables. Consequently, the server need consult only the
      <code class="literal">user</code> table to determine whether a user can
      perform an administrative operation.
    </p><p>
      The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege also is
      specified only in the <code class="literal">user</code> table. It is not an
      administrative privilege as such, but a user's ability to read or
      write files on the server host is independent of the database
      being accessed.
    </p><p>
      The server reads the contents of the grant tables into memory when
      it starts. You can tell it to reload the tables by issuing a
      <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH PRIVILEGES</code></a>
      statement or executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
      flush-privileges</strong></span></a> or <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a>
      command. Changes to the grant tables take effect as indicated in
      <a class="xref" href="security.html#privilege-changes" title="6.2.6 When Privilege Changes Take Effect">Section 6.2.6, “When Privilege Changes Take Effect”</a>.
    </p><p>
      When you modify an account, it is a good idea to verify that your
      changes have the intended effect. To check the privileges for a
      given account, use the <a class="link" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
      statement. For example, to determine the privileges that are
      granted to an account with user name and host name values of
      <code class="literal">bob</code> and <code class="literal">pc84.example.com</code>,
      use this statement:
    </p><pre class="programlisting">
SHOW GRANTS FOR 'bob'@'pc84.example.com';
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-names"></a>6.2.3 Specifying Account Names</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737186147360"></a><a class="indexterm" name="idm139737186146320"></a><a class="indexterm" name="idm139737186144832"></a><a class="indexterm" name="idm139737186143344"></a><a class="indexterm" name="idm139737186141856"></a><p>
      MySQL account names consist of a user name and a host name. This
      enables creation of accounts for users with the same name who can
      connect from different hosts. This section describes how to write
      account names, including special values and wildcard rules.
    </p><p>
      In SQL statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE
      USER</code></a>, <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>, write account names
      using the following rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Syntax for account names is
          <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>.
        </p></li><li class="listitem"><p>
          An account name consisting only of a user name is equivalent
          to
          <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'%'</code>.
          For example, <code class="literal">'me'</code> is equivalent to
          <code class="literal">'me'@'%'</code>.
        </p></li><li class="listitem"><p>
          The user name and host name need not be quoted if they are
          legal as unquoted identifiers. Quotes are necessary to specify
          a <em class="replaceable"><code>user_name</code></em> string containing
          special characters (such as
          <span class="quote">“<span class="quote"><code class="literal">-</code></span>”</span>), or a
          <em class="replaceable"><code>host_name</code></em> string containing special
          characters or wildcard characters (such as
          <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span>); for example,
          <code class="literal">'test-user'@'%.com'</code>.
        </p></li><li class="listitem"><p>
          Quote user names and host names as identifiers or as strings,
          using either backticks (<span class="quote">“<span class="quote"><code class="literal">`</code></span>”</span>),
          single quotation marks (<span class="quote">“<span class="quote"><code class="literal">'</code></span>”</span>),
          or double quotation marks
          (<span class="quote">“<span class="quote"><code class="literal">"</code></span>”</span>).
        </p></li><li class="listitem"><p>
          The user name and host name parts, if quoted, must be quoted
          separately. That is, write
          <code class="literal">'me'@'localhost'</code>, not
          <code class="literal">'me@localhost'</code>; the latter is interpreted
          as <code class="literal">'me@localhost'@'%'</code>.
        </p></li><li class="listitem"><p>
          A reference to the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a>
          or <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function is
          equivalent to specifying the current client's user name and
          host name literally.
</p></li></ul>
</div>
<p>
      MySQL stores account names in grant tables in the
      <code class="literal">mysql</code> database using separate columns for the
      user name and host name parts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">user</code> table contains one row for each
          account. The <code class="literal">User</code> and
          <code class="literal">Host</code> columns store the user name and host
          name. This table also indicates which global privileges the
          account has.
        </p></li><li class="listitem"><p>
          Other grant tables indicate privileges an account has for
          databases and objects within databases. These tables have
          <code class="literal">User</code> and <code class="literal">Host</code> columns to
          store the account name. Each row in these tables associates
          with the account in the <code class="literal">user</code> table that has
          the same <code class="literal">User</code> and <code class="literal">Host</code>
          values.
</p></li></ul>
</div>
<p>
      For additional detail about grant table structure, see
      <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>.
    </p><p>
      User names and host names have certain special values or wildcard
      conventions, as described following.
    </p><p>
      A user name is either a nonblank value that literally matches the
      user name for incoming connection attempts, or a blank value
      (empty string) that matches any user name. An account with a blank
      user name is an anonymous user. To specify an anonymous user in
      SQL statements, use a quoted empty user name part, such as
      <code class="literal">''@'localhost'</code>.
    </p><p>
      The host name part of an account name can take many forms, and
      wildcards are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A host value can be a host name or an IP address (IPv4 or
          IPv6). The name <code class="literal">'localhost'</code> indicates the
          local host. The IP address <code class="literal">'127.0.0.1'</code>
          indicates the IPv4 loopback interface. The IP address
          <code class="literal">'::1'</code> indicates the IPv6 loopback
          interface.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186098080"></a>

          You can use the wildcard characters
          <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span> and
          <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> in host name or IP address
          values. These have the same meaning as for pattern-matching
          operations performed with the
          <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator. For example, a
          host value of <code class="literal">'%'</code> matches any host name,
          whereas a value of <code class="literal">'%.mysql.com'</code> matches
          any host in the <code class="literal">mysql.com</code> domain.
          <code class="literal">'192.168.1.%'</code> matches any host in the
          192.168.1 class C network.
        </p><p>
          Because you can use IP wildcard values in host values (for
          example, <code class="literal">'192.168.1.%'</code> to match every host
          on a subnet), someone could try to exploit this capability by
          naming a host <code class="literal">192.168.1.somewhere.com</code>. To
          foil such attempts, MySQL disallows matching on host names
          that start with digits and a dot. Thus, if you have a host
          named something like <code class="literal">1.2.example.com</code>, its
          name never matches the host part of account names. An IP
          wildcard value can match only IP addresses, not host names.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737186086688"></a>

          For a host value specified as an IPv4 address, you can specify
          a netmask indicating how many address bits to use for the
          network number. Netmask notation cannot be used for IPv6
          addresses.
        </p><p>
          The syntax is
          <code class="literal"><em class="replaceable"><code>host_ip</code></em>/<em class="replaceable"><code>netmask</code></em></code>.
          For example:
        </p><pre class="programlisting">
CREATE USER 'david'@'192.58.197.0/255.255.255.0';
</pre><p>
          This enables <code class="literal">david</code> to connect from any
          client host having an IP address
          <em class="replaceable"><code>client_ip</code></em> for which the following
          condition is true:
        </p><pre class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; <em class="replaceable"><code>netmask</code></em> = <em class="replaceable"><code>host_ip</code></em>
</pre><p>
          That is, for the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
          statement just shown:
        </p><pre class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; 255.255.255.0 = 192.58.197.0
</pre><p>
          IP addresses that satisfy this condition and can connect to
          the MySQL server are those in the range from
          <code class="literal">192.58.197.0</code> to
          <code class="literal">192.58.197.255</code>.
        </p><p>
          A netmask typically begins with bits set to 1, followed by
          bits set to 0. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">192.0.0.0/255.0.0.0</code>: Any host on the
              192 class A network
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.0.0/255.255.0.0</code>: Any host on
              the 192.168 class B network
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.1.0/255.255.255.0</code>: Any host on
              the 192.168.1 class C network
            </p></li><li class="listitem"><p>
              <code class="literal">192.168.1.1</code>: Only the host with this
              specific IP address
</p></li></ul>
</div>
<p>
          The following netmask will not work because it masks 28 bits,
          and 28 is not a multiple of 8:
        </p><pre class="programlisting">
192.168.0.1/255.255.255.240
</pre></li></ul>
</div>
<p>
      The server performs matching of host values in account names
      against the client host using the value returned by the system DNS
      resolver for the client host name or IP address. Except in the
      case that the account host value is specified using netmask
      notation, this comparison is performed as a string match, even for
      an account host value given as an IP address. This means that you
      should specify account host values in the same format used by DNS.
      Here are examples of problems to watch out for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Suppose that a host on the local network has a fully qualified
          name of <code class="literal">host1.example.com</code>. If DNS returns
          name lookups for this host as
          <code class="literal">host1.example.com</code>, use that name in account
          host values. But if DNS returns just <code class="literal">host1</code>,
          use <code class="literal">host1</code> instead.
        </p></li><li class="listitem"><p>
          If DNS returns the IP address for a given host as
          <code class="literal">192.168.1.2</code>, that will match an account
          host value of <code class="literal">192.168.1.2</code> but not
          <code class="literal">192.168.01.2</code>. Similarly, it will match an
          account host pattern like <code class="literal">192.168.1.%</code> but
          not <code class="literal">192.168.01.%</code>.
</p></li></ul>
</div>
<p>
      To avoid problems like this, it is advisable to check the format
      in which your DNS returns host names and addresses, and use values
      in the same format in MySQL account names.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="connection-access"></a>6.2.4 Access Control, Stage 1: Connection Verification</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737186053776"></a><a class="indexterm" name="idm139737186052736"></a><a class="indexterm" name="idm139737186051248"></a><p>
      When you attempt to connect to a MySQL server, the server accepts
      or rejects the connection based on your identity and whether you
      can verify your identity by supplying the correct password. If
      not, the server denies access to you completely. Otherwise, the
      server accepts the connection, and then enters Stage 2 and waits
      for requests.
    </p><p>
      Credential checking is performed using the three
      <code class="literal">user</code> table scope columns
      (<code class="literal">Host</code>, <code class="literal">User</code>, and
      <code class="literal">Password</code>). The server accepts the connection
      only if the <code class="literal">Host</code> and <code class="literal">User</code>
      columns in some <code class="literal">user</code> table row match the client
      host name and user name and the client supplies the password
      specified in that row. The rules for permissible
      <code class="literal">Host</code> and <code class="literal">User</code> values are
      given in <a class="xref" href="security.html#account-names" title="6.2.3 Specifying Account Names">Section 6.2.3, “Specifying Account Names”</a>.
    </p><p>
      Your identity is based on two pieces of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The client host from which you connect
        </p></li><li class="listitem"><p>
          Your MySQL user name
</p></li></ul>
</div>
<a class="indexterm" name="idm139737186038640"></a><p>
      If the <code class="literal">User</code> column value is nonblank, the user
      name in an incoming connection must match exactly. If the
      <code class="literal">User</code> value is blank, it matches any user name.
      If the <code class="literal">user</code> table row that matches an incoming
      connection has a blank user name, the user is considered to be an
      anonymous user with no name, not a user with the name that the
      client actually specified. This means that a blank user name is
      used for all further access checking for the duration of the
      connection (that is, during Stage 2).
    </p><p>
      The <code class="literal">Password</code> column can be blank. This is not a
      wildcard and does not mean that any password matches. It means
      that the user must connect without specifying a password. If the
      server authenticates a client using a plugin, the authentication
      method that the plugin implements may or may not use the password
      in the <code class="literal">Password</code> column. In this case, it is
      possible that an external password is also used to authenticate to
      the MySQL server.
    </p><a class="indexterm" name="idm139737186032208"></a><p>
      Nonblank <code class="literal">Password</code> values in the
      <code class="literal">user</code> table represent encrypted passwords. MySQL
      does not store passwords in cleartext form for anyone to see.
      Rather, the password supplied by a user who is attempting to
      connect is encrypted (using the
      <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function). The encrypted
      password then is used during the connection process when checking
      whether the password is correct. This is done without the
      encrypted password ever traveling over the connection. See
      <a class="xref" href="security.html#user-names" title="6.3.1 User Names and Passwords">Section 6.3.1, “User Names and Passwords”</a>.
    </p><p>
      From MySQL's point of view, the encrypted password is the
      <span class="emphasis"><em>real</em></span> password, so you should never give
      anyone access to it. In particular, <span class="emphasis"><em>do not give
      nonadministrative users read access to tables in the
      <code class="literal">mysql</code> database</em></span>.
    </p><p>
      The following table shows how various combinations of
      <code class="literal">Host</code> and <code class="literal">User</code> values in the
      <code class="literal">user</code> table apply to incoming connections.
</p>
<div class="informaltable">
<table summary="This table shows how various combinations of
        Host and User values in
        the user table apply to incoming connections
        to a MySQL server." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">Host</code> Value</th><th scope="col"><code class="literal">User</code> Value</th><th scope="col">Permissible Connections</th></tr></thead><tbody><tr><td scope="row"><code class="literal">'thomas.loc.gov'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from
              <code class="literal">thomas.loc.gov</code></td></tr><tr><td scope="row"><code class="literal">'thomas.loc.gov'</code></td><td><code class="literal">''</code></td><td>Any user, connecting from <code class="literal">thomas.loc.gov</code></td></tr><tr><td scope="row"><code class="literal">'%'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from any host</td></tr><tr><td scope="row"><code class="literal">'%'</code></td><td><code class="literal">''</code></td><td>Any user, connecting from any host</td></tr><tr><td scope="row"><code class="literal">'%.loc.gov'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from any host in the
              <code class="literal">loc.gov</code> domain</td></tr><tr><td scope="row"><code class="literal">'x.y.%'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from <code class="literal">x.y.net</code>,
              <code class="literal">x.y.com</code>, <code class="literal">x.y.edu</code>,
              and so on; this is probably not useful</td></tr><tr><td scope="row"><code class="literal">'144.155.166.177'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from the host with IP address
              <code class="literal">144.155.166.177</code></td></tr><tr><td scope="row"><code class="literal">'144.155.166.%'</code></td><td><code class="literal">'fred'</code></td><td><code class="literal">fred</code>, connecting from any host in the
<code class="literal">144.155.166</code> class C subnet</td></tr><tr><td scope="row"><code class="literal">'144.155.166.0/255.255.255.0'</code></td><td><code class="literal">'fred'</code></td><td>Same as previous example</td></tr></tbody></table>
</div>
<p>
      It is possible for the client host name and user name of an
      incoming connection to match more than one row in the
      <code class="literal">user</code> table. The preceding set of examples
      demonstrates this: Several of the entries shown match a connection
      from <code class="literal">thomas.loc.gov</code> by <code class="literal">fred</code>.
    </p><p>
      When multiple matches are possible, the server must determine
      which of them to use. It resolves this issue as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Whenever the server reads the <code class="literal">user</code> table
          into memory, it sorts the rows.
        </p></li><li class="listitem"><p>
          When a client attempts to connect, the server looks through
          the rows in sorted order.
        </p></li><li class="listitem"><p>
          The server uses the first row that matches the client host
          name and user name.
</p></li></ul>
</div>
<p>
      The server uses sorting rules that order rows with the
      most-specific <code class="literal">Host</code> values first. Literal host
      names and IP addresses are the most specific. (The specificity of
      a literal IP address is not affected by whether it has a netmask,
      so <code class="literal">192.168.1.13</code> and
      <code class="literal">192.168.1.0/255.255.255.0</code> are considered
      equally specific.) The pattern <code class="literal">'%'</code> means
      <span class="quote">“<span class="quote">any host</span>”</span> and is least specific. The empty string
      <code class="literal">''</code> also means <span class="quote">“<span class="quote">any host</span>”</span> but sorts
      after <code class="literal">'%'</code>. Rows with the same
      <code class="literal">Host</code> value are ordered with the most-specific
      <code class="literal">User</code> values first (a blank
      <code class="literal">User</code> value means <span class="quote">“<span class="quote">any user</span>”</span> and is
      least specific). For rows with equally-specific
      <code class="literal">Host</code> and <code class="literal">User</code> values, the
      order is indeterminate.
    </p><p>
      To see how this works, suppose that the <code class="literal">user</code>
      table looks like this:
    </p><pre class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
</pre><p>
      When the server reads the table into memory, it sorts the rows
      using the rules just described. The result after sorting looks
      like this:
    </p><pre class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
</pre><a class="indexterm" name="idm139737185961616"></a><a class="indexterm" name="idm139737185960128"></a><a class="indexterm" name="idm139737185958640"></a><p>
      When a client attempts to connect, the server looks through the
      sorted rows and uses the first match found. For a connection from
      <code class="literal">localhost</code> by <code class="literal">jeffrey</code>, two of
      the rows from the table match: the one with
      <code class="literal">Host</code> and <code class="literal">User</code> values of
      <code class="literal">'localhost'</code> and <code class="literal">''</code>, and the
      one with values of <code class="literal">'%'</code> and
      <code class="literal">'jeffrey'</code>. The <code class="literal">'localhost'</code>
      row appears first in sorted order, so that is the one the server
      uses.
    </p><p>
      Here is another example. Suppose that the <code class="literal">user</code>
      table looks like this:
    </p><pre class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| thomas.loc.gov |          | ...
+----------------+----------+-
</pre><p>
      The sorted table looks like this:
    </p><pre class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| thomas.loc.gov |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
</pre><p>
      A connection by <code class="literal">jeffrey</code> from
      <code class="literal">thomas.loc.gov</code> is matched by the first row,
      whereas a connection by <code class="literal">jeffrey</code> from any host
      is matched by the second.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        It is a common misconception to think that, for a given user
        name, all rows that explicitly name that user are used first
        when the server attempts to find a match for the connection.
        This is not true. The preceding example illustrates this, where
        a connection from <code class="literal">thomas.loc.gov</code> by
        <code class="literal">jeffrey</code> is first matched not by the row
        containing <code class="literal">'jeffrey'</code> as the
        <code class="literal">User</code> column value, but by the row with no
        user name. As a result, <code class="literal">jeffrey</code> is
        authenticated as an anonymous user, even though he specified a
        user name when connecting.
</p>
</div>
<p>
      If you are able to connect to the server, but your privileges are
      not what you expect, you probably are being authenticated as some
      other account. To find out what account the server used to
      authenticate you, use the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function. (See
      <a class="xref" href="functions.html#information-functions" title="12.14 Information Functions">Section 12.14, “Information Functions”</a>.) It returns a value in
      <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
      format that indicates the <code class="literal">User</code> and
      <code class="literal">Host</code> values from the matching
      <code class="literal">user</code> table row. Suppose that
      <code class="literal">jeffrey</code> connects and issues the following
      query:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CURRENT_USER();</code></strong>
+----------------+
| CURRENT_USER() |
+----------------+
| @localhost     |
+----------------+
</pre><p>
      The result shown here indicates that the matching
      <code class="literal">user</code> table row had a blank
      <code class="literal">User</code> column value. In other words, the server
      is treating <code class="literal">jeffrey</code> as an anonymous user.
    </p><p>
      Another way to diagnose authentication problems is to print out
      the <code class="literal">user</code> table and sort it by hand to see where
      the first match is being made.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="request-access"></a>6.2.5 Access Control, Stage 2: Request Verification</h3>

</div>

</div>

</div>
<p>
      After you establish a connection, the server enters Stage 2 of
      access control. For each request that you issue through that
      connection, the server determines what operation you want to
      perform, then checks whether you have sufficient privileges to do
      so. This is where the privilege columns in the grant tables come
      into play. These privileges can come from any of the
      <code class="literal">user</code>, <code class="literal">db</code>,
      <code class="literal">tables_priv</code>, <code class="literal">columns_priv</code>,
      or <code class="literal">procs_priv</code> tables. (You may find it helpful
      to refer to <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>, which lists
      the columns present in each of the grant tables.)
    </p><p>
      The <code class="literal">user</code> table grants privileges that are
      assigned to you on a global basis and that apply no matter what
      the default database is. For example, if the
      <code class="literal">user</code> table grants you the
      <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> privilege, you can delete
      rows from any table in any database on the server host! It is wise
      to grant privileges in the <code class="literal">user</code> table only to
      people who need them, such as database administrators. For other
      users, you should leave all privileges in the
      <code class="literal">user</code> table set to <code class="literal">'N'</code> and
      grant privileges at more specific levels only. You can grant
      privileges for particular databases, tables, columns, or routines.
    </p><a class="indexterm" name="idm139737185914880"></a><a class="indexterm" name="idm139737185913808"></a><p>
      The <code class="literal">db</code> table grants database-specific
      privileges. Values in the scope columns of this table can take the
      following forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A blank <code class="literal">User</code> value matches the anonymous
          user. A nonblank value matches literally; there are no
          wildcards in user names.
        </p></li><li class="listitem"><p>
          The wildcard characters <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span>
          and <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> can be used in the
          <code class="literal">Host</code> and <code class="literal">Db</code> columns.
          These have the same meaning as for pattern-matching operations
          performed with the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator.
          If you want to use either character literally when granting
          privileges, you must escape it with a backslash. For example,
          to include the underscore character
          (<span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span>) as part of a database
          name, specify it as <span class="quote">“<span class="quote"><code class="literal">\_</code></span>”</span> in
          the <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement.
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Host</code>
          value means <span class="quote">“<span class="quote">any host.</span>”</span>
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Db</code> value
          means <span class="quote">“<span class="quote">any database.</span>”</span>
</p></li></ul>
</div>
<a class="indexterm" name="idm139737185895568"></a><a class="indexterm" name="idm139737185894080"></a><a class="indexterm" name="idm139737185892592"></a><a class="indexterm" name="idm139737185891104"></a><p>
      The server reads the <code class="literal">db</code> table into memory and
      sorts it at the same time that it reads the
      <code class="literal">user</code> table. The server sorts the
      <code class="literal">db</code> table based on the <code class="literal">Host</code>,
      <code class="literal">Db</code>, and <code class="literal">User</code> scope columns.
      As with the <code class="literal">user</code> table, sorting puts the
      most-specific values first and least-specific values last, and
      when the server looks for matching rows, it uses the first match
      that it finds.
    </p><a class="indexterm" name="idm139737185883968"></a><a class="indexterm" name="idm139737185882464"></a><a class="indexterm" name="idm139737185880960"></a><p>
      The <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, and <code class="literal">procs_priv</code>
      tables grant table-specific, column-specific, and routine-specific
      privileges. Values in the scope columns of these tables can take
      the following forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The wildcard characters <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span>
          and <span class="quote">“<span class="quote"><code class="literal">_</code></span>”</span> can be used in the
          <code class="literal">Host</code> column. These have the same meaning as
          for pattern-matching operations performed with the
          <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator.
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Host</code>
          value means <span class="quote">“<span class="quote">any host.</span>”</span>
        </p></li><li class="listitem"><p>
          The <code class="literal">Db</code>, <code class="literal">Table_name</code>,
          <code class="literal">Column_name</code>, and
          <code class="literal">Routine_name</code> columns cannot contain
          wildcards or be blank.
</p></li></ul>
</div>
<p>
      The server sorts the <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, and <code class="literal">procs_priv</code>
      tables based on the <code class="literal">Host</code>,
      <code class="literal">Db</code>, and <code class="literal">User</code> columns. This
      is similar to <code class="literal">db</code> table sorting, but simpler
      because only the <code class="literal">Host</code> column can contain
      wildcards.
    </p><p>
      The server uses the sorted tables to verify each request that it
      receives. For requests that require administrative privileges such
      as <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> or
      <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a>, the server checks only the
      <code class="literal">user</code> table row because that is the only table
      that specifies administrative privileges. The server grants access
      if the row permits the requested operation and denies access
      otherwise. For example, if you want to execute <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
      shutdown</strong></span></a> but your <code class="literal">user</code> table row does
      not grant the <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> privilege to
      you, the server denies access without even checking the
      <code class="literal">db</code> table. (It contains no
      <code class="literal">Shutdown_priv</code> column, so there is no need to do
      so.)
    </p><p>
      For database-related requests
      (<a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and so on), the server
      first checks the user's global privileges by looking in the
      <code class="literal">user</code> table row. If the row permits the
      requested operation, access is granted. If the global privileges
      in the <code class="literal">user</code> table are insufficient, the server
      determines the user's database-specific privileges by checking the
      <code class="literal">db</code> table:
    </p><p>
      The server looks in the <code class="literal">db</code> table for a match on
      the <code class="literal">Host</code>, <code class="literal">Db</code>, and
      <code class="literal">User</code> columns. The <code class="literal">Host</code> and
      <code class="literal">User</code> columns are matched to the connecting
      user's host name and MySQL user name. The <code class="literal">Db</code>
      column is matched to the database that the user wants to access.
      If there is no row for the <code class="literal">Host</code> and
      <code class="literal">User</code>, access is denied.
    </p><p>
      After determining the database-specific privileges granted by the
      <code class="literal">db</code> table rows, the server adds them to the
      global privileges granted by the <code class="literal">user</code> table. If
      the result permits the requested operation, access is granted.
      Otherwise, the server successively checks the user's table and
      column privileges in the <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code> tables, adds those to the user's
      privileges, and permits or denies access based on the result. For
      stored-routine operations, the server uses the
      <code class="literal">procs_priv</code> table rather than
      <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code>.
    </p><p>
      Expressed in boolean terms, the preceding description of how a
      user's privileges are calculated may be summarized like this:
    </p><pre class="programlisting">
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
OR routine privileges
</pre><p>
      It may not be apparent why, if the global <code class="literal">user</code>
      row privileges are initially found to be insufficient for the
      requested operation, the server adds those privileges to the
      database, table, and column privileges later. The reason is that a
      request might require more than one type of privilege. For
      example, if you execute an
      <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT INTO ...
      SELECT</code></a> statement, you need both the
      <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> and the
      <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privileges. Your privileges
      might be such that the <code class="literal">user</code> table row grants
      one privilege and the <code class="literal">db</code> table row grants the
      other. In this case, you have the necessary privileges to perform
      the request, but the server cannot tell that from either table by
      itself; the privileges granted by the rows in both tables must be
      combined.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privilege-changes"></a>6.2.6 When Privilege Changes Take Effect</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185822880"></a><a class="indexterm" name="idm139737185821424"></a><p>
      When <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> starts, it reads all grant table
      contents into memory. The in-memory tables become effective for
      access control at that point.
    </p><p>
      If you modify the grant tables indirectly using account-management
      statements such as <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>,
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a>, <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
      PASSWORD</code></a>, or <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.5 RENAME USER Syntax"><code class="literal">RENAME USER</code></a>,
      the server notices these changes and loads the grant tables into
      memory again immediately.
    </p><p>
      If you modify the grant tables directly using statements such as
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>, your changes have no effect
      on privilege checking until you either restart the server or tell
      it to reload the tables. If you change the grant tables directly
      but forget to reload them, your changes have <span class="emphasis"><em>no
      effect</em></span> until you restart the server. This may leave you
      wondering why your changes seem to make no difference!
    </p><p>
      To tell the server to reload the grant tables, perform a
      flush-privileges operation. This can be done by issuing a
      <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH PRIVILEGES</code></a>
      statement or by executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
      flush-privileges</strong></span></a> or <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a>
      command.
    </p><p>
      A grant table reload affects privileges for each existing client
      connection as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Table and column privilege changes take effect with the
          client's next request.
        </p></li><li class="listitem"><p>
          Database privilege changes take effect the next time the
          client executes a <code class="literal">USE
          <em class="replaceable"><code>db_name</code></em></code> statement.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Client applications may cache the database name; thus, this
            effect may not be visible to them without actually changing
            to a different database or flushing the privileges.
</p>
</div>
</li><li class="listitem"><p>
          Global privileges and passwords are unaffected for a connected
          client. These changes take effect only for subsequent
          connections.
</p></li></ul>
</div>
<p>
      If the server is started with the
      <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option, it does
      not read the grant tables or implement any access control. Anyone
      can connect and do anything, <span class="emphasis"><em>which is
      insecure.</em></span> To cause a server thus started to read the
      tables and enable access checking, flush the privileges.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="problems-connecting"></a>6.2.7 Troubleshooting Problems Connecting to MySQL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185794848"></a><a class="indexterm" name="idm139737185793808"></a><a class="indexterm" name="idm139737185792320"></a><p>
      If you encounter problems when you try to connect to the MySQL
      server, the following items describe some courses of action you
      can take to correct the problem.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure that the server is running. If it is not, clients
          cannot connect to it. For example, if an attempt to connect to
          the server fails with a message such as one of those
          following, one cause might be that the server is not running:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2003: Can't connect to MySQL server on '<em class="replaceable"><code>host_name</code></em>' (111)
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2002: Can't connect to local MySQL server through socket
'/tmp/mysql.sock' (111)
</pre></li><li class="listitem"><p>
          It might be that the server is running, but you are trying to
          connect using a TCP/IP port, named pipe, or Unix socket file
          different from the one on which the server is listening. To
          correct this when you invoke a client program, specify a
          <a class="link" href="programs.html#option_general_port"><code class="option">--port</code></a> option to indicate the
          proper port number, or a
          <a class="link" href="programs.html#option_general_socket"><code class="option">--socket</code></a> option to indicate
          the proper named pipe or Unix socket file. To find out where
          the socket file is, you can use this command:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre></li><li class="listitem"><p>
          Make sure that the server has not been configured to ignore
          network connections or (if you are attempting to connect
          remotely) that it has not been configured to listen only
          locally on its network interfaces. If the server was started
          with <a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a>, it will
          not accept TCP/IP connections at all. If the server was
          started with
          <a class="link" href="server-administration.html#option_mysqld_bind-address"><code class="option">--bind-address=127.0.0.1</code></a>, it
          will listen for TCP/IP connections only locally on the
          loopback interface and will not accept remote connections.
        </p></li><li class="listitem"><p>
          Check to make sure that there is no firewall blocking access
          to MySQL. Your firewall may be configured on the basis of the
          application being executed, or the port number used by MySQL
          for communication (3306 by default). Under Linux or Unix,
          check your IP tables (or similar) configuration to ensure that
          the port has not been blocked. Under Windows, applications
          such as ZoneAlarm or the Windows XP personal firewall may need
          to be configured not to block the MySQL port.
        </p></li><li class="listitem"><p>
          The grant tables must be properly set up so that the server
          can use them for access control. For some distribution types
          (such as binary distributions on Windows, or RPM distributions
          on Linux), the installation process initializes the
          <code class="literal">mysql</code> database containing the grant tables.
          For distributions that do not do this, you must initialize the
          grant tables manually. For details, see
          <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
        </p><p>
          To determine whether you need to initialize the grant tables,
          look for a <code class="filename">mysql</code> directory under the data
          directory. (The data directory normally is named
          <code class="filename">data</code> or <code class="filename">var</code> and is
          located under your MySQL installation directory.) Make sure
          that you have a file named <code class="filename">user.MYD</code> in
          the <code class="filename">mysql</code> database directory. If not,
          execute the <a class="link" href="programs.html#mysql-install-db" title="4.4.3 mysql_install_db — Initialize MySQL Data Directory"><span class="command"><strong>mysql_install_db</strong></span></a> program. After
          running this program and starting the server, test the initial
          privileges by executing this command:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root test</code></strong>
</pre><p>
          The server should let you connect without error.
        </p></li><li class="listitem"><p>
          After a fresh installation, you should connect to the server
          and set up your users and their access permissions:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root mysql</code></strong>
</pre><p>
          The server should let you connect because the MySQL
          <code class="literal">root</code> user has no password initially. That
          is also a security risk, so setting the password for the
          <code class="literal">root</code> accounts is something you should do
          while you're setting up your other MySQL accounts. For
          instructions on setting the initial passwords, see
          <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Accounts">Section 2.10.4, “Securing the Initial MySQL Accounts”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737185761664"></a>

          If you have updated an existing MySQL installation to a newer
          version, did you run the <a class="link" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a>
          script? If not, do so. The structure of the grant tables
          changes occasionally when new capabilities are added, so after
          an upgrade you should always make sure that your tables have
          the current structure. For instructions, see
          <a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables">Section 4.4.7, “<span class="command"><strong>mysql_upgrade</strong></span> — Check and Upgrade MySQL Tables”</a>.
        </p></li><li class="listitem"><p>
          If a client program receives the following error message when
          it tries to connect, it means that the server expects
          passwords in a newer format than the client is capable of
          generating:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre><p>
          For information on how to deal with this, see
          <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>, and
          <a class="xref" href="error-handling.html#old-client" title="B.5.2.4 Client does not support authentication protocol">Section B.5.2.4, “Client does not support authentication protocol”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm139737185753216"></a>

          <a class="indexterm" name="idm139737185752144"></a>

          <a class="indexterm" name="idm139737185751072"></a>

          <a class="indexterm" name="idm139737185750000"></a>

          Remember that client programs use connection parameters
          specified in option files or environment variables. If a
          client program seems to be sending incorrect default
          connection parameters when you have not specified them on the
          command line, check any applicable option files and your
          environment. For example, if you get <code class="literal">Access
          denied</code> when you run a client without any options,
          make sure that you have not specified an old password in any
          of your option files!
        </p><p>
          You can suppress the use of option files by a client program
          by invoking it with the
          <a class="link" href="programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a> option. For
          example:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin --no-defaults -u root version</code></strong>
</pre><p>
          The option files that clients use are listed in
          <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>. Environment variables are
          listed in <a class="xref" href="installing.html#environment-variables" title="2.12 Environment Variables">Section 2.12, “Environment Variables”</a>.
        </p></li><li class="listitem"><p>
          If you get the following error, it means that you are using an
          incorrect <code class="literal">root</code> password:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> ver</code></strong>
Access denied for user 'root'@'localhost' (using password: YES)
</pre><p>
          If the preceding error occurs even when you have not specified
          a password, it means that you have an incorrect password
          listed in some option file. Try the
          <a class="link" href="programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a> option as
          described in the previous item.
        </p><p>
          For information on changing passwords, see
          <a class="xref" href="security.html#assigning-passwords" title="6.3.5 Assigning Account Passwords">Section 6.3.5, “Assigning Account Passwords”</a>.
        </p><p>
          If you have lost or forgotten the <code class="literal">root</code>
          password, see <a class="xref" href="error-handling.html#resetting-permissions" title="B.5.4.1 How to Reset the Root Password">Section B.5.4.1, “How to Reset the Root Password”</a>.
        </p></li><li class="listitem"><p>
          If you change a password by using <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
          PASSWORD</code></a>, <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>, or
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, you must encrypt the
          password using the <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
          function. If you do not use
          <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> for these
          statements, the password will not work. For example, the
          following statement assigns a password, but fails to encrypt
          it, so the user is not able to connect afterward:
        </p><pre class="programlisting">
SET PASSWORD FOR 'abe'@'<em class="replaceable"><code>host_name</code></em>' = 'eagle';
</pre><p>
          Instead, set the password like this:
        </p><pre class="programlisting">
SET PASSWORD FOR 'abe'@'<em class="replaceable"><code>host_name</code></em>' = PASSWORD('eagle');
</pre><p>
          The <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function is
          unnecessary when you specify a password using the
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements or the
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin password</strong></span></a> command. Each of those
          automatically uses <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>
          to encrypt the password. See
          <a class="xref" href="security.html#assigning-passwords" title="6.3.5 Assigning Account Passwords">Section 6.3.5, “Assigning Account Passwords”</a>, and
          <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax">Section 13.7.1.2, “CREATE USER Syntax”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">localhost</code> is a synonym for your local host
          name, and is also the default host to which clients try to
          connect if you specify no host explicitly.
        </p><p>
          You can use a <a class="link" href="programs.html#option_general_host"><code class="option">--host=127.0.0.1</code></a>
          option to name the server host explicitly. This will make a
          TCP/IP connection to the local <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server. You can also use TCP/IP by specifying a
          <a class="link" href="programs.html#option_general_host"><code class="option">--host</code></a> option that uses the
          actual host name of the local host. In this case, the host
          name must be specified in a <code class="literal">user</code> table row
          on the server host, even though you are running the client
          program on the same host as the server.
        </p></li><li class="listitem"><p>
          The <code class="literal">Access denied</code> error message tells you
          who you are trying to log in as, the client host from which
          you are trying to connect, and whether you were using a
          password. Normally, you should have one row in the
          <code class="literal">user</code> table that exactly matches the host
          name and user name that were given in the error message. For
          example, if you get an error message that contains
          <code class="literal">using password: NO</code>, it means that you tried
          to log in without a password.
        </p></li><li class="listitem"><p>
          If you get an <code class="literal">Access denied</code> error when
          trying to connect to the database with <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code>, you may have a
          problem with the <code class="literal">user</code> table. Check this by
          executing <code class="literal">mysql -u root mysql</code> and issuing
          this SQL statement:
        </p><pre class="programlisting">
SELECT * FROM user;
</pre><p>
          The result should include a row with the
          <code class="literal">Host</code> and <code class="literal">User</code> columns
          matching your client's host name and your MySQL user name.
        </p></li><li class="listitem"><p>
          If the following error occurs when you try to connect from a
          host other than the one on which the MySQL server is running,
          it means that there is no row in the <code class="literal">user</code>
          table with a <code class="literal">Host</code> value that matches the
          client host:
        </p><pre class="programlisting">
Host ... is not allowed to connect to this MySQL server
</pre><p>
          You can fix this by setting up an account for the combination
          of client host name and user name that you are using when
          trying to connect.
        </p><p>
          If you do not know the IP address or host name of the machine
          from which you are connecting, you should put a row with
          <code class="literal">'%'</code> as the <code class="literal">Host</code> column
          value in the <code class="literal">user</code> table. After trying to
          connect from the client machine, use a <code class="literal">SELECT
          USER()</code> query to see how you really did connect. Then
          change the <code class="literal">'%'</code> in the
          <code class="literal">user</code> table row to the actual host name that
          shows up in the log. Otherwise, your system is left insecure
          because it permits connections from any host for the given
          user name.
        </p><p>
          On Linux, another reason that this error might occur is that
          you are using a binary MySQL version that is compiled with a
          different version of the <code class="literal">glibc</code> library than
          the one you are using. In this case, you should either upgrade
          your operating system or <code class="literal">glibc</code>, or download
          a source distribution of MySQL version and compile it
          yourself. A source RPM is normally trivial to compile and
          install, so this is not a big problem.
        </p></li><li class="listitem"><p>
          If you specify a host name when trying to connect, but get an
          error message where the host name is not shown or is an IP
          address, it means that the MySQL server got an error when
          trying to resolve the IP address of the client host to a name:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> -h <em class="replaceable"><code>some_hostname</code></em> ver</code></strong>
Access denied for user 'root'@'' (using password: YES)
</pre><p>
          If you try to connect as <code class="literal">root</code> and get the
          following error, it means that you do not have a row in the
          <code class="literal">user</code> table with a <code class="literal">User</code>
          column value of <code class="literal">'root'</code> and that
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> cannot resolve the host name for
          your client:
        </p><pre class="programlisting">
Access denied for user ''@'unknown'
</pre><p>
          These errors indicate a DNS problem. To fix it, execute
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-hosts</strong></span></a> to reset the
          internal DNS host cache. See <a class="xref" href="optimization.html#host-cache" title="8.12.6.2 DNS Lookup Optimization and the Host Cache">Section 8.12.6.2, “DNS Lookup Optimization and the Host Cache”</a>.
        </p><p>
          Some permanent solutions are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Determine what is wrong with your DNS server and fix it.
            </p></li><li class="listitem"><p>
              Specify IP addresses rather than host names in the MySQL
              grant tables.
            </p></li><li class="listitem"><p>
              Put an entry for the client machine name in
              <code class="filename">/etc/hosts</code> on Unix or
              <code class="filename">\windows\hosts</code> on Windows.
            </p></li><li class="listitem"><p>
              Start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
              <a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> option.
            </p></li><li class="listitem"><p>
              Start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
              <a class="link" href="server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a> option.
            </p></li><li class="listitem"><p>
              On Unix, if you are running the server and the client on
              the same machine, connect to <code class="literal">localhost</code>.
              For connections to <code class="literal">localhost</code>, MySQL
              programs attempt to connect to the local server by using a
              Unix socket file, unless there are connection parameters
              specified to ensure that the client makes a TCP/IP
              connection. For more information, see
              <a class="xref" href="programs.html#connecting" title="4.2.2 Connecting to the MySQL Server">Section 4.2.2, “Connecting to the MySQL Server”</a>.
            </p></li><li class="listitem"><p>
              On Windows, if you are running the server and the client
              on the same machine and the server supports named pipe
              connections, connect to the host name <code class="literal">.</code>
              (period). Connections to <code class="literal">.</code> use a named
              pipe rather than TCP/IP.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          If <code class="literal">mysql -u root test</code> works but
          <code class="literal">mysql -h <em class="replaceable"><code>your_hostname</code></em> -u
          root test</code> results in <code class="literal">Access
          denied</code> (where
          <em class="replaceable"><code>your_hostname</code></em> is the actual host
          name of the local host), you may not have the correct name for
          your host in the <code class="literal">user</code> table. A common
          problem here is that the <code class="literal">Host</code> value in the
          <code class="literal">user</code> table row specifies an unqualified
          host name, but your system's name resolution routines return a
          fully qualified domain name (or vice versa). For example, if
          you have a row with host <code class="literal">'pluto'</code> in the
          <code class="literal">user</code> table, but your DNS tells MySQL that
          your host name is <code class="literal">'pluto.example.com'</code>, the
          row does not work. Try adding a row to the
          <code class="literal">user</code> table that contains the IP address of
          your host as the <code class="literal">Host</code> column value.
          (Alternatively, you could add a row to the
          <code class="literal">user</code> table with a <code class="literal">Host</code>
          value that contains a wildcard; for example,
          <code class="literal">'pluto.%'</code>. However, use of
          <code class="literal">Host</code> values ending with
          <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span> is
          <span class="emphasis"><em>insecure</em></span> and is <span class="emphasis"><em>not</em></span>
          recommended!)
        </p></li><li class="listitem"><p>
          If <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em>
          test</code> works but <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>other_db</code></em></code> does not, you
          have not granted access to the given user for the database
          named <em class="replaceable"><code>other_db</code></em>.
        </p></li><li class="listitem"><p>
          If <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code> works when
          executed on the server host, but <code class="literal">mysql -h
          <em class="replaceable"><code>host_name</code></em> -u
          <em class="replaceable"><code>user_name</code></em></code> does not work
          when executed on a remote client host, you have not enabled
          access to the server for the given user name from the remote
          host.
        </p></li><li class="listitem"><p>
          If you cannot figure out why you get <code class="literal">Access
          denied</code>, remove from the <code class="literal">user</code>
          table all rows that have <code class="literal">Host</code> values
          containing wildcards (rows that contain <code class="literal">'%'</code>
          or <code class="literal">'_'</code> characters). A very common error is
          to insert a new row with
          <code class="literal">Host</code>=<code class="literal">'%'</code> and
          <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>,
          thinking that this enables you to specify
          <code class="literal">localhost</code> to connect from the same machine.
          The reason that this does not work is that the default
          privileges include a row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">''</code>. Because that
          row has a <code class="literal">Host</code> value
          <code class="literal">'localhost'</code> that is more specific than
          <code class="literal">'%'</code>, it is used in preference to the new
          row when connecting from <code class="literal">localhost</code>! The
          correct procedure is to insert a second row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>,
          or to delete the row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">''</code>. After deleting
          the row, remember to issue a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
          PRIVILEGES</code></a> statement to reload the grant tables. See
          also <a class="xref" href="security.html#connection-access" title="6.2.4 Access Control, Stage 1: Connection Verification">Section 6.2.4, “Access Control, Stage 1: Connection Verification”</a>.
        </p></li><li class="listitem"><p>
          If you are able to connect to the MySQL server, but get an
          <code class="literal">Access denied</code> message whenever you issue a
          <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
          OUTFILE</code></a> or
          <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
          INFILE</code></a> statement, your row in the
          <code class="literal">user</code> table does not have the
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege enabled.
        </p></li><li class="listitem"><p>
          If you change the grant tables directly (for example, by using
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements) and your
          changes seem to be ignored, remember that you must execute a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
          PRIVILEGES</code></a> statement or a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          flush-privileges</strong></span></a> command to cause the server to
          reload the privilege tables. Otherwise, your changes have no
          effect until the next time the server is restarted. Remember
          that after you change the <code class="literal">root</code> password
          with an <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statement, you
          will not need to specify the new password until after you
          flush the privileges, because the server will not know you've
          changed the password yet!
        </p></li><li class="listitem"><p>
          If your privileges seem to have changed in the middle of a
          session, it may be that a MySQL administrator has changed
          them. Reloading the grant tables affects new client
          connections, but it also affects existing connections as
          indicated in <a class="xref" href="security.html#privilege-changes" title="6.2.6 When Privilege Changes Take Effect">Section 6.2.6, “When Privilege Changes Take Effect”</a>.
        </p></li><li class="listitem"><p>
          If you have access problems with a Perl, PHP, Python, or ODBC
          program, try to connect to the server with <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>db_name</code></em></code> or <code class="literal">mysql
          -u <em class="replaceable"><code>user_name</code></em>
          -p<em class="replaceable"><code>your_pass</code></em>
          <em class="replaceable"><code>db_name</code></em></code>. If you are able
          to connect using the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client, the
          problem lies with your program, not with the access
          privileges. (There is no space between <code class="option">-p</code> and
          the password; you can also use the
          <a class="link" href="programs.html#option_general_password"><code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code></a>
          syntax to specify the password. If you use the
          <code class="option">-p</code> or
          <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> option with no
          password value, MySQL prompts you for the password.)
        </p></li><li class="listitem"><p>
          For testing purposes, start the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server with the
          <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option.
          Then you can change the MySQL grant tables and use the
          <a class="link" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> statement to check
          whether your modifications have the desired effect. When you
          are satisfied with your changes, execute <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          flush-privileges</strong></span></a> to tell the
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server to reload the privileges.
          This enables you to begin using the new grant table contents
          without stopping and restarting the server.
        </p></li><li class="listitem"><p>
          If everything else fails, start the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server with a debugging option (for example,
          <a class="link" href="server-administration.html#option_mysqld_debug"><code class="option">--debug=d,general,query</code></a>). This
          prints host and user information about attempted connections,
          as well as information about each command issued. See
          <a class="xref" href="extending-mysql.html#dbug-package" title="24.4.3 The DBUG Package">Section 24.4.3, “The DBUG Package”</a>.
        </p></li><li class="listitem"><p>
          If you have any other problems with the MySQL grant tables and
          feel you must post the problem to the mailing list, always
          provide a dump of the MySQL grant tables. You can dump the
          tables with the <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump mysql</strong></span></a> command. To
          file a bug report, see the instructions at
          <a class="xref" href="introduction.html#bug-reports" title="1.6 How to Report Bugs or Problems">Section 1.6, “How to Report Bugs or Problems”</a>. In some cases, you may need to
          restart <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with
          <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> to run
          <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="user-account-management"></a>6.3 MySQL User Account Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#user-names">6.3.1 User Names and Passwords</a></span></dt><dt><span class="section"><a href="security.html#adding-users">6.3.2 Adding User Accounts</a></span></dt><dt><span class="section"><a href="security.html#removing-users">6.3.3 Removing User Accounts</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.3.4 Setting Account Resource Limits</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.3.5 Assigning Account Passwords</a></span></dt><dt><span class="section"><a href="security.html#password-expiration-sandbox-mode">6.3.6 Password Expiration and Sandbox Mode</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.3.7 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#authentication-plugins-available">6.3.8 Authentication Plugins Available in MySQL</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.3.9 Proxy Users</a></span></dt><dt><span class="section"><a href="security.html#ssl-connections">6.3.10 Using SSL for Secure Connections</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.11 Creating SSL and RSA Certificates and Keys</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.12 Connecting to MySQL Remotely from Windows with SSH</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin">6.3.13 MySQL Enterprise Audit Log Plugin</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.3.14 SQL-Based MySQL Account Activity Auditing</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.3.15 MySQL Enterprise Firewall</a></span></dt></dl>
</div>
<p>
    This section describes how to set up accounts for clients of your
    MySQL server. It discusses the following topics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The meaning of account names and passwords as used in MySQL and
        how that compares to names and passwords used by your operating
        system
      </p></li><li class="listitem"><p>
        How to set up new accounts and remove existing accounts
      </p></li><li class="listitem"><p>
        How to change passwords
      </p></li><li class="listitem"><p>
        Guidelines for using passwords securely
      </p></li><li class="listitem"><p>
        How to use secure connections with SSL
</p></li></ul>
</div>
<p>
    See also <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>, which describes
    the syntax and use for all user-management SQL statements.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-names"></a>6.3.1 User Names and Passwords</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm139737185563616"></a><a class="indexterm" name="idm139737185562160"></a><p>
      MySQL stores accounts in the <code class="literal">user</code> table of the
      <code class="literal">mysql</code> system database. An account is defined in
      terms of a user name and the client host or hosts from which the
      user can connect to the server. For information about account
      representation in the <code class="literal">user</code> table, see
      <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>.
    </p><p>
      The account may also have a password. MySQL supports
      authentication plugins, so it is possible that an account
      authenticates using some external authentication method. See
      <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
    </p><p>
      There are several distinctions between the way user names and
      passwords are used by MySQL and your operating system:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          User names, as used by MySQL for authentication purposes, have
          nothing to do with user names (login names) as used by Windows
          or Unix. On Unix, most MySQL clients by default try to log in
          using the current Unix user name as the MySQL user name, but
          that is for convenience only. The default can be overridden
          easily, because client programs permit any user name to be
          specified with a <code class="option">-u</code> or
          <code class="option">--user</code> option. This means that anyone can
          attempt to connect to the server using any user name, so you
          cannot make a database secure in any way unless all MySQL
          accounts have passwords. Anyone who specifies a user name for
          an account that has no password is able to connect
          successfully to the server.
        </p></li><li class="listitem"><p>
          MySQL user names can be up to 16 characters long. Operating
          system user names may be of a different maximum length. For
          example, Unix user names typically are limited to eight
          characters.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            The limit on MySQL user name length is hard-coded in MySQL
            servers and clients, and trying to circumvent it by
            modifying the definitions of the tables in the
            <code class="literal">mysql</code> database <span class="emphasis"><em>does not
            work</em></span>.
          </p><p>
            You should never alter the structure of tables in the
            <code class="literal">mysql</code> database in any manner whatsoever
            except by means of the procedure that is described in
            <a class="xref" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables">Section 4.4.7, “<span class="command"><strong>mysql_upgrade</strong></span> — Check and Upgrade MySQL Tables”</a>. Attempting to redefine
            MySQL's system tables in any other fashion results in
            undefined (and unsupported!) behavior. The server is free to
            ignore rows that become malformed as a result of such
            modifications.
</p>
</div>
</li><li class="listitem"><p>
          To authenticate client connections for accounts that use MySQL
          native authentication (implemented by the
          <code class="literal">mysql_native_password</code> authentication
          plugin), the server uses passwords stored in the
          <code class="literal">user</code> table. These passwords are distinct
          from passwords for logging in to your operating system. There
          is no necessary connection between the <span class="quote">“<span class="quote">external</span>”</span>
          password you use to log in to a Windows or Unix machine and
          the password you use to access the MySQL server on that
          machine.
        </p><p>
          If the server authenticates a client using some other plugin,
          the authentication method that the plugin implements may or
          may not use a password stored in the <code class="literal">user</code>
          table. In this case, it is possible that an external password
          is also used to authenticate to the MySQL server.
        </p></li><li class="listitem"><p>
          Passwords stored in the <code class="literal">user</code> table are
          encrypted using plugin-specific algorithms. For information
          about MySQL native password hashing, see
          <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>.
        </p></li><li class="listitem"><p>
          If the user name and password contain only ASCII characters,
          it is possible to connect to the server regardless of
          character set settings. To connect when the user name or
          password contain non-ASCII characters, the client should call
          the <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options()</code></a> C API
          function with the <code class="literal">MYSQL_SET_CHARSET_NAME</code>
          option and appropriate character set name as arguments. This
          causes authentication to take place using the specified
          character set. Otherwise, authentication will fail unless the
          server default character set is the same as the encoding in
          the authentication defaults.
        </p><p>
          Standard MySQL client programs support a
          <code class="option">--default-character-set</code> option that causes
          <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options()</code></a> to be called
          as just described. In addition, character set autodetection is
          supported as described in
          <a class="xref" href="globalization.html#charset-connection" title="10.1.4 Connection Character Sets and Collations">Section 10.1.4, “Connection Character Sets and Collations”</a>. For programs that use a
          connector that is not based on the C API, the connector may
          provide an equivalent to
          <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options()</code></a> that can be
          used instead. Check the connector documentation.
        </p><p>
          The preceding notes do not apply for <code class="literal">ucs2</code>,
          <code class="literal">utf16</code>, and <code class="literal">utf32</code>, which
          are not permitted as client character sets.
</p></li></ul>
</div>
<p>
      The MySQL installation process populates the grant tables with an
      initial account or accounts. The names and access privileges for
      these accounts are described in
      <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Accounts">Section 2.10.4, “Securing the Initial MySQL Accounts”</a>, which also discusses how to
      assign passwords to them. Thereafter, you normally set up, modify,
      and remove MySQL accounts using statements such as
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
      <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.3 DROP USER Syntax"><code class="literal">DROP USER</code></a>,
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a>. See
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>.
    </p><p>
      To connect to a MySQL server with a command-line client, specify
      user name and password options as necessary for the account that
      you want to use:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=monty --password <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you prefer short options, the command looks like this:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u monty -p <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you omit the password value following the
      <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> or <code class="option">-p</code>
      option on the command line (as just shown), the client prompts for
      one. Alternatively, the password can be specified on the command
      line:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=monty --password=<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
shell&gt; <strong class="userinput"><code>mysql -u monty -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you use the <code class="option">-p</code> option, there must be
      <span class="emphasis"><em>no space</em></span> between <code class="option">-p</code> and the
      following password value.
    </p><p>
      Specifying a password on the command line should be considered
      insecure. See <a class="xref" href="security.html#password-security-user" title="6.1.2.1 End-User Guidelines for Password Security">Section 6.1.2.1, “End-User Guidelines for Password Security”</a>. You can
      use an option file or a login path file to avoid giving the
      password on the command line. See <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>,
      and <a class="xref" href="programs.html#mysql-config-editor" title="4.6.6 mysql_config_editor — MySQL Configuration Utility">Section 4.6.6, “<span class="command"><strong>mysql_config_editor</strong></span> — MySQL Configuration Utility”</a>.
    </p><p>
      For additional information about specifying user names, passwords,
      and other connection parameters, see <a class="xref" href="programs.html#connecting" title="4.2.2 Connecting to the MySQL Server">Section 4.2.2, “Connecting to the MySQL Server”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="adding-users"></a>6.3.2 Adding User Accounts</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185506224"></a><a class="indexterm" name="idm139737185505152"></a><a class="indexterm" name="idm139737185503664"></a><a class="indexterm" name="idm139737185502176"></a><a class="indexterm" name="idm139737185500688"></a><a class="indexterm" name="idm139737185499200"></a><a class="indexterm" name="idm139737185497712"></a><p>
      You can create MySQL accounts two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          By using account-management statements intended for creating
          accounts and establishing their privileges, such as
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>. These statements cause
          the server to make appropriate modifications to the underlying
          grant tables.
        </p></li><li class="listitem"><p>
          By manipulating the MySQL grant tables directly with
          statements such as <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>.
</p></li></ul>
</div>
<p>
      The preferred method is to use account-management statements
      because they are more concise and less error-prone than
      manipulating the grant tables directly. All such statements are
      described in <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. Direct
      grant table manipulation is discouraged, and is not described
      here. The server is free to ignore rows that become malformed as a
      result of such modifications.
    </p><p>
      Another option for creating accounts is to use the GUI tool
      MySQL Workbench. Also, several third-party programs offer capabilities
      for MySQL account administration. <code class="literal">phpMyAdmin</code> is
      one such program.
    </p><p>
      The following examples show how to use the
      <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client program to set up new accounts.
      These examples assume that privileges have been set up according
      to the defaults described in <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Accounts">Section 2.10.4, “Securing the Initial MySQL Accounts”</a>.
      This means that to make changes, you must connect to the MySQL
      server as the MySQL <code class="literal">root</code> user, which has the
      <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege.
    </p><p>
      First, use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> program to connect to the
      server as the MySQL <code class="literal">root</code> user:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=root mysql</code></strong>
</pre><p>
      If you have assigned a password to the <code class="literal">root</code>
      account, you must also supply a <code class="option">--password</code> or
      <code class="option">-p</code> option.
    </p><p>
      After connecting to the server as <code class="literal">root</code>, you can
      add new accounts. The following example uses
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER </code></a> and
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements to set up four
      accounts:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'monty'@'localhost' IDENTIFIED BY 'some_pass';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'monty'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'monty'@'%' IDENTIFIED BY 'some_pass';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL PRIVILEGES ON *.* TO 'monty'@'%'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'admin'@'localhost' IDENTIFIED BY 'admin_pass';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT RELOAD,PROCESS ON *.* TO 'admin'@'localhost';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'dummy'@'localhost';</code></strong>
</pre><p>
      The accounts created by those statements have the following
      properties:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Two accounts have a user name of <code class="literal">monty</code> and
          a password of <code class="literal">some_pass</code>. Both are superuser
          accounts with full privileges to do anything. The
          <code class="literal">'monty'@'localhost'</code> account can be used
          only when connecting from the local host. The
          <code class="literal">'monty'@'%'</code> account uses the
          <code class="literal">'%'</code> wildcard for the host part, so it can
          be used to connect from any host.
        </p><p>
          The <code class="literal">'monty'@'localhost'</code> account is
          necessary if there is an anonymous-user account for
          <code class="literal">localhost</code>. Without the
          <code class="literal">'monty'@'localhost'</code> account, that
          anonymous-user account takes precedence when
          <code class="literal">monty</code> connects from the local host and
          <code class="literal">monty</code> is treated as an anonymous user. The
          reason for this is that the anonymous-user account has a more
          specific <code class="literal">Host</code> column value than the
          <code class="literal">'monty'@'%'</code> account and thus comes earlier
          in the <code class="literal">user</code> table sort order.
          (<code class="literal">user</code> table sorting is discussed in
          <a class="xref" href="security.html#connection-access" title="6.2.4 Access Control, Stage 1: Connection Verification">Section 6.2.4, “Access Control, Stage 1: Connection Verification”</a>.)
        </p></li><li class="listitem"><p>
          The <code class="literal">'admin'@'localhost'</code> account has a
          password of <code class="literal">admin_pass</code>. This account can be
          used only by <code class="literal">admin</code> to connect from the
          local host. It is granted the
          <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> and
          <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> administrative
          privileges. These privileges enable the
          <code class="literal">admin</code> user to execute the
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a>, <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          refresh</strong></span></a>, and <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          flush-<em class="replaceable"><code>xxx</code></em></strong></span></a> commands, as
          well as <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin processlist</strong></span></a> . No
          privileges are granted for accessing any databases. You could
          add such privileges using <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>
          statements.
        </p></li><li class="listitem"><p>
          The <code class="literal">'dummy'@'localhost'</code> account has no
          password (which is insecure and not recommended). This account
          can be used only to connect from the local host. No privileges
          are granted. It is assumed that you will grant specific
          privileges to the account using
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements.
</p></li></ul>
</div>
<p>
      To see the privileges for an account, use
      <a class="link" href="sql-syntax.html#show-grants" title="13.7.5.22 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+-----------------------------------------------------+
| Grants for admin@localhost                          |
+-----------------------------------------------------+
| GRANT RELOAD, PROCESS ON *.* TO 'admin'@'localhost' |
+-----------------------------------------------------+
</pre><p>
      The next examples create three accounts and grant them access to
      specific databases. Each of them has a user name of
      <code class="literal">custom</code> and password of
      <code class="literal">obscure</code>:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'localhost' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON bankaccount.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'localhost';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'host47.example.com' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON expenses.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'host47.example.com';</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE USER 'custom'@'%.example.com' IDENTIFIED BY 'obscure';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</code></strong>
    -&gt; <strong class="userinput"><code>    ON customer.*</code></strong>
    -&gt; <strong class="userinput"><code>    TO 'custom'@'%.example.com';</code></strong>
</pre><p>
      The three accounts can be used as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The first account can access the
          <code class="literal">bankaccount</code> database, but only from the
          local host.
        </p></li><li class="listitem"><p>
          The second account can access the <code class="literal">expenses</code>
          database, but only from the host
          <code class="literal">host47.example.com</code>.
        </p></li><li class="listitem"><p>
          The third account can access the <code class="literal">customer</code>
          database, from any host in the <code class="literal">example.com</code>
          domain. This account has access from all machines in the
          domain due to use of the <span class="quote">“<span class="quote"><code class="literal">%</code></span>”</span>
          wildcard character in the host part of the account name.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="removing-users"></a>6.3.3 Removing User Accounts</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185409456"></a><a class="indexterm" name="idm139737185407968"></a><a class="indexterm" name="idm139737185406480"></a><a class="indexterm" name="idm139737185404992"></a><a class="indexterm" name="idm139737185403504"></a><a class="indexterm" name="idm139737185402016"></a><a class="indexterm" name="idm139737185400528"></a><a class="indexterm" name="idm139737185399040"></a><p>
      To remove an account, use the <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.3 DROP USER Syntax"><code class="literal">DROP
      USER</code></a> statement, which is described in
      <a class="xref" href="sql-syntax.html#drop-user" title="13.7.1.3 DROP USER Syntax">Section 13.7.1.3, “DROP USER Syntax”</a>. For example:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>DROP USER 'jeffrey'@'localhost';</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-resources"></a>6.3.4 Setting Account Resource Limits</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185392576"></a><a class="indexterm" name="idm139737185391120"></a><a class="indexterm" name="idm139737185389632"></a><a class="indexterm" name="idm139737185388560"></a><a class="indexterm" name="idm139737185387488"></a><a class="indexterm" name="idm139737185386400"></a><p>
      One means of restricting client use of MySQL server resources is
      to set the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable to a nonzero value. This limits the number of
      simultaneous connections that can be made by any given account,
      but places no limits on what a client can do once connected. In
      addition, setting
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> does not
      enable management of individual accounts. Both types of control
      are of interest to MySQL administrators.
    </p><p>
      To address such concerns, MySQL permits limits for individual
      accounts on use of these server resources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The number of queries an account can issue per hour
        </p></li><li class="listitem"><p>
          The number of updates an account can issue per hour
        </p></li><li class="listitem"><p>
          The number of times an account can connect to the server per
          hour
        </p></li><li class="listitem"><p>
          The number of simultaneous connections to the server by an
          account
</p></li></ul>
</div>
<p>
      Any statement that a client can issue counts against the query
      limit, unless its results are served from the query cache. Only
      statements that modify databases or tables count against the
      update limit.
    </p><p>
      An <span class="quote">“<span class="quote">account</span>”</span> in this context corresponds to a row in
      the <code class="literal">mysql.user</code> table. That is, a connection is
      assessed against the <code class="literal">User</code> and
      <code class="literal">Host</code> values in the <code class="literal">user</code>
      table row that applies to the connection. For example, an account
      <code class="literal">'usera'@'%.example.com'</code> corresponds to a row in
      the <code class="literal">user</code> table that has <code class="literal">User</code>
      and <code class="literal">Host</code> values of <code class="literal">usera</code> and
      <code class="literal">%.example.com</code>, to permit
      <code class="literal">usera</code> to connect from any host in the
      <code class="literal">example.com</code> domain. In this case, the server
      applies resource limits in this row collectively to all
      connections by <code class="literal">usera</code> from any host in the
      <code class="literal">example.com</code> domain because all such connections
      use the same account.
    </p><p>
      Before MySQL 5.0.3, an <span class="quote">“<span class="quote">account</span>”</span> was assessed against
      the actual host from which a user connects. This older method of
      accounting may be selected by starting the server with the
      <a class="link" href="server-administration.html#option_mysqld_old-style-user-limits"><code class="option">--old-style-user-limits</code></a> option. In
      this case, if <code class="literal">usera</code> connects simultaneously
      from <code class="literal">host1.example.com</code> and
      <code class="literal">host2.example.com</code>, the server applies the
      account resource limits separately to each connection. If
      <code class="literal">usera</code> connects again from
      <code class="literal">host1.example.com</code>, the server applies the
      limits for that connection together with the existing connection
      from that host.
    </p><p>
      To establish resource limits for an account, use the
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement (see
      <a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax">Section 13.7.1.4, “GRANT Syntax”</a>). Provide a <code class="literal">WITH</code> clause
      that names each resource to be limited. The default value for each
      limit is zero (no limit). For example, to create a new account
      that can access the <code class="literal">customer</code> database, but only
      in a limited fashion, issue these statements:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL ON customer.* TO 'francis'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH MAX_QUERIES_PER_HOUR 20</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_UPDATES_PER_HOUR 10</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_CONNECTIONS_PER_HOUR 5</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_USER_CONNECTIONS 2;</code></strong>
</pre><p>
      The limit types need not all be named in the
      <code class="literal">WITH</code> clause, but those named can be present in
      any order. The value for each per-hour limit should be an integer
      representing a count per hour. For
      <code class="literal">MAX_USER_CONNECTIONS</code>, the limit is an integer
      representing the maximum number of simultaneous connections by the
      account. If this limit is set to zero, the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable value determines the number of simultaneous connections.
      If <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> is also
      zero, there is no limit for the account.
    </p><p>
      To modify limits for an existing account, use a
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT USAGE</code></a>
      statement at the global level (<code class="literal">ON *.*</code>). The
      following statement changes the query limit for
      <code class="literal">francis</code> to 100:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'francis'@'localhost'</code></strong>
    -&gt;     <strong class="userinput"><code>WITH MAX_QUERIES_PER_HOUR 100;</code></strong>
</pre><p>
      The statement modifies only the limit value specified and leaves
      the account otherwise unchanged.
    </p><p>
      To remove a limit, set its value to zero. For example, to remove
      the limit on how many times per hour <code class="literal">francis</code>
      can connect, use this statement:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'francis'@'localhost'</code></strong>
    -&gt;     <strong class="userinput"><code>WITH MAX_CONNECTIONS_PER_HOUR 0;</code></strong>
</pre><p>
      As mentioned previously, the simultaneous-connection limit for an
      account is determined from the
      <code class="literal">MAX_USER_CONNECTIONS</code> limit and the
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable. Suppose that the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> value is 10
      and three accounts have individual resource limits specified as
      follows:
    </p><pre class="programlisting">
GRANT ... TO 'user1'@'localhost' WITH MAX_USER_CONNECTIONS 0;
GRANT ... TO 'user2'@'localhost' WITH MAX_USER_CONNECTIONS 5;
GRANT ... TO 'user3'@'localhost' WITH MAX_USER_CONNECTIONS 20;
</pre><p>
      <code class="literal">user1</code> has a connection limit of 10 (the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> value)
      because it has a <code class="literal">MAX_USER_CONNECTIONS</code> limit of
      zero. <code class="literal">user2</code> and <code class="literal">user3</code> have
      connection limits of 5 and 20, respectively, because they have
      nonzero <code class="literal">MAX_USER_CONNECTIONS</code> limits.
    </p><p>
      The server stores resource limits for an account in the
      <code class="literal">user</code> table row corresponding to the account.
      The <code class="literal">max_questions</code>,
      <code class="literal">max_updates</code>, and
      <code class="literal">max_connections</code> columns store the per-hour
      limits, and the <code class="literal">max_user_connections</code> column
      stores the <code class="literal">MAX_USER_CONNECTIONS</code> limit. (See
      <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>.)
    </p><p>
      Resource-use counting takes place when any account has a nonzero
      limit placed on its use of any of the resources.
    </p><p>
      As the server runs, it counts the number of times each account
      uses resources. If an account reaches its limit on number of
      connections within the last hour, the server rejects further
      connections for the account until that hour is up. Similarly, if
      the account reaches its limit on the number of queries or updates,
      the server rejects further queries or updates until the hour is
      up. In all such cases, the server issues appropriate error
      messages.
    </p><p>
      Resource counting occurs per account, not per client. For example,
      if your account has a query limit of 50, you cannot increase your
      limit to 100 by making two simultaneous client connections to the
      server. Queries issued on both connections are counted together.
    </p><p>
      The current per-hour resource-use counts can be reset globally for
      all accounts, or individually for a given account:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To reset the current counts to zero for all accounts, issue a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
          USER_RESOURCES</code></a> statement. The counts also can be
          reset by reloading the grant tables (for example, with a
          <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
          PRIVILEGES</code></a> statement or a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          reload</strong></span></a> command).
        </p></li><li class="listitem"><p>
          The counts for an individual account can be reset to zero by
          setting any of its limits again. Specify a limit value equal
          to the value currently assigned to the account.
</p></li></ul>
</div>
<p>
      Per-hour counter resets do not affect the
      <code class="literal">MAX_USER_CONNECTIONS</code> limit.
    </p><p>
      All counts begin at zero when the server starts. Counts do not
      carry over through server restarts.
    </p><p>
      For the <code class="literal">MAX_USER_CONNECTIONS</code> limit, an edge
      case can occur if the account currently has open the maximum
      number of connections permitted to it: A disconnect followed
      quickly by a connect can result in an error
      (<a class="link" href="error-handling.html#error_er_too_many_user_connections"><code class="literal">ER_TOO_MANY_USER_CONNECTIONS</code></a> or
      <a class="link" href="error-handling.html#error_er_user_limit_reached"><code class="literal">ER_USER_LIMIT_REACHED</code></a>) if the
      server has not fully processed the disconnect by the time the
      connect occurs. When the server finishes disconnect processing,
      another connection will once more be permitted.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="assigning-passwords"></a>6.3.5 Assigning Account Passwords</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185304816"></a><a class="indexterm" name="idm139737185303776"></a><a class="indexterm" name="idm139737185302704"></a><a class="indexterm" name="idm139737185301216"></a><p>
      Required credentials for clients that connect to the MySQL server
      can include a password. This section describes how to assign
      passwords for MySQL accounts. Client authentication occurs using
      plugins; see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
    </p><p>
      MySQL stores passwords in the <code class="literal">user</code> table in the
      <code class="literal">mysql</code> database. Operations that assign or
      modify passwords are permitted only to users with the
      <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege, or,
      alternatively, privileges for the <code class="literal">mysql</code>
      database (<a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> to create new
      accounts, <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> to modify existing
      accounts). If the <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a>
      system variable is enabled, use of account-modification statements
      such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> additionally requires
      the <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
    </p><p>
      To assign a password when you create a new account with
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>, include an
      <code class="literal">IDENTIFIED BY</code> clause:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre><p>
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> also supports syntax
      for specifying the account authentication plugin. See
      <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax">Section 13.7.1.2, “CREATE USER Syntax”</a>.
    </p><p>
      To assign or change a password for an existing account, one way is
      to issue a <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statement:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR</code></strong>
    -&gt; <strong class="userinput"><code>'jeffrey'@'localhost' = PASSWORD('mypass');</code></strong>
</pre><p>
      If you are not connected as an anonymous user, you can change your
      own password by omitting the <code class="literal">FOR</code> clause:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD = PASSWORD('mypass');</code></strong>
</pre><p>
      The <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system variable
      value determines the hashing method used by
      <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>. If you specify the
      password using that function and <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
      PASSWORD</code></a> rejects the password as not being in the
      correct format, it may be necessary to set
      <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> to change the
      hashing method. See <a class="xref" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax">Section 13.7.1.7, “SET PASSWORD Syntax”</a>.
    </p><p>
      You can also use a <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT
      USAGE</code></a> statement at the global level (<code class="literal">ON
      *.*</code>) to assign a password to an account without
      affecting the account's current privileges:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT USAGE ON *.* TO 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre><p>
      To assign a password from the command line, use the
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> command:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u <em class="replaceable"><code>user_name</code></em> -h <em class="replaceable"><code>host_name</code></em> password "<em class="replaceable"><code>newpwd</code></em>"</code></strong>
</pre><p>
      The account for which this command sets the password is the one
      with a <code class="literal">user</code> table row that matches
      <em class="replaceable"><code>user_name</code></em> in the
      <code class="literal">User</code> column and the client host <span class="emphasis"><em>from
      which you connect</em></span> in the <code class="literal">Host</code>
      column.
    </p><p>
      During authentication when a client connects to the server, MySQL
      treats the password in the <code class="literal">user</code> table as an
      encrypted hash value. When assigning a password to an account, it
      is important to store an encrypted value, not the cleartext
      password. Use the following guidelines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          When you assign a password using <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE
          USER</code></a>, <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> with an
          <code class="literal">IDENTIFIED BY</code> clause, or the
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin password</strong></span></a> command, they encrypt
          the password for you. Specify the literal cleartext password:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY 'mypass';</code></strong>
</pre></li><li class="listitem"><p>
          For <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, you can avoid sending
          the cleartext password if you know the hash value that
          <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> would return for the
          password. Specify the hash value preceded by the keyword
          <code class="literal">PASSWORD</code>:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'jeffrey'@'localhost'</code></strong>
    -&gt; <strong class="userinput"><code>IDENTIFIED BY PASSWORD '*90E462C37378CED12064BB3388827D2BA3A9B689';</code></strong>
</pre></li><li class="listitem"><p>
          When you assign an account a nonempty password using
          <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>, you must use the
          <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function to encrypt
          the password, otherwise the password is stored as cleartext.
          Suppose that you assign a password like this:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR</code></strong>
    -&gt; <strong class="userinput"><code>'jeffrey'@'localhost' = 'mypass';</code></strong>
</pre><p>
          The result is that the literal value
          <code class="literal">'mypass'</code> is stored as the password in the
          <code class="literal">user</code> table, not the encrypted value. When
          <code class="literal">jeffrey</code> attempts to connect to the server
          using this password, the value is encrypted and compared to
          the value stored in the <code class="literal">user</code> table.
          However, the stored value is the literal string
          <code class="literal">'mypass'</code>, so the comparison fails and the
          server rejects the connection with an <code class="literal">Access
          denied</code> error.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> encryption differs
        from Unix password encryption. See <a class="xref" href="security.html#user-names" title="6.3.1 User Names and Passwords">Section 6.3.1, “User Names and Passwords”</a>.
</p>
</div>
<p>
      Although it is preferable to modify passwords using
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>,
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>, or
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>, it is also possible to modify the
      <code class="literal">user</code> table directly. In this case, you must
      also use <a class="link" href="sql-syntax.html#flush" title="13.7.6.3 FLUSH Syntax"><code class="literal">FLUSH
      PRIVILEGES</code></a> to cause the server to reread the grant
      tables. Otherwise, the change remains unnoticed by the server
      until you restart it.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-expiration-sandbox-mode"></a>6.3.6 Password Expiration and Sandbox Mode</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737185217040"></a><a class="indexterm" name="idm139737185215968"></a><p>
      MySQL 5.6 introduces password-expiration capability, to enable
      database administrators to expire account passwords and require
      users to reset their password. The immediately following
      discussion describes how password expiration works currently.
      Later, the development of this capability is detailed as it
      occurred over several versions, as background to help you
      understand what features are available when. However, to ensure
      that you can take advantage of all features and fixes, you should
      use the most recent available version of MySQL 5.6 if possible.
</p>
<h4><a name="idm139737185212848"></a>How Password Expiration Works</h4>
<p>
      To expire an account password, use the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
      USER</code></a> statement. For example:
    </p><pre class="programlisting">
ALTER USER 'myuser'@'localhost' PASSWORD EXPIRE;
</pre><a class="indexterm" name="idm139737185209712"></a><p>
      This statement modifies the row of the
      <code class="literal">mysql.user</code> table associated with the named
      account, setting the <code class="literal">password_expired</code> column to
      <code class="literal">'Y'</code>. This does not affect any current
      connections the account has open. For each subsequent connection
      that uses the account, the server either disconnects the client or
      handles the client in <span class="quote">“<span class="quote">sandbox mode,</span>”</span> in which the
      server permits the client only those operations necessary to reset
      the expired password. (The action taken by the server depends on
      both client and server settings.)
    </p><p>
      If the server disconnects the client, it returns an
      <a class="link" href="error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a>
      error:
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u myuser -p</code></strong>
Password: <strong class="userinput"><code>******</code></strong>
ERROR 1862 (HY000): Your password has expired. To log in you must
change it using a client that supports expired passwords.
</pre><p>
      If the server puts the client in sandbox mode, these operations
      are permitted within the client session:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The client can reset the account password with
          <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>. This modifies the
          row of the <code class="literal">mysql.user</code> table associated with
          the current account, setting the
          <code class="literal">password_expired</code> column to
          <code class="literal">'N'</code>. After the password has been reset, the
          server restores normal access for the session, as well as for
          subsequent connections that use the account.
        </p><p>
          It is possible to <span class="quote">“<span class="quote">reset</span>”</span> a password by setting
          it to its current value. As a matter of good policy, it is
          preferable to choose a different password.
        </p></li><li class="listitem"><p>
          The client can use <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a>
          statements. This might be necessary prior to resetting the
          password; for example, if the account password uses a hashing
          format that requires the
          <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> system variable
          to be set to a value different from its default.
</p></li></ul>
</div>
<p>
      For any operation not permitted within the session, the server
      returns an <a class="link" href="error-handling.html#error_er_must_change_password"><code class="literal">ER_MUST_CHANGE_PASSWORD</code></a>
      error:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
ERROR 1820 (HY000): You must SET PASSWORD before executing this statement
</pre><p>
      As mentioned previously, whether the server disconnects an
      expired-password client or puts it in sandbox mode depends on a
      combination of client and server settings. The following
      discussion describes the relevant settings and how they interact.
    </p><p>
      On the client side, a given client indicates whether it can handle
      sandbox mode for expired passwords. For clients that use the C
      client library, there are two ways to do this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Pass the
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> flag
          to <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options()</code></a> prior to
          connecting:
        </p><pre class="programlisting">
arg = 1;
result = mysql_options(mysql,
                       MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS, &amp;arg);
</pre></li><li class="listitem"><p>
          Pass the
          <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> flag to
          <a class="link" href="connectors-apis.html#mysql-real-connect" title="23.8.7.53 mysql_real_connect()"><code class="literal">mysql_real_connect()</code></a> at
          connection time:
        </p><pre class="programlisting">
mysql = mysql_real_connect(mysql,
                           host, user, password, "test",
                           port, unix_socket,
                           CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS);
</pre></li></ul>
</div>
<p>
      Other MySQL Connectors have their own conventions for indicating
      readiness to handle sandbox mode. See the relevant Connector
      documentation.
    </p><p>
      On the server side, if a client indicates that it can handle
      expired passwords, the server puts it in sandbox mode.
    </p><p>
      If a client does not indicate that it can handle expired passwords
      (or uses an older version of the client library that cannot so
      indicate), the server action depends on the value of the
      <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
      system variable:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If
          <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
          is enabled (the default), the server disconnects the client
          with an
          <a class="link" href="error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a>
          error.
        </p></li><li class="listitem"><p>
          If
          <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
          is disabled, the server puts the client in sandbox mode.
</p></li></ul>
</div>
<p>
      The preceding client and server settings apply only for accounts
      with expired passwords. If a client connects using a nonexpired
      password, the server handles the client normally.
</p>
<h4><a name="idm139737185169232"></a>Development of Password-Expiration Capability</h4>
<p>
      The following timeline describes the versions in which various
      password-expiration features were added.
    </p><p>
      MySQL 5.6.6: Initial implementation of password expiration
    </p><p>
      The <code class="literal">password_expired</code> column is introduced in
      the <code class="literal">mysql.user</code> table to enable DBAs to expire
      account passwords. The column default value is
      <code class="literal">'N'</code> (not expired).
    </p><p>
      The <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement is
      introduced as the SQL interface for setting the
      <code class="literal">password_expired</code> column to
      <code class="literal">'Y'</code>.
    </p><p>
      Connections that use an account with an expired password enter
      <span class="quote">“<span class="quote">sandbox mode</span>”</span> that permits only
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements. For other
      statements, the server returns an
      <a class="link" href="error-handling.html#error_er_must_change_password"><code class="literal">ER_MUST_CHANGE_PASSWORD</code></a> error. The
      intent is to force the client to reset the password before the
      server permits any other operations. <code class="literal">SET
      PASSWORD</code> resets the account password and sets
      <code class="literal">password_expired</code> to <code class="literal">'N'</code>.
    </p><p>
      A bug in the initial implementation is that
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> sets the
      <code class="literal">Password</code> column in the
      <code class="literal">mysql.user</code> table to the empty string. The
      implication is that users should wait until MySQL 5.6.7 to use
      this statement.
    </p><p>
      MySQL 5.6.7:
    </p><p>
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> is fixed to not set the
      <code class="literal">Password</code> column to the empty string.
    </p><p>
      MySQL 5.6.8:
    </p><p>
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> can be used as a
      prepared statement.
    </p><p>
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin password</strong></span></a> is made capable of setting
      passwords for accounts with expired native or old-native
      passwords.
    </p><p>
      Sandbox mode is changed to permit clients to execute
      <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> statements in addition to
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> Prohibiting
      <code class="literal">SET</code> prevented clients that needed to set
      <code class="literal">old_passwords</code> from resetting their password. It
      also broke some Connectors, which use <code class="literal">SET</code>
      extensively at connect time to initialize the session environment.
    </p><p>
      MySQL 5.6.9:
    </p><p>
      Sandbox mode is changed to permit <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
      PASSWORD</code></a> only if the account named in the statement
      matches the account the client authenticated as.
    </p><p>
      MySQL 5.6.10:
    </p><p>
      Sandbox mode is changed to permit better control over how the
      server handles client connections for accounts with expired
      passwords, and to permit clients to signal whether they are
      capable of handling expired passwords:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The
          <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
          system variable is added, which controls how the server treats
          expired-password accounts.
        </p></li><li class="listitem"><p>
          Two flags are added to the C API client library:
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> for
          <code class="literal">mysql_options()</code> and
          <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> for
          <code class="literal">mysql_real_connect()</code>. Each flag enables a
          client program to indicate whether it can handle sandbox mode
          for accounts with expired passwords.
        </p><p>
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> is
          enabled for <span class="command"><strong>mysqltest</strong></span> unconditionally, for
          <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> in interactive mode, and for
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> if the first command is
          <code class="literal">password</code>.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a>
          error is added. The server returns this error when it
          disconnects a client.
</p></li></ul>
</div>
<p>
      Concurrent with these changes to sandbox mode in MySQL Server and
      the C API client library, work begins to modify Connectors for
      conformance to the changes.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-authentication"></a>6.3.7 Pluggable Authentication</h3>

</div>

</div>

</div>
<p>
      When a client connects to the MySQL server, the server uses the
      user name provided by the client and the client host to select the
      appropriate account row from the <code class="literal">mysql.user</code>
      table. The server then authenticates the client, determining from
      the account row which authentication plugin applies for the
      client:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If the account row specifies a plugin, the server invokes it
          to authenticate the user. If the server cannot find the
          plugin, an error occurs.
        </p></li><li class="listitem"><p>
          If the account row specifies no plugin name, the server
          authenticates the account using either the
          <code class="literal">mysql_native_password</code> or
          <code class="literal">mysql_old_password</code> plugin, depending on
          whether the password hash value in the
          <code class="literal">Password</code> column used native hashing or the
          older pre-4.1 hashing method. Clients must match the password
          in the <code class="literal">Password</code> column of the account row.
</p></li></ul>
</div>
<p>
      The plugin returns a status to the server indicating whether the
      user is permitted to connect.
    </p><p>
      Pluggable authentication enables two important capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>External authentication:</strong></span>
          Pluggable authentication makes it possible for clients to
          connect to the MySQL server with credentials that are
          appropriate for authentication methods other than native
          authentication based on passwords stored in the
          <code class="literal">mysql.user</code> table. For example, plugins can
          be created to use external authentication methods such as PAM,
          Windows login IDs, LDAP, or Kerberos.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>Proxy users:</strong></span> If a user is
          permitted to connect, an authentication plugin can return to
          the server a user name different from the name of the
          connecting user, to indicate that the connecting user is a
          proxy for another user. While the connection lasts, the proxy
          user is treated, for purposes of access control, as having the
          privileges of a different user. In effect, one user
          impersonates another. For more information, see
          <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
</p></li></ul>
</div>
<p>
      Several authentication plugins are available in MySQL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Plugins that perform native authentication that matches the
          password against the <code class="literal">Password</code> column of the
          account row. The <code class="literal">mysql_native_password</code>
          plugin implements authentication based on the native password
          hashing method. The <code class="literal">mysql_old_password</code>
          plugin implements native authentication based on the older
          (pre-4.1) password hashing method (and is now deprecated). See
          <a class="xref" href="security.html#native-authentication-plugin" title="6.3.8.1 The Native Authentication Plugin">Section 6.3.8.1, “The Native Authentication Plugin”</a>, and
          <a class="xref" href="security.html#old-native-authentication-plugin" title="6.3.8.2 The Old Native Authentication Plugin">Section 6.3.8.2, “The Old Native Authentication Plugin”</a>. Native
          authentication using <code class="literal">mysql_native_password</code>
          is the default for new accounts, unless the
          <a class="link" href="server-administration.html#option_mysqld_default-authentication-plugin"><code class="option">--default-authentication-plugin</code></a>
          option is set otherwise at server startup.
        </p></li><li class="listitem"><p>
          A plugin that performs authentication using SHA-256 password
          hashing. This plugin matches the password against the
          <code class="literal">authentication_string</code> column of the account
          row. This is stronger encryption than that available with
          native authentication. See
          <a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 The SHA-256 Authentication Plugin">Section 6.3.8.4, “The SHA-256 Authentication Plugin”</a>.
        </p></li><li class="listitem"><p>
          A plugin that performs external authentication against PAM
          (Pluggable Authentication Modules), enabling MySQL Server to
          use PAM to authenticate MySQL users. This plugin supports
          proxy users as well. See
          <a class="xref" href="security.html#pam-authentication-plugin" title="6.3.8.5 The PAM Authentication Plugin">Section 6.3.8.5, “The PAM Authentication Plugin”</a>.
        </p></li><li class="listitem"><p>
          A plugin that performs external authentication on Windows,
          enabling MySQL Server to use native Windows services to
          authenticate client connections. Users who have logged in to
          Windows can connect from MySQL client programs to the server
          based on the information in their environment without
          specifying an additional password. This plugin supports proxy
          users as well. See
          <a class="xref" href="security.html#windows-authentication-plugin" title="6.3.8.6 The Windows Native Authentication Plugin">Section 6.3.8.6, “The Windows Native Authentication Plugin”</a>.
        </p></li><li class="listitem"><p>
          A client-side plugin that sends the password to the server
          without hashing or encryption. This plugin can be used by
          server-side plugins that require access to the password
          exactly as provided by the client user. See
          <a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 The Cleartext Client-Side Authentication Plugin">Section 6.3.8.7, “The Cleartext Client-Side Authentication Plugin”</a>.
        </p></li><li class="listitem"><p>
          A plugin that authenticates clients that connect from the
          local host through the Unix socket file. See
          <a class="xref" href="security.html#socket-authentication-plugin" title="6.3.8.8 The Socket Peer-Credential Authentication Plugin">Section 6.3.8.8, “The Socket Peer-Credential Authentication Plugin”</a>.
        </p></li><li class="listitem"><p>
          A test plugin that authenticates using MySQL native
          authentication. This plugin is intended for testing and
          development purposes, and as an example of how to write an
          authentication plugin. See
          <a class="xref" href="security.html#test-authentication-plugin" title="6.3.8.9 The Test Authentication Plugin">Section 6.3.8.9, “The Test Authentication Plugin”</a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        For information about current restrictions on the use of
        pluggable authentication, including which connectors support
        which plugins, see
        <a class="xref" href="restrictions.html#pluggable-authentication-restrictions" title="D.9 Restrictions on Pluggable Authentication">Section D.9, “Restrictions on Pluggable Authentication”</a>.
      </p><p>
        Third-party connector developers should read that section to
        determine the extent to which a connector can take advantage of
        pluggable authentication capabilities and what steps to take to
        become more compliant.
</p>
</div>
<p>
      If you are interested in writing your own authentication plugins,
      see <a class="xref" href="extending-mysql.html#writing-authentication-plugins" title="24.2.4.9 Writing Authentication Plugins">Section 24.2.4.9, “Writing Authentication Plugins”</a>.
</p>
<h4><a name="authentication-plugin-use"></a>Authentication Plugin Usage Instructions</h4>
<p>
      This section provides general instructions for installing and
      using authentication plugins.
    </p><p>
      In general, pluggable authentication uses corresponding plugins on
      the server and client sides, so you use a given authentication
      method like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          On the server host, install the library containing the
          appropriate server plugin, if necessary, so that the server
          can use it to authenticate client connections. Similarly, on
          each client host, install the library containing the
          appropriate client plugin for use by client programs.
        </p></li><li class="listitem"><p>
          Create MySQL accounts that specify use of the plugin for
          authentication.
        </p></li><li class="listitem"><p>
          When a client connects, the server plugin tells the client
          program which client plugin to use for authentication.
</p></li></ul>
</div>
<p>
      The instructions here use an example authentication plugin
      included in MySQL distributions (see
      <a class="xref" href="security.html#test-authentication-plugin" title="6.3.8.9 The Test Authentication Plugin">Section 6.3.8.9, “The Test Authentication Plugin”</a>). The procedure is
      similar for other authentication plugins; substitute the
      appropriate plugin and file names.
    </p><p>
      The example authentication plugin has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The server-side plugin name is
          <code class="literal">test_plugin_server</code>.
        </p></li><li class="listitem"><p>
          The client-side plugin name is
          <code class="literal">auth_test_plugin</code>.
        </p></li><li class="listitem"><p>
          Both plugins are located in the shared library object file
          named <code class="filename">auth_test_plugin.so</code> in the plugin
          directory (the directory named by the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable).
          The file name suffix might differ on your system.
</p></li></ul>
</div>
<p>
      Install and use the example authentication plugin as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Make sure that the plugin library is installed on the server
          and client hosts.
        </p></li><li class="listitem"><p>
          Install the server-side test plugin at server startup or at
          runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To install the plugin at startup, use the
              <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option. With
              this plugin-loading method, the option must be given each
              time you start the server. For example, use these lines in
              a <code class="filename">my.cnf</code> option file:
            </p><pre class="programlisting">
[mysqld]
plugin-load=test_plugin_server=auth_test_plugin.so
</pre></li><li class="listitem"><p>
              To install the plugin at runtime, use the
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement:
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN test_plugin_server SONAME 'auth_test_plugin.so';</code></strong>
</pre><p>
              This installs the plugin permanently and need be done only
              once.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Verify that the plugin is installed. For example, use
          <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW PLUGINS\G</code></strong>
...
*************************** 21. row ***************************
   Name: test_plugin_server
 Status: ACTIVE
   Type: AUTHENTICATION
Library: auth_test_plugin.so
License: GPL
</pre><p>
          For other ways to check the plugin, see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
        </p></li><li class="listitem"><p>
          To specify that a MySQL user must be authenticated using a
          specific server plugin, name the plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of the
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement that
          creates the user:
        </p><pre class="programlisting">
CREATE USER 'testuser'@'localhost' IDENTIFIED WITH test_plugin_server;
</pre></li><li class="listitem"><p>
          Connect to the server using a client program. The test plugin
          authenticates the same way as native MySQL authentication, so
          provide the usual <a class="link" href="programs.html#option_general_user"><code class="option">--user</code></a> and
          <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> options that you
          normally use to connect to the server. For example:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=<em class="replaceable"><code>your_name</code></em> --password=<em class="replaceable"><code>your_pass</code></em></code></strong>
</pre><p>
          For connections by <code class="literal">testuser</code>, the server
          sees that the account must be authenticated using the
          server-side plugin named <code class="literal">test_plugin_server</code>
          and communicates to the client program which client-side
          plugin it must use—in this case,
          <code class="literal">auth_test_plugin</code>.
        </p><p>
          In the case that the account uses the authentication method
          that is the default for both the server and the client
          program, the server need not communicate to the client which
          plugin to use, and a round trip in client/server negotiation
          can be avoided. Currently this is true for accounts that use
          native MySQL authentication
          (<code class="literal">mysql_native_password</code>).
        </p><p>
          The
          <a class="link" href="programs.html#option_mysql_default-auth"><code class="option">--default-auth=<em class="replaceable"><code>plugin_name</code></em></code></a>
          option can be specified on the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
          command line as a hint about which client-side plugin the
          program can expect to use, although the server will override
          this if the user account requires a different plugin.
        </p><p>
          If the client program does not find the plugin, specify a
          <a class="link" href="programs.html#option_mysql_plugin-dir"><code class="option">--plugin-dir=<em class="replaceable"><code>dir_name</code></em></code></a>
          option to indicate where the plugin is located.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        If you start the server with the
        <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option,
        authentication plugins are not used even if loaded because the
        server performs no client authentication and permits any client
        to connect. Because this is insecure, you might want to use
        <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> in
        conjunction with
        <a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a> to prevent
        remote clients from connecting.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="authentication-plugins-available"></a>6.3.8 Authentication Plugins Available in MySQL</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#native-authentication-plugin">6.3.8.1 The Native Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#old-native-authentication-plugin">6.3.8.2 The Old Native Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#account-upgrades">6.3.8.3 Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password
Plugin</a></span></dt><dt><span class="section"><a href="security.html#sha256-authentication-plugin">6.3.8.4 The SHA-256 Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#pam-authentication-plugin">6.3.8.5 The PAM Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#windows-authentication-plugin">6.3.8.6 The Windows Native Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#cleartext-authentication-plugin">6.3.8.7 The Cleartext Client-Side Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#socket-authentication-plugin">6.3.8.8 The Socket Peer-Credential Authentication Plugin</a></span></dt><dt><span class="section"><a href="security.html#test-authentication-plugin">6.3.8.9 The Test Authentication Plugin</a></span></dt></dl>
</div>
<p>
      The following sections describe the authentication plugins
      available in MySQL.
    </p><p>
      The default plugin is <code class="literal">mysql_native_password</code>
      unless the
      <a class="link" href="server-administration.html#option_mysqld_default-authentication-plugin"><code class="option">--default-authentication-plugin</code></a>
      option is set otherwise at server startup.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="native-authentication-plugin"></a>6.3.8.1 The Native Authentication Plugin</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm139737185028416"></a><a class="indexterm" name="idm139737185027312"></a><p>
        MySQL includes two plugins that implement native authentication;
        that is, authentication against passwords stored in the
        <code class="literal">Password</code> column of the
        <code class="literal">mysql.user</code> table. This section describes
        <code class="literal">mysql_native_password</code>, which implements
        authentication against the <code class="literal">mysql.user</code> table
        using the native password hashing method. For information about
        <code class="literal">mysql_old_password</code>, which implements
        authentication using the older (pre-4.1) password hashing
        method, see <a class="xref" href="security.html#old-native-authentication-plugin" title="6.3.8.2 The Old Native Authentication Plugin">Section 6.3.8.2, “The Old Native Authentication Plugin”</a>.
        For information about these password hashing methods, see
        <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>.
      </p><p>
        The <code class="literal">mysql_native_password</code> native
        authentication plugin is backward compatible. Clients older than
        MySQL 5.5.7 do not support authentication
        <span class="emphasis"><em>plugins</em></span> but do use the native
        authentication <span class="emphasis"><em>protocol</em></span>, so they can
        connect to servers from MySQL 5.5.7 and up.
      </p><p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm139737185017280"></a><p class="title"><b>Table 6.8 MySQL Native Password Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Native Password Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">mysql_native_password</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">mysql_native_password</code></td></tr><tr><td scope="row">Library object file name</td><td>None (plugins are built in)</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The plugin exists in both client and server form:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server-side plugin is built into the server, need not be
            loaded explicitly, and cannot be disabled by unloading it.
          </p></li><li class="listitem"><p>
            The client-side plugin is built into the
            <code class="literal">libmysqlclient</code> client library as of MySQL
            5.5.7 and available to any program linked against
            <code class="literal">libmysqlclient</code> from that version or
            newer.
          </p></li><li class="listitem"><p>
            MySQL client programs use
            <code class="literal">mysql_native_password</code> by default. The
            <a class="link" href="programs.html#option_mysql_default-auth"><code class="option">--default-auth</code></a> option can be
            used as a hint about which client-side plugin the program
            can expect to use:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_native_password ...</code></strong>
</pre></li></ul>
</div>
<p>
        If an account row specifies no plugin name, the server
        authenticates the account using either the
        <code class="literal">mysql_native_password</code> or
        <code class="literal">mysql_old_password</code> plugin, depending on
        whether the password hash value in the
        <code class="literal">Password</code> column used native hashing or the
        older pre-4.1 hashing method. Clients must match the password in
        the <code class="literal">Password</code> column of the account row.
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="old-native-authentication-plugin"></a>6.3.8.2 The Old Native Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184995632"></a><a class="indexterm" name="idm139737184994528"></a><p>
        MySQL includes two plugins that implement native authentication;
        that is, authentication against passwords stored in the
        <code class="literal">Password</code> column of the
        <code class="literal">mysql.user</code> table. This section describes
        <code class="literal">mysql_old_password</code>, which implements
        authentication against the <code class="literal">mysql.user</code> table
        using the older (pre-4.1) password hashing method. For
        information about <code class="literal">mysql_native_password</code>,
        which implements authentication using the native password
        hashing method, see
        <a class="xref" href="security.html#native-authentication-plugin" title="6.3.8.1 The Native Authentication Plugin">Section 6.3.8.1, “The Native Authentication Plugin”</a>. For information
        about these password hashing methods, see
        <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Passwords that use the pre-4.1 hashing method are less secure
          than passwords that use the native password hashing method and
          should be avoided. Pre-4.1 passwords are deprecated and
          support for them will be removed in a future MySQL release.
          For account upgrade instructions, see
          <a class="xref" href="security.html#account-upgrades" title="6.3.8.3 Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password Plugin">Section 6.3.8.3, “Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password
        Plugin”</a>.
</p>
</div>
<p>
        The <code class="literal">mysql_old_password</code> native authentication
        plugin is backward compatible. Clients older than MySQL 5.5.7 do
        not support authentication <span class="emphasis"><em>plugins</em></span> but do
        use the native authentication <span class="emphasis"><em>protocol</em></span>, so
        they can connect to servers from MySQL 5.5.7 and up.
      </p><p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm139737184982704"></a><p class="title"><b>Table 6.9 MySQL Old Native Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Old Native Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">mysql_old_password</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">mysql_old_password</code></td></tr><tr><td scope="row">Library object file name</td><td>None (plugins are built in)</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The plugin exists in both client and server form:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server-side plugin is built into the server, need not be
            loaded explicitly, and cannot be disabled by unloading it.
          </p></li><li class="listitem"><p>
            The client-side plugin is built into the
            <code class="literal">libmysqlclient</code> client library as of MySQL
            5.5.7 and available to any program linked against
            <code class="literal">libmysqlclient</code> from that version or
            newer.
          </p></li><li class="listitem"><p>
            MySQL client programs can use the
            <a class="link" href="programs.html#option_mysql_default-auth"><code class="option">--default-auth</code></a> option to
            specify the <code class="literal">mysql_old_password</code> plugin as
            a hint about which client-side plugin the program can expect
            to use:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_old_password ...</code></strong>
</pre></li></ul>
</div>
<p>
        If an account row specifies no plugin name, the server
        authenticates the account using either the
        <code class="literal">mysql_native_password</code> or
        <code class="literal">mysql_old_password</code> plugin, depending on
        whether the password hash value in the
        <code class="literal">Password</code> column used native hashing or the
        older pre-4.1 hashing method. Clients must match the password in
        the <code class="literal">Password</code> column of the account row.
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="account-upgrades"></a>6.3.8.3 Migrating Away from Pre-4.1 Password Hashing and the mysql_old_password
Plugin</h4>
</div>
</div>
</div>
<p>
        The MySQL server authenticates connection attempts for each
        account listed in the <code class="literal">mysql.user</code> table using
        the authentication plugin named in the <code class="literal">plugin</code>
        column. If the <code class="literal">plugin</code> column is empty, the
        server authenticates the account as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Before MySQL 5.7.2, the server uses the
            <code class="literal">mysql_native_password</code> or
            <code class="literal">mysql_old_password</code> plugin implicitly,
            depending on the format of the password hash in the
            <code class="literal">Password</code> column. If the
            <code class="literal">Password</code> value is empty or a 4.1 password
            hash (41 characters), the server uses
            <code class="literal">mysql_native_password</code>. If the password
            value is a pre-4.1 password hash (16 characters), the server
            uses <code class="literal">mysql_old_password</code>. (For additional
            information about these hash formats, see
            <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>.)
          </p></li><li class="listitem"><p>
            As of MySQL 5.7.2, the server requires the
            <code class="literal">plugin</code> column to be nonempty and disables
            accounts that have an empty <code class="literal">plugin</code> value.
</p></li></ul>
</div>
<p>
        Pre-4.1 password hashes and the
        <code class="literal">mysql_old_password</code> plugin are deprecated as
        of MySQL 5.6.5 and support for them is removed in MySQL 5.7.5.
        They provide a level of security inferior to that offered by 4.1
        password hashing and the
        <code class="literal">mysql_native_password</code> plugin.
      </p><p>
        Given the requirement in MySQL 5.7.2 that the
        <code class="literal">plugin</code> column must be nonempty, coupled with
        removal of <code class="literal">mysql_old_password</code> support in
        5.7.5, DBAs are advised to upgrade accounts as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Upgrade accounts that use
            <code class="literal">mysql_native_password</code> implicitly to use
            it explicitly
          </p></li><li class="listitem"><p>
            Upgrade accounts that use
            <code class="literal">mysql_old_password</code> (either implicitly or
            explicitly) to use <code class="literal">mysql_native_password</code>
            explicitly
</p></li></ul>
</div>
<p>
        The instructions in this section describe how to perform those
        upgrades. The result is that no account has an empty
        <code class="literal">plugin</code> value and no account uses pre-4.1
        password hashing or the <code class="literal">mysql_old_password</code>
        plugin.
      </p><p>
        As a variant on these instructions, DBAs might offer users the
        choice to upgrade to the <code class="literal">sha256_password</code>
        plugin, which authenticates using SHA-256 password hashes. For
        information about this plugin, see
        <a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 The SHA-256 Authentication Plugin">Section 6.3.8.4, “The SHA-256 Authentication Plugin”</a>.
      </p><p>
        The following table lists the types of
        <code class="literal">mysql.user</code> accounts considered in this
        discussion.
</p>
<div class="informaltable">
<table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col"><code class="literal">plugin</code> Column</th><th scope="col"><code class="literal">Password</code> Column</th><th scope="col">Authentication Result</th><th scope="col">Upgrade Action</th></tr></thead><tbody><tr><td scope="row">Empty</td><td>Empty</td><td>Implicitly uses <code class="literal">mysql_native_password</code></td><td>Assign plugin</td></tr><tr><td scope="row">Empty</td><td>4.1 hash</td><td>Implicitly uses <code class="literal">mysql_native_password</code></td><td>Assign plugin</td></tr><tr><td scope="row">Empty</td><td>Pre-4.1 hash</td><td>Implicitly uses <code class="literal">mysql_old_password</code></td><td>Assign plugin, rehash password</td></tr><tr><td scope="row"><code class="literal">mysql_native_password</code></td><td>Empty</td><td>Explicitly uses <code class="literal">mysql_native_password</code></td><td>None</td></tr><tr><td scope="row"><code class="literal">mysql_native_password</code></td><td>4.1 hash</td><td>Explicitly uses <code class="literal">mysql_native_password</code></td><td>None</td></tr><tr><td scope="row"><code class="literal">mysql_old_password</code></td><td>Empty</td><td>Explicitly uses <code class="literal">mysql_old_password</code></td><td>Upgrade plugin</td></tr><tr><td scope="row"><code class="literal">mysql_old_password</code></td><td>Pre-4.1 hash</td><td>Explicitly uses <code class="literal">mysql_old_password</code></td><td>Upgrade plugin, rehash password</td></tr></tbody></table>
</div>
<p>
        Accounts corresponding to lines for the
        <code class="literal">mysql_native_password</code> plugin require no
        upgrade action (because no change of plugin or hash format is
        required). For accounts corresponding to lines for which the
        password is empty, consider asking the account owners to choose
        a password (or require it by using <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
        USER</code></a> to expire empty account passwords).
</p>
<h5><a name="idm139737184906224"></a>Upgrading Accounts from Implicit to Explicit mysql_native_password Use</h5>
<p>
        Accounts that have an empty plugin and a 4.1 password hash use
        <code class="literal">mysql_native_password</code> implicitly. To upgrade
        these accounts to use <code class="literal">mysql_native_password</code>
        explicitly, execute these statements:
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = 'mysql_native_password'
WHERE plugin = '' AND (Password = '' OR LENGTH(Password) = 41);
FLUSH PRIVILEGES;
</pre><p>
        Before MySQL 5.7.2, you can execute those statements to uprade
        accounts proactively. As of MySQL 5.7.2, you can run
        <a class="link" href="programs.html#mysql-upgrade" title="4.4.7 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a>, which performs the same
        operation among its upgrade actions.
      </p><p>
        Notes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The upgrade operation just described is safe to execute at
            any time because it makes the
            <code class="literal">mysql_native_password</code> plugin explicit
            only for accounts that already use it implicitly.
          </p></li><li class="listitem"><p>
            This operation requires no password changes, so it can be
            performed without affecting users or requiring their
            involvement in the upgrade process.
</p></li></ul>
</div>
<h5><a name="idm139737184897312"></a>Upgrading Accounts from mysql_old_password to mysql_native_password</h5>
<p>
        Accounts that use <code class="literal">mysql_old_password</code> (either
        implicitly or explicitly) should be upgraded to use
        <code class="literal">mysql_native_password</code> explicitly. This
        requires changing the plugin <span class="emphasis"><em>and</em></span> changing
        the password from pre-4.1 to 4.1 hash format.
      </p><p>
        For the accounts covered in this step that must be upgraded, one
        of these conditions is true:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The account uses <code class="literal">mysql_old_password</code>
            implicitly because the <code class="literal">plugin</code> column is
            empty and the password has the pre-4.1 hash format (16
            characters).
          </p></li><li class="listitem"><p>
            The account uses <code class="literal">mysql_old_password</code>
            explicitly.
</p></li></ul>
</div>
<p>
        To identify such accounts, use this query:
      </p><pre class="programlisting">
SELECT User, Host, Password FROM mysql.user
WHERE (plugin = '' AND LENGTH(Password) = 16)
OR plugin = 'mysql_old_password';
</pre><p>
        The following discussion provides two methods for updating that
        set of accounts. They have differing characteristics, so read
        both and decide which is most suitable for a given MySQL
        installation.
      </p><p>
        <span class="bold"><strong>Method 1.</strong></span>
      </p><p>
        Characteristics of this method:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            It requires that server and clients be run with
            <code class="literal">secure_auth=0</code> until all users have been
            upgraded to <code class="literal">mysql_native_password</code>.
            (Otherwise, users cannot connect to the server using their
            old-format password hashes for the purpose of upgrading to a
            new-format hash.)
          </p></li><li class="listitem"><p>
            It works for MySQL 5.5 through 5.7.1. As of 5.7.2, it does
            not work because the server requires accounts to have a
            nonempty plugin and disables them otherwise. Therefore, if
            you have already upgraded to 5.7.2 or later, choose Method
            2, described later.
</p></li></ul>
</div>
<p>
        You should ensure that the server is running with
        <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=0</code></a>.
      </p><p>
        For all accounts that use <code class="literal">mysql_old_password</code>
        explicitly, set them to the empty plugin:
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = ''
WHERE plugin = 'mysql_old_password';
FLUSH PRIVILEGES;
</pre><p>
        To also expire the password for affected accounts, use these
        statements instead:
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = '', password_expired = 'Y'
WHERE plugin = 'mysql_old_password';
FLUSH PRIVILEGES;
</pre><p>
        Now affected users can reset their password to use 4.1 hashing.
        Ask each user who now has an empty plugin to connect to the
        server and execute these statements:
      </p><pre class="programlisting">
SET old_passwords = 0;
SET PASSWORD = PASSWORD('<em class="replaceable"><code>user-chosen-password</code></em>');
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          In MySQL 5.6.5 or later, the client-side
          <a class="link" href="programs.html#option_mysql_secure-auth"><code class="option">--secure-auth</code></a> option is enabled
          by default, so remind users to disable it or they will be
          unable to connect:
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u <em class="replaceable"><code>user_name</code></em> -p --secure-auth=0</code></strong>
</pre>
</div>
<p>
        After an affected user has executed those statements, you can
        set the corresponding account plugin to
        <code class="literal">mysql_native_password</code> to make the plugin
        explicit. Or you can periodically run these statements to find
        and fix any accounts for which affected users have reset their
        password:
      </p><pre class="programlisting">
UPDATE mysql.user SET plugin = 'mysql_native_password'
WHERE plugin = '' AND (Password = '' OR LENGTH(Password) = 41);
FLUSH PRIVILEGES;
</pre><p>
        When there are no more accounts with an empty plugin, this query
        returns an empty result:
      </p><pre class="programlisting">
SELECT User, Host, Password FROM mysql.user
WHERE (plugin = '' AND LENGTH(Password) = 16);
</pre><p>
        At that point, all accounts have been migrated away from pre-4.1
        password hashing and the server no longer need be run with
        <a class="link" href="server-administration.html#sysvar_secure_auth"><code class="literal">secure_auth=0</code></a>.
      </p><p>
        <span class="bold"><strong>Method 2.</strong></span>
      </p><p>
        Characteristics of this method:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            It assigns each affected account a new password, so you must
            tell each such user the new password and ask the user to
            choose a new one. Communication of passwords to users is
            outside the scope of MySQL, but should be done carefully.
          </p></li><li class="listitem"><p>
            It does not require server or clients to be run with
            <code class="literal">secure_auth=0</code>.
          </p></li><li class="listitem"><p>
            It works for any version of MySQL 5.5 or later (and for
            5.7.6 or later has an easier variant).
</p></li></ul>
</div>
<p>
        With this method, you update each account separately due to the
        need to set passwords individually. <span class="emphasis"><em>Choose a different
        password for each account.</em></span>
      </p><p>
        Suppose that <code class="literal">'user1'@'localhost'</code> is one of
        the accounts to be upgraded. Modify it as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In MySQL 5.7.6 and up, <code class="literal">ALTER USER</code>
            provides the capability of modifying both the account
            password and its authentication plugin, so you need not
            modify the <code class="literal">mysql.user</code> table directly:
          </p><pre class="programlisting">
ALTER USER 'user1'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>DBA-chosen-password</code></em>';
</pre><p>
            To also expire the account password, use this statement
            instead:
          </p><pre class="programlisting">
ALTER USER 'user1'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>DBA-chosen-password</code></em>'
PASSWORD EXPIRE;
</pre><p>
            Then tell the user the new password and ask the user to
            connect to the server with that password and execute this
            statement to choose a new password:
          </p><pre class="programlisting">
ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>user-chosen-password</code></em>';
</pre></li><li class="listitem"><p>
            Before MySQL 5.7.6, you must modify the
            <code class="literal">mysql.user</code> table directly using these
            statements:
          </p><pre class="programlisting">
SET old_passwords = 0;
UPDATE mysql.user SET plugin = 'mysql_native_password',
Password = PASSWORD('<em class="replaceable"><code>DBA-chosen-password</code></em>')
WHERE (User, Host) = ('user1', 'localhost');
FLUSH PRIVILEGES;
</pre><p>
            To also expire the account password, use these statements
            instead:
          </p><pre class="programlisting">
SET old_passwords = 0;
UPDATE mysql.user SET plugin = 'mysql_native_password',
Password = PASSWORD('<em class="replaceable"><code>DBA-chosen-password</code></em>'), password_expired = 'Y'
WHERE (User, Host) = ('user1', 'localhost');
FLUSH PRIVILEGES;
</pre><p>
            Then tell the user the new password and ask the user to
            connect to the server with that password and execute these
            statements to choose a new password:
          </p><pre class="programlisting">
SET old_passwords = 0;
SET PASSWORD = PASSWORD('<em class="replaceable"><code>user-chosen-password</code></em>');
</pre></li></ul>
</div>
<p>
        Repeat for each account to be upgraded.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sha256-authentication-plugin"></a>6.3.8.4 The SHA-256 Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184842960"></a><a class="indexterm" name="idm139737184841872"></a><p>
        As of MySQL 5.6.6, MySQL provides an authentication plugin that
        implements SHA-256 hashing for user account passwords.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          To connect to the server using an account that authenticates
          with the <code class="literal">sha256_password</code> plugin, you must
          use either an SSL connection or an unencrypted connection that
          encrypts the password using RSA, as described later in this
          section. Either way, use of the
          <code class="literal">sha256_password</code> plugin requires that MySQL
          be built with SSL capabilities. See
          <a class="xref" href="security.html#ssl-connections" title="6.3.10 Using SSL for Secure Connections">Section 6.3.10, “Using SSL for Secure Connections”</a>.
</p>
</div>
<p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm139737184836096"></a><p class="title"><b>Table 6.10 MySQL SHA-256 Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL SHA-256 Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">sha256_password</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">sha256_password</code></td></tr><tr><td scope="row">Library object file name</td><td>None (plugins are built in)</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The server-side <code class="literal">sha256_password</code> plugin is
        built into the server, need not be loaded explicitly, and cannot
        be disabled by unloading it. Similarly, clients need not specify
        the location of the client-side plugin.
      </p><p>
        To set up an account that uses SHA-256 password hashing, use the
        following procedure.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create the account and specify that it authenticates using
            the <code class="literal">sha256_password</code> plugin:
          </p><pre class="programlisting">
CREATE USER 'sha256user'@'localhost' IDENTIFIED WITH sha256_password;
</pre></li><li class="listitem"><p>
            Set the <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a>
            system variable to 2 to cause the
            <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a> function to use
            SHA-256 hashing of password strings, then set the account
            password:
          </p><pre class="programlisting">
SET old_passwords = 2;
SET PASSWORD FOR 'sha256user'@'localhost' = PASSWORD('Sh@256Pa33');
</pre></li></ol>
</div>
<p>
        Alternatively, start the server with the default authentication
        plugin set to <code class="literal">sha256_password</code>. For example,
        put these lines in the server option file:
      </p><pre class="programlisting">
[mysqld]
default-authentication-plugin=sha256_password
</pre><p>
        That causes the <code class="literal">sha256_password</code> plugin to be
        used by default for new accounts. As a result, it is possible to
        create the account and set its password without naming the
        plugin explicitly using this <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE
        USER</code></a> syntax:
      </p><pre class="programlisting">
CREATE USER 'sha256user'@'localhost' IDENTIFIED BY 'Sh@256Pa33';
</pre><p>
        In this case, the server assigns the
        <code class="literal">sha256_password</code> plugin to the account and
        encrypts the password using SHA-256.
      </p><p>
        Accounts in the <code class="literal">mysql.user</code> table that use
        SHA-256 passwords can be identified as rows with
        <code class="literal">'sha256_password'</code> in the
        <code class="literal">plugin</code> column and a SHA-256 password hash in
        the <code class="literal">authentication_string</code> column.
      </p><p>
        Another consequence of using <code class="literal">sha256_password</code>
        as the default authentication plugin is that to create an
        account that uses a different plugin, you must specify that
        plugin using an <code class="literal">IDENTIFIED WITH</code> clause in the
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement, then set
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> appropriately for
        the plugin before using <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET
        PASSWORD</code></a> to set the account password. For example, to
        use the <code class="literal">mysql_native_password</code> plugin, do
        this:
      </p><pre class="programlisting">
CREATE USER 'nativeuser'@'localhost' IDENTIFIED WITH mysql_native_password;
SET old_passwords = 0;
SET PASSWORD FOR 'nativeuser'@'localhost' = PASSWORD('N@tivePa33');
</pre><p>
        To set or change the password for any account that authenticates
        using the <code class="literal">sha256_password</code> plugin, be sure
        that the value of <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a>
        is 2 before using <a class="link" href="sql-syntax.html#set-password" title="13.7.1.7 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>.
        If <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> has a value
        other than 2, an error occurs for attempts to set the password:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET old_passwords = 0;</code></strong>
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR 'sha256user'@'localhost' = PASSWORD('NewSh@256Pa33');</code></strong>
ERROR 1827 (HY000): The password hash doesn't have the expected format.
Check if the correct password algorithm is being used with the
PASSWORD() function.
</pre><p>
        For more information about
        <a class="link" href="server-administration.html#sysvar_old_passwords"><code class="literal">old_passwords</code></a> and
        <a class="link" href="functions.html#function_password"><code class="literal">PASSWORD()</code></a>, see
        <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
        <a class="xref" href="functions.html#encryption-functions" title="12.13 Encryption and Compression Functions">Section 12.13, “Encryption and Compression Functions”</a>.
      </p><p>
        MySQL can be compiled using either OpenSSL or yaSSL (see
        <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>). The
        <code class="literal">sha256_password</code> plugin works with
        distributions compiled using either package, but if MySQL is
        compiled using OpenSSL, RSA encryption is available and
        <code class="literal">sha256_password</code> implements the following
        additional capabilities. (To enable these capabilities, you must
        also follow the RSA configuration procedure given later in this
        section.)
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            It is possible for the client to transmit passwords to the
            server using RSA encryption during the client connection
            process, as described later.
          </p></li><li class="listitem"><p>
            The server exposes two additional system variables,
            <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
            and
            <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>.
            It is intended that the database administrator will set
            these to the names of the RSA private and public key-pair
            files at server startup if the key files have names that
            differ from the system variable default values.
          </p></li><li class="listitem"><p>
            The server exposes a status variable,
            <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a>, that
            displays the RSA public key value.
          </p></li><li class="listitem"><p>
            The <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> and
            <span class="command"><strong>mysqltest</strong></span> client programs support a
            <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a>
            option for specifying an RSA public key file explicitly.
            (This option was added in MySQL 5.6.6 under the name
            <code class="option">--server-public-key</code> and renamed in 5.6.7 to
            <code class="option">--server-public-key-path</code>.)
</p></li></ul>
</div>
<p>
        For clients that use the <code class="literal">sha256_password</code>
        plugin, passwords are never exposed as cleartext when connecting
        to the server. How password transmission occurs depends on
        whether an SSL connection is used and whether RSA encryption is
        available:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If an SSL connection is used, the password is sent as
            cleartext but cannot be snooped because the connection is
            encrypted using SSL.
          </p></li><li class="listitem"><p>
            If an SSL connection is not used but RSA encryption is
            available, the password is sent within an unencrypted
            connection, but the password is RSA-encrypted to prevent
            snooping. When the server receives the password, it decrypts
            it. A scramble is used in the encryption to prevent repeat
            attacks.
          </p></li><li class="listitem"><p>
            If an SSL connection is not used and RSA encryption is not
            available, the <code class="literal">sha256_password</code> plugin
            causes the connection attempt to fail because the password
            cannot be sent without being exposed as cleartext.
</p></li></ul>
</div>
<p>
        As mentioned previously, RSA password encryption is available
        only if MySQL was compiled using OpenSSL. The implication for
        MySQL distributions compiled using yaSSL is that SHA-256
        passwords can be used only when clients use SSL to access the
        server. See <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
      </p><p>
        Assuming that MySQL has been compiled using OpenSSL, the
        following procedure describes how to enable RSA encryption of
        passwords during the client connection process:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create the RSA private and public key-pair files using the
            instructions in <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.11 Creating SSL and RSA Certificates and Keys">Section 6.3.11, “Creating SSL and RSA Certificates and Keys”</a>.
          </p></li><li class="listitem"><p>
            If the private and public key files are located in the data
            directory and are named <code class="filename">private_key.pem</code>
            and <code class="filename">public_key.pem</code> (the default values
            of the
            <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
            and
            <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
            system variables), the server will use them automatically at
            startup.
          </p><p>
            Otherwise, in the server option file, set the system
            variables to the key file names. If the files are located in
            the server data directory, you need not specify their full
            path names:
          </p><pre class="programlisting">
[mysqld]
sha256_password_private_key_path=myprivkey.pem
sha256_password_public_key_path=mypubkey.pem
</pre><p>
            If the key files are not located in the data directory, or
            to make their locations explicit in the system variable
            values, use full path names:
          </p><pre class="programlisting">
[mysqld]
sha256_password_private_key_path=/usr/local/mysql/myprivkey.pem
sha256_password_public_key_path=/usr/local/mysql/mypubkey.pem
</pre></li><li class="listitem"><p>
            Restart the server, then connect to it and check the
            <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a> status
            variable value. The value will differ from that shown here,
            but should be nonempty:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
            If the value is empty, the server found some problem with
            the key files. Check the error log for diagnostic
            information.
</p></li></ol>
</div>
<p>
        After the server has been configured with the RSA key files,
        clients have the option of using them to connect to the server
        using accounts that authenticate with the
        <code class="literal">sha256_password</code> plugin. As mentioned
        previously, such accounts can use either an SSL connection (in
        which case RSA is not used) or an unencrypted connection that
        encrypts the password using RSA. Assume for the following
        discussion that SSL is not used. Connecting to the server
        involves no special preparation on the client side. For example:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl=0 -u sha256user -p</code></strong>
Enter password: <strong class="userinput"><code>Sh@256Pa33</code></strong>
</pre><p>
        For connection attempts by <code class="literal">sha256user</code>, the
        server determines that <code class="literal">sha256_password</code> is the
        appropriate authentication plugin and invokes it. The plugin
        finds that the connection does not use SSL and thus requires the
        password to be transmitted using RSA encryption. In this case,
        the plugin sends the RSA public key to the client, which uses it
        to encrypt the password and returns the result to the server.
        The plugin uses the RSA key on the server side to decrypt the
        password and accepts or rejects the connection based on whether
        the password is correct.
      </p><p>
        The server sends the public key to the client as needed, but if
        a copy of the RSA public key is available on the client host,
        the client can use it to save a round trip in the client/server
        protocol:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl=0 -u sha256user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
</pre><p>
        The public key value in the file named by the
        <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option
        should be the same as the key value in the server-side file
        named by the
        <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
        system variable. If the key file contains a valid public key
        value but the value is incorrect, an access-denied error occurs.
        If the key file does not contain a valid public key, the client
        program cannot use it. In this case, the
        <code class="literal">sha256_password</code> plugin sends the public key
        to the client as if no
        <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option
        had been specified.
      </p><p>
        Client users can get the RSA public key two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The database administrator can provide a copy of the public
            key file.
          </p></li><li class="listitem"><p>
            A client user who can connect to the server some other way
            can use a <code class="literal">SHOW STATUS LIKE
            'Rsa_public_key'</code> statement and save the returned
            key value in a file.
</p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pam-authentication-plugin"></a>6.3.8.5 The PAM Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184734208"></a><a class="indexterm" name="idm139737184733104"></a><a class="indexterm" name="idm139737184731616"></a><a class="indexterm" name="idm139737184730096"></a><a class="indexterm" name="idm139737184728624"></a><a class="indexterm" name="idm139737184727536"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The PAM authentication plugin is an extension included in
          MySQL Enterprise Edition, a commercial product. To learn more
          about commercial products, see
          <a class="ulink" href="http://www.mysql.com/products/" target="_top">http://www.mysql.com/products/</a>.
</p>
</div>
<p>
        As of MySQL 5.6.10, MySQL Enterprise Edition includes an
        authentication plugin that enables MySQL Server to use PAM
        (Pluggable Authentication Modules) to authenticate MySQL users.
        PAM enables a system to use a standard interface to access
        various kinds of authentication methods, such as Unix passwords
        or an LDAP directory.
      </p><p>
        The PAM plugin uses the information passed to it by MySQL Server
        (such as user name, host name, password, and authentication
        string), plus whatever method is available for PAM lookup. The
        plugin checks the user credentials against PAM and returns
        <code class="literal">'Authentication succeeded, Username is
        <em class="replaceable"><code>user_name</code></em>'</code> or
        <code class="literal">'Authentication failed'</code>.
      </p><p>
        The PAM authentication plugin provides these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            External authentication: The plugin enables MySQL Server to
            accept connections from users defined outside the MySQL
            grant tables.
          </p></li><li class="listitem"><p>
            Proxy user support: The plugin can return to MySQL a user
            name different from the login user, based on the groups the
            external user is in and the authentication string provided.
            This means that the plugin can return the MySQL user that
            defines the privileges the external PAM-authenticated user
            should have. For example, a PAM user named
            <code class="literal">joe</code> can connect and have the privileges
            of the MySQL user named <code class="literal">developer</code>.
</p></li></ul>
</div>
<p>
        The following table shows the plugin and library file names. The
        file name suffix might be different on your system. The file
        location must be the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable. For
        installation information, see
        <a class="xref" href="security.html#pam-authentication-plugin-installation" title="6.3.8.5.1 Installing the PAM Authentication Plugin">Section 6.3.8.5.1, “Installing the PAM Authentication Plugin”</a>.
</p>
<div class="table">
<a name="idm139737184713808"></a><p class="title"><b>Table 6.11 MySQL PAM Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL PAM Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">authentication_pam</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">mysql_clear_password</code></td></tr><tr><td scope="row">Library object file name</td><td><code class="filename">authentication_pam.so</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The library file includes only the server-side plugin. The
        client-side plugin is built into the
        <code class="literal">libmysqlclient</code> client library. See
        <a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 The Cleartext Client-Side Authentication Plugin">Section 6.3.8.7, “The Cleartext Client-Side Authentication Plugin”</a>.
      </p><p>
        The server-side PAM authentication plugin is included only in
        MySQL Enterprise Edition. It is not included in MySQL community
        distributions. The client-side clear-text plugin that
        communicates with the server-side plugin is built into the MySQL
        client library and is included in all distributions, including
        community distributions. This permits clients from any 5.6.10 or
        newer distribution to connect to a server that has the
        server-side plugin loaded.
      </p><p>
        The PAM authentication plugin has been tested on Linux and Mac
        OS X. It requires MySQL Server 5.6.10 or newer.
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>. For proxy user
        information, see <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="pam-authentication-plugin-installation"></a>6.3.8.5.1 Installing the PAM Authentication Plugin</h5>
</div>
</div>
</div>
<p>
          The PAM authentication plugin must be located in the MySQL
          plugin directory (the directory named by the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable).
          If necessary, set the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup
          to tell the server the location of the plugin directory.
        </p><p>
          To enable the plugin, start the server with the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option. For
          example, put the following lines in your
          <code class="filename">my.cnf</code> file. If object files have a
          suffix different from <code class="filename">.so</code> on your system,
          substitute the correct suffix.
        </p><pre class="programlisting">
[mysqld]
plugin-load=authentication_pam.so
</pre><p>
          Use the plugin name <code class="literal">authentication_pam</code> in
          the <code class="literal">IDENTIFIED WITH</code> clause of
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements for MySQL
          accounts that should be authenticated with this plugin.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="21.14 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement. See <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="pam-authentication-plugin-usage"></a>6.3.8.5.2 Using the PAM Authentication Plugin</h5>

</div>

</div>

</div>
<p>
          This section describes how to use the PAM authentication
          plugin to connect from MySQL client programs to the server. It
          is assumed that the server-side plugin is enabled and that
          client programs are recent enough to include the client-side
          plugin.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The client-side plugin with which the PAM plugin
            communicates simply sends the password to the server in
            clear text so it can be passed to PAM. This may be a
            security problem in some configurations, but is necessary to
            use the server-side PAM library. To avoid problems if there
            is any possibility that the password would be intercepted,
            clients should connect to MySQL Server using SSL. See
            <a class="xref" href="security.html#cleartext-authentication-plugin" title="6.3.8.7 The Cleartext Client-Side Authentication Plugin">Section 6.3.8.7, “The Cleartext Client-Side Authentication Plugin”</a>.
</p>
</div>
<p>
          To refer to the PAM authentication plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of a
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement, use the name
          <code class="literal">authentication_pam</code>. For example:
        </p><pre class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS '<em class="replaceable"><code>authentication_string</code></em>';
</pre><p>
          The authentication string specifies the following types of
          information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              PAM supports the notion of <span class="quote">“<span class="quote">service name,</span>”</span>
              which is a name that the system administrator can use to
              configure the authentication method for a particular
              application. There can be several such
              <span class="quote">“<span class="quote">applications</span>”</span> associated with a single
              database server instance, so the choice of service name is
              left to the SQL application developer. When you define an
              account that should authenticate using PAM, specify the
              service name in the authentication string.
            </p></li><li class="listitem"><p>
              PAM provides a way for a PAM module to return to the
              server a MySQL user name other than the login name
              supplied at login time. Use the authentication string to
              control the mapping between login name and MySQL user
              name. If you want to take advantage of proxy user
              capabilities, the authentication string must include this
              kind of mapping.
</p></li></ul>
</div>
<p>
          For example, if the service name is <code class="literal">mysql</code>
          and users in the <code class="literal">root</code> and
          <code class="literal">users</code> PAM groups should be mapped to the
          <code class="literal">developer</code> and <code class="literal">data_entry</code>
          users, respectively, use a statement like this:
        </p><pre class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS 'mysql, root=developer, users=data_entry';
</pre><p>
          Authentication string syntax for the PAM authentication plugin
          follows these rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The string consists of a PAM service name, optionally
              followed by a group mapping list consisting of one or more
              keyword/value pairs each specifying a group name and a SQL
              user name:
            </p><pre class="programlisting">
<em class="replaceable"><code>pam_service_name</code></em>[,<em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em>]...
</pre></li><li class="listitem"><p>
              Each
              <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em></code>
              pair must be preceded by a comma.
            </p></li><li class="listitem"><p>
              Leading and trailing spaces not inside double quotation
              marks are ignored.
            </p></li><li class="listitem"><p>
              Unquoted <em class="replaceable"><code>pam_service_name</code></em>,
              <em class="replaceable"><code>group_name</code></em>, and
              <em class="replaceable"><code>sql_user_name</code></em> values can
              contain anything except equal sign, comma, or space.
            </p></li><li class="listitem"><p>
              If a <em class="replaceable"><code>pam_service_name</code></em>,
              <em class="replaceable"><code>group_name</code></em>, or
              <em class="replaceable"><code>sql_user_name</code></em> value is quoted
              with double quotation marks, everything between the
              quotation marks is part of the value. This is necessary,
              for example, if the value contains space characters. All
              characters are legal except double quotation mark and
              backslash (<code class="literal">'\'</code>). To include either
              character, escape it with a backslash.
</p></li></ul>
</div>
<p>
          The plugin parses the authentication string on each login
          check. To minimize overhead, keep the string as short as
          possible.
        </p><p>
          If the plugin successfully authenticates a login name, it
          looks for a group mapping list in the authentication string
          and uses it to return a different user name to the MySQL
          server based on the groups the external user is a member of:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the authentication string contains no group mapping
              list, the plugin returns the login name.
            </p></li><li class="listitem"><p>
              If the authentication string does contain a group mapping
              list, the plugin examines each
              <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>sql_user_name</code></em></code>
              pair in the list from left to right and tries to find a
              match for the <em class="replaceable"><code>group_name</code></em> value
              in a non-MySQL directory of the groups assigned to the
              authenticated user and returns
              <em class="replaceable"><code>sql_user_name</code></em> for the first
              match it finds. If the plugin finds no match for any
              group, it returns the login name. If the plugin is not
              capable of looking up a group in a directory, it ignores
              the group mapping list and returns the login name.
</p></li></ul>
</div>
<p>
          The following sections describe how to set up several
          authentication scenarios that use the PAM authentication
          plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              No proxy users. This uses PAM only to check login names
              and passwords. Every external user permitted to connect to
              MySQL Server should have a matching MySQL account that is
              defined to use external PAM authentication. Authentication
              can be performed by various PAM-supported methods. The
              discussion shows how to use traditional Unix passwords and
              LDAP.
            </p><p>
              PAM authentication, when not done through proxy users or
              groups, requires the MySQL account to have the same user
              name as the Unix account. Because MySQL user names are
              limited to 16 characters (see
              <a class="xref" href="security.html#grant-table-structure" title="6.2.2 Privilege System Grant Tables">Section 6.2.2, “Privilege System Grant Tables”</a>), this limits PAM
              nonproxy authentication to Unix accounts with names of at
              most 16 characters.
            </p></li><li class="listitem"><p>
              Proxy login only and group mapping. For this scenario,
              create a few MySQL accounts that define different sets of
              privileges. (Ideally, nobody should log in through these
              directly.) Then define a default user authenticating
              through PAM that uses some mapping scheme (usually by the
              external groups the users are in) to map all the external
              logins to the few MySQL accounts holding the privilege
              sets. Any user that logs in is mapped to one of the MySQL
              accounts and uses its privileges. The discussion shows how
              to set this up using Unix passwords, but other PAM methods
              such as LDAP could be used instead.
</p></li></ul>
</div>
<p>
          Variations on these scenarios are possible. For example, you
          can permit some users to log in directly but require others to
          connect through proxy users.
        </p><p>
          The examples make the following assumptions. You might need to
          make some adjustments if your system is set up differently.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The PAM configuration directory is
              <code class="filename">/etc/pam.d</code>.
            </p></li><li class="listitem"><p>
              The PAM service name is <code class="literal">mysql</code>, which
              means that you must set up a PAM file named
              <code class="filename">mysql</code> in the PAM configuration
              directory (creating the file if it does not exist). If you
              use a different service name, the file name will be
              different and you must use a different name in the
              <code class="literal">AS</code> clause of
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
              <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements.
            </p></li><li class="listitem"><p>
              The examples use a login name of
              <code class="literal">antonio</code> and password of
              <code class="literal">verysecret</code>. Change these to correspond
              to the users you want to authenticate.
</p></li></ul>
</div>
<p>
          The PAM authentication plugin checks at initialization time
          whether the <code class="literal">AUTHENTICATION_PAM_LOG</code>
          environment value is set. If so, the plugin enables logging of
          diagnostic messages to the standard output. These messages may
          be helpful for debugging PAM-related problems that occur when
          the plugin performs authentication. For more information, see
          <a class="xref" href="security.html#pam-authentication-plugin-debugging" title="6.3.8.5.3 PAM Authentication Plugin Debugging">Section 6.3.8.5.3, “PAM Authentication Plugin Debugging”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="pam-authentication-unix-without-proxy"></a>6.3.8.5.2.1 Unix Password Authentication without Proxy Users</h6>
</div>

</div>

</div>
<p>
            This authentication scenario uses PAM only to check Unix
            user login names and passwords. Every external user
            permitted to connect to MySQL Server should have a matching
            MySQL account that is defined to use external PAM
            authentication.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Verify that Unix authentication in PAM permits you to
                log in as <code class="literal">antonio</code> with password
                <code class="literal">verysecret</code>.
              </p></li><li class="listitem"><p>
                Set up PAM to authenticate the <code class="literal">mysql</code>
                service. Put the following in
                <code class="filename">/etc/pam.d/mysql</code>:
              </p><pre class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre></li><li class="listitem"><p>
                Create a MySQL account with the same user name as the
                Unix login name and define it to authenticate using the
                PAM plugin:
              </p><pre class="programlisting">
CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam AS 'mysql';
GRANT ALL PRIVILEGES ON mydb.* TO 'antonio'@'localhost';
</pre></li><li class="listitem"><p>
                Try to connect to the MySQL server using the
                <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> command-line client. For
                example:
              </p><pre class="programlisting">
mysql --user=antonio --password=verysecret --enable-cleartext-plugin mydb
</pre><p>
                The server should permit the connection and the
                following query should return output as shown:
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+-------------------+--------------+
| USER()            | CURRENT_USER()    | @@proxy_user |
+-------------------+-------------------+--------------+
| antonio@localhost | antonio@localhost | NULL         |
+-------------------+-------------------+--------------+
</pre><p>
                This shows that <code class="literal">antonio</code> uses the
                privileges granted to the <code class="literal">antonio</code>
                MySQL account, and that no proxying has occurred.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="pam-authentication-ldap-without-proxy"></a>6.3.8.5.2.2 LDAP Authentication without Proxy Users</h6>
</div>

</div>

</div>
<p>
            This authentication scenario uses PAM only to check LDAP
            user login names and passwords. Every external user
            permitted to connect to MySQL Server should have a matching
            MySQL account that is defined to use external PAM
            authentication.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Verify that LDAP authentication in PAM permits you to
                log in as <code class="literal">antonio</code> with password
                <code class="literal">verysecret</code>.
              </p></li><li class="listitem"><p>
                Set up PAM to authenticate the <code class="literal">mysql</code>
                service through LDAP. Put the following in
                <code class="filename">/etc/pam.d/mysql</code>:
              </p><pre class="programlisting">
#%PAM-1.0
auth        required    pam_ldap.so
account     required    pam_ldap.so
</pre><p>
                If PAM object files have a suffix different from
                <code class="filename">.so</code> on your system, substitute the
                correct suffix.
              </p></li><li class="listitem"><p>
                MySQL account creation and connecting to the server is
                the same as previously described in
                <a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="6.3.8.5.2.1 Unix Password Authentication without Proxy Users">Section 6.3.8.5.2.1, “Unix Password Authentication without Proxy Users”</a>.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h6 class="title"><a name="pam-authentication-unix-with-proxy"></a>6.3.8.5.2.3 Unix Password Authentication with Proxy Users and Group Mapping</h6>
</div>

</div>

</div>
<p>
            This authentication scheme uses proxying and group mapping
            to map users who connect to the MySQL server through PAM
            onto a few MySQL accounts that define different sets of
            privileges. Users do not connect directly through the
            accounts that define the privileges. Instead, they connect
            through a default proxy user authenticating through PAM that
            uses a mapping scheme to map all the external logins to the
            few MySQL accounts holding the privileges. Any user who
            connects is mapped to one of the MySQL accounts and uses its
            privileges.
          </p><p>
            The procedure shown here uses Unix password authentication.
            To use LDAP instead, see the early steps of
            <a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="6.3.8.5.2.2 LDAP Authentication without Proxy Users">Section 6.3.8.5.2.2, “LDAP Authentication without Proxy Users”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Verify that Unix authentication in PAM permits you to
                log in as <code class="literal">antonio</code> with password
                <code class="literal">verysecret</code> and that
                <code class="literal">antonio</code> is a member of the
                <code class="literal">root</code> or <code class="literal">users</code>
                group.
              </p></li><li class="listitem"><p>
                Set up PAM to authenticate the <code class="literal">mysql</code>
                service. Put the following in
                <code class="filename">/etc/pam.d/mysql</code>:
              </p><pre class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre></li><li class="listitem"><p>
                Create the default proxy user that maps the external PAM
                users to the proxied accounts. It maps external users
                from the <code class="literal">root</code> PAM group to the
                <code class="literal">developer</code> MySQL account and the
                external users from the <code class="literal">users</code> PAM
                group to the <code class="literal">data_entry</code> MySQL
                account:
              </p><pre class="programlisting">
CREATE USER ''@''
  IDENTIFIED WITH authentication_pam
  AS 'mysql, root=developer, users=data_entry';
</pre><p>
                The mapping list following the service name is required
                when you set up proxy users. Otherwise, the plugin
                cannot tell how to map the name of PAM groups to the
                proper proxied user name.
              </p></li><li class="listitem"><p>
                Create the proxied accounts that will be used to access
                the databases:
              </p><pre class="programlisting">
CREATE USER 'developer'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';
GRANT ALL PRIVILEGES ON mydevdb.* TO 'developer'@'localhost';
CREATE USER 'data_entry'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';
GRANT ALL PRIVILEGES ON mydb.* TO 'data_entry'@'localhost'; 
</pre><p>
                If you do not let anyone know the passwords for these
                accounts, other users cannot use them to connect
                directly to the MySQL server. Instead, it is expected
                that users will authenticate using PAM and that they
                will use the <code class="literal">developer</code> or
                <code class="literal">data_entry</code> account by proxy based on
                their PAM group.
              </p></li><li class="listitem"><p>
                Grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege
                to the proxy account for the proxied accounts:
              </p><pre class="programlisting">
GRANT PROXY ON 'developer'@'localhost' TO ''@'';
GRANT PROXY ON 'data_entry'@'localhost' TO ''@'';
</pre></li><li class="listitem"><p>
                Try to connect to the MySQL server using the
                <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> command-line client. For
                example:
              </p><pre class="programlisting">
mysql --user=antonio --password=verysecret --enable-cleartext-plugin mydb
</pre><p>
                The server authenticates the connection using the
                <code class="literal">''@''</code> account. The privileges
                <code class="literal">antonio</code> will have depends on what PAM
                groups he is a member of. If <code class="option">antonio</code> is
                a member of the <code class="literal">root</code> PAM group, the
                PAM plugin maps <code class="literal">root</code> to the
                <code class="literal">developer</code> MySQL user name and returns
                that name to the server. The server verifies that
                <code class="literal">''@''</code> has the
                <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
                <code class="literal">developer</code> and permits the connection.
                the following query should return output as shown:
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+---------------------+--------------+
| USER()            | CURRENT_USER()      | @@proxy_user |
+-------------------+---------------------+--------------+
| antonio@localhost | developer@localhost | ''@''        |
+-------------------+---------------------+--------------+
</pre><p>
                This shows that <code class="literal">antonio</code> uses the
                privileges granted to the <code class="literal">developer</code>
                MySQL account, and that proxying occurred through the
                default proxy user account.
              </p><p>
                If <code class="literal">antonio</code> is not a member of the
                <code class="literal">root</code> PAM group but is a member of the
                <code class="literal">users</code> group, a similar process
                occurs, but the plugin maps <code class="literal">user</code>
                group membership to the <code class="literal">data_entry</code>
                MySQL user name and returns that name to the server. In
                this case, <code class="literal">antonio</code> uses the
                privileges of the <code class="literal">data_entry</code> MySQL
                account:
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+----------------------+--------------+
| USER()            | CURRENT_USER()       | @@proxy_user |
+-------------------+----------------------+--------------+
| antonio@localhost | data_entry@localhost | ''@''        |
+-------------------+----------------------+--------------+
</pre></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="pam-authentication-plugin-debugging"></a>6.3.8.5.3 PAM Authentication Plugin Debugging</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184548736"></a><a class="indexterm" name="idm139737184547632"></a><p>
          The PAM authentication plugin checks at initialization time
          whether the <code class="literal">AUTHENTICATION_PAM_LOG</code>
          environment value is set (the value does not matter). If so,
          the plugin enables logging of diagnostic messages to the
          standard output. These messages may be helpful for debugging
          PAM-related problems that occur when the plugin performs
          authentication.
        </p><p>
          Some messages include reference to PAM plugin source files and
          line numbers, which enables plugin actions to be tied more
          closely to the location in the code where they occur.
        </p><p>
          The following transcript demonstrates the kind of information
          produced by enabling logging. It resulted from a successful
          proxy authentication attempt.
        </p><pre class="programlisting">
entering auth_pam_server
entering auth_pam_next_token
auth_pam_next_token:reading at [cups,admin=writer,everyone=reader], sep=[,]
auth_pam_next_token:state=PRESPACE, ptr=[cups,admin=writer,everyone=reader],
out=[]
auth_pam_next_token:state=IDENT, ptr=[cups,admin=writer,everyone=reader],
out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[,admin=writer,everyone=reader],
out=[cups]
auth_pam_next_token:state=DELIMITER, ptr=[,admin=writer,everyone=reader],
out=[cups]
auth_pam_next_token:state=DONE, ptr=[,admin=writer,everyone=reader],
out=[cups]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
auth_pam_server:password 12345qq received
auth_pam_server:pam_start rc=0
auth_pam_server:pam_set_item(PAM_RUSER,gkodinov) rc=0
auth_pam_server:pam_set_item(PAM_RHOST,localhost) rc=0
entering auth_pam_server_conv
auth_pam_server_conv:PAM_PROMPT_ECHO_OFF [Password:] received
leaving auth_pam_server_conv on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:257
auth_pam_server:pam_authenticate rc=0
auth_pam_server:pam_acct_mgmt rc=0
auth_pam_server:pam_setcred(PAM_ESTABLISH_CRED) rc=0
auth_pam_server:pam_get_item rc=0
auth_pam_server:pam_setcred(PAM_DELETE_CRED) rc=0
entering auth_pam_map_groups
entering auth_pam_walk_namevalue_list
auth_pam_walk_namevalue_list:reading at: [admin=writer,everyone=reader]
entering auth_pam_next_token
auth_pam_next_token:reading at [admin=writer,everyone=reader], sep=[=]
auth_pam_next_token:state=PRESPACE, ptr=[admin=writer,everyone=reader], out=[]
auth_pam_next_token:state=IDENT, ptr=[admin=writer,everyone=reader], out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[=writer,everyone=reader],
out=[admin]
auth_pam_next_token:state=DELIMITER, ptr=[=writer,everyone=reader],
out=[admin]
auth_pam_next_token:state=DONE, ptr=[=writer,everyone=reader], out=[admin]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
auth_pam_walk_namevalue_list:name=[admin]
entering auth_pam_next_token
auth_pam_next_token:reading at [writer,everyone=reader], sep=[,]
auth_pam_next_token:state=PRESPACE, ptr=[writer,everyone=reader], out=[]
auth_pam_next_token:state=IDENT, ptr=[writer,everyone=reader], out=[]
auth_pam_next_token:state=AFTERSPACE, ptr=[,everyone=reader], out=[writer]
auth_pam_next_token:state=DELIMITER, ptr=[,everyone=reader], out=[writer]
auth_pam_next_token:state=DONE, ptr=[,everyone=reader], out=[writer]
leaving auth_pam_next_token on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:191
walk, &amp;error_namevalue_list:value=[writer]
entering auth_pam_map_group_to_user
auth_pam_map_group_to_user:pam_user=gkodinov, name=admin, value=writer
examining member root
examining member gkodinov
substitution was made to mysql user writer
leaving auth_pam_map_group_to_user on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:118
auth_pam_walk_namevalue_list:found mapping
leaving auth_pam_walk_namevalue_list on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/parser.c:270
auth_pam_walk_namevalue_list returned 0
leaving auth_pam_map_groups on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:171
auth_pam_server:authenticated_as=writer
auth_pam_server: rc=0
leaving auth_pam_server on
/Users/gkodinov/mysql/work/x-5.5.16-release-basket/release/plugin/pam-authentication-plugin/src/authentication_pam.c:429
</pre>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="windows-authentication-plugin"></a>6.3.8.6 The Windows Native Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184535888"></a><a class="indexterm" name="idm139737184534784"></a><a class="indexterm" name="idm139737184533296"></a><a class="indexterm" name="idm139737184532192"></a><a class="indexterm" name="idm139737184530736"></a><a class="indexterm" name="idm139737184529232"></a><a class="indexterm" name="idm139737184527728"></a><a class="indexterm" name="idm139737184526640"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The Windows authentication plugin is an extension included in
          MySQL Enterprise Edition, a commercial product. To learn more
          about commercial products, see
          <a class="ulink" href="http://www.mysql.com/products/" target="_top">http://www.mysql.com/products/</a>.
</p>
</div>
<p>
        As of MySQL 5.6.10, MySQL Enterprise Edition for Windows
        includes an authentication plugin that performs external
        authentication on Windows, enabling MySQL Server to use native
        Windows services to authenticate client connections. Users who
        have logged in to Windows can connect from MySQL client programs
        to the server based on the information in their environment
        without specifying an additional password.
      </p><p>
        The client and server exchange data packets in the
        authentication handshake. As a result of this exchange, the
        server creates a security context object that represents the
        identity of the client in the Windows OS. This identity includes
        the name of the client account. The Windows authentication
        plugin uses the identity of the client to check whether it is a
        given account or a member of a group. By default, negotiation
        uses Kerberos to authenticate, then NTLM if Kerberos is
        unavailable.
      </p><p>
        The Windows authentication plugin provides these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            External authentication: The plugin enables MySQL Server to
            accept connections from users defined outside the MySQL
            grant tables.
          </p></li><li class="listitem"><p>
            Proxy user support: The plugin can return to MySQL a user
            name different from the client user. This means that the
            plugin can return the MySQL user that defines the privileges
            the external Windows-authenticated user should have. For
            example, a Windows user named <code class="literal">joe</code> can
            connect and have the privileges of the MySQL user named
            <code class="literal">developer</code>.
</p></li></ul>
</div>
<p>
        The following table shows the plugin and library file names. The
        file location must be the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable. For
        installation information, see
        <a class="xref" href="security.html#windows-authentication-plugin-installation" title="6.3.8.6.1 Installing the Windows Authentication Plugin">Section 6.3.8.6.1, “Installing the Windows Authentication Plugin”</a>.
</p>
<div class="table">
<a name="idm139737184514208"></a><p class="title"><b>Table 6.12 MySQL Windows Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Windows Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">authentication_windows</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">authentication_windows_client</code></td></tr><tr><td scope="row">Library object file name</td><td><code class="filename">authentication_windows.dll</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The library file includes only the server-side plugin. The
        client-side plugin is built into the
        <code class="literal">libmysqlclient</code> client library.
      </p><p>
        The server-side Windows authentication plugin is included only
        in MySQL Enterprise Edition. It is not included in MySQL
        community distributions. The client-side plugin is included in
        all distributions, including community distributions. This
        permits clients from any distribution to connect to a server
        that has the server-side plugin loaded.
      </p><p>
        The Windows authentication plugin is supported on any version of
        Windows supported by MySQL 5.6 (see
        <a class="ulink" href="http://www.mysql.com/support/supportedplatforms/database.html" target="_top">http://www.mysql.com/support/supportedplatforms/database.html</a>). It requires MySQL
        Server 5.6.10 or newer.
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>. For proxy user
        information, see <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="windows-authentication-plugin-installation"></a>6.3.8.6.1 Installing the Windows Authentication Plugin</h5>
</div>
</div>
</div>
<p>
          The Windows authentication plugin must be installed in the
          MySQL plugin directory (the directory named by the
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable).
          If necessary, set the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup
          to tell the server the location of the plugin directory.
        </p><p>
          To enable the plugin, start the server with the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option. For
          example, put these lines in your <code class="filename">my.ini</code>
          file:
        </p><pre class="programlisting">
[mysqld]
plugin-load=authentication_windows.dll
</pre><p>
          Use the plugin name <code class="literal">authentication_windows</code>
          in the <code class="literal">IDENTIFIED WITH</code> clause of
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statements for MySQL
          accounts that should be authenticated with this plugin.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="21.14 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement. See <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="windows-authentication-plugin-usage"></a>6.3.8.6.2 Using the Windows Authentication Plugin</h5>

</div>

</div>

</div>
<p>
          The Windows authentication plugin supports the use of MySQL
          accounts such that users who have logged in to Windows can
          connect to the MySQL server without having to specify an
          additional password. It is assumed that the server-side plugin
          is enabled and that client programs are recent enough to
          include the client-side plugin built into
          <code class="literal">libmysqlclient</code>. Once the DBA has enabled
          the server-side plugin and set up accounts to use it, clients
          can connect using those accounts with no other setup required
          on their part.
        </p><p>
          To refer to the Windows authentication plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of a
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement, use the name
          <code class="literal">authentication_windows</code>. Suppose that the
          Windows users <code class="literal">Rafal</code> and
          <code class="literal">Tasha</code> should be permitted to connect to
          MySQL, as well as any users in the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group. To set this up, create a MySQL account
          named <code class="literal">sql_admin</code> that uses the Windows
          plugin for authentication:
        </p><pre class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';
</pre><p>
          The plugin name is <code class="literal">authentication_windows</code>.
          The string following the <code class="literal">AS</code> keyword is the
          authentication string. It specifies that the Windows users
          named <code class="literal">Rafal</code> or <code class="literal">Tasha</code> are
          permitted to authenticate to the server as the MySQL user
          <code class="literal">sql_admin</code>, as are any Windows users in the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group. The latter group name contains a space,
          so it must be quoted with double quote characters.
        </p><p>
          After you create the <code class="literal">sql_admin</code> account, a
          user who has logged in to Windows can attempt to connect to
          the server using that account:
        </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>mysql --user=sql_admin</code></strong>
</pre><p>
          No password is required here. The
          <code class="literal">authentication_windows</code> plugin uses the
          Windows security API to check which Windows user is
          connecting. If that user is named <code class="literal">Rafal</code> or
          <code class="literal">Tasha</code>, or is in the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group, the server grants access and the client
          is authenticated as <code class="literal">sql_admin</code> and has
          whatever privileges are granted to the
          <code class="literal">sql_admin</code> account. Otherwise, the server
          denies access.
        </p><p>
          Authentication string syntax for the Windows authentication
          plugin follows these rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The string consists of one or more user mappings separated
              by commas.
            </p></li><li class="listitem"><p>
              Each user mapping associates a Windows user or group name
              with a MySQL user name:
            </p><pre class="programlisting">
<em class="replaceable"><code>win_user_or_group_name=sql_user_name</code></em>
<em class="replaceable"><code>win_user_or_group_name</code></em>
</pre><p>
              For the latter syntax, with no
              <em class="replaceable"><code>sql_user_name</code></em> value given, the
              implicit value is the MySQL user created by the
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement.
              Thus, these statements are equivalent:
            </p><pre class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';

CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal=sql_admin, Tasha=sql_admin, Administrators=sql_admin,
      "Power Users"=sql_admin';
</pre></li><li class="listitem"><p>
              Each backslash (<code class="literal">'\'</code>) in a value must be
              doubled because backslash is the escape character in MySQL
              strings.
            </p></li><li class="listitem"><p>
              Leading and trailing spaces not inside double quotation
              marks are ignored.
            </p></li><li class="listitem"><p>
              Unquoted <em class="replaceable"><code>win_user_or_group_name</code></em>
              and <em class="replaceable"><code>sql_user_name</code></em> values can
              contain anything except equal sign, comma, or space.
            </p></li><li class="listitem"><p>
              If a <em class="replaceable"><code>win_user_or_group_name</code></em> and
              or <em class="replaceable"><code>sql_user_name</code></em> value is
              quoted with double quotation marks, everything between the
              quotation marks is part of the value. This is necessary,
              for example, if the name contains space characters. All
              characters within double quotes are legal except double
              quotation mark and backslash. To include either character,
              escape it with a backslash.
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> values
              use conventional syntax for Windows principals, either
              local or in a domain. Examples (note the doubling of
              backslashes):
            </p><pre class="programlisting">
domain\\user
.\\user
domain\\group
.\\group
BUILTIN\\WellKnownGroup
</pre></li></ul>
</div>
<p>
          When invoked by the server to authenticate a client, the
          plugin scans the authentication string left to right for a
          user or group match to the Windows user. If there is a match,
          the plugin returns the corresponding
          <em class="replaceable"><code>sql_user_name</code></em> to the MySQL server.
          If there is no match, authentication fails.
        </p><p>
          A user name match takes preference over a group name match.
          Suppose that the Windows user named
          <code class="literal">win_user</code> is a member of
          <code class="literal">win_group</code> and the authentication string
          looks like this:
        </p><pre class="programlisting">
'win_group = sql_user1, win_user = sql_user2'
</pre><p>
          When <code class="literal">win_user</code> connects to the MySQL server,
          there is a match both to <code class="literal">win_group</code> and to
          <code class="literal">win_user</code>. The plugin authenticates the user
          as <code class="literal">sql_user2</code> because the more-specific user
          match takes precedence over the group match, even though the
          group is listed first in the authentication string.
        </p><p>
          Windows authentication always works for connections from the
          same computer on which the server is running. For
          cross-computer connections, both computers must be registered
          with Windows Active Directory. If they are in the same Windows
          domain, it is unnecessary to specify a domain name. It is also
          possible to permit connections from a different domain, as in
          this example:
        </p><pre class="programlisting">
CREATE USER sql_accounting
  IDENTIFIED WITH authentication_windows
  AS 'SomeDomain\\Accounting';
</pre><p>
          Here <code class="literal">SomeDomain</code> is the name of the other
          domain. The backslash character is doubled because it is the
          MySQL escape character within strings.
        </p><p>
          MySQL supports the concept of proxy users whereby a client can
          connect and authenticate to the MySQL server using one account
          but while connected has the privileges of another account (see
          <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>). Suppose that you want Windows
          users to connect using a single user name but be mapped based
          on their Windows user and group names onto specific MySQL
          accounts as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <code class="literal">local_user</code> and
              <code class="literal">MyDomain\domain_user</code> local and domain
              Windows users should map to the
              <code class="literal">local_wlad</code> MySQL account.
            </p></li><li class="listitem"><p>
              Users in the <code class="literal">MyDomain\Developers</code> domain
              group should map to the <code class="literal">local_dev</code> MySQL
              account.
            </p></li><li class="listitem"><p>
              Local machine administrators should map to the
              <code class="literal">local_admin</code> MySQL account.
</p></li></ul>
</div>
<p>
          To set this up, create a proxy account for Windows users to
          connect to, and configure this account so that users and
          groups map to the appropriate MySQL accounts
          (<code class="literal">local_wlad</code>, <code class="literal">local_dev</code>,
          <code class="literal">local_admin</code>). In addition, grant the MySQL
          accounts the privileges appropriate to the operations they
          need to perform. The following instructions use
          <code class="literal">win_proxy</code> as the proxy account, and
          <code class="literal">local_wlad</code>, <code class="literal">local_dev</code>,
          and <code class="literal">local_admin</code> as the proxied accounts.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the proxy MySQL account:
            </p><pre class="programlisting">
CREATE USER win_proxy
  IDENTIFIED WITH  authentication_windows
  AS 'local_user = local_wlad,
      MyDomain\\domain_user = local_wlad,
      MyDomain\\Developers = local_dev,
      BUILTIN\\Administrators = local_admin';
</pre></li><li class="listitem"><p>
              For proxying to work, the proxied accounts must exist, so
              create them:
            </p><pre class="programlisting">
CREATE USER local_wlad IDENTIFIED BY 'wlad_pass';
CREATE USER local_dev IDENTIFIED BY 'dev_pass';
CREATE USER local_admin IDENTIFIED BY  'admin_pass';
</pre><p>
              If you do not let anyone know the passwords for these
              accounts, other users cannot use them to connect directly
              to the MySQL server.
            </p><p>
              You should also issue <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>
              statements (not shown) that grant each proxied account the
              privileges it needs.
            </p></li><li class="listitem"><p>
              The proxy account must have the
              <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for each of
              the proxied accounts:
            </p><pre class="programlisting">
GRANT PROXY ON local_wlad TO win_proxy;
GRANT PROXY ON local_dev TO win_proxy;
GRANT PROXY ON local_admin TO win_proxy;
</pre></li></ol>
</div>
<p>
          Now the Windows users <code class="literal">local_user</code> and
          <code class="literal">MyDomain\domain_user</code> can connect to the
          MySQL server as <code class="literal">win_proxy</code> and when
          authenticated have the privileges of the account given in the
          authentication string—in this case,
          <code class="literal">local_wlad</code>. A user in the
          <code class="literal">MyDomain\Developers</code> group who connects as
          <code class="literal">win_proxy</code> has the privileges of the
          <code class="literal">local_dev</code> account. A user in the
          <code class="literal">BUILTIN\Administrators</code> group has the
          privileges of the <code class="literal">local_admin</code> account.
        </p><p>
          To configure authentication so that all Windows users who do
          not have their own MySQL account go through a proxy account,
          substitute the default proxy user (<code class="literal">''@''</code>)
          for <code class="literal">win_proxy</code> in the preceding
          instructions. For information about the default proxy user,
          see <a class="xref" href="security.html#proxy-users" title="6.3.9 Proxy Users">Section 6.3.9, “Proxy Users”</a>.
        </p><p>
          To use the Windows authentication plugin with Connector/Net
          connection strings in Connection/Net 6.4.4 and higher, see
          <a class="ulink" href="http://dev.mysql.com/doc/connector-net/en/connector-net-programming-authentication-windows-native.html" target="_top">Using the Windows Native Authentication Plugin</a>.
        </p><p>
          Additional control over the Windows authentication plugin is
          provided by the
          <a class="link" href="server-administration.html#sysvar_authentication_windows_use_principal_name"><code class="literal">authentication_windows_use_principal_name</code></a>
          and
          <a class="link" href="server-administration.html#sysvar_authentication_windows_log_level"><code class="literal">authentication_windows_log_level</code></a>
          system variables. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="cleartext-authentication-plugin"></a>6.3.8.7 The Cleartext Client-Side Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184392432"></a><a class="indexterm" name="idm139737184391328"></a><p>
        As of MySQL 5.6.2, a client-side authentication plugin is
        available that sends the password to the server without hashing
        or encryption. This plugin is built into the MySQL client
        library.
      </p><p>
        The following table shows the plugin name.
</p>
<div class="table">
<a name="idm139737184388752"></a><p class="title"><b>Table 6.13 MySQL Cleartext Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Cleartext Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td>None, see discussion</td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">mysql_clear_password</code></td></tr><tr><td scope="row">Library object file name</td><td>None (plugin is built in)</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        With native MySQL authentication, the client performs one-way
        hashing on the password before sending it to the server. This
        enables the client to avoid sending the password in clear text.
        See <a class="xref" href="security.html#password-hashing" title="6.1.2.4 Password Hashing in MySQL">Section 6.1.2.4, “Password Hashing in MySQL”</a>. However, because the
        hash algorithm is one way, the original password cannot be
        recovered on the server side.
      </p><p>
        One-way hashing cannot be done for authentication schemes that
        require the server to receive the password as entered on the
        client side. In such cases, the
        <code class="literal">mysql_clear_password</code> client-side plugin can
        be used to send the password to the server in clear text. There
        is no corresponding server-side plugin. Rather, the client-side
        plugin can be used by any server-side plugin that needs a clear
        text password. (The PAM authentication plugin is one such; see
        <a class="xref" href="security.html#pam-authentication-plugin" title="6.3.8.5 The PAM Authentication Plugin">Section 6.3.8.5, “The PAM Authentication Plugin”</a>.)
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Sending passwords in clear text may be a security problem in
          some configurations. To avoid problems if there is any
          possibility that the password would be intercepted, clients
          should connect to MySQL Server using a method that protects
          the password. Possibilities include SSL (see
          <a class="xref" href="security.html#ssl-connections" title="6.3.10 Using SSL for Secure Connections">Section 6.3.10, “Using SSL for Secure Connections”</a>), IPsec, or a private
          network.
</p>
</div>
<p>
        As of MySQL 5.6.7, to make inadvertent use of this plugin less
        likely, it is required that clients explicitly enable it. This
        can be done several ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Set the <code class="literal">LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN</code>
            environment variable to a value that begins with
            <code class="literal">1</code>, <code class="literal">Y</code>, or
            <code class="literal">y</code>. This enables the plugin for all client
            connections.
          </p></li><li class="listitem"><p>
            The <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>, <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>,
            and <a class="link" href="programs.html#mysqlslap" title="4.5.7 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a> client programs support an
            <code class="option">--enable-cleartext-plugin</code> option that
            enables the plugin on a per-invocation basis.
          </p></li><li class="listitem"><p>
            The <a class="link" href="connectors-apis.html#mysql-options" title="23.8.7.49 mysql_options()"><code class="literal">mysql_options()</code></a> C API
            function supports a
            <code class="literal">MYSQL_ENABLE_CLEARTEXT_PLUGIN</code> option that
            enables the plugin on a per-connection basis. Also, any
            program that uses <code class="literal">libmysqlclient</code> and
            reads option files can enable the plugin by including an
            <code class="literal">enable-cleartext-plugin</code> option in an
            option group read by the client library.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="socket-authentication-plugin"></a>6.3.8.8 The Socket Peer-Credential Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184359632"></a><a class="indexterm" name="idm139737184358592"></a><p>
        As of MySQL 5.6.2, a server-side authentication plugin is
        available that authenticates clients that connect from the local
        host through the Unix socket file.
      </p><p>
        The source code for this plugin can be examined as a relatively
        simple example demonstrating how to write a loadable
        authentication plugin.
      </p><p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The file location
        is the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable. For
        installation information, see
        <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
<div class="table">
<a name="idm139737184353312"></a><p class="title"><b>Table 6.14 MySQL Socket Peer-Credential Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Socket Peer-Credential Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">auth_socket</code></td></tr><tr><td scope="row">Client-side plugin name</td><td>None, see discussion</td></tr><tr><td scope="row">Library object file name</td><td><code class="filename">auth_socket.so</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The <code class="literal">auth_socket</code> authentication plugin
        authenticates clients that connect from the local host through
        the Unix socket file. The plugin uses the
        <code class="literal">SO_PEERCRED</code> socket option to obtain
        information about the user running the client program. Thus, the
        plugin can be built only on systems that support the
        <code class="literal">SO_PEERCRED</code> option, such as Linux.
      </p><p>
        The plugin checks whether the user name matches the MySQL user
        name specified by the client program to the server, and permits
        the connection only if the names match.
      </p><p>
        Suppose that a MySQL account is created for a user named
        <code class="literal">valerie</code> who is to be authenticated by the
        <code class="literal">auth_socket</code> plugin for connections from the
        local host through the socket file:
      </p><pre class="programlisting">
CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
</pre><p>
        If a user on the local host with a login name of
        <code class="literal">stefanie</code> invokes <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
        with the option <code class="option">--user=valerie</code> to connect
        through the socket file, the server uses
        <code class="literal">auth_socket</code> to authenticate the client. The
        plugin determines that the <code class="option">--user</code> option value
        (<code class="literal">valerie</code>) differs from the client user's name
        (<code class="literal">stephanie</code>) and refuses the connection. If a
        user named <code class="literal">valerie</code> tries the same thing, the
        plugin finds that the user name and the MySQL user name are both
        <code class="literal">valerie</code> and permits the connection. However,
        the plugin refuses the connection even for
        <code class="literal">valerie</code> if the connection is made using a
        different protocol, such as TCP/IP.
      </p><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="test-authentication-plugin"></a>6.3.8.9 The Test Authentication Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184329328"></a><a class="indexterm" name="idm139737184328224"></a><a class="indexterm" name="idm139737184326736"></a><a class="indexterm" name="idm139737184325648"></a><p>
        MySQL includes a test plugin that authenticates using MySQL
        native authentication, but is a loadable plugin (not built in)
        and must be installed prior to use. It can authenticate against
        either normal or older (shorter) password hash values.
      </p><p>
        This plugin is intended for testing and development purposes,
        and not for use in production environments. The test plugin
        source code is separate from the server source, unlike the
        built-in native plugin, so it can be examined as a relatively
        simple example demonstrating how to write a loadable
        authentication plugin.
      </p><p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The file location
        is the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable. For
        installation information, see
        <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
<div class="table">
<a name="idm139737184320080"></a><p class="title"><b>Table 6.15 MySQL Test Authentication Plugin</b></p>
<div class="table-contents">
<table summary="MySQL Test Authentication Plugin" border="1"><colgroup><col><col></colgroup><tbody><tr><td scope="row">Server-side plugin name</td><td><code class="literal">test_plugin_server</code></td></tr><tr><td scope="row">Client-side plugin name</td><td><code class="literal">auth_test_plugin</code></td></tr><tr><td scope="row">Library object file name</td><td><code class="filename">auth_test_plugin.so</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        Because the test plugin authenticates the same way as native
        MySQL authentication, provide the usual
        <a class="link" href="programs.html#option_general_user"><code class="option">--user</code></a> and
        <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> options that you
        normally use for accounts that use native authentication when
        you connect to the server. For example:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=<em class="replaceable"><code>your_name</code></em> --password=<em class="replaceable"><code>your_pass</code></em></code></strong>
</pre><p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="proxy-users"></a>6.3.9 Proxy Users</h3>

</div>

</div>

</div>
<p>
      When authentication to the MySQL server occurs by means of an
      authentication plugin, the plugin may request that the connecting
      (external) user be treated as a different user for
      privilege-checking purposes. This enables the external user to be
      a proxy for the second user; that is, to have the privileges of
      the second user. In other words, the external user is a
      <span class="quote">“<span class="quote">proxy user</span>”</span> (a user who can impersonate or become
      known as another user) and the second user is a <span class="quote">“<span class="quote">proxied
      user</span>”</span> (a user whose identity can be taken on by a proxy
      user).
    </p><p>
      This section describes how the proxy user capability works. For
      general information about authentication plugins, see
      <a class="xref" href="security.html#pluggable-authentication" title="6.3.7 Pluggable Authentication">Section 6.3.7, “Pluggable Authentication”</a>. If you are interested
      in writing your own authentication plugins that support proxy
      users, see
      <a class="xref" href="extending-mysql.html#writing-authentication-plugins-proxy-users" title="24.2.4.9.4 Implementing Proxy User Support in Authentication Plugins">Section 24.2.4.9.4, “Implementing Proxy User Support in Authentication Plugins”</a>.
    </p><p>
      For proxying to occur for a given authentication plugin, these
      conditions must be satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          When a connecting client should be treated as a proxy user,
          the plugin must return a different name, to indicate the
          proxied user name.
        </p></li><li class="listitem"><p>
          A proxy user account must be set up to be authenticated by the
          plugin. Use the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement to associate an
          account with a plugin.
        </p></li><li class="listitem"><p>
          A proxy user account must have the
          <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for the proxied
          account. Use the <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>
          statement for this.
</p></li></ul>
</div>
<p>
      Consider the following definitions:
    </p><pre class="programlisting">
CREATE USER 'empl_external'@'localhost'
  IDENTIFIED WITH auth_plugin AS 'auth_string';
CREATE USER 'employee'@'localhost'
  IDENTIFIED BY 'employee_pass';
GRANT PROXY
  ON 'employee'@'localhost'
  TO 'empl_external'@'localhost';
</pre><p>
      When a client connects as <code class="literal">empl_external</code> from
      the local host, MySQL uses <code class="literal">auth_plugin</code> to
      perform authentication. Suppose that
      <code class="literal">auth_plugin</code> returns the
      <code class="literal">employee</code> user name to the server, based on the
      content of <code class="literal">'auth_string'</code> and perhaps by
      consulting some external authentication system. That serves as a
      request to the server to treat this client, for purposes of
      privilege checking, as the <code class="literal">employee</code> local user.
    </p><p>
      In this case, <code class="literal">empl_external</code> is the proxy user
      and <code class="literal">employee</code> is the proxied user.
    </p><p>
      The server verifies that proxy authentication for
      <code class="literal">employee</code> is possible for the
      <code class="literal">empl_external</code> user by checking whether
      <code class="literal">empl_external</code> (the proxy user) has the
      <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
      <code class="literal">employee</code> (the proxied user). If this privilege
      had not been granted, an error occurs.
    </p><p>
      When proxying occurs, the <code class="literal">USER()</code> and
      <code class="literal">CURRENT_USER()</code> functions can be used to see the
      difference between the connecting user and the account whose
      privileges apply during the current session. For the example just
      described, those functions return these values:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-------------------------+--------------------+
| USER()                  | CURRENT_USER()     |
+-------------------------+--------------------+
| empl_external@localhost | employee@localhost |
+-------------------------+--------------------+
</pre><p>
      The <code class="literal">IDENTIFIED WITH</code> clause that names the
      authentication plugin may be followed by an <code class="literal">AS</code>
      clause specifying a string that the server passes to the plugin
      when the user connects. It is up to each plugin whether the
      <code class="literal">AS</code> clause is required. If it is required, the
      format of the authentication string depends on how the plugin
      intends to use it. Consult the documentation for a given plugin
      for information about the authentication string values it accepts.
</p>
<h4><a name="idm139737184272880"></a>Granting the Proxy Privilege</h4>
<p>
      A special <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege is needed
      to enable an external user to connect as and have the privileges
      of another user. To grant this privilege, use the
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement. For example:
    </p><pre class="programlisting">
GRANT PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' TO '<em class="replaceable"><code>proxy_user</code></em>';
</pre><a class="indexterm" name="idm139737184267568"></a><a class="indexterm" name="idm139737184266080"></a><p>
      The statement creates a row in the
      <code class="literal">mysql.proxies_priv</code> grant table.
    </p><p>
      At connection time, <em class="replaceable"><code>proxy_user</code></em> must
      represent a valid externally authenticated MySQL user, and
      <em class="replaceable"><code>proxied_user</code></em> must represent a valid
      locally authenticated user. Otherwise, connection attempts fail.
    </p><p>
      The corresponding <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a> syntax is:
    </p><pre class="programlisting">
REVOKE PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' FROM '<em class="replaceable"><code>proxy_user</code></em>';
</pre><p>
      MySQL <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.6 REVOKE Syntax"><code class="literal">REVOKE</code></a> syntax extensions work as
      usual. For example:
    </p><pre class="programlisting">
GRANT PROXY ON 'a' TO 'b', 'c', 'd';
GRANT PROXY ON 'a' TO 'd' IDENTIFIED BY ...;
GRANT PROXY ON 'a' TO 'd' WITH GRANT OPTION;
GRANT PROXY ON 'a' TO ''@'';
REVOKE PROXY ON 'a' FROM 'b', 'c', 'd';
</pre><p>
      In the preceding example, <code class="literal">''@''</code> is the default
      proxy user and means <span class="quote">“<span class="quote">any user.</span>”</span> The default proxy
      user is discussed later in this section.
    </p><p>
      The <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege can be granted
      in these cases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          By <em class="replaceable"><code>proxied_user</code></em> for itself: The
          value of <code class="literal">USER()</code> must exactly match
          <code class="literal">CURRENT_USER()</code> and
          <em class="replaceable"><code>proxied_user</code></em>, for both the user
          name and host name parts of the account name.
        </p></li><li class="listitem"><p>
          By a user that has <code class="literal">GRANT PROXY ... WITH GRANT
          OPTION</code> for <em class="replaceable"><code>proxied_user</code></em>.
</p></li></ul>
</div>
<p>
      The <code class="literal">root</code> account created by default during
      MySQL installation has the
      <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY ... WITH GRANT
      OPTION</code></a> privilege for <code class="literal">''@''</code>, that is,
      for all users and all hosts. This enables <code class="literal">root</code>
      to set up proxy users, as well as to delegate to other accounts
      the authority to set up proxy users. For example,
      <code class="literal">root</code> can do this:
    </p><pre class="programlisting">
CREATE USER 'admin'@'localhost' IDENTIFIED BY 'test';
GRANT PROXY ON ''@'' TO 'admin'@'localhost' WITH GRANT OPTION;
</pre><p>
      Now the <code class="literal">admin</code> user can manage all the specific
      <code class="literal">GRANT PROXY</code> mappings. For example,
      <code class="literal">admin</code> can do this:
    </p><pre class="programlisting">
GRANT PROXY ON sally TO joe;
</pre>
<h4><a name="idm139737184237072"></a>Default Proxy Users</h4>
<p>
      To specify that some or all users should connect using a given
      plugin, create a <span class="quote">“<span class="quote">blank</span>”</span> MySQL user, set it up to use
      that plugin for authentication, and let the plugin return the real
      authenticated user name (if different from the blank user). For
      example, suppose that there exists a hypothetical plugin named
      <code class="literal">ldap_auth</code> that implements LDAP authentication:
    </p><pre class="programlisting">
CREATE USER ''@'' IDENTIFIED WITH ldap_auth AS 'O=Oracle, OU=MySQL';
CREATE USER 'developer'@'localhost' IDENTIFIED BY 'developer_pass';
CREATE USER 'manager'@'localhost' IDENTIFIED BY 'manager_pass';
GRANT PROXY ON 'manager'@'localhost' TO ''@'';
GRANT PROXY ON 'developer'@'localhost' TO ''@'';
</pre><p>
      Now assume that a client tries to connect as follows:
    </p><pre class="programlisting">
mysql --user=myuser --password='myuser_pass' ...
</pre><p>
      The server will not find <code class="literal">myuser</code> defined as a
      MySQL user. But because there is a blank user account
      (<code class="literal">''@''</code>), that matches the client user name and
      host name, the server authenticates the client against that
      account: The server invokes <code class="literal">ldap_auth</code>, passing
      it <code class="literal">myuser</code> and <code class="literal">myuser_pass</code> as
      the user name and password.
    </p><p>
      If the <code class="literal">ldap_auth</code> plugin finds in the LDAP
      directory that <code class="literal">myuser_pass</code> is not the correct
      password for <code class="literal">myuser</code>, authentication fails and
      the server rejects the connection.
    </p><p>
      If the password is correct and <code class="literal">ldap_auth</code> finds
      that <code class="literal">myuser</code> is a developer, it returns the user
      name <code class="literal">developer</code> to the MySQL server, rather than
      <code class="literal">myuser</code>. The server verifies that
      <code class="literal">''@''</code> can authenticate as
      <code class="literal">developer</code> (because it has the
      <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to do so) and
      accepts the connection. The session proceeds with
      <code class="literal">myuser</code> having the privileges of
      <code class="literal">developer</code>. (These privileges should be set up
      by the DBA using <code class="literal">GRANT</code> statements, not shown.)
      The <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> functions return
      these values:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+---------------------+
| USER()           | CURRENT_USER()      |
+------------------+---------------------+
| myuser@localhost | developer@localhost |
+------------------+---------------------+
</pre><p>
      If the plugin instead finds in the LDAP directory that
      <code class="literal">myuser</code> is a manager, it returns
      <code class="literal">manager</code> as the user name and the session
      proceeds with <code class="literal">myuser</code> having the privileges of
      <code class="literal">manager</code>.
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+-------------------+
| USER()           | CURRENT_USER()    |
+------------------+-------------------+
| myuser@localhost | manager@localhost |
+------------------+-------------------+
</pre><p>
      For simplicity, external authentication cannot be multilevel:
      Neither the credentials for <code class="literal">developer</code> nor those
      for <code class="literal">manager</code> are taken into account in the
      preceding example. However, they are still used if a client tries
      to authenticate directly against the <code class="literal">developer</code>
      or <code class="literal">manager</code> account, which is why those accounts
      should be assigned passwords.
    </p><p>
      The default proxy account uses <code class="literal">''</code> in the host
      part, which matches any host. If you set up a default proxy user,
      take care to also check for accounts with <code class="literal">'%'</code>
      in the host part, because that also matches any host, but has
      precedence over <code class="literal">''</code> by the rules that the server
      uses to sort account rows internally (see
      <a class="xref" href="security.html#connection-access" title="6.2.4 Access Control, Stage 1: Connection Verification">Section 6.2.4, “Access Control, Stage 1: Connection Verification”</a>).
    </p><p>
      Suppose that a MySQL installation includes these two accounts:
    </p><pre class="programlisting">
CREATE USER ''@'' IDENTIFIED WITH some_plugin;
CREATE USER ''@'%' IDENTIFIED BY 'some_password';
</pre><p>
      The intent of the first account is to serve as the default proxy
      user, to be used to authenticate connections for users who do not
      otherwise match a more-specific account. The second account might
      have been created, for example, to enable users without their own
      account as the anonymous user.
    </p><p>
      However, in this configuration, the first account is never used
      because the matching rules sort <code class="literal">''@'%'</code> ahead of
      <code class="literal">''@''</code>. For accounts that do not match any
      more-specific account, the server attempts to authenticate them
      against <code class="literal">''@'%'</code> rather than
      <code class="literal">''@''</code>.
    </p><p>
      If you intend to create a default proxy user, check for other
      existing <span class="quote">“<span class="quote">match any user</span>”</span> accounts that will take
      precedence over the default proxy user and thus prevent that user
      from working as intended. It may be necessary to remove any such
      accounts.
</p>
<h4><a name="idm139737184194208"></a>Proxy User System Variables</h4>
<p>
      Two system variables help trace the proxy login process:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_proxy_user"><code class="literal">proxy_user</code></a>: This value is
          <code class="literal">NULL</code> if proxying is not used. Otherwise, it
          indicates the proxy user account. For example, if a client
          authenticates through the <code class="literal">''@''</code> proxy
          account, this variable is set as follows:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@proxy_user;</code></strong>
+--------------+
| @@proxy_user |
+--------------+
| ''@''        |
+--------------+
</pre></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a>: Sometimes the
          authentication plugin may use an external user to authenticate
          to the MySQL server. For example, when using Windows native
          authentication, a plugin that authenticates using the windows
          API does not need the login ID passed to it. However, it still
          uses a Windows user ID to authenticate. The plugin may return
          this external user ID (or the first 512 UTF-8 bytes of it) to
          the server using the <code class="literal">external_user</code>
          read-only session variable. If the plugin does not set this
          variable, its value is <code class="literal">NULL</code>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="ssl-connections"></a>6.3.10 Using SSL for Secure Connections</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#openssl-versus-yassl">6.3.10.1 OpenSSL Versus yaSSL</a></span></dt><dt><span class="section"><a href="security.html#building-with-ssl-support">6.3.10.2 Building MySQL with SSL Support</a></span></dt><dt><span class="section"><a href="security.html#using-ssl-connections">6.3.10.3 Configuring MySQL to Use SSL Connections</a></span></dt><dt><span class="section"><a href="security.html#ssl-options">6.3.10.4 SSL Command Options</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737184182256"></a><a class="indexterm" name="idm139737184181200"></a><a class="indexterm" name="idm139737184180128"></a><a class="indexterm" name="idm139737184179056"></a><p>
      With an unencrypted connection between the MySQL client and the
      server, someone with access to the network could watch all your
      traffic and look at the data being sent or received, or even
      change the data while it is in transit between client and server.
    </p><a class="indexterm" name="idm139737184176912"></a><p>
      When you must move information over a network in a secure fashion,
      an unencrypted connection is unacceptable. Encryption is the way
      to make any kind of data unreadable. Encryption algorithms must
      include security elements to resist many kinds of known attacks
      such as changing the order of encrypted messages or replaying data
      twice.
    </p><p>
      MySQL supports secure (encrypted) connections between clients and
      the server using the Secure Sockets Layer (SSL) protocol. SSL uses
      encryption algorithms to ensure that data received over a public
      network can be trusted. It has mechanisms to detect any data
      change, loss, or replay. SSL also incorporates algorithms that
      provide identity verification using the X509 standard.
    </p><a class="indexterm" name="idm139737184174256"></a><p>
      X509 makes it possible to identify someone on the Internet. It is
      most commonly used in e-commerce applications. In basic terms,
      there should be some entity called a <span class="quote">“<span class="quote">Certificate
      Authority</span>”</span> (or CA) that assigns electronic certificates to
      anyone who needs them. Certificates rely on asymmetric encryption
      algorithms that have two encryption keys (a public key and a
      secret key). A certificate owner can show the certificate to
      another party as proof of identity. A certificate consists of its
      owner's public key. Any data encrypted with this public key can be
      decrypted only using the corresponding secret key, which is held
      by the owner of the certificate.
    </p><p>
      For more information about SSL, X509, encryption, or public-key
      cryptography, perform an Internet search for the keywords in which
      you are interested.
    </p><p>
      MySQL supports SSL using the TLSv1.0 protocol. As of MySQL 5.6.23,
      it explicitly disables SSL 2.0 and SSL 3.0 because they provide
      weak encryption. To see which protocol version an SSL connection
      uses, check the value of the
      <a class="link" href="server-administration.html#statvar_Ssl_version"><code class="literal">Ssl_version</code></a> status variable
      using this query:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_version';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Ssl_version   | TLSv1 |
+---------------+-------+
</pre><p>
      MySQL enables SSL encryption on a per-connection basis, and use of
      SSL can be optional or mandatory. You can choose an unencrypted
      connection or a secure SSL connection according to the
      requirements of individual applications. For information on how to
      require users to use SSL connections, see the discussion of the
      <code class="literal">REQUIRE</code> clause of the
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement in
      <a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax">Section 13.7.1.4, “GRANT Syntax”</a>.
    </p><p>
      Encrypted connections are not used by default. For applications
      that require the security provided by encrypted connections, the
      extra computation to encrypt the data is worthwhile.
    </p><p>
      Secure connections are are available through the MySQL C API using
      the <a class="link" href="connectors-apis.html#mysql-ssl-set" title="23.8.7.68 mysql_ssl_set()"><code class="literal">mysql_ssl_set()</code></a> function. See
      <a class="xref" href="connectors-apis.html#mysql-ssl-set" title="23.8.7.68 mysql_ssl_set()">Section 23.8.7.68, “mysql_ssl_set()”</a>.
    </p><p>
      Replication uses the C API, so secure connections can be used
      between master and slave servers. See
      <a class="xref" href="replication.html#replication-solutions-ssl" title="17.3.7 Setting Up Replication Using SSL">Section 17.3.7, “Setting Up Replication Using SSL”</a>.
    </p><p>
      MySQL can be compiled using OpenSSL or yaSSL. For a comparison of
      the two packages, see <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>
    </p><p>
      Another way to connect securely is from within an SSH connection
      to the MySQL server host. For an example, see
      <a class="xref" href="security.html#windows-and-ssh" title="6.3.12 Connecting to MySQL Remotely from Windows with SSH">Section 6.3.12, “Connecting to MySQL Remotely from Windows with SSH”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="openssl-versus-yassl"></a>6.3.10.1 OpenSSL Versus yaSSL</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm139737184156176"></a><a class="indexterm" name="idm139737184154704"></a><a class="indexterm" name="idm139737184153216"></a><p>
        MySQL can be compiled using OpenSSL or yaSSL, both of which
        enable secure conections based on the OpenSSL API:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL Enterprise Edition binary distributions are compiled
            using OpenSSL. It is not possible to use yaSSL with MySQL
            Enterprise Edition.
          </p></li><li class="listitem"><p>
            MySQL Community Edition binary distributions are compiled
            using yaSSL. Community Edition source distributions can be
            compiled using either OpenSSL or yaSSL (see
            <a class="xref" href="security.html#building-with-ssl-support" title="6.3.10.2 Building MySQL with SSL Support">Section 6.3.10.2, “Building MySQL with SSL Support”</a>).
</p></li></ul>
</div>
<p>
        OpenSSL and yaSSL offer the same basic functionality, but these
        additional features are available in MySQL distributions
        compiled using OpenSSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            OpenSSL supports a wider range of encryption ciphers from
            which to choose for the
            <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a> option. OpenSSL
            supports the <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>,
            <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a>, and
            <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> options. See
            <a class="xref" href="security.html#ssl-options" title="6.3.10.4 SSL Command Options">Section 6.3.10.4, “SSL Command Options”</a>.
          </p></li><li class="listitem"><p>
            Accounts that authenticate using the
            <code class="literal">sha256_password</code> plugin can use RSA key
            files for secure password exchange over unencrypted
            connections. See
            <a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 The SHA-256 Authentication Plugin">Section 6.3.8.4, “The SHA-256 Authentication Plugin”</a>.
          </p></li><li class="listitem"><p>
            OpenSSL supports more encryption modes for the
            <a class="link" href="functions.html#function_aes-encrypt"><code class="literal">AES_ENCRYPT()</code></a> and
            <a class="link" href="functions.html#function_aes-decrypt"><code class="literal">AES_DECRYPT()</code></a> functions. See
            <a class="xref" href="functions.html#encryption-functions" title="12.13 Encryption and Compression Functions">Section 12.13, “Encryption and Compression Functions”</a>
</p></li></ul>
</div>
<a class="indexterm" name="idm139737184135232"></a><p>
        Certain OpenSSL-related system and status variables are present
        only if MySQL was compiled using OpenSSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
            (added in MySQL 5.6.6)
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
            (added in MySQL 5.6.6)
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a> (added in
            MySQL 5.6.6)
</p></li></ul>
</div>
<p>
        You can test the existence of any of those variables to
        determine whether your server was compiled using OpenSSL. For
        example, this statement returns a row if OpenSSL was used and an
        empty result if yaSSL was used:
      </p><pre class="programlisting">
SHOW STATUS LIKE 'Rsa_public_key';
</pre><p>
        Such tests assume that your server version is not older than the
        first appearance of the variable tested. For example, you cannot
        test for <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a> before
        MySQL 5.6.6.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="building-with-ssl-support"></a>6.3.10.2 Building MySQL with SSL Support</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184122224"></a><a class="indexterm" name="idm139737184120768"></a><a class="indexterm" name="idm139737184119696"></a><p>
        To use SSL connections between the MySQL server and client
        programs, your system must support either OpenSSL or yaSSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL Enterprise Edition binary distributions are compiled
            using OpenSSL. It is not possible to use yaSSL with MySQL
            Enterprise Edition.
          </p></li><li class="listitem"><p>
            MySQL Community Edition binary distributions are compiled
            using yaSSL. Community Edition source distributions can be
            compiled using either OpenSSL or yaSSL.
</p></li></ul>
</div>
<p>
        If you compile MySQL from a source distribution,
        <span class="command"><strong>CMake</strong></span> configures the distribution to use
        yaSSL by default. To compile using OpenSSL instead, use this
        procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Ensure OpenSSL 1.0.1 or higher is installed on your system.
            To obtain OpenSSL, visit
            <a class="ulink" href="http://www.openssl.org" target="_top">http://www.openssl.org</a>.
          </p><p>
            If the installed OpenSSL version is lower than 1.0.1,
            <span class="command"><strong>CMake</strong></span> produces an error at MySQL
            configuration time.
          </p></li><li class="listitem"><p>
            To use OpenSSL, add the
            <a class="link" href="installing.html#option_cmake_with_ssl"><code class="option">-DWITH_SSL=system</code></a> option to
            the <span class="command"><strong>CMake</strong></span> command you normally use to
            configure the MySQL source distribution. For example:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DWITH_SSL=system</code></strong>
</pre><p>
            That command configures the distribution to use the
            installed OpenSSL library. Alternatively, to explicitly
            specify the path name to the OpenSSL installation, use the
            following syntax. This can be useful if you have multiple
            versions of OpenSSL installed, to prevent
            <span class="command"><strong>CMake</strong></span> from choosing the wrong one:
          </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>cmake . -DWITH_SSL=<em class="replaceable"><code>path_name</code></em></code></strong>
</pre><p>
            See <a class="xref" href="installing.html#source-configuration-options" title="2.9.4 MySQL Source-Configuration Options">Section 2.9.4, “MySQL Source-Configuration Options”</a>.
          </p></li><li class="listitem"><p>
            Compile and install the distribution.
</p></li></ol>
</div>
<p>
        To check whether a <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server supports
        SSL, examine the value of the
        <a class="link" href="server-administration.html#sysvar_have_ssl"><code class="literal">have_ssl</code></a> system variable:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_ssl';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| have_ssl      | YES   |
+---------------+-------+
</pre><p>
        If the value is <code class="literal">YES</code>, the server supports SSL
        connections. If the value is <code class="literal">DISABLED</code>, the
        server is capable of supporting SSL connections but was not
        started with the appropriate
        <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options to
        enable SSL to be used; see
        <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
      </p><p>
        To determine whether a server was compiled using OpenSSL or
        yaSSL, check the existence of any of the system or status
        variables that are present only for OpenSSL. See
        <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="using-ssl-connections"></a>6.3.10.3 Configuring MySQL to Use SSL Connections</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184091216"></a><p>
        To enable SSL connections, your MySQL distribution must be built
        with SSL support, as described in
        <a class="xref" href="security.html#building-with-ssl-support" title="6.3.10.2 Building MySQL with SSL Support">Section 6.3.10.2, “Building MySQL with SSL Support”</a>. In addition, the
        proper SSL-related options must be used to specify the
        appropriate certificate and key files. For a complete list of
        SSL options, see <a class="xref" href="security.html#ssl-options" title="6.3.10.4 SSL Command Options">Section 6.3.10.4, “SSL Command Options”</a>.
      </p><p>
        If you need to create the required SSL files, see
        <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.11 Creating SSL and RSA Certificates and Keys">Section 6.3.11, “Creating SSL and RSA Certificates and Keys”</a>.
</p>
<h5><a name="idm139737184086576"></a>Server-Side SSL Configuration</h5>
<p>
        To start the MySQL server so that it permits clients to connect
        using SSL, use options that identify the certificate and key
        files the server uses when establishing a secure connection:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> identifies the
            Certificate Authority (CA) certificate.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> identifies the
            server public key certificate. This can be sent to the
            client and authenticated against the CA certificate that it
            has.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> identifies the
            server private key.
</p></li></ul>
</div>
<p>
        For example, start the server with these lines in the
        <code class="filename">my.cnf</code> file, changing the file names as
        necessary:
      </p><pre class="programlisting">
[mysqld]
ssl-ca=ca.pem
ssl-cert=server-cert.pem
ssl-key=server-key.pem
</pre><p>
        Each option names a file in PEM format. If you have a MySQL
        source distribution, you can also test your setup using the
        demonstration certificate and key files in its
        <code class="filename">mysql-test/std_data</code> directory.
</p>
<h5><a name="idm139737184076080"></a>Client-Side SSL Configuration</h5>
<p>
        For client programs, SSL options are similar to those used on
        the server side, but <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a>
        and <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> identify the
        client public and private key.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> identifies the
            Certificate Authority (CA) certificate. This option, if
            used, must specify the same certificate as used by the
            server.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> identifies the
            client public key certificate.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> identifies the
            client private key.
</p></li></ul>
</div>
<p>
        To establish a secure connection to a MySQL server with SSL
        support, the options that a client must specify depend on the
        SSL requirements of the MySQL account used by the client. (See
        the discussion of the <code class="literal">REQUIRE</code> clause in
        <a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax">Section 13.7.1.4, “GRANT Syntax”</a>.)
      </p><p>
        Suppose that you want to connect using an account that has no
        special SSL requirements or was created using a
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement that includes the
        <code class="literal">REQUIRE SSL</code> option. As a recommended set of
        SSL options, start the server with at least
        <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
        <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a>, and invoke the client
        with <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a>. A client can
        connect securely like this:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-ca=ca.pem</code></strong>
</pre><p>
        To require that a client certificate also be specified, create
        the account using the <code class="literal">REQUIRE X509</code> option.
        Then the client must also specify the proper client key and
        certificate files or the server will reject the connection:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-ca=ca.pem \</code></strong>
       <strong class="userinput"><code>--ssl-cert=client-cert.pem \</code></strong>
       <strong class="userinput"><code>--ssl-key=client-key.pem</code></strong>
</pre><p>
        To prevent use of SSL and override other SSL options, invoke the
        client program with <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl=0</code></a> or a
        synonym
        (<a class="link" href="security.html#option_general_ssl"><code class="option">--skip-ssl</code></a>,
        <a class="link" href="security.html#option_general_ssl"><code class="option">--disable-ssl</code></a>):
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl=0</code></strong>
</pre><p>
        A client can determine whether the current connection with the
        server uses SSL by checking the value of the
        <a class="link" href="server-administration.html#statvar_Ssl_cipher"><code class="literal">Ssl_cipher</code></a> status variable.
        The value is nonempty if SSL is used, and empty otherwise. For
        example:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Ssl_cipher';</code></strong>
+---------------+--------------------+
| Variable_name | Value              |
+---------------+--------------------+
| Ssl_cipher    | DHE-RSA-AES256-SHA |
+---------------+--------------------+
</pre><p>
        For the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client, an alternative is to
        use the <code class="literal">STATUS</code> or <code class="literal">\s</code>
        command and check the <code class="literal">SSL</code> line:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Cipher in use is DHE-RSA-AES256-SHA
...
</pre><p>
        Or:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Not in use
...
</pre>
<h5><a name="idm139737184038784"></a>SSL Configuration and the C API</h5>
<p>
        The C API enables application programs to use SSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To establish a secure connection, use the
            <a class="link" href="connectors-apis.html#mysql-ssl-set" title="23.8.7.68 mysql_ssl_set()"><code class="literal">mysql_ssl_set()</code></a> C API
            function to set the appropriate certificate options before
            calling
            <a class="link" href="connectors-apis.html#mysql-real-connect" title="23.8.7.53 mysql_real_connect()"><code class="literal">mysql_real_connect()</code></a>. See
            <a class="xref" href="connectors-apis.html#mysql-ssl-set" title="23.8.7.68 mysql_ssl_set()">Section 23.8.7.68, “mysql_ssl_set()”</a>.
          </p></li><li class="listitem"><p>
            To determine whether SSL is in use after the connection is
            established, use
            <a class="link" href="connectors-apis.html#mysql-get-ssl-cipher" title="23.8.7.33 mysql_get_ssl_cipher()"><code class="literal">mysql_get_ssl_cipher()</code></a>. A
            non-<code class="literal">NULL</code> return value indicates a secure
            connection and names the SSL cipher used for encryption. A
            <code class="literal">NULL</code> return value indicates that SSL is
            not being used. See <a class="xref" href="connectors-apis.html#mysql-get-ssl-cipher" title="23.8.7.33 mysql_get_ssl_cipher()">Section 23.8.7.33, “mysql_get_ssl_cipher()”</a>.
</p></li></ul>
</div>
<p>
        Replication uses the C API, so secure connections can be used
        between master and slave servers. See
        <a class="xref" href="replication.html#replication-solutions-ssl" title="17.3.7 Setting Up Replication Using SSL">Section 17.3.7, “Setting Up Replication Using SSL”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="ssl-options"></a>6.3.10.4 SSL Command Options</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737184026096"></a><p>
        This section describes options that specify whether to use SSL
        and the names of SSL certificate and key files. These options
        can be given on the command line or in an option file. They are
        not available unless MySQL has been built with SSL support. See
        <a class="xref" href="security.html#building-with-ssl-support" title="6.3.10.2 Building MySQL with SSL Support">Section 6.3.10.2, “Building MySQL with SSL Support”</a>. For examples of
        suggested use and how to check whether a connection is secure,
        see <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
</p>
<div class="table">
<a name="idm139737184022496"></a><p class="title"><b>Table 6.16 SSL Option/Variable Summary</b></p>
<div class="table-contents">
<table summary="SSL Option/Variable Summary" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option File</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_openssl">have_openssl</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_ssl">have_ssl</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">skip-ssl</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">ssl</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-ca">ssl-ca</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_ca">ssl_ca</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-capath">ssl-capath</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_capath">ssl_capath</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cert">ssl-cert</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_cert">ssl_cert</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cipher">ssl-cipher</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_cipher">ssl_cipher</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crl">ssl-crl</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_crl">ssl_crl</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crlpath">ssl-crlpath</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_crlpath">ssl_crlpath</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-key">ssl-key</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_ssl_key">ssl_key</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_general_ssl"></a>
            <a class="indexterm" name="idm139737183951728"></a>

            <a class="indexterm" name="idm139737183950688"></a>

            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>
          </p><p>
            For the MySQL server, this option specifies that the server
            permits but does not require SSL connections.
          </p><p>
            For MySQL client programs, this option permits but does not
            require the client to connect to the server using SSL.
            Therefore, this option is not sufficient in itself to cause
            an SSL connection to be used. For example, if you specify
            this option for a client program but the server has not been
            configured to enable SSL connections, the client falls back
            to an unencrypted connection.
          </p><p>
            As a recommended set of options to enable SSL connections,
            use at least <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the server side
            and <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> on the client
            side. See <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
          </p><p>
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> may be implied by
            other <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code>
            options, as indicated in the descriptions for those options.
          </p><p>
            The <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> option in negated
            form overrides other SSL options and indicates that SSL
            should <span class="emphasis"><em>not</em></span> be used. To do this, specify
            the option as <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl=0</code></a> or a
            synonym
            (<a class="link" href="security.html#option_general_ssl"><code class="option">--skip-ssl</code></a>,
            <a class="link" href="security.html#option_general_ssl"><code class="option">--disable-ssl</code></a>).
            For example, you might have SSL options specified in the
            <code class="literal">[client]</code> group of your option file to use
            SSL connections by default when you invoke MySQL client
            programs. To use an unencrypted connection instead, invoke
            the client program with
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl=0</code></a> on
            the command line to override the options in the option file.
          </p><p>
            To require use of SSL connections for a MySQL account, issue
            a <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a> statement for the
            account that includes at least a <code class="literal">REQUIRE
            SSL</code> clause. Connections for the account will be
            rejected unless MySQL supports SSL connections and the
            server and client have been started with the proper SSL
            options.
          </p><p>
            The <code class="literal">REQUIRE</code> clause permits other
            SSL-related options, which can be used to enforce stricter
            requirements than <code class="literal">REQUIRE SSL</code>. For
            additional details about which SSL command options may or
            must be specified by clients that connect using accounts
            configured using the various <code class="literal">REQUIRE</code>
            options, see the description of <code class="literal">REQUIRE</code>
            in <a class="xref" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax">Section 13.7.1.4, “GRANT Syntax”</a>.
          </p></li><li class="listitem"><p><a name="option_general_ssl-ca"></a>
            <a class="indexterm" name="idm139737183926000"></a>

            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca=<em class="replaceable"><code>file_name</code></em></code></a>
          </p><p>
            The path to a file in PEM format that contains a list of
            trusted SSL certificate authorities. This option implies
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            If you use SSL when establishing a client connection, to
            tell the client not to authenticate the server certificate,
            specify neither <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> nor
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>. The server
            still verifies the client according to any applicable
            requirements established for the client account, and it
            still uses any <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option values
            specified at server startup.
          </p></li><li class="listitem"><p><a name="option_general_ssl-capath"></a>
            <a class="indexterm" name="idm139737183916336"></a>

            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath=<em class="replaceable"><code>dir_name</code></em></code></a>
          </p><p>
            The path to a directory that contains trusted SSL
            certificate authority certificates in PEM format. This
            option implies <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            If you use SSL when establishing a client connection, to
            tell the client not to authenticate the server certificate,
            specify neither <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> nor
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>. The server
            still verifies the client according to any applicable
            requirements established for the client account, and it
            still uses any <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option values
            specified at server startup.
          </p><p>
            MySQL distributions compiled using OpenSSL support the
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option (see
            <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>). Distributions
            compiled using yaSSL do not because yaSSL does not look in
            any directory and does not follow a chained certificate
            tree. yaSSL requires that all components of the CA
            certificate tree be contained within a single CA certificate
            tree and that each certificate in the file has a unique
            SubjectName value. To work around this yaSSL limitation,
            concatenate the individual certificate files comprising the
            certificate tree into a new file and specify that file as
            the value of the <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a>
            option.
          </p></li><li class="listitem"><p><a name="option_general_ssl-cert"></a>
            <a class="indexterm" name="idm139737183902960"></a>

            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert=<em class="replaceable"><code>file_name</code></em></code></a>
          </p><p>
            The name of the SSL certificate file in PEM format to use
            for establishing a secure connection. This option implies
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p></li><li class="listitem"><p><a name="option_general_ssl-cipher"></a>
            <a class="indexterm" name="idm139737183897904"></a>

            <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher=<em class="replaceable"><code>cipher_list</code></em></code></a>
          </p><p>
            A list of permissible ciphers to use for SSL encryption. If
            no cipher in the list is supported, SSL connections will not
            work. This option implies
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            For greatest portability,
            <em class="replaceable"><code>cipher_list</code></em> should be a list of
            one or more cipher names, separated by colons. This format
            is understood both by OpenSSL and yaSSL. Examples:
          </p><pre class="programlisting">
--ssl-cipher=AES128-SHA
--ssl-cipher=DHE-RSA-AES256-SHA:AES128-SHA
</pre><p>
            OpenSSL supports a more flexible syntax for specifying
            ciphers, as described in the OpenSSL documentation at
            <a class="ulink" href="http://www.openssl.org/docs/apps/ciphers.html" target="_top">http://www.openssl.org/docs/apps/ciphers.html</a>.
            However, yaSSL does not, so attempts to use that extended
            syntax fail for a MySQL distribution compiled using yaSSL.
          </p><p>
            For OpenSSL, the supported ciphers may depend on which
            version your server is linked against. For example, the list
            may include these ciphers:
          </p><pre class="programlisting">
AES256-GCM-SHA384
AES256-SHA
AES256-SHA256
CAMELLIA256-SHA
DES-CBC3-SHA
DHE-DSS-AES256-GCM-SHA384
DHE-DSS-AES256-SHA
DHE-DSS-AES256-SHA256
DHE-DSS-CAMELLIA256-SHA
DHE-RSA-AES256-GCM-SHA384
DHE-RSA-AES256-SHA
DHE-RSA-AES256-SHA256
DHE-RSA-CAMELLIA256-SHA
ECDH-ECDSA-AES256-GCM-SHA384
ECDH-ECDSA-AES256-SHA
ECDH-ECDSA-AES256-SHA384
ECDH-ECDSA-DES-CBC3-SHA
ECDH-RSA-AES256-GCM-SHA384
ECDH-RSA-AES256-SHA
ECDH-RSA-AES256-SHA384
ECDH-RSA-DES-CBC3-SHA
ECDHE-ECDSA-AES128-GCM-SHA256
ECDHE-ECDSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA256
ECDHE-ECDSA-AES256-GCM-SHA384
ECDHE-ECDSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA384
ECDHE-ECDSA-DES-CBC3-SHA
ECDHE-RSA-AES128-GCM-SHA256
ECDHE-RSA-AES128-SHA
ECDHE-RSA-AES128-SHA256
ECDHE-RSA-AES256-GCM-SHA384
ECDHE-RSA-AES256-SHA
ECDHE-RSA-AES256-SHA384
ECDHE-RSA-DES-CBC3-SHA
EDH-DSS-DES-CBC3-SHA
EDH-RSA-DES-CBC3-SHA
PSK-3DES-EDE-CBC-SHA
PSK-AES256-CBC-SHA
SRP-DSS-3DES-EDE-CBC-SHA
SRP-DSS-AES-128-CBC-SHA
SRP-DSS-AES-256-CBC-SHA
SRP-RSA-3DES-EDE-CBC-SHA
SRP-RSA-AES-128-CBC-S
SRP-RSA-AES-256-CBC-SHA
</pre><p>
            yaSSL supports these ciphers:
          </p><pre class="programlisting">
AES128-RMD
AES128-SHA
AES256-RMD
AES256-SHA
DES-CBC-SHA
DES-CBC3-RMD
DES-CBC3-SHA
DHE-RSA-AES128-RMD
DHE-RSA-AES128-SHA
DHE-RSA-AES256-RMD
DHE-RSA-AES256-SHA
DHE-RSA-DES-CBC3-RMD
EDH-RSA-DES-CBC-SHA
EDH-RSA-DES-CBC3-SHA
RC4-MD5
RC4-SHA
</pre><p>
            To verify exactly which ciphers a given server supports,
            check the value of the
            <a class="link" href="server-administration.html#statvar_Ssl_cipher_list"><code class="literal">Ssl_cipher_list</code></a> status
            variable using this query:
          </p><pre class="programlisting">
SHOW SESSION STATUS LIKE 'Ssl_cipher_list';
</pre></li><li class="listitem"><p><a name="option_general_ssl-crl"></a>
            <a class="indexterm" name="idm139737183883632"></a>

            <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl=<em class="replaceable"><code>file_name</code></em></code></a>
          </p><p>
            The path to a file containing certificate revocation lists
            in PEM format. This option implies
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            If neither <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a> nor
            <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> is given, no
            CRL checks are performed, even if the CA path contains
            certificate revocation lists.
          </p><p>
            MySQL distributions compiled using OpenSSL support the
            <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a> option (see
            <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>). Distributions
            compiled using yaSSL do not because revocation lists do not
            work with yaSSL.
          </p><p>
            This option was added in MySQL 5.6.3.
          </p></li><li class="listitem"><p><a name="option_general_ssl-crlpath"></a>
            <a class="indexterm" name="idm139737183873376"></a>

            <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath=<em class="replaceable"><code>dir_name</code></em></code></a>
          </p><p>
            The path to a directory that contains files containing
            certificate revocation lists in PEM format. This option
            implies <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            If neither <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a> nor
            <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> is given, no
            CRL checks are performed, even if the CA path contains
            certificate revocation lists.
          </p><p>
            MySQL distributions compiled using OpenSSL support the
            <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> option (see
            <a class="xref" href="security.html#openssl-versus-yassl" title="6.3.10.1 OpenSSL Versus yaSSL">Section 6.3.10.1, “OpenSSL Versus yaSSL”</a>). Distributions
            compiled using yaSSL do not because revocation lists do not
            work with yaSSL.
          </p><p>
            This option was added in MySQL 5.6.3.
          </p></li><li class="listitem"><p><a name="option_general_ssl-key"></a>
            <a class="indexterm" name="idm139737183863152"></a>

            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key=<em class="replaceable"><code>file_name</code></em></code></a>
          </p><p>
            The name of the SSL key file in PEM format to use for
            establishing a secure connection. This option implies
            <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
          </p><p>
            If the MySQL distribution was built using OpenSSL or (as of
            MySQL 5.6.3) yaSSL and the key file is protected by a
            passphrase, the program prompts the user for the passphrase.
            The password must be given interactively; it cannot be
            stored in a file. If the passphrase is incorrect, the
            program continues as if it could not read the key. Before
            MySQL 5.6.3, if the MySQL distribution was built using yaSSL
            and the key file is protected by a passphrase, an error
            occurs.
          </p></li><li class="listitem"><p><a name="option_general_ssl-verify-server-cert"></a>
            <a class="indexterm" name="idm139737183857072"></a>

            <a class="link" href="security.html#option_general_ssl-verify-server-cert"><code class="option">--ssl-verify-server-cert</code></a>
          </p><p>
            This option is available for client programs only, not the
            server. It causes the client to check the server's Common
            Name value in the certificate that the server sends to the
            client. The client verifies that name against the host name
            the client uses for connecting to the server, and the
            connection fails if there is a mismatch. When SSL is used,
            this option helps prevent man-in-the-middle attacks.
            Verification is disabled by default.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-ssl-rsa-files"></a>6.3.11 Creating SSL and RSA Certificates and Keys</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#creating-ssl-files-using-openssl">6.3.11.1 Creating SSL Certificates and Keys Using openssl</a></span></dt><dt><span class="section"><a href="security.html#creating-rsa-files-using-openssl">6.3.11.2 Creating RSA Keys Using openssl</a></span></dt></dl>
</div>
<p>
      The following discussion describes how to create the files
      required for SSL and RSA support in MySQL. File creation is done
      by invoking the <span class="command"><strong>openssl</strong></span> command.
    </p><p>
      SSL certificate and key files enable MySQL to support secure
      connections using SSL. See <a class="xref" href="security.html#ssl-connections" title="6.3.10 Using SSL for Secure Connections">Section 6.3.10, “Using SSL for Secure Connections”</a>.
    </p><p>
      RSA key files enable MySQL to support secure password exchange
      over unencrypted connections for accounts authenticated by the
      <code class="literal">sha256_password</code> plugin. See
      <a class="xref" href="security.html#sha256-authentication-plugin" title="6.3.8.4 The SHA-256 Authentication Plugin">Section 6.3.8.4, “The SHA-256 Authentication Plugin”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-ssl-files-using-openssl"></a>6.3.11.1 Creating SSL Certificates and Keys Using openssl</h4>
</div>
</div>
</div>
<p>
        This section describes how to use the <span class="command"><strong>openssl</strong></span>
        command to set up SSL certificate and key files for use by MySQL
        servers and clients. The first example shows a simplified
        procedure such as you might use from the command line. The
        second shows a script that contains more detail. The first two
        examples are intended for use on Unix and both use the
        <span class="command"><strong>openssl</strong></span> command that is part of OpenSSL. The
        third example describes how to set up SSL files on Windows.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          Whatever method you use to generate the certificate and key
          files, the Common Name value used for the server and client
          certificates/keys must each differ from the Common Name value
          used for the CA certificate. Otherwise, the certificate and
          key files will not work for servers compiled using OpenSSL. A
          typical error in this case is:
        </p><pre class="programlisting">
ERROR 2026 (HY000): SSL connection error:
error:00000001:lib(0):func(0):reason(1)
</pre>
</div>
<h5><a name="idm139737183842400"></a>Example 1: Creating SSL Files from the Command Line on Unix</h5>
<p>
        The following example shows a set of commands to create MySQL
        server and client certificate and key files. You will need to
        respond to several prompts by the <span class="command"><strong>openssl</strong></span>
        commands. To generate test files, you can press Enter to all
        prompts. To generate files for production use, you should
        provide nonempty responses.
      </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>rm -rf newcerts</code></strong>
shell&gt; <strong class="userinput"><code>mkdir newcerts &amp;&amp; cd newcerts</code></strong>

# Create CA certificate
shell&gt; <strong class="userinput"><code>openssl genrsa 2048 &gt; ca-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl req -new -x509 -nodes -days 3600 \</code></strong>
         <strong class="userinput"><code>-key ca-key.pem -out ca.pem</code></strong>

# Create server certificate, remove passphrase, and sign it
# server-cert.pem = public key, server-key.pem = private key
shell&gt; <strong class="userinput"><code>openssl req -newkey rsa:2048 -days 3600 \</code></strong>
         <strong class="userinput"><code>-nodes -keyout server-key.pem -out server-req.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl rsa -in server-key.pem -out server-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl x509 -req -in server-req.pem -days 3600 \</code></strong>
         <strong class="userinput"><code>-CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem</code></strong>

# Create client certificate, remove passphrase, and sign it
# client-cert.pem = public key, client-key.pem = private key
shell&gt; <strong class="userinput"><code>openssl req -newkey rsa:2048 -days 3600 \</code></strong>
         <strong class="userinput"><code>-nodes -keyout client-key.pem -out client-req.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl rsa -in client-key.pem -out client-key.pem</code></strong>
shell&gt; <strong class="userinput"><code>openssl x509 -req -in client-req.pem -days 3600 \</code></strong>
         <strong class="userinput"><code>-CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem</code></strong>
</pre><p>
        After generating the certificates, verify them:
      </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>openssl verify -CAfile ca.pem server-cert.pem client-cert.pem</code></strong>
server-cert.pem: OK
client-cert.pem: OK
</pre><p>
        Now you have a set of files that can be used as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">ca.pem</code>: Use this as the argument to
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> on the server and
            client sides. (The CA certificate, if used, must be the same
            on both sides.)
          </p></li><li class="listitem"><p>
            <code class="filename">server-cert.pem</code>,
            <code class="filename">server-key.pem</code>: Use these as the
            arguments to <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the server
            side.
          </p></li><li class="listitem"><p>
            <code class="filename">client-cert.pem</code>,
            <code class="filename">client-key.pem</code>: Use these as the
            arguments to <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the client
            side.
</p></li></ul>
</div>
<p>
        To use the files for SSL connections, see
        <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
</p>
<h5><a name="idm139737183812960"></a>Example 2: Creating SSL Files Using a Script on Unix</h5>
<p>
        Here is an example script that shows how to set up SSL
        certificate and key files for MySQL. After executing the script,
        use the files for SSL connections as described in
        <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
      </p><pre class="programlisting">
DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# Create necessary files: $database, $serial and $new_certs_dir
# directory (optional)

touch $DIR/index.txt
echo "01" &gt; $DIR/serial

#
# Generation of Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/ca.pem \
    -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/monty/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Create server request and key
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/monty/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Sign server cert
#
openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/server-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/server-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create client request and key
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/monty/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Sign client cert
#

openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/client-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/client-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create a my.cnf file that you can use to test the certificates
#

cat &lt;&lt;EOF &gt; $DIR/my.cnf
[client]
ssl-ca=$DIR/ca.pem
ssl-cert=$DIR/client-cert.pem
ssl-key=$DIR/client-key.pem
[mysqld]
ssl-ca=$DIR/ca.pem
ssl-cert=$DIR/server-cert.pem
ssl-key=$DIR/server-key.pem
EOF
</pre>
<h5><a name="idm139737183792704"></a>Example 3: Creating SSL Files on Windows</h5>
<p>
        Download OpenSSL for Windows if it is not installed on your
        system. An overview of available packages can be seen here:
      </p><pre class="programlisting">
<a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top">http://www.slproweb.com/products/Win32OpenSSL.html</a>
</pre><p>
        Choose the Win32 OpenSSL Light or Win64 OpenSSL Light package,
        depending on your architecture (32-bit or 64-bit). The default
        installation location will be
        <code class="literal">C:\OpenSSL-Win32</code> or
        <code class="literal">C:\OpenSSL-Win64</code>, depending on which package
        you downloaded. The following instructions assume a default
        location of <code class="literal">C:\OpenSSL-Win32</code>. Modify this as
        necessary if you are using the 64-bit package.
      </p><p>
        If a message occurs during setup indicating
        <code class="literal">'...critical component is missing: Microsoft Visual C++
        2008 Redistributables'</code>, cancel the setup and download
        one of the following packages as well, again depending on your
        architecture (32-bit or 64-bit):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Visual C++ 2008 Redistributables (x86), available at:
          </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF</a>
</pre></li><li class="listitem"><p>
            Visual C++ 2008 Redistributables (x64), available at:
          </p><pre class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6</a>
</pre></li></ul>
</div>
<p>
        After installing the additional package, restart the OpenSSL
        setup procedure.
      </p><p>
        During installation, leave the default
        <code class="filename">C:\OpenSSL-Win32</code> as the install path, and
        also leave the default option <code class="literal">'Copy OpenSSL DLL files
        to the Windows system directory'</code> selected.
      </p><p>
        When the installation has finished, add
        <code class="filename">C:\OpenSSL-Win32\bin</code> to the Windows System
        Path variable of your server:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the Windows desktop, right-click the <span class="guiicon">My
            Computer</span> icon, and select
            <span class="guimenuitem">Properties</span>.
          </p></li><li class="listitem"><p>
            Select the <span class="guimenuitem">Advanced</span> tab from the
            <span class="guimenu">System Properties</span> menu that appears, and
            click the <span class="guibutton">Environment Variables</span>
            button.
          </p></li><li class="listitem"><p>
            Under <span class="guilabel">System Variables</span>, select
            <span class="guimenuitem">Path</span>, then click the
            <span class="guibutton">Edit</span> button. The <span class="guimenu">Edit System
            Variable</span> dialogue should appear.
          </p></li><li class="listitem"><p>
            Add <code class="literal">';C:\OpenSSL-Win32\bin'</code> to the end
            (notice the semicolon).
          </p></li><li class="listitem"><p>
            Press OK 3 times.
          </p></li><li class="listitem"><p>
            Check that OpenSSL was correctly integrated into the Path
            variable by opening a new command console
            (<span class="command"><strong>Start&gt;Run&gt;cmd.exe</strong></span>) and verifying
            that OpenSSL is available:
          </p><pre class="programlisting">
Microsoft Windows [Version ...]
Copyright (c) 2006 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;<strong class="userinput"><code>cd \</code></strong>

C:\&gt;<strong class="userinput"><code>openssl</code></strong>
OpenSSL&gt; <strong class="userinput"><code>exit</code></strong> &lt;&lt;&lt; If you see the OpenSSL prompt, installation was successful.

C:\&gt;
</pre></li></ol>
</div>
<p>
        Depending on your version of Windows, the preceding path-setting
        instructions might differ slightly.
      </p><p>
        After OpenSSL has been installed, use instructions similar to
        those from Example 1 (shown earlier in this section), with the
        following changes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Change the following Unix commands:
          </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>rm -rf newcerts</code></strong>
shell&gt; <strong class="userinput"><code>mkdir newcerts &amp;&amp; cd newcerts</code></strong>
</pre><p>
            On Windows, use these commands instead:
          </p><pre class="programlisting">
# Create clean environment
shell&gt; <strong class="userinput"><code>md c:\newcerts</code></strong>
shell&gt; <strong class="userinput"><code>cd c:\newcerts</code></strong>
</pre></li><li class="listitem"><p>
            When a <code class="literal">'\'</code> character is shown at the end
            of a command line, this <code class="literal">'\'</code> character
            must be removed and the command lines entered all on a
            single line.
</p></li></ul>
</div>
<p>
        After generating the certificate and key files, to use them for
        SSL connections, see <a class="xref" href="security.html#using-ssl-connections" title="6.3.10.3 Configuring MySQL to Use SSL Connections">Section 6.3.10.3, “Configuring MySQL to Use SSL Connections”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-rsa-files-using-openssl"></a>6.3.11.2 Creating RSA Keys Using openssl</h4>

</div>

</div>

</div>
<p>
        This section describes how to use the <span class="command"><strong>openssl</strong></span>
        command to set up the RSA key files that enable MySQL to support
        secure password exchange over unencrypted connections for
        accounts authenticated by the <code class="literal">sha256_password</code>
        plugin.
      </p><p>
        To create the RSA private and public key-pair files, run these
        commands while logged into the system account used to run the
        MySQL server so the files will be owned by that account:
      </p><pre class="programlisting">
openssl genrsa -out private_key.pem 2048
openssl rsa -in private_key.pem -pubout -out public_key.pem
</pre><p>
        Those commands create 2,048-bit keys. To create stronger keys,
        use a larger value.
      </p><p>
        Then set the access modes for the key files. The private key
        should be readable only by the server, whereas the public key
        can be freely distributed to client users:
      </p><pre class="programlisting">
chmod 400 private_key.pem
chmod 444 public_key.pem
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="windows-and-ssh"></a>6.3.12 Connecting to MySQL Remotely from Windows with SSH</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm139737183741696"></a><a class="indexterm" name="idm139737183740688"></a><a class="indexterm" name="idm139737183739200"></a><p>
      This section describes how to get a secure connection to a remote
      MySQL server with SSH. The original information was provided by
      David Carlson <code class="email">&lt;<a class="email" href="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>&gt;</code>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Install an SSH client on your Windows machine. For a
          comparison of SSH clients, see
          <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>.
        </p></li><li class="listitem"><p>
          Start your Windows SSH client. Set <code class="literal">Host_Name =
          <em class="replaceable"><code>yourmysqlserver_URL_or_IP</code></em></code>.
          Set
          <code class="literal">userid=<em class="replaceable"><code>your_userid</code></em></code>
          to log in to your server. This <code class="literal">userid</code> value
          might not be the same as the user name of your MySQL account.
        </p></li><li class="listitem"><p>
          Set up port forwarding. Either do a remote forward (Set
          <code class="literal">local_port: 3306</code>, <code class="literal">remote_host:
          <em class="replaceable"><code>yourmysqlservername_or_ip</code></em></code>,
          <code class="literal">remote_port: 3306</code> ) or a local forward (Set
          <code class="literal">port: 3306</code>, <code class="literal">host:
          localhost</code>, <code class="literal">remote port: 3306</code>).
        </p></li><li class="listitem"><p>
          Save everything, otherwise you will have to redo it the next
          time.
        </p></li><li class="listitem"><p>
          Log in to your server with the SSH session you just created.
        </p></li><li class="listitem"><p>
          On your Windows machine, start some ODBC application (such as
          Access).
        </p></li><li class="listitem"><p>
          Create a new file in Windows and link to MySQL using the ODBC
          driver the same way you normally do, except type in
          <code class="literal">localhost</code> for the MySQL host server, not
          <em class="replaceable"><code>yourmysqlservername</code></em>.
</p></li></ol>
</div>
<p>
      At this point, you should have an ODBC connection to MySQL,
      encrypted using SSH.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="audit-log-plugin"></a>6.3.13 MySQL Enterprise Audit Log Plugin</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#audit-log-plugin-installation">6.3.13.1 Installing the Audit Log Plugin</a></span></dt><dt><span class="section"><a href="security.html#audit-log-security">6.3.13.2 Audit Log Plugin Security Considerations</a></span></dt><dt><span class="section"><a href="security.html#audit-log-file">6.3.13.3 The Audit Log File</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-logging-control">6.3.13.4 Audit Log Plugin Logging Control</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-option-variable-reference">6.3.13.5 Audit Log Plugin Option and Variable Reference</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-options-variables">6.3.13.6 Audit Log Plugin Options and System Variables</a></span></dt><dt><span class="section"><a href="security.html#audit-log-status-variables">6.3.13.7 Audit Log Plugin Status Variables</a></span></dt><dt><span class="section"><a href="security.html#audit-log-plugin-restrictions">6.3.13.8 Audit Log Plugin Restrictions</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737183719120"></a><a class="indexterm" name="idm139737183718080"></a><a class="indexterm" name="idm139737183716592"></a><a class="indexterm" name="idm139737183715520"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        MySQL Enterprise Audit is an extension included in MySQL
        Enterprise Edition, a commercial product. To learn more about
        commercial products, see <a class="ulink" href="http://www.mysql.com/products/" target="_top">http://www.mysql.com/products/</a>.
</p>
</div>
<p>
      As of MySQL 5.6.10, MySQL Enterprise Edition includes MySQL
      Enterprise Audit, implemented using a server plugin named
      <code class="literal">audit_log</code>. MySQL Enterprise Audit uses the open
      MySQL Audit API to enable standard, policy-based monitoring and
      logging of connection and query activity executed on specific
      MySQL servers. Designed to meet the Oracle audit specification,
      MySQL Enterprise Audit provides an out of box, easy to use
      auditing and compliance solution for applications that are
      governed by both internal and external regulatory guidelines.
    </p><p>
      When installed, the audit plugin enables MySQL Server to produce a
      log file containing an audit record of server activity. The log
      contents include when clients connect and disconnect, and what
      actions they perform while connected, such as which databases and
      tables they access.
    </p><p>
      After you install the plugin (see
      <a class="xref" href="security.html#audit-log-plugin-installation" title="6.3.13.1 Installing the Audit Log Plugin">Section 6.3.13.1, “Installing the Audit Log Plugin”</a>), it writes an
      audit log file. By default, the file is named
      <code class="filename">audit.log</code> in the server data directory. To
      change the name of the file, set the
      <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system variable at
      server startup.
    </p><p>
      Audit log file contents are not encrypted. See
      <a class="xref" href="security.html#audit-log-security" title="6.3.13.2 Audit Log Plugin Security Considerations">Section 6.3.13.2, “Audit Log Plugin Security Considerations”</a>.
    </p><p>
      The audit log file is written in XML, with auditable events
      encoded as <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. To
      select the file format, set the
      <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system variable
      at server startup. For details on file format and contents, see
      <a class="xref" href="security.html#audit-log-file" title="6.3.13.3 The Audit Log File">Section 6.3.13.3, “The Audit Log File”</a>.
    </p><p>
      To control what information <code class="literal">audit_log</code> writes to
      its log file, set the
      <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> system variable.
      By default, this variable is set to <code class="literal">ALL</code> (write
      all auditable events), but also permits values of
      <code class="literal">LOGINS</code> or <code class="literal">QUERIES</code> to log
      only login or query events, or <code class="literal">NONE</code> to disable
      logging.
    </p><p>
      For more information about controlling how logging occurs, see
      <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>. For
      descriptions of the parameters used to configure the audit log
      plugin, see <a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.13.6 Audit Log Plugin Options and System Variables">Section 6.3.13.6, “Audit Log Plugin Options and System Variables”</a>.
    </p><p>
      If the <code class="literal">audit_log</code> plugin is enabled, the
      Performance Schema (see <a class="xref" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Chapter 22, <i>MySQL Performance Schema</i></a>) has
      instrumentation for the audit log plugin. To identify the relevant
      instruments, use this query:
    </p><pre class="programlisting">
SELECT NAME FROM performance_schema.setup_instruments
WHERE NAME LIKE '%/alog/%';
</pre>
<h4><a name="idm139737183692128"></a>Changes from Older Audit Log Plugin Versions</h4>
<p>
      Several changes were made to the audit log plugin in MySQL 5.6.14
      for better compatibility with Oracle Audit Vault.
    </p><p>
      A new audit log file format was implemented. It is possible to
      select either the old or new format using the
      <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system variable,
      which has permitted values of <code class="literal">OLD</code> and
      <code class="literal">NEW</code> (default <code class="literal">OLD</code>). The two
      formats differ as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Information within <code class="literal">&lt;AUDIT_RECORD&gt;</code>
          elements written in the old format using attributes is written
          in the new format using subelements.
        </p></li><li class="listitem"><p>
          The new format includes more information in
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. Every
          element includes a <code class="literal">RECORD_ID</code> value
          providing a unique identifier. The
          <code class="literal">TIMESTAMP</code> value includes time zone
          information. Query records include <code class="literal">HOST</code>,
          <code class="literal">IP</code>, <code class="literal">OS_LOGIN</code>, and
          <code class="literal">USER</code> information, as well as
          <code class="literal">COMMAND_CLASS</code> and
          <code class="literal">STATUS_CODE</code> values.
</p></li></ul>
</div>
<p>
      Example of old <code class="literal">&lt;AUDIT_RECORD&gt;</code> format:
    </p><pre class="programlisting">
&lt;AUDIT_RECORD
 TIMESTAMP="2013-09-15T15:27:27"
 NAME="Query"
 CONNECTION_ID="3"
 STATUS="0"
 SQLTEXT="SELECT 1"
/&gt;
</pre><p>
      Example of new <code class="literal">&lt;AUDIT_RECORD&gt;</code> format:
    </p><pre class="programlisting">
&lt;AUDIT_RECORD&gt;
 &lt;TIMESTAMP&gt;2013-09-15T15:27:27 UTC&lt;/TIMESTAMP&gt;
 &lt;RECORD_ID&gt;3998_2013-09-15T15:27:27&lt;/RECORD_ID&gt;
 &lt;NAME&gt;Query&lt;/NAME&gt;
 &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
 &lt;STATUS&gt;0&lt;/STATUS&gt;
 &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
 &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
 &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
 &lt;HOST&gt;localhost&lt;/HOST&gt;
 &lt;IP&gt;127.0.0.1&lt;/IP&gt;
 &lt;COMMAND_CLASS&gt;select&lt;/COMMAND_CLASS&gt;
 &lt;SQLTEXT&gt;SELECT 1&lt;/SQLTEXT&gt;
&lt;/AUDIT_RECORD&gt;
</pre><p>
      When the audit log plugin rotates the audit log file, it uses a
      different file name format. For a log file named
      <code class="filename">audit.log</code>, the plugin previously renamed the
      file to
      <code class="filename">audit.log.<em class="replaceable"><code>TIMESTAMP</code></em></code>.
      The plugin now renames the file to
      <code class="filename">audit.log.<em class="replaceable"><code>TIMESTAMP</code></em>.xml</code>
      to indicate that it is an XML file.
    </p><p>
      If you change the value of
      <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>, use this
      procedure to avoid writing log entries in one format to an
      existing log file that contains entries in a different format:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop the server.
        </p></li><li class="listitem"><p>
          Rename the current audit log file manually.
        </p></li><li class="listitem"><p>
          Restart the server with the new value of
          <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>. The audit
          log plugin creates a new log file, which will contain log
          entries in the selected format.
</p></li></ol>
</div>
<p>
      The API for writing audit plugins has also changed. The
      <code class="literal">mysql_event_general</code> structure has new members
      to represent client host name and IP address, command class, and
      external user. For more information, see
      <a class="xref" href="extending-mysql.html#writing-audit-plugins" title="24.2.4.8 Writing Audit Plugins">Section 24.2.4.8, “Writing Audit Plugins”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-plugin-installation"></a>6.3.13.1 Installing the Audit Log Plugin</h4>
</div>
</div>
</div>
<p>
        The audit log plugin is named <code class="literal">audit_log</code>. To
        be usable by the server, the plugin library object file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, set the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup to
        tell the server the location of the plugin directory.
      </p><p>
        To load the plugin at server startup, use the
        <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> option to name the
        object file that contains the plugin. With this plugin-loading
        method, the option must be given each time the server starts.
        For example, put the following lines in your
        <code class="filename">my.cnf</code> file:
      </p><pre class="programlisting">
[mysqld]
plugin-load=audit_log.so
</pre><p>
        If object files have a suffix different from
        <code class="filename">.so</code> on your system, substitute the correct
        suffix (for example, <code class="filename">.dll</code> on Windows).
      </p><p>
        Alternatively, to register the plugin at runtime, use this
        statement (changing the suffix as necessary):
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN audit_log SONAME 'audit_log.so';</code></strong>
</pre><p>
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin,
        and also registers it in the <code class="literal">mysql.plugins</code>
        table to cause the plugin to be loaded for each subsequent
        normal server startup.
      </p><p>
        If the plugin is loaded with
        <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> or has been
        previously registered with <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
        PLUGIN</code></a>, you can use the <code class="option">--audit-log</code>
        option at server startup to control plugin activation. For
        example, to load the plugin at startup and prevent it from being
        removed at runtime, use these options:
      </p><pre class="programlisting">
[mysqld]
plugin-load=audit_log.so
audit-log=FORCE_PLUS_PERMANENT
</pre><p>
        If it is desired to prevent the server from running without the
        audit plugin, use <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log</code></a>
        with a value of <code class="literal">FORCE</code> or
        <code class="literal">FORCE_PLUS_PERMANENT</code> to force server startup
        to fail if the plugin does not initialize successfully.
      </p><p>
        For general information about installing or uninstalling
        plugins, see <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>. To verify
        plugin installation, examine the
        <a class="link" href="information-schema.html#plugins-table" title="21.14 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table or
        use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a> statement.
        See <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.1.8.2 Obtaining Server Plugin Information">Section 5.1.8.2, “Obtaining Server Plugin Information”</a>.
      </p><p>
        For additional information about the parameters used to
        configure operation of the <code class="literal">audit_log</code> plugin,
        see <a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.13.6 Audit Log Plugin Options and System Variables">Section 6.3.13.6, “Audit Log Plugin Options and System Variables”</a>.
      </p><p>
        Audit log file contents are not encrypted. See
        <a class="xref" href="security.html#audit-log-security" title="6.3.13.2 Audit Log Plugin Security Considerations">Section 6.3.13.2, “Audit Log Plugin Security Considerations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-security"></a>6.3.13.2 Audit Log Plugin Security Considerations</h4>

</div>

</div>

</div>
<p>
        Contents of the audit log file produced by the
        <code class="literal">audit_log</code> audit log plugin are not encrypted
        and may contain sensitive information, such as the text of SQL
        statements. For security reasons, this file should be written to
        a directory accessible only to the MySQL server and users with a
        legitimate reason to view the log. The default file is
        <code class="filename">audit.log</code> in the data directory. This can
        be changed by setting the
        <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system variable
        at server startup.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-file"></a>6.3.13.3 The Audit Log File</h4>

</div>

</div>

</div>
<p>
        Audit log file contents are not encrypted. See
        <a class="xref" href="security.html#audit-log-security" title="6.3.13.2 Audit Log Plugin Security Considerations">Section 6.3.13.2, “Audit Log Plugin Security Considerations”</a>.
      </p><p>
        The audit log file is written as XML, using UTF-8 (up to 4 bytes
        per character). The root element is
        <code class="literal">&lt;AUDIT&gt;</code>. The closing
        <code class="literal">&lt;/AUDIT&gt;</code> tag of the root element is
        written when the audit log plugin terminates, so the tag is not
        present in the file while the plugin is active.
      </p><p>
        The root element contains
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements, each of which
        provides information about an audited event.
      </p><p>
        In MySQL 5.6.14, a new audit log file format was implemented for
        better compatibility with Oracle Audit Vault. It is possible to
        select either the old or new format using the
        <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system
        variable, which has permitted values of <code class="literal">OLD</code>
        and <code class="literal">NEW</code> (default <code class="literal">OLD</code>).
      </p><p>
        If you change the value of
        <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>, use this
        procedure to avoid writing log entries in one format to an
        existing log file that contains entries in a different format:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Stop the server.
          </p></li><li class="listitem"><p>
            Rename the current audit log file manually.
          </p></li><li class="listitem"><p>
            Restart the server with the new value of
            <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>. The audit
            log plugin will create a new log file, which will contain
            log entries in the selected format.
</p></li></ol>
</div>
<p>
        Here is a sample log file in the default (old) format,
        reformatted slightly for readability:
      </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;AUDIT&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:52:12"
    NAME="Audit"
    SERVER_ID="1"
    VERSION="1"
    STARTUP_OPTIONS="--port=3306"
    OS_VERSION="i686-Linux"
    MYSQL_VERSION="5.6.10-log"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:52:41"
    NAME="Connect"
    CONNECTION_ID="1"
    STATUS="0"
    USER="root"
    PRIV_USER="root"
    OS_LOGIN=""
    PROXY_USER=""
    HOST="localhost"
    IP="127.0.0.1"
    DB=""/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:53:45"
    NAME="Query"
    CONNECTION_ID="1"
    STATUS="0"
    SQLTEXT="INSERT INTO t1 () VALUES()"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-02T14:53:51"
    NAME="Quit"
    CONNECTION_ID="1"
    STATUS="0"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2012-08-06T14:21:03"
    NAME="NoAudit"
    SERVER_ID="1"/&gt;
&lt;/AUDIT&gt;
</pre><p>
        Here is a sample log file in the new format, reformatted
        slightly for readability:
      </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;AUDIT&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:24 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;1_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Audit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
  &lt;VERSION&gt;1&lt;/VERSION&gt;
  &lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
    --socket=/usr/local/mysql/mysql.sock
    --port=3306&lt;/STARTUP_OPTIONS&gt;
  &lt;OS_VERSION&gt;x86_64-osx10.6&lt;/OS_VERSION&gt;
  &lt;MYSQL_VERSION&gt;5.7.2-m12-log&lt;/MYSQL_VERSION&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:40 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;2_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Connect&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;PRIV_USER&gt;root&lt;/PRIV_USER&gt;
  &lt;PROXY_USER&gt;&lt;/PROXY_USER&gt;
  &lt;DB&gt;test&lt;/DB&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;4_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;DROP TABLE IF EXISTS t&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;5_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;create_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;CREATE TABLE t (i INT)&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:41 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;7_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;2&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;&lt;/HOST&gt;
  &lt;IP&gt;&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:47 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;9_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Shutdown&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:47 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;10_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;3&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;&lt;/USER&gt;
  &lt;OS_LOGIN&gt;&lt;/OS_LOGIN&gt;
  &lt;HOST&gt;&lt;/HOST&gt;
  &lt;IP&gt;&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2013-09-17T15:03:49 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;11_2013-09-17T15:03:24&lt;/RECORD_ID&gt;
  &lt;NAME&gt;NoAudit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
 &lt;/AUDIT_RECORD&gt;
&lt;/AUDIT&gt;
</pre><p>
        Attributes of <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements
        have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Some attributes appear in every element, but most are
            optional and do not necessarily appear in every element.
          </p></li><li class="listitem"><p>
            Order of attributes within an element is not guaranteed.
          </p></li><li class="listitem"><p>
            Attribute values are not fixed length. Long values may be
            truncated as indicated in the attribute descriptions given
            later.
          </p></li><li class="listitem"><p>
            The <code class="literal">&lt;</code>, <code class="literal">&gt;</code>,
            <code class="literal">"</code>, and <code class="literal">&amp;</code>
            characters are encoded as <code class="literal">&amp;lt;</code>,
            <code class="literal">&amp;gt;</code>, <code class="literal">&amp;quot;</code>,
            and <code class="literal">&amp;amp;</code>, respectively. NUL bytes
            (U+00) are encoded as the <code class="literal">?</code> character.
          </p></li><li class="listitem"><p>
            Characters not valid as XML characters are encoded using
            numeric character references. Valid XML characters are:
          </p><pre class="programlisting">
#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul>
</div>
<h5><a name="idm139737183590080"></a>New Audit Log File Format</h5>
<p>
        Every <code class="literal">&lt;AUDIT_RECORD&gt;</code> element contains a
        set of mandatory elements. Other optional elements may appear,
        depending on the audit record type.
      </p><p>
        The following elements are mandatory in every
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> element:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;NAME&gt;</code>
          </p><p>
            A string representing the type of instruction that generated
            the audit event, such as a command that the server received
            from a client.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;NAME&gt;Query&lt;/NAME&gt;
</pre><p>
            Some common <code class="literal">&lt;NAME&gt;</code> values:
          </p><pre class="programlisting">
Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
            The possible values are <code class="literal">Audit</code>,
            <code class="literal">Binlog Dump</code>, <code class="literal">Change
            user</code>, <code class="literal">Close stmt</code>,
            <code class="literal">Connect Out</code>, <code class="literal">Connect</code>,
            <code class="literal">Create DB</code>, <code class="literal">Daemon</code>,
            <code class="literal">Debug</code>, <code class="literal">Delayed insert</code>,
            <code class="literal">Drop DB</code>, <code class="literal">Execute</code>,
            <code class="literal">Fetch</code>, <code class="literal">Field List</code>,
            <code class="literal">Init DB</code>, <code class="literal">Kill</code>,
            <code class="literal">Long Data</code>, <code class="literal">NoAudit</code>,
            <code class="literal">Ping</code>, <code class="literal">Prepare</code>,
            <code class="literal">Processlist</code>, <code class="literal">Query</code>,
            <code class="literal">Quit</code>, <code class="literal">Refresh</code>,
            <code class="literal">Register Slave</code>, <code class="literal">Reset
            stmt</code>, <code class="literal">Set option</code>,
            <code class="literal">Shutdown</code>, <code class="literal">Sleep</code>,
            <code class="literal">Statistics</code>, <code class="literal">Table
            Dump</code>, <code class="literal">Time</code>.
          </p><p>
            With the exception of <code class="literal">Audit</code> and
            <code class="literal">NoAudit</code>, these values correspond to the
            <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code>
            command values listed in the
            <code class="filename">mysql_com.h</code> header file. For example,
            <code class="literal">Create DB</code> and <code class="literal">Shutdown</code>
            correspond to <code class="literal">COM_CREATE_DB</code> and
            <code class="literal">COM_SHUTDOWN</code>, respectively.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;RECORD_ID&gt;</code>
          </p><p>
            A unique identifier for the audit record. The value is
            composed from a sequence number and timestamp, in the format
            <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code>.
            The sequence number is initialized to the size of the audit
            log file at the time the audit log plugin opens it and
            increments by 1 for each record logged. The timestamp is a
            UTC value in
            <code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code>
            format indicating the time when the audit log plugin opened
            the file.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;RECORD_ID&gt;28743_2013-09-18T21:03:24&lt;/RECORD_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;TIMESTAMP&gt;</code>
          </p><p>
            The date and time that the audit event was generated. For
            example, the event corresponding to execution of an SQL
            statement received from a client has a
            <code class="literal">&lt;TIMESTAMP&gt;</code> value occurring after
            the statement finishes, not when it is received. The value
            has the format
            <code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em>
            UTC</code> (with <code class="literal">T</code>, no decimals). The
            format includes a time zone specifier at the end. Currently,
            the time zone is always UTC.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;TIMESTAMP&gt;2013-09-17T15:03:49 UTC&lt;/TIMESTAMP&gt;
</pre></li></ul>
</div>
<p>
        The following elements are optional in
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. Many of them
        occur only with specific <code class="literal">&lt;NAME&gt;</code> values.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">&lt;COMMAND_CLASS&gt;</code>
          </p><p>
            A string that indicates the type of action performed.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
</pre><p>
            The values come from the <code class="literal">com_status_vars</code>
            array in the <code class="filename">sql/mysqld.cc</code> file in a
            MySQL source distribution. They correspond to the status
            variables displayed by this statement:
          </p><pre class="programlisting">
SHOW STATUS LIKE 'Com%';
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;CONNECTION_ID&gt;</code>
          </p><p>
            An unsigned integer representing the client connection
            identifier. This is the same as the
            <a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a> function
            value within the session.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;CONNECTION_ID&gt;127&lt;/CONNECTION_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;DB&gt;</code>
          </p><p>
            A string representing the default database name. This
            element appears only if the <code class="literal">&lt;NAME&gt;</code>
            value is <code class="literal">Connect</code> or <code class="literal">Change
            user</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;HOST&gt;</code>
          </p><p>
            A string representing the client host name. This element
            appears only if the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code>, <code class="literal">Change user</code>,
            or <code class="literal">Query</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;HOST&gt;localhost&lt;/HOST&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;IP&gt;</code>
          </p><p>
            A string representing the client IP address. This element
            appears only if the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code>, <code class="literal">Change user</code>,
            or <code class="literal">Query</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;IP&gt;127.0.0.1&lt;/IP&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;MYSQL_VERSION&gt;</code>
          </p><p>
            A string representing the MySQL server version. This is the
            same as the value of the
            <a class="link" href="functions.html#function_version"><code class="literal">VERSION()</code></a> function or
            <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> system variable.
            This element appears only if the
            <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Audit</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;MYSQL_VERSION&gt;5.7.1-m11-log&lt;/MYSQL_VERSION&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;OS_LOGIN&gt;</code>
          </p><p>
            A string representing the external user (empty if none). The
            value may differ from the <code class="literal">&lt;USER&gt;</code>
            value, for example, if the server authenticates the client
            using an external authentication method. This element
            appears only if the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code>, <code class="literal">Change user</code>,
            or <code class="literal">Query</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;OS_VERSION&gt;</code>
          </p><p>
            A string representing the operating system on which the
            server was built or is running. This element appears only if
            the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Audit</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;OS_VERSION&gt;x86_64-Linux&lt;/OS_VERSION&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;PRIV_USER&gt;</code>
          </p><p>
            A string representing the user that the server authenticated
            the client as. This is the user name that the server uses
            for privilege checking, and may differ from the
            <code class="literal">&lt;USER&gt;</code> value. This element appears
            only if the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code> or <code class="literal">Change
            user</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;PROXY_USER&gt;</code>
          </p><p>
            A string representing the proxy user. The value is empty if
            user proxying is not in effect. This element appears only if
            the <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code> or <code class="literal">Change
            user</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">&lt;SERVER_ID&gt;</code>
          </p><p>
            An unsigned integer representing the server ID. This is the
            same as the value of the
            <a class="link" href="server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a> system variable.
            This element appears only if the
            <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Audit</code> or <code class="literal">NoAudit</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;SQLTEXT&gt;</code>
          </p><p>
            A string representing the text of an SQL statement. The
            value can be empty. Long values may be truncated. This
            element appears only if the <code class="literal">&lt;NAME&gt;</code>
            value is <code class="literal">Query</code> or
            <code class="literal">Execute</code>.
          </p><p>
            The string, like the audit log file itself, is written using
            UTF-8 (up to 4 bytes per character), so the value may be the
            result of conversion. For example, the original statement
            might have been received from the client as an SJIS string.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;SQLTEXT&gt;DELETE FROM t1&lt;/SQLTEXT&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STARTUP_OPTIONS&gt;</code>
          </p><p>
            A string representing the options that were given on the
            command line or in option files when the MySQL server was
            started. This element appears only if the
            <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Audit</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
  --port=3306 --log-output=FILE&lt;/STARTUP_OPTIONS&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STATUS&gt;</code>
          </p><p>
            An unsigned integer representing the command status: 0 for
            success, nonzero if an error occurred. This is the same as
            the value of the
            <a class="link" href="connectors-apis.html#mysql-errno" title="23.8.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
            function.
          </p><p>
            The audit log does not contain the SQLSTATE value or error
            message. To see the associations between error codes,
            SQLSTATE values, and messages, see
            <a class="xref" href="error-handling.html#error-messages-server" title="B.3 Server Error Codes and Messages">Section B.3, “Server Error Codes and Messages”</a>.
          </p><p>
            Warnings are not logged.
          </p><p>
            See the description for
            <code class="literal">&lt;STATUS_CODE&gt;</code> for information about
            how it differs from <code class="literal">&lt;STATUS&gt;</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;STATUS&gt;1051&lt;/STATUS&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;STATUS_CODE&gt;</code>
          </p><p>
            An unsigned integer representing the command status: 0 for
            success, 1 if an error occurred.
          </p><p>
            The <code class="literal">STATUS_CODE</code> value differs from the
            <code class="literal">STATUS</code> value:
            <code class="literal">STATUS_CODE</code> is 0 for success and 1 for
            error, which is compatible with the EZ_collector consumer
            for Audit Vault. <code class="literal">STATUS</code> is the value of
            the <a class="link" href="connectors-apis.html#mysql-errno" title="23.8.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
            function. This is 0 for success and nonzero for error, and
            thus is not necessarily 1 for error.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;USER&gt;</code>
          </p><p>
            A string representing the user name sent by the client. This
            may differ from the <code class="literal">&lt;PRIV_USER&gt;</code>
            value. This element appears only if the
            <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Connect</code>, <code class="literal">Change user</code>,
            or <code class="literal">Query</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
</pre></li><li class="listitem"><p>
            <code class="literal">&lt;VERSION&gt;</code>
          </p><p>
            An unsigned integer representing the version of the audit
            log file format. This element appears only if the
            <code class="literal">&lt;NAME&gt;</code> value is
            <code class="literal">Audit</code>.
          </p><p>
            Example:
          </p><pre class="programlisting">
&lt;VERSION&gt;1&lt;/VERSION&gt;
</pre></li></ul>
</div>
<h5><a name="idm139737183438624"></a>Old Audit Log File Format</h5>
<p>
        Every <code class="literal">&lt;AUDIT_RECORD&gt;</code> element contains a
        set of mandatory attributes. Other optional attributes may
        appear depending on the audit record type.
      </p><p>
        The following attributes are mandatory in every
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> element:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">NAME</code>
          </p><p>
            A string representing the type of instruction that generated
            the audit event, such as a command that the server received
            from a client.
          </p><p>
            Example: <code class="literal">NAME="Query"</code>
          </p><p>
            Some common <code class="literal">NAME</code> values:
          </p><pre class="programlisting">
"Audit"    When auditing starts, which may be server startup time
"Connect"  When a client connects, also known as logging in
"Query"    An SQL statement (executed directly)
"Prepare"  Preparation of an SQL statement; usually followed by Execute
"Execute"  Execution of an SQL statement; usually follows Prepare
"Shutdown" Server shutdown
"Quit"     When a client disconnects
"NoAudit"  Auditing has been turned off
</pre><p>
            The possible values are <code class="literal">"Audit"</code>,
            <code class="literal">"Binlog Dump"</code>, <code class="literal">"Change
            user"</code>, <code class="literal">"Close stmt"</code>,
            <code class="literal">"Connect Out"</code>,
            <code class="literal">"Connect"</code>, <code class="literal">"Create
            DB"</code>, <code class="literal">"Daemon"</code>,
            <code class="literal">"Debug"</code>, <code class="literal">"Delayed
            insert"</code>, <code class="literal">"Drop DB"</code>,
            <code class="literal">"Execute"</code>, <code class="literal">"Fetch"</code>,
            <code class="literal">"Field List"</code>, <code class="literal">"Init
            DB"</code>, <code class="literal">"Kill"</code>, <code class="literal">"Long
            Data"</code>, <code class="literal">"NoAudit"</code>,
            <code class="literal">"Ping"</code>, <code class="literal">"Prepare"</code>,
            <code class="literal">"Processlist"</code>,
            <code class="literal">"Query"</code>, <code class="literal">"Quit"</code>,
            <code class="literal">"Refresh"</code>, <code class="literal">"Register
            Slave"</code>, <code class="literal">"Reset stmt"</code>,
            <code class="literal">"Set option"</code>,
            <code class="literal">"Shutdown"</code>, <code class="literal">"Sleep"</code>,
            <code class="literal">"Statistics"</code>, <code class="literal">"Table
            Dump"</code>, <code class="literal">"Time"</code>.
          </p><p>
            With the exception of <code class="literal">"Audit"</code> and
            <code class="literal">"NoAudit"</code>, these values correspond to the
            <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code>
            command values listed in the
            <code class="filename">mysql_com.h</code> header file. For example,
            <code class="literal">"Create DB"</code> and
            <code class="literal">"Shutdown"</code> correspond to
            <code class="literal">COM_CREATE_DB</code> and
            <code class="literal">COM_SHUTDOWN</code>, respectively.
          </p></li><li class="listitem"><p>
            <code class="literal">TIMESTAMP</code>
          </p><p>
            The date and time that the audit event was generated. For
            example, the event corresponding to execution of an SQL
            statement received from a client has a
            <code class="literal">TIMESTAMP</code> value occurring after the
            statement finishes, not when it is received. The value is
            UTC, in the format
            <code class="literal"><em class="replaceable"><code>yyyy-mm-dd</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code>
            (with <code class="literal">T</code>, no decimals).
          </p><p>
            Example: <code class="literal">TIMESTAMP="2012-08-09T12:55:16"</code>
</p></li></ul>
</div>
<p>
        The following attributes are optional in
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. Many of them
        occur only for elements with specific values of the
        <code class="literal">NAME</code> attribute.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">CONNECTION_ID</code>
          </p><p>
            An unsigned integer representing the client connection
            identifier. This is the same as the
            <a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a> function
            value within the session.
          </p><p>
            Example: <code class="literal">CONNECTION_ID="127"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">DB</code>
          </p><p>
            A string representing the default database name. This
            attribute appears only if the <code class="literal">NAME</code> value
            is <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">HOST</code>
          </p><p>
            A string representing the client host name. This attribute
            appears only if the <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p><p>
            Example: <code class="literal">HOST="localhost"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">IP</code>
          </p><p>
            A string representing the client IP address. This attribute
            appears only if the <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p><p>
            Example: <code class="literal">IP="127.0.0.1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_VERSION</code>
          </p><p>
            A string representing the MySQL server version. This is the
            same as the value of the
            <a class="link" href="functions.html#function_version"><code class="literal">VERSION()</code></a> function or
            <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> system variable.
            This attribute appears only if the <code class="literal">NAME</code>
            value is <code class="literal">"Audit"</code>.
          </p><p>
            Example: <code class="literal">MYSQL_VERSION="5.6.11-log"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">OS_LOGIN</code>
          </p><p>
            A string representing the external user (empty if none). The
            value may differ from <code class="literal">USER</code>, for example,
            if the server authenticates the client using an external
            authentication method. This attribute appears only if the
            <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">OS_VERSION</code>
          </p><p>
            A string representing the operating system on which the
            server was built or is running. This attribute appears only
            if the <code class="literal">NAME</code> value is
            <code class="literal">"Audit"</code>.
          </p><p>
            Example: <code class="literal">OS_VERSION="x86_64-Linux"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">PRIV_USER</code>
          </p><p>
            A string representing the user that the server authenticated
            the client as. This is the user name that the server uses
            for privilege checking, and may be different from the
            <code class="literal">USER</code> value. This attribute appears only
            if the <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">PROXY_USER</code>
          </p><p>
            A string representing the proxy user. The value is empty if
            user proxying is not in effect. This attribute appears only
            if the <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">SERVER_ID</code>
          </p><p>
            An unsigned integer representing the server ID. This is the
            same as the value of the
            <a class="link" href="server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a> system variable.
            This attribute appears only if the <code class="literal">NAME</code>
            value is <code class="literal">"Audit"</code> or
            <code class="literal">"NoAudit"</code>.
          </p><p>
            Example: <code class="literal">SERVER_ID="1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">SQLTEXT</code>
          </p><p>
            A string representing the text of an SQL statement. The
            value can be empty. Long values may be truncated. This
            attribute appears only if the <code class="literal">NAME</code> value
            is <code class="literal">"Query"</code> or
            <code class="literal">"Execute"</code>.
          </p><p>
            The string, like the audit log file itself, is written using
            UTF-8 (up to 4 bytes per character), so the value may be the
            result of conversion. For example, the original statement
            might have been received from the client as an SJIS string.
          </p><p>
            Example: <code class="literal">SQLTEXT="DELETE FROM t1"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">STARTUP_OPTIONS</code>
          </p><p>
            A string representing the options that were given on the
            command line or in option files when the MySQL server was
            started. This attribute appears only if the
            <code class="literal">NAME</code> value is <code class="literal">"Audit"</code>.
          </p><p>
            Example: <code class="literal">STARTUP_OPTIONS="--port=3306
            --log-output=FILE"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">STATUS</code>
          </p><p>
            An unsigned integer representing the command status: 0 for
            success, nonzero if an error occurred. This is the same as
            the value of the
            <a class="link" href="connectors-apis.html#mysql-errno" title="23.8.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
            function.
          </p><p>
            The audit log does not contain the SQLSTATE value or error
            message. To see the associations between error codes,
            SQLSTATE values, and messages, see
            <a class="xref" href="error-handling.html#error-messages-server" title="B.3 Server Error Codes and Messages">Section B.3, “Server Error Codes and Messages”</a>.
          </p><p>
            Warnings are not logged.
          </p><p>
            Example: <code class="literal">STATUS="1051"</code>
          </p></li><li class="listitem"><p>
            <code class="literal">USER</code>
          </p><p>
            A string representing the user name sent by the client. This
            may be different from the <code class="literal">PRIV_USER</code>
            value. This attribute appears only if the
            <code class="literal">NAME</code> value is
            <code class="literal">"Connect"</code> or <code class="literal">"Change
            user"</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">VERSION</code>
          </p><p>
            An unsigned integer representing the version of the audit
            log file format. This attribute appears only if the
            <code class="literal">NAME</code> value is <code class="literal">"Audit"</code>.
          </p><p>
            Example: <code class="literal">VERSION="1"</code>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-plugin-logging-control"></a>6.3.13.4 Audit Log Plugin Logging Control</h4>

</div>

</div>

</div>
<p>
        This section describes how the <code class="literal">audit_log</code>
        plugin performs logging and the system variables that control
        how logging occurs. It assumes familiarity with the log file
        format described in <a class="xref" href="security.html#audit-log-file" title="6.3.13.3 The Audit Log File">Section 6.3.13.3, “The Audit Log File”</a>.
      </p><p>
        When the audit log plugin opens its log file, it checks whether
        the XML declaration and opening <code class="literal">&lt;AUDIT&gt;</code>
        root element tag must be written and writes them if so. When the
        audit log plugin terminates, it writes a closing
        <code class="literal">&lt;/AUDIT&gt;</code> tag to the file.
      </p><p>
        If the log file exists at open time, the plugin checks whether
        the file ends with an <code class="literal">&lt;/AUDIT&gt;</code> tag and
        truncates it if so before writing any
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. If the log
        file exists but does not end with
        <code class="literal">&lt;/AUDIT&gt;</code> or the
        <code class="literal">&lt;/AUDIT&gt;</code> tag cannot be truncated, the
        plugin considers the file malformed and fails to initialize.
        This can occur if the server crashes or is killed with the audit
        log plugin running. No logging occurs until the problem is
        rectified. Check the error log for diagnostic information:
      </p><a class="indexterm" name="idm139737183305008"></a><pre class="programlisting">
[ERROR] Plugin 'audit_log' init function returned error.
</pre><p>
        To deal with this problem, you must either remove or rename the
        malformed log file and restart the server.
      </p><p>
        The MySQL server calls the audit log plugin to write an
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> element whenever an
        auditable event occurs, such as when it completes execution of
        an SQL statement received from a client. Typically the first
        <code class="literal">&lt;AUDIT_RECORD&gt;</code> element written after
        server startup has the server description and startup options.
        Elements following that one represent events such as client
        connect and disconnect events, executed SQL statements, and so
        forth. Only top-level statements are logged, not statements
        within stored programs such as triggers or stored procedures.
        Contents of files referenced by statements such as
        <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
        INFILE</code></a> are not logged.
      </p><p>
        To permit control over how logging occurs, the
        <code class="literal">audit_log</code> plugin provides several system
        variables, described following. For more information, see
        <a class="xref" href="security.html#audit-log-plugin-options-variables" title="6.3.13.6 Audit Log Plugin Options and System Variables">Section 6.3.13.6, “Audit Log Plugin Options and System Variables”</a>.
</p>
<h5><a name="idm139737183296448"></a>Audit Log File Naming</h5>
<p>
        To control the audit log file name, set the
        <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system variable
        at server startup. By default, the name is
        <code class="filename">audit.log</code> in the server data directory. For
        security reasons, the audit log file should be written to a
        directory accessible only to the MySQL server and users with a
        legitimate reason to view the log.
</p>
<h5><a name="idm139737183293120"></a>Audit Logging Strategy</h5>
<p>
        The audit log plugin can use any of several strategies for log
        writes. To specify a strategy, set the
        <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a> system
        variable at server startup. By default, the strategy value is
        <code class="literal">ASYNCHRONOUS</code> and the plugin logs
        asynchronously to a buffer, waiting if the buffer is full. It's
        possible to tell the plugin not to wait
        (<code class="literal">PERFORMANCE</code>) or to log synchronously, either
        using file system caching (<code class="literal">SEMISYNCHRONOUS</code>)
        or forcing output with a <code class="literal">sync()</code> call after
        each write request (<code class="literal">SYNCHRONOUS</code>).
      </p><p>
        Asynchronous logging strategy has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Minimal impact on server performance and scalability.
          </p></li><li class="listitem"><p>
            Blocking of threads that generate audit events for the
            shortest possible time; that is, time to allocate the buffer
            plus time to copy the event to the buffer.
          </p></li><li class="listitem"><p>
            Output goes to the buffer. A separate thread handles writes
            from the buffer to the log file.
</p></li></ul>
</div>
<p>
        A disadvantage of <code class="literal">PERFORMANCE</code> strategy is
        that it drops events when the buffer is full. For a heavily
        loaded server, it is more likely that the audit log will be
        missing events.
      </p><p>
        With asynchronous logging, the integrity of the log file may be
        compromised if a problem occurs during a write to the file or if
        the plugin does not shut down cleanly (for example, in the event
        that the server host crashes). To reduce this risk, set
        <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a> to use
        synchronous logging. Regardless of strategy, logging occurs on a
        best-effort basis, with no guarantee of consistency.
      </p><p>
        If the file system to which the audit log is being written fills
        up, a <span class="quote">“<span class="quote">disk full</span>”</span> error is written to the error
        log. Audit logging continues until the audit log buffer is full.
        If free disk space has not been made available by the time the
        buffer fills, client sessions will hang, and stopping the server
        at the time of client sessions hanging will result in audit log
        corruption. To avoid this if client sessions are hung, ensure
        that free space is available on the audit logging file system
        before stopping the server.
</p>
<h5><a name="idm139737183278256"></a>Audit Log Space Management</h5>
<p>
        The audit log plugin provides several system variables that
        enable you to manage the space used by its log files:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a>: Set
            this variable at server startup to set the size of the
            buffer for asynchronous logging. The plugin uses a single
            buffer, which it allocates when it initializes and removes
            when it terminates. The plugin allocates this buffer only if
            logging is asynchronous.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>,
            <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a>: These
            variables permit audit log file rotation and flushing. The
            audit log file has the potential to grow very large and
            consume a lot of disk space. To manage the space used,
            either enable automatic log rotation, or manually rename the
            audit file and flush the log to open a new file. The renamed
            file can be removed or backed up as desired.
          </p><p>
            By default,
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size=0</code></a>
            and there is no log rotation. In this case, the audit log
            plugin closes and reopens the log file when the
            <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> value
            changes from disabled to enabled. Log file renaming must be
            done externally to the server. Suppose that you want to
            maintain the three most recent log files, which cycle
            through the names <code class="filename">audit.log.1</code> through
            <code class="filename">audit.log.3</code>. On Unix, perform rotation
            manually like this:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                From the command line, rename the current log files:
              </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mv audit.log.2 audit.log.3</code></strong>
shell&gt; <strong class="userinput"><code>mv audit.log.1 audit.log.2</code></strong>
shell&gt; <strong class="userinput"><code>mv audit.log audit.log.1</code></strong>
</pre><p>
                At this point, the plugin is still writing to the
                current log file, which has been renamed to
                <code class="filename">audit.log.1</code>.
              </p></li><li class="listitem"><p>
                Connect to the server and flush the log file so the
                plugin closes it and reopens a new
                <code class="filename">audit.log</code> file:
              </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL audit_log_flush = ON;</code></strong>
</pre></li></ol>
</div>
<p>
            If <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
            is greater than 0, setting
            <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> has no
            effect. In this case, the audit log plugin closes and
            reopens its log file whenever a write to the file causes its
            size to exceed the
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
            value. The plugin renames the original file to have a
            timestamp extension. For example,
            <code class="filename">audit.log</code> might be renamed to
            <code class="filename">audit.log.13440033615657730</code>. The last 7
            digits are a fractional second part. The first 10 digits are
            a Unix timestamp value that can be interpreted using the
            <a class="link" href="functions.html#function_from-unixtime"><code class="literal">FROM_UNIXTIME()</code></a> function:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FROM_UNIXTIME(1344003361);</code></strong>
+---------------------------+
| FROM_UNIXTIME(1344003361) |
+---------------------------+
| 2012-08-03 09:16:01       |
+---------------------------+
</pre></li></ul>
</div>
<h5><a name="idm139737183247936"></a>Audit Log Filtering</h5>
<p>
        The audit log plugin can filter audited events. This enables you
        to control whether it writes events to the audit log file based
        on the account from which events originate or event status.
        Status filtering occurs separately for connection events and
        statement events.
</p>
<h5><a name="idm139737183246528"></a>Event Filtering by Account</h5>
<p>
        As of MySQL 5.6.20, to filter audited events based on the
        originating account, set one of these system variables at server
        startup or runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>:
            The accounts to include in audit logging. If this variable
            is set, only these accounts are audited.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>:
            The accounts to exclude from audit logging. If this variable
            is set, all but these accounts are audited.
</p></li></ul>
</div>
<p>
        The value for either variable can be <code class="literal">NULL</code> or
        a string containing one or more comma-separated account names,
        each in
        <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
        format. By default, both variables are <code class="literal">NULL</code>,
        in which case, no account filtering is done and auditing occurs
        for all accounts.
      </p><p>
        Modifications to
        <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a> or
        <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
        affect only connections created subsequent to the modification,
        not existing connections.
      </p><p>
        Example: To enable audit logging only for the
        <code class="literal">user1</code> and <code class="literal">user2</code> local host
        account accounts, set the
        <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
        system variable like this:
      </p><pre class="programlisting">
SET GLOBAL audit_log_include_accounts = 'user1@localhost,user2@localhost';
</pre><p>
        Only one of
        <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a> or
        <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a> can
        be non-<code class="literal">NULL</code> at a time:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you set
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>,
            the server sets
            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
            to <code class="literal">NULL</code>.
          </p></li><li class="listitem"><p>
            If you attempt to set
            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>,
            an error occurs unless
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
            is <code class="literal">NULL</code>. In this case, you must first
            clear
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
            by setting it to <code class="literal">NULL</code>.
</p></li></ul>
</div>
<pre class="programlisting">
-- This sets audit_log_exclude_accounts to NULL
SET GLOBAL audit_log_include_accounts = <em class="replaceable"><code>value</code></em>;

-- This fails because audit_log_include_accounts is not NULL
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;

-- To set audit_log_exclude_accounts, first set
-- audit_log_include_accounts to NULL
SET GLOBAL audit_log_include_accounts = NULL;
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;
</pre><p>
        If you inspect the value of either variable, be aware that
        <a class="link" href="sql-syntax.html#show-variables" title="13.7.5.40 SHOW VARIABLES Syntax"><code class="literal">SHOW VARIABLES</code></a> displays
        <code class="literal">NULL</code> as an empty string. To avoid this, use
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> instead:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log_include_accounts';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| audit_log_include_accounts |       |
+----------------------------+-------+
mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_include_accounts;</code></strong>
+------------------------------+
| @@audit_log_include_accounts |
+------------------------------+
| NULL                         |
+------------------------------+
</pre><p>
        If a user name or host name requires quoting because it contains
        a comma, space, or other special character, quote it using
        single quotes. If the variable value itself is quoted with
        single quotes, double each inner single quote or escape it with
        a backslash. The following statements each enable audit logging
        for the local <code class="literal">root</code> account and are
        equivalent, even though the quoting styles differ:
      </p><pre class="programlisting">
SET GLOBAL audit_log_include_accounts = 'root@localhost';
SET GLOBAL audit_log_include_accounts = '''root''@''localhost''';
SET GLOBAL audit_log_include_accounts = '\'root\'@\'localhost\'';
SET GLOBAL audit_log_include_accounts = "'root'@'localhost'";
</pre><p>
        The last statement will not work if the
        <code class="literal">ANSI_QUOTES</code> SQL mode is enabled because in
        that mode double quotes signify identifier quoting, not string
        quoting.
</p>
<h5><a name="idm139737183203104"></a>Event Filtering by Status</h5>
<p>
        As of MySQL 5.6.20, to filter audited events based on status,
        set these system variables at server startup or runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>:
            Logging policy for connection events
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>:
            Logging policy for statement events
</p></li></ul>
</div>
<p>
        Each variable takes a value of <code class="literal">ALL</code> (log all
        associated events; this is the default),
        <code class="literal">ERRORS</code> (log only failed events), or
        <code class="literal">NONE</code> (do not log events). For example, to log
        all statement events but only failed connection events, use
        these settings:
      </p><pre class="programlisting">
SET GLOBAL audit_log_statement_policy = ALL;
SET GLOBAL audit_log_connection_policy = ERRORS;
</pre><p>
        Before MySQL 5.6.20,
        <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a> and
        <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a> are
        not available. Instead, use
        <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> at server
        startup or runtime. It takes a value of <code class="literal">ALL</code>
        (log all events; this is the default), <code class="literal">LOGINS</code>
        (log connection events), <code class="literal">QUERIES</code> (log
        statement events), or <code class="literal">NONE</code> (do not log
        events). For any of those values, the audit log plugin logs all
        selected events without distinction as to success or failure.
      </p><p>
        As of MySQL 5.6.20,
        <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is still
        available but can be set only at server startup. At runtime, it
        is a read-only variable. Its use at startup works as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you do not set
            <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> or set it
            to its default of <code class="literal">ALL</code>, any explicit
            settings for
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
            or
            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
            apply as specified. If not specified, they default to
            <code class="literal">ALL</code>.
          </p></li><li class="listitem"><p>
            If you set <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>
            to a non-<code class="literal">ALL</code> value, that value takes
            precedence over and is used to set
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
            and
            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>,
            as indicated in the following table. If you also set either
            of those variables to a value other than their default of
            <code class="literal">ALL</code>, the server writes a message to the
            error log to indicate that their values are being
            overridden.
</p>
<div class="informaltable">
<table summary="This table shows how the server uses
              audit_log_policy to set
              audit_log_connection_policy
              and
              audit_log_statement_policy
at startup." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Startup audit_log_policy Value</th><th scope="col">Resulting audit_log_connection_policy Value</th><th scope="col">Resulting audit_log_statement_policy Value</th></tr></thead><tbody><tr><td scope="row"><code class="literal">LOGINS</code></td><td><code class="literal">ALL</code></td><td><code class="literal">NONE</code></td></tr><tr><td scope="row"><code class="literal">QUERIES</code></td><td><code class="literal">NONE</code></td><td><code class="literal">ALL</code></td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td><code class="literal">NONE</code></td><td><code class="literal">NONE</code></td></tr></tbody></table>
</div>
</li></ul>
</div>
<h5><a name="idm139737183153648"></a>Event Filtering Reporting</h5>
<p>
        To check the effect of filtering, you can inspect the values of
        these status variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Audit_log_events</code>: The number of events
            handled by the audit log plugin, whether or not they were
            written to the log based on filtering policy.
          </p></li><li class="listitem"><p>
            <code class="literal">Audit_log_events_filtered</code>: The number of
            events handled by the audit log plugin that were filtered
            (not written to the log) based on filtering policy.
          </p></li><li class="listitem"><p>
            <code class="literal">Audit_log_events_written</code>: The number of
            events written to the audit log.
</p></li></ul>
</div>
<p>
        These variables are available as of MySQL 5.6.20.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-plugin-option-variable-reference"></a>6.3.13.5 Audit Log Plugin Option and Variable Reference</h4>

</div>

</div>

</div>
<div class="table">
<a name="idm139737183145360"></a><p class="title"><b>Table 6.17 Audit Log Plugin Option/Variable
Reference</b></p>
<div class="table-contents">
<table summary="Audit Log Plugin Option/Variable
Reference" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option File</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#option_mysqld_audit-log">audit-log</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_current_size">Audit_log_current_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_event_max_drop_size">Audit_log_event_max_drop_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events">Audit_log_events</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_filtered">Audit_log_events_filtered</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_lost">Audit_log_events_lost</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_written">Audit_log_events_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Varies</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_total_size">Audit_log_total_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_write_waits">Audit_log_write_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-plugin-options-variables"></a>6.3.13.6 Audit Log Plugin Options and System Variables</h4>

</div>

</div>

</div>
<p>
        This section describes the command options and system variables
        that control operation of the audit log plugin. If values
        specified at startup time are incorrect, the plugin may fail to
        initialize properly and the server does not load it. In this
        case, the server may also produce error messages for other audit
        log settings because it will not recognize them.
      </p><p>
        To control the activation of the <code class="literal">audit_log</code>
        plugin, use this option:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_audit-log"></a>
            <a class="indexterm" name="idm139737183065280"></a>

            <a class="indexterm" name="idm139737183063824"></a>

            <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit-log" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit-log[=value]</code></td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE_PLUS_PERMANENT</code></td></tr></tbody></table>
</div>
<p>
            This option controls how the server loads the
            <code class="literal">audit_log</code> plugin at startup. It is
            available only if the audit log plugin has been previously
            registered with <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
            PLUGIN</code></a> or is loaded with
            <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a>. See
            <a class="xref" href="security.html#audit-log-plugin-installation" title="6.3.13.1 Installing the Audit Log Plugin">Section 6.3.13.1, “Installing the Audit Log Plugin”</a>.
          </p><p>
            The option value should be one of those available for
            plugin-loading options, as described in
            <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>. For example,
            <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log=FORCE_PLUS_PERMANENT</code></a>
            tells the server to load the plugin at startup and prevents
            it from being removed while the server is running.
          </p><p>
            This option was added in MySQL 5.6.10.
</p></li></ul>
</div>
<p>
        If the <code class="literal">audit_log</code> plugin is installed, it
        exposes several system variables that permit control over
        logging. These variables are available only if the
        <code class="literal">audit_log</code> plugin is enabled.
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log%';</code></strong>
+-----------------------------+--------------+
| Variable_name               | Value        |
+-----------------------------+--------------+
| audit_log_buffer_size       | 1048576      |
| audit_log_connection_policy | ALL          |
| audit_log_current_session   | ON           |
| audit_log_exclude_accounts  |              |
| audit_log_file              | audit.log    |
| audit_log_flush             | OFF          |
| audit_log_format            | OLD          |
| audit_log_include_accounts  |              |
| audit_log_policy            | ALL          |
| audit_log_rotate_on_size    | 0            |
| audit_log_statement_policy  | ALL          |
| audit_log_strategy          | ASYNCHRONOUS |
+-----------------------------+--------------+
</pre><p>
        You can set any of these variables at server startup, and some
        of them at runtime.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_audit_log_buffer_size"></a>
            <a class="indexterm" name="idm139737183027376"></a>

            <a class="indexterm" name="idm139737183026336"></a>

            <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_buffer_size=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">18446744073709547520</code></td></tr></tbody></table>
</div>
<p>
            When the audit log plugin writes events to the log
            asynchronously, it uses a buffer to store event contents
            prior to writing them. This variable controls the size of
            that buffer, in bytes. The server adjusts the value to a
            multiple of 4096. The plugin uses a single buffer, which it
            allocates when it initializes and removes when it
            terminates. The plugin allocates this buffer only if logging
            is asynchronous.
          </p><p>
            This variable was added in MySQL 5.6.10.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_connection_policy"></a>
            <a class="indexterm" name="idm139737182985248"></a>

            <a class="indexterm" name="idm139737182984144"></a>

            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_connection_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_connection_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ERRORS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table>
</div>
<p>
            The policy controlling how the audit log plugin writes
            connection events to its log file. The following table shows
            the permitted values.
</p>
<div class="informaltable">
<table summary="This table shows permitted values for the
              audit_log_connection_policy
variable." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>Log all connection events</td></tr><tr><td scope="row"><code class="literal">ERRORS</code></td><td>Log only failed connection events</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>Do not log connection events</td></tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
              At server startup, any explicit value given for
              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              may be overridden if
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is also
              specified, as described in
              <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
</p>
</div>
<p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_current_session"></a>
            <a class="indexterm" name="idm139737182937552"></a>

            <a class="indexterm" name="idm139737182936448"></a>

            <a class="link" href="security.html#sysvar_audit_log_current_session"><code class="literal">audit_log_current_session</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_current_session" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">depends on filtering policy</code></td></tr></tbody></table>
</div>
<p>
            Whether audit logging is enabled for the current session.
            The session value of this variable is read only. It is set
            when the session begins based on the values of the
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
            and
            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
            system variables. The audit log plugin uses the session
            value to determine whether to audit events for the session.
            (There is a global value, but the plugin does not use it.)
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_exclude_accounts"></a>
            <a class="indexterm" name="idm139737182909984"></a>

            <a class="indexterm" name="idm139737182908880"></a>

            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_exclude_accounts" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_exclude_accounts=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
            The accounts for which events should not be logged. The
            value should be <code class="literal">NULL</code> or a string
            containing a list of one or more comma-separated account
            names. For more information, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            Modifications to
            <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
            affect only connections created subsequent to the
            modification, not existing connections.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_file"></a>
            <a class="indexterm" name="idm139737182879680"></a>

            <a class="indexterm" name="idm139737182878624"></a>

            <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_file=file_name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">audit.log</code></td></tr></tbody></table>
</div>
<p>
            The name of the file to which the audit log plugin writes
            events. The default value is <code class="filename">audit.log</code>.
            If the file name is a relative path, the server interprets
            it relative to the data directory. For security reasons, the
            audit log file should be written to a directory accessible
            only to the MySQL server and users with a legitimate reason
            to view the log.
          </p><p>
            This variable was added in MySQL 5.6.10.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_flush"></a>
            <a class="indexterm" name="idm139737182851888"></a>

            <a class="indexterm" name="idm139737182850832"></a>

            <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_flush" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
            When this variable is set to enabled (1 or
            <code class="literal">ON</code>), the audit log plugin closes and
            reopens its log file to flush it. (The value remains
            <code class="literal">OFF</code> so that you need not disable it
            explicitly before enabling it again to perform another
            flush.) Enabling this variable has no effect unless
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a> is
            0.
          </p><p>
            This variable was added in MySQL 5.6.10.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_format"></a>
            <a class="indexterm" name="idm139737182824544"></a>

            <a class="indexterm" name="idm139737182823488"></a>

            <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.14</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_format=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.6.14)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OLD</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OLD</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NEW</code></td></tr></tbody></table>
</div>
<p>
            The audit log file format. Permitted values are
            <code class="literal">OLD</code> and <code class="literal">NEW</code> (default
            <code class="literal">OLD</code>). For details about each format, see
            <a class="xref" href="security.html#audit-log-file" title="6.3.13.3 The Audit Log File">Section 6.3.13.3, “The Audit Log File”</a>.
          </p><p>
            If you change the value of
            <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>, use this
            procedure to avoid writing log entries in one format to an
            existing log file that contains entries in a different
            format:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Stop the server.
              </p></li><li class="listitem"><p>
                Rename the current audit log file manually.
              </p></li><li class="listitem"><p>
                Restart the server with the new value of
                <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>. The
                audit log plugin will create a new log file, which will
                contain log entries in the selected format.
</p></li></ol>
</div>
<p>
            This variable was added in MySQL 5.6.14.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_include_accounts"></a>
            <a class="indexterm" name="idm139737182784016"></a>

            <a class="indexterm" name="idm139737182782912"></a>

            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_include_accounts" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_include_accounts=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
            The accounts for which events should be logged. The value
            should be <code class="literal">NULL</code> or a string containing a
            list of one or more comma-separated account names. For more
            information, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            Modifications to
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
            affect only connections created subsequent to the
            modification, not existing connections.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_policy"></a>
            <a class="indexterm" name="idm139737182753712"></a>

            <a class="indexterm" name="idm139737182752656"></a>

            <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&lt;= 5.6.19)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&gt;= 5.6.20)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">LOGINS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">QUERIES</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table>
</div>
<p>
            The policy controlling how the audit log plugin writes
            events to its log file. The following table shows the
            permitted values.
</p>
<div class="informaltable">
<table summary="This table shows permitted values for the
              audit_log_policy
variable." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>Log all events</td></tr><tr><td scope="row"><code class="literal">LOGINS</code></td><td>Log only login events</td></tr><tr><td scope="row"><code class="literal">QUERIES</code></td><td>Log only query events</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>Log nothing (disable the audit stream)</td></tr></tbody></table>
</div>
<p>
            As of MySQL 5.6.20,
            <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> can be set
            only at server startup. At runtime, it is a read-only
            variable. This is due to the introduction of two other
            system variables,
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
            and
            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>,
            that provide finer control over logging policy and that can
            be set either at startup or at runtime. If you continue to
            use <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> at
            startup instead of the other two variables, the server uses
            its value to set those variables. For more information about
            the policy variables and their interaction, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            Before MySQL 5.6.20, the
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
            and
            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
            system variables do not exist.
            <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is the
            only policy control variable and it can be set at server
            startup or runtime.
          </p><p>
            This variable was added in MySQL 5.6.10.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_rotate_on_size"></a>
            <a class="indexterm" name="idm139737182688784"></a>

            <a class="indexterm" name="idm139737182687680"></a>

            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_rotate_on_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_rotate_on_size=N</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr></tbody></table>
</div>
<p>
            If the
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
            value is greater than 0, the audit log plugin closes and
            reopens its log file if a write to the file causes its size
            to exceed this value. The original file is renamed to have a
            timestamp extension.
          </p><p>
            If the
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
            value is 0, the plugin does not close and reopen its log
            based on size. Instead, use
            <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> to close
            and reopen the log on demand. In this case, rename the file
            externally to the server before flushing it.
          </p><p>
            For more information about audit log file rotation and
            timestamp interpretation, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            If you set this variable to a value that is not a multiple
            of 4096, it is truncated to the nearest multiple. (Thus,
            setting it to a value less than 4096 has the effect of
            setting it to 0 and no rotation occurs.)
          </p><p>
            This variable was added in MySQL 5.6.10.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_statement_policy"></a>
            <a class="indexterm" name="idm139737182655376"></a>

            <a class="indexterm" name="idm139737182654272"></a>

            <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_statement_policy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.20</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_statement_policy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ALL</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ERRORS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">NONE</code></td></tr></tbody></table>
</div>
<p>
            The policy controlling how the audit log plugin writes
            statement events to its log file. The following table shows
            the permitted values.
</p>
<div class="informaltable">
<table summary="This table shows permitted values for the
              audit_log_statement_policy
variable." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ALL</code></td><td>Log all statement events</td></tr><tr><td scope="row"><code class="literal">ERRORS</code></td><td>Log only failed statement events</td></tr><tr><td scope="row"><code class="literal">NONE</code></td><td>Do not log statement events</td></tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
              At server startup, any explicit value given for
              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
              may be overridden if
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is also
              specified, as described in
              <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
</p>
</div>
<p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="sysvar_audit_log_strategy"></a>
            <a class="indexterm" name="idm139737182607664"></a>

            <a class="indexterm" name="idm139737182606624"></a>

            <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a>
</p>
<div class="informaltable">
<table summary="Options for audit_log_strategy" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--audit_log_strategy=value</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="6"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ASYNCHRONOUS</code></td></tr><tr><td scope="row" rowspan="4" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">ASYNCHRONOUS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">PERFORMANCE</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">SEMISYNCHRONOUS</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">SYNCHRONOUS</code></td></tr></tbody></table>
</div>
<p>
            The logging method used by the audit log plugin. The
            following table describes the permitted values.
</p>
<div class="table">
<a name="idm139737182575296"></a><p class="title"><b>Table 6.18 Audit Log Strategies</b></p>
<div class="table-contents">
<table summary="Audit Log Strategies" border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Value</th><th scope="col">Meaning</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ASYNCHRONOUS</code></td><td>Log asynchronously, wait for space in output buffer</td></tr><tr><td scope="row"><code class="literal">PERFORMANCE</code></td><td>Log asynchronously, drop request if insufficient space in output buffer</td></tr><tr><td scope="row"><code class="literal">SEMISYNCHRONOUS</code></td><td>Log synchronously, permit caching by operating system</td></tr><tr><td scope="row"><code class="literal">SYNCHRONOUS</code></td><td>Log synchronously, call <code class="filename">sync()</code> after each request</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            This variable was added in MySQL 5.6.10.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-status-variables"></a>6.3.13.7 Audit Log Plugin Status Variables</h4>

</div>

</div>

</div>
<p>
        The audit log plugin supports the following status variables.
        They are available only if the <code class="literal">audit_log</code>
        plugin is enabled.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Audit_log_current_size"></a>
            <a class="indexterm" name="idm139737182559104"></a>

            <a class="indexterm" name="idm139737182558064"></a>

            <a class="link" href="security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a>
          </p><p>
            The size of the current audit log file. The value increases
            when an event is written to the log and is reset to 0 when
            the log is rotated.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_event_max_drop_size"></a>
            <a class="indexterm" name="idm139737182553008"></a>

            <a class="indexterm" name="idm139737182551904"></a>

            <a class="link" href="security.html#statvar_Audit_log_event_max_drop_size"><code class="literal">Audit_log_event_max_drop_size</code></a>
          </p><p>
            The size of the largest dropped event in performance logging
            mode. For a description of logging modes, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events"></a>
            <a class="indexterm" name="idm139737182546272"></a>

            <a class="indexterm" name="idm139737182545232"></a>

            <a class="link" href="security.html#statvar_Audit_log_events"><code class="literal">Audit_log_events</code></a>
          </p><p>
            The number of events handled by the audit log plugin,
            whether or not they were written to the log based on
            filtering policy (see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>).
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_filtered"></a>
            <a class="indexterm" name="idm139737182539488"></a>

            <a class="indexterm" name="idm139737182538384"></a>

            <a class="link" href="security.html#statvar_Audit_log_events_filtered"><code class="literal">Audit_log_events_filtered</code></a>
          </p><p>
            The number of events handled by the audit log plugin that
            were filtered (not written to the log) based on filtering
            policy (see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>).
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_lost"></a>
            <a class="indexterm" name="idm139737182532656"></a>

            <a class="indexterm" name="idm139737182531616"></a>

            <a class="link" href="security.html#statvar_Audit_log_events_lost"><code class="literal">Audit_log_events_lost</code></a>
          </p><p>
            The number of events lost in performance logging mode
            because an event was larger than than the available audit
            log buffer space. This value may be useful for assessing how
            to set
            <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a> to
            size the buffer for performance mode. For a description of
            logging modes, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_written"></a>
            <a class="indexterm" name="idm139737182524512"></a>

            <a class="indexterm" name="idm139737182523408"></a>

            <a class="link" href="security.html#statvar_Audit_log_events_written"><code class="literal">Audit_log_events_written</code></a>
          </p><p>
            The number of events written to the audit log.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_total_size"></a>
            <a class="indexterm" name="idm139737182518496"></a>

            <a class="indexterm" name="idm139737182517456"></a>

            <a class="link" href="security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a>
          </p><p>
            The total size of events written to all audit log files.
            Unlike
            <a class="link" href="security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a>,
            the value of
            <a class="link" href="security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a>
            increases even when the log is rotated.
          </p><p>
            This variable was added in MySQL 5.6.20.
          </p></li><li class="listitem"><p><a name="statvar_Audit_log_write_waits"></a>
            <a class="indexterm" name="idm139737182509904"></a>

            <a class="indexterm" name="idm139737182508864"></a>

            <a class="link" href="security.html#statvar_Audit_log_write_waits"><code class="literal">Audit_log_write_waits</code></a>
          </p><p>
            The number of times an event had to wait for space in the
            audit log buffer in asynchronous logging mode. For a
            description of logging modes, see
            <a class="xref" href="security.html#audit-log-plugin-logging-control" title="6.3.13.4 Audit Log Plugin Logging Control">Section 6.3.13.4, “Audit Log Plugin Logging Control”</a>.
          </p><p>
            This variable was added in MySQL 5.6.20.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-plugin-restrictions"></a>6.3.13.8 Audit Log Plugin Restrictions</h4>

</div>

</div>

</div>
<p>
        The audit log plugin is subject to these restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Only top-level statements are logged, not statements within
            stored programs such as triggers or stored procedures.
          </p></li><li class="listitem"><p>
            Contents of files referenced by statements such as
            <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD DATA
            INFILE</code></a> are not logged.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-activity-auditing"></a>6.3.14 SQL-Based MySQL Account Activity Auditing</h3>

</div>

</div>

</div>
<p>
      Applications can use the following guidelines to perform SQL-based
      auditing that ties database activity to MySQL accounts.
    </p><p>
      MySQL accounts correspond to rows in the
      <code class="literal">mysql.user</code> table. When a client connects
      successfully, the server authenticates the client to a particular
      row in this table. The <code class="literal">User</code> and
      <code class="literal">Host</code> column values in this row uniquely
      identify the account and correspond to the
      <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>
      format in which account names are written in SQL statements.
    </p><p>
      The account used to authenticate a client determines which
      privileges the client has. Normally, the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function can be
      invoked to determine which account this is for the client user.
      Its value is constructed from the <code class="literal">User</code> and
      <code class="literal">Host</code> columns of the <code class="literal">user</code>
      table row for the account.
    </p><p>
      However, there are circumstances under which the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value corresponds
      not to the client user but to a different account. This occurs in
      contexts when privilege checking is not based the client's
      account:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Stored routines (procedures and functions) defined with the
          <code class="literal">SQL SECURITY DEFINER</code> characteristic
        </p></li><li class="listitem"><p>
          Views defined with the <code class="literal">SQL SECURITY DEFINER</code>
          characteristic
        </p></li><li class="listitem"><p>
          Triggers and events
</p></li></ul>
</div>
<p>
      In those contexts, privilege checking is done against the
      <code class="literal">DEFINER</code> account and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> refers to that
      account, not to the account for the client who invoked the stored
      routine or view or who caused the trigger to activate. To
      determine the invoking user, you can call the
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> function, which returns a
      value indicating the actual user name provided by the client and
      the host from which the client connected. However, this value does
      not necessarily correspond directly to an account in the
      <code class="literal">user</code> table, because the
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> value never contains
      wildcards, whereas account values (as returned by
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>) may contain user
      name and host name wildcards.
    </p><p>
      For example, a blank user name matches any user, so an account of
      <code class="literal">''@'localhost'</code> enables clients to connect as an
      anonymous user from the local host with any user name. In this
      case, if a client connects as <code class="literal">user1</code> from the
      local host, <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> return different
      values:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-----------------+----------------+
| USER()          | CURRENT_USER() |
+-----------------+----------------+
| user1@localhost | @localhost     |
+-----------------+----------------+
</pre><p>
      The host name part of an account can contain wildcards, too. If
      the host name contains a <code class="literal">'%'</code> or
      <code class="literal">'_'</code> pattern character or uses netmask notation,
      the account can be used for clients connecting from multiple hosts
      and the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value will
      not indicate which one. For example, the account
      <code class="literal">'user2'@'%.example.com'</code> can be used by
      <code class="literal">user2</code> to connect from any host in the
      <code class="literal">example.com</code> domain. If <code class="literal">user2</code>
      connects from <code class="literal">remote.example.com</code>,
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> return different
      values:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+--------------------------+---------------------+
| USER()                   | CURRENT_USER()      |
+--------------------------+---------------------+
| user2@remote.example.com | user2@%.example.com |
+--------------------------+---------------------+
</pre><p>
      If an application must invoke
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> for user auditing (for
      example, if it does auditing from within triggers) but must also
      be able to associate the <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a>
      value with an account in the <code class="literal">user</code> table, it is
      necessary to avoid accounts that contain wildcards in the
      <code class="literal">User</code> or <code class="literal">Host</code> column.
      Specifically, do not permit <code class="literal">User</code> to be empty
      (which creates an anonymous-user account), and do not permit
      pattern characters or netmask notation in <code class="literal">Host</code>
      values. All accounts must have a nonempty <code class="literal">User</code>
      value and literal <code class="literal">Host</code> value.
    </p><p>
      With respect to the previous examples, the
      <code class="literal">''@'localhost'</code> and
      <code class="literal">'user2'@'%.example.com'</code> accounts should be
      changed not to use wildcards:
    </p><pre class="programlisting">
RENAME USER ''@'localhost' TO 'user1'@'localhost';
RENAME USER 'user2'@'%.example.com' TO 'user2'@'remote.example.com';
</pre><p>
      If <code class="literal">user2</code> must be able to connect from several
      hosts in the <code class="literal">example.com</code> domain, there should
      be a separate account for each host.
    </p><p>
      To extract the user name or host name part from a
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> or
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> value, use the
      <a class="link" href="functions.html#function_substring-index"><code class="literal">SUBSTRING_INDEX()</code></a> function:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);</code></strong>
+---------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',1) |
+---------------------------------------+
| user1                                 |
+---------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);</code></strong>
+----------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',-1) |
+----------------------------------------+
| localhost                              |
+----------------------------------------+
</pre>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="firewall"></a>6.3.15 MySQL Enterprise Firewall</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#firewall-components">6.3.15.1 MySQL Enterprise Firewall Components</a></span></dt><dt><span class="section"><a href="security.html#firewall-installation">6.3.15.2 Installing or Uninstalling MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#firewall-usage">6.3.15.3 Using MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#firewall-reference">6.3.15.4 MySQL Enterprise Firewall Reference</a></span></dt></dl>
</div>
<a class="indexterm" name="idm139737182436192"></a><a class="indexterm" name="idm139737182435136"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        MySQL Enterprise Firewall is an extension included in MySQL Enterprise Edition, a
        commercial product. To learn more about commercial products, see
        <a class="ulink" href="http://www.mysql.com/products/" target="_top">http://www.mysql.com/products/</a>.
</p>
</div>
<p>
      As of MySQL 5.6.24, MySQL Enterprise Edition includes MySQL Enterprise Firewall, an
      application-level firewall that enables database administrators to
      permit or deny SQL statement execution based on matching against
      whitelists of accepted statement patterns. This helps harden MySQL
      Server against attacks such as SQL injection or attempts to
      exploit applications by using them outside of their legitimate
      query workload characteristics.
    </p><p>
      Each MySQL account registered with the firewall has its own
      statement whitelist, enabling protection to be tailored per
      account. For a given account, the firewall can operate in
      recording, protecting, or detecting mode, for training in the
      accepted statement patterns, active protection against
      unacceptable statements, or passive detection of unacceptable
      statements. The diagram illustrates how the firewall processes
      incoming statements in each mode.
</p>
<div class="figure">
<a name="firewall-diagram"></a><p class="title"><b>Figure 6.1 MySQL Enterprise Firewall Operation</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/firewall-diagram-1.png" width="613" height="426" alt="MySQL Enterprise Firewall Operation">
</div>

</div>

</div>
<br class="figure-break"><p>
      The following sections describe the components of MySQL Enterprise Firewall, discuss
      how to install and use it, and provide reference information for
      its components.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-components"></a>6.3.15.1 MySQL Enterprise Firewall Components</h4>
</div>
</div>
</div>
<p>
        MySQL Enterprise Firewall has these components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A server-side plugin named <code class="literal">MYSQL_FIREWALL</code>
            examines SQL statements before they execute and, based on
            its in-memory cache, renders a decision whether to execute
            or reject each statement.
          </p></li><li class="listitem"><p>
            Server-side plugins named
            <code class="literal">MYSQL_FIREWALL_USERS</code> and
            <code class="literal">MYSQL_FIREWALL_WHITELIST</code> implement
            <code class="literal">INFORMATION_SCHEMA</code> tables that provide
            views into the firewall data cache.
          </p></li><li class="listitem"><p>
            System tables named <code class="literal">firewall_users</code> and
            <code class="literal">firewall_whitelist</code> in the
            <code class="literal">mysql</code> database provide persistent storage
            of firewall data.
          </p></li><li class="listitem"><p>
            Stored procedures named
            <code class="literal">sp_set_firewall_mode()</code> and
            <code class="literal">sp_reload_firewall_rules()</code> perform tasks
            such as registering MySQL accounts with the firewall,
            establishing their operational mode, and managing transfer
            of firewall data between the cache and the underlying system
            tables.
          </p></li><li class="listitem"><p>
            A set of user-defined functions provides an SQL-level API
            for lower-level tasks such as synchronizing the cache with
            the underlying system tables.
          </p></li><li class="listitem"><p>
            System variables enable firewall configuration and status
            variables provide runtime operational information.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-installation"></a>6.3.15.2 Installing or Uninstalling MySQL Enterprise Firewall</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737182407568"></a><p>
        MySQL Enterprise Firewall installation is a one-time operation that installs the
        components described in <a class="xref" href="security.html#firewall-components" title="6.3.15.1 MySQL Enterprise Firewall Components">Section 6.3.15.1, “MySQL Enterprise Firewall Components”</a>.
        Installation can be performed using a graphical interface or
        manually:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            On Windows, MySQL Installer includes an option to enable MySQL Enterprise Firewall for
            you.
          </p></li><li class="listitem"><p>
            MySQL Workbench 6.3.4 or higher can install MySQL Enterprise Firewall, enable or
            disable an installed firewall, or uninstall the firewall.
          </p></li><li class="listitem"><p>
            Manual MySQL Enterprise Firewall installation involves running a script located
            in the <code class="filename">share</code> directory of your MySQL
            installation.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If installed, MySQL Enterprise Firewall involves some minimal overhead even when
          disabled. To avoid this overhead, do not install the firewall
          unless you plan to use it.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          MySQL Enterprise Firewall does not work together with the query cache. If the
          query cache is enabled, disable it before installing the
          firewall (see <a class="xref" href="optimization.html#query-cache-configuration" title="8.10.3.3 Query Cache Configuration">Section 8.10.3.3, “Query Cache Configuration”</a>).
</p>
</div>
<p>
        For usage instructions, see <a class="xref" href="security.html#firewall-usage" title="6.3.15.3 Using MySQL Enterprise Firewall">Section 6.3.15.3, “Using MySQL Enterprise Firewall”</a>.
        For reference information, see
        <a class="xref" href="security.html#firewall-reference" title="6.3.15.4 MySQL Enterprise Firewall Reference">Section 6.3.15.4, “MySQL Enterprise Firewall Reference”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="firewall-install"></a>Installing MySQL Enterprise Firewall</h5>
</div>
</div>
</div>
<p>
          If MySQL Enterprise Firewall is already installed from an older version version
          of MySQL, uninstall it using the instructions given later in
          this section before installing the current version. In this
          case, it is also necessary to register your configuration
          again.
        </p><p>
          On Windows, you can use MySQL Installer to install MySQL Enterprise Firewall, as shown in
          <a class="xref" href="security.html#firewall-installation-windows-installer" title="Figure 6.2 MySQL Enterprise Firewall Installation on Windows">Figure 6.2, “MySQL Enterprise Firewall Installation on Windows”</a>.
          Check the <span class="guilabel">Enable Enterprise Firewall</span>
          checkbox. (<span class="guilabel">Open Firewall port for network
          access</span> has a different purpose. It refers to
          Windows Firewall and controls whether Windows blocks the
          TCP/IP port on which the MySQL server listens for client
          connections.)
</p>
<div class="figure">
<a name="firewall-installation-windows-installer"></a><p class="title"><b>Figure 6.2 MySQL Enterprise Firewall Installation on Windows</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/firewall-windows-installer-option.png" width="801" height="602" alt="MySQL Enterprise Firewall Installation on Windows">
</div>

</div>

</div>
<br class="figure-break"><p>
          To install MySQL Enterprise Firewall using MySQL Workbench 6.3.4 or higher, see
          <a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
        </p><p>
          To install MySQL Enterprise Firewall manually, look in the
          <code class="filename">share</code> directory of your MySQL
          installation and choose the script that is appropriate for
          your platform. The available scripts differ in the suffix used
          to refer to the plugin library file:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">win_install_firewall.sql</code>: Choose this
              script for Windows systems that use
              <code class="filename">.dll</code> as the file name suffix.
            </p></li><li class="listitem"><p>
              <code class="filename">linux_install_firewall.sql</code>: Choose
              this script for Linux and similar systems that use
              <code class="filename">.so</code> as the file name suffix.
</p></li></ul>
</div>
<p>
          The installation script creates stored procedures in the
          default database, so choose a database to use. Then run the
          script as follows, naming the chosen database on the command
          line. The example here uses the <code class="literal">mysql</code>
          database and the Linux installation script. Make the
          appropriate substitutions for your system.
        </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root -p mysql &lt; linux_install_firewall.sql</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre><p>
          Installing MySQL Enterprise Firewall either using a graphical interface or
          manually should enable the firewall. To verify that, connect
          to the server and execute this statement:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'mysql_firewall_mode';</code></strong>
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| mysql_firewall_mode | ON    |
+---------------------+-------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="firewall-uninstall"></a>Uninstalling MySQL Enterprise Firewall</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall can be uninstalled using MySQL Workbench or manually.
        </p><p>
          To uninstall MySQL Enterprise Firewall using MySQL Workbench 6.3.4 or higher, see
          <a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
        </p><p>
          To uninstall MySQL Enterprise Firewall manually, execute the following
          statements. It is assumed that the stored procedures were
          created in the <code class="literal">mysql</code> database. Adjust the
          <a class="link" href="sql-syntax.html#drop-procedure" title="13.1.26 DROP PROCEDURE and DROP FUNCTION Syntax"><code class="literal">DROP PROCEDURE</code></a> statements
          appropriately if the procedures were created in a different
          database.
        </p><pre class="programlisting">
DROP TABLE mysql.firewall_whitelist;
DROP TABLE mysql.firewall_users;
UNINSTALL PLUGIN mysql_firewall;
UNINSTALL PLUGIN mysql_firewall_whitelist;
UNINSTALL PLUGIN mysql_firewall_users;
DROP FUNCTION set_firewall_mode;
DROP FUNCTION normalize_statement;
DROP FUNCTION read_firewall_whitelist;
DROP FUNCTION read_firewall_users;
DROP FUNCTION mysql_firewall_flush_status;     # MySQL 5.6.26 and up only
DROP PROCEDURE mysql.sp_set_firewall_mode;
DROP PROCEDURE mysql.sp_reload_firewall_rules; # MySQL 5.6.26 and up only
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-usage"></a>6.3.15.3 Using MySQL Enterprise Firewall</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm139737182362128"></a><p>
        Before using MySQL Enterprise Firewall, install it according to the instructions at
        <a class="xref" href="security.html#firewall-installation" title="6.3.15.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.3.15.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>. Also, MySQL Enterprise Firewall does not
        work together with the query cache; disable the query cache if
        it is enabled (see <a class="xref" href="optimization.html#query-cache-configuration" title="8.10.3.3 Query Cache Configuration">Section 8.10.3.3, “Query Cache Configuration”</a>).
      </p><p>
        This section describes how to configure MySQL Enterprise Firewall using SQL
        statements. Alternatively, MySQL Workbench 6.3.4 or higher provides
        a graphical interface for firewall control. See
        <a class="ulink" href="http://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
      </p><p>
        To enable or disable the firewall, set the
        <a class="link" href="security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a> system
        variable. By default, this variable is enabled when the firewall
        is installed. To control the initial firewall state explicitly,
        you can set the variable at server startup. For example, to
        enable the firewall in an option file, use these lines:
      </p><pre class="programlisting">
[mysqld]
mysql_firewall_mode=ON
</pre><p>
        It is also possible to disable or enable the firewall at
        runtime:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = OFF;</code></strong>
mysql&gt; <strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = ON;</code></strong>
</pre><p>
        In addition to the global on/off firewall mode, each account
        registered with the firewall has its own operational mode. For
        an account in recording mode, the firewall learns an
        application's <span class="quote">“<span class="quote">fingerprint,</span>”</span> that is, the
        acceptable statement patterns that, taken together, form a
        whitelist. After training, switch the firewall to protecting
        mode to harden MySQL against access by statements that deviate
        from the fingerprint. For additional training, switch the
        firewall back to recording mode as necessary to update the
        whitelist with new statement patterns. As of MySQL 5.6.26, an
        intrusion-detection mode is available that writes suspicious
        statements to the error log but does not deny access.
      </p><p>
        The firewall maintains whitelist rules on a per-account basis,
        enabling implementation of protection strategies such as these:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For an application that has unique protection requirements,
            configure it to use an account that is not used for any
            other purpose.
          </p></li><li class="listitem"><p>
            For applications that are related and share protection
            requirements, configure them as a group to use the same
            account.
</p></li></ul>
</div>
<p>
        Firewall operation is based on conversion of SQL statements to
        normalized digest form. Firewall digests are like the statement
        digests used by the Performance Schema (see
        <a class="xref" href="performance-schema.html#performance-schema-statement-digests" title="22.7 Performance Schema Statement Digests">Section 22.7, “Performance Schema Statement Digests”</a>).
        However, unlike the Performance Schema, the relevant
        digest-related system variables are
        <a class="link" href="server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a> and
        <a class="link" href="security.html#sysvar_mysql_firewall_max_query_size"><code class="literal">mysql_firewall_max_query_size</code></a>.
      </p><p>
        For a connection from a registered account, the firewall
        converts each incoming statement to normalized form and
        processes it according to the account mode:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In recording mode, the firewall adds the normalized
            statement to the account whitelist rules.
          </p></li><li class="listitem"><p>
            In protecting mode, the firewall compares the normalized
            statement to the account whitelist rules. If there is a
            match, the statement passes and the server continues to
            process it. Otherwise, the server rejects the statement and
            returns an error to the client. As of MySQL 5.6.25, the
            firewall also writes the rejected statement to the error log
            if the <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
            system variable is enabled.
          </p></li><li class="listitem"><p>
            In detecting mode, the firewall matches statements as in
            protecting mode, but writes nonmatching statements to the
            error log without denying access.
</p></li></ul>
</div>
<p>
        Accounts that have a mode of <code class="literal">OFF</code> or are not
        registered with the firewall are ignored by it.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Before MySQL 5.6.25, MySQL Enterprise Firewall records prepared statements as
          they are received by the server, not as normalized digests.
          Thus, spaces, tabs, and lettercase are signficant for
          comparison of whitelist rules against incoming statements.
</p>
</div>
<p>
        To protect an account using MySQL Enterprise Firewall, follow these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Register the account and put it in recording mode.
          </p></li><li class="listitem"><p>
            Connect to the MySQL server using the registered account and
            execute statements to be learned. This establishes the
            account's whitelist of accepted statements.
          </p></li><li class="listitem"><p>
            Switch the registered account to protecting mode.
</p></li></ol>
</div>
<p>
        The following example shows how to register an account with the
        firewall, use the firewall to learn acceptable statements for
        that account, and protect the account against execution of
        unacceptable statements. The example account,
        <code class="literal">'fwuser'@'localhost'</code>, is for use by an
        application that accesses tables in the
        <code class="literal">sakila</code> database. (This database is available
        at <a class="ulink" href="http://dev.mysql.com/doc/index-other.html" target="_top">http://dev.mysql.com/doc/index-other.html</a>.)
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The user and host parts of the account name are quoted
          separately for statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.2 CREATE USER Syntax"><code class="literal">CREATE
          USER</code></a> and <a class="link" href="sql-syntax.html#grant" title="13.7.1.4 GRANT Syntax"><code class="literal">GRANT</code></a>,
          whereas to specify an account for use with a firewall
          component, name it as a single quoted string
          <code class="literal">'fwuser@localhost'</code>.
        </p><p>
          The convention for naming accounts as a single quoted string
          for firewall components means that you cannot use accounts
          that have embedded <code class="literal">@</code> characters in the user
          name.
</p>
</div>
<p>
        Perform the steps in the following procedure using an
        administrative MySQL account, except those designated for
        execution by the account registered with the firewall. The
        default database should be <code class="literal">sakila</code> for
        statements executed using the registered account.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            If necessary, create the account to be protected (choose an
            appropriate password) and grant it privileges for the
            <code class="literal">sakila</code> database:
          </p><pre class="programlisting">

mysql&gt; <strong class="userinput"><code>CREATE USER 'fwuser'@'localhost' IDENTIFIED BY 'fWp@3sw0rd';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL ON sakila.* TO 'fwuser'@'localhost';</code></strong>
</pre></li><li class="listitem"><p>
            Use the <code class="literal">sp_set_firewall_mode()</code> stored
            procedure to register the account with the firewall and
            place it in recording mode (if the procedure is located in a
            database other than <code class="literal">mysql</code>, adjust the
            statement accordingly):
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'RECORDING');</code></strong>
</pre><p>
            During the course of its execution, the stored procedure
            invokes firewall user-defined functions, which may produce
            output of their own.
          </p></li><li class="listitem"><p>
            Using the registered account, connect to the server, then
            execute some statements that are legitimate for it:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1;</code></strong>
mysql&gt; <strong class="userinput"><code>UPDATE rental SET return_date = NOW() WHERE rental_id = 1;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT get_customer_balance(1, NOW());</code></strong>
</pre><p>
            The firewall converts the statements to digest form and
            records them in the account whitelist.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Until the account executes statements in recording mode,
              its whitelist is empty, which is equivalent to <span class="quote">“<span class="quote">deny
              all.</span>”</span> If switched to protecting mode, the account
              will be effectively prohibited from executing statements.
</p>
</div>
</li><li class="listitem"><p>
            At this point, the user and whitelist information is cached
            and can be seen in the firewall
            <code class="literal">INFORMATION_SCHEMA</code> tables:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT MODE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code></strong>
    -&gt; <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code></strong>
    -&gt; <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+----------------------------------------------------------------------------+
| RULE                                                                       |
+----------------------------------------------------------------------------+
| SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?  |
| SELECT `get_customer_balance` ( ? , NOW ( ) )                              |
| UPDATE `rental` SET `return_date` = NOW ( ) WHERE `rental_id` = ?          |
| SELECT @@`version_comment` LIMIT ?                                         |
+----------------------------------------------------------------------------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="literal">@@version_comment</code> rule comes from a
              statement sent automatically by the
              <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client when you connect to the
              server as the registered user.
            </p><p>
              It is important to train the firewall under conditions
              matching application use. For example, a given MySQL
              connector might send statements to the server at the
              beginning of a connection to determine server
              characteristics and capabilities. If an application
              normally is used through that connector, train the
              firewall that way, too. That enables those initial
              statements to become part of the whitelist for the account
              associated with the application.
</p>
</div>
</li><li class="listitem"><p>
            Use the stored procedure to switch the registered user to
            protecting mode:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'PROTECTING');</code></strong>
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Switching the account out of <code class="literal">RECORDING</code>
              mode synchronizes its firewall cache data to the
              underlying <code class="literal">mysql</code> system database tables
              for persistent storage. If you do not switch the mode for
              a user who is being recorded, the cached whitelist data is
              not written to the system tables and will be lost when the
              server is restarted.
</p>
</div>
</li><li class="listitem"><p>
            Using the registered account, execute some acceptable and
            unacceptable statements. The firewall matches each one
            against the account whitelist and accepts or rejects it.
          </p><p>
            This statement is not identical to a training statement but
            produces the same normalized statement as one of them, so
            the firewall accepts it:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = '48';</code></strong>
+------------+-----------+
| first_name | last_name |                                           
+------------+-----------+
| ANN        | EVANS     |
+------------+-----------+
</pre><p>
            These statements do not match anything in the whitelist and
            each results in an error:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1 OR TRUE;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
</pre><p>
            As of MySQL 5.6.25, the firewall also writes the rejected
            statements to the error log if the
            <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> system
            variable is enabled. For example:
          </p><pre class="programlisting">
[Note] Plugin MYSQL_FIREWALL reported:
'ACCESS DENIED for fwuser@localhost. Reason: No match in whitelist.
Statement: TRUNCATE TABLE `mysql` . `slow_log` '
</pre><p>
            You can use these log messages in your efforts to identify
            the source of attacks.
          </p></li><li class="listitem"><p>
            As of MySQL 5.6.26, you can log nonmatching statements as
            suspicious without denying access. To do this, put the
            account in intrusion-detecting mode:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'DETECTING');</code></strong>
</pre></li><li class="listitem"><p>
            Using the registered account, connect to the server, then
            execute some statement does not match the whitelist:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
+------------------------------+
| Tables_in_sakila (customer%) |
+------------------------------+
| customer                     |
| customer_list                |
+------------------------------+
</pre><p>
            In detecting mode, the firewall permits the nonmatching
            statement to execute but writes a message to the error log:
          </p><pre class="programlisting">
[Note] Plugin MYSQL_FIREWALL reported:
'SUSPICIOUS STATEMENT from 'fwuser@localhost'. Reason: No match in whitelist.
Statement: SHOW TABLES LIKE ? '
</pre></li><li class="listitem"><p>
            To assess firewall activity, examine its status variables:
          </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Firewall%';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| Firewall_access_denied     | 3     |
| Firewall_access_granted    | 4     |
| Firewall_access_suspicious | 1     |
| Firewall_cached_entries    | 4     |
+----------------------------+-------+
</pre><p>
            The variables indicate the number of statements rejected,
            accepted, logged as suspicious, and added to the cache,
            respectively. The
            <a class="link" href="security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
            count is 4 because of the
            <code class="literal">@@version_comment</code> statement sent by the
            <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client each of the three time you
            used it to connect as the registered user, plus the
            <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38 SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> statement that
            was not blocked in <code class="literal">DETECTING</code> mode.
</p></li></ol>
</div>
<p>
        Should additional training for an account be necessary, switch
        it to recording mode again, then back to protecting mode after
        executing statements to be added to the whitelist.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-reference"></a>6.3.15.4 MySQL Enterprise Firewall Reference</h4>

</div>

</div>

</div>
<p>
        The following discussion serves as a reference to these MySQL Enterprise Firewall
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Firewall tables in the <code class="literal">mysql</code> and
            <code class="literal">INFORMATION_SCHEMA</code> databases
          </p></li><li class="listitem"><p>
            Firewall procedures and functions
          </p></li><li class="listitem"><p>
            Firewall system and status variables
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-tables"></a>6.3.15.4.1 MySQL Enterprise Firewall Tables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall maintains account and whitelist information. It uses
          <code class="literal">INFORMATION_SCHEMA</code> tables to provide views
          into cached data, and tables in the <code class="literal">mysql</code>
          system database to store this data in persistent form. When
          enabled, the firewall bases its operational decisions on the
          cached data.
        </p><p>
          The <code class="literal">INFORMATION_SCHEMA</code> tables are
          accessible by anyone. The <code class="literal">mysql</code> tables can
          be accessed only by users with privileges for that database.
        </p><p>
          The <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code>
          and <code class="literal">mysql.firewall_users</code> tables list
          registered firewall accounts and their operational modes. The
          tables have these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              An account registered with the firewall. Each account has
              the format
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              and represents actual user and host names as authenticated
              by the server. Patterns and netmasks should not be used
              when registering users.
            </p></li><li class="listitem"><p>
              <code class="literal">MODE</code>
            </p><p>
              The current firewall operational mode for the account. The
              permitted mode values are <code class="literal">OFF</code>,
              <code class="literal">DETECTING</code> (as of MySQL 5.6.26),
              <code class="literal">PROTECTING</code>,
              <code class="literal">RECORDING</code>, and
              <code class="literal">RESET</code>. For details about their
              meanings, see the description of
              <code class="literal">sp_set_firewall_mode()</code> in
              <a class="xref" href="security.html#firewall-routines" title="6.3.15.4.2 MySQL Enterprise Firewall Procedures and Functions">Section 6.3.15.4.2, “MySQL Enterprise Firewall Procedures and Functions”</a>.
</p></li></ul>
</div>
<p>
          The
          <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code>
          and <code class="literal">mysql.firewall_whitelist</code> tables list
          registered firewall accounts and their whitelists. The tables
          have these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              An account registered with the firewall. The format is the
              same as for the user account tables.
            </p></li><li class="listitem"><p>
              <code class="literal">RULE</code>
            </p><p>
              A normalized statement indicating an acceptable statement
              pattern for the account. An account whitelist is the union
              of its rules.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-routines"></a>6.3.15.4.2 MySQL Enterprise Firewall Procedures and Functions</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall has stored procedures that perform tasks such as
          registering MySQL accounts with the firewall, establishing
          their operational mode, and managing transfer of firewall data
          between the cache and the underlying system tables. It also
          has a set of user-defined functions (UDFs) that provides an
          SQL-level API for lower-level tasks such as synchronizing the
          cache with the underlying system tables.
        </p><p>
          Under normal operation, the stored procedures implement the
          user interface. The UDFs are invoked by the stored procedures,
          not directly by users.
        </p><p>
          To invoke a stored procedure when the default database is not
          the database that contains the procedure, qualify the
          procedure name with the database name. For example:
        </p><pre class="programlisting">
CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>);
</pre><p>
          The following list describes each firewall stored procedure
          and UDF:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">sp_reload_firewall_rules(<em class="replaceable"><code>user</code></em>)</code>
            </p><p>
              This stored procedure uses firewall UDFs to reset a
              registered account and reload the in-memory rules for it
              from the rules stored in the
              <code class="literal">mysql.firewall_whitelist</code> table. This
              procedure provides control over firewall operation for
              individual accounts.
            </p><p>
              The <em class="replaceable"><code>user</code></em> argument names the
              affected account, as a string in
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              format.
            </p><p>
              Example:
            </p><pre class="programlisting">
CALL mysql.sp_reload_firewall_rules('fwuser@localhost');
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
                This procedure sets the account mode to
                <code class="literal">RESET</code>, which clears the account
                whitelist and sets its mode to <code class="literal">OFF</code>.
                If the account mode was not <code class="literal">OFF</code> prior
                to the <code class="literal">sp_reload_firewall_rules()</code>
                call, use <code class="literal">sp_set_firewall_mode()</code> to
                restore its previous mode after reloading the rules. For
                example, if the account was in
                <code class="literal">PROTECTING</code> mode, that is no longer
                true after calling
                <code class="literal">sp_reload_firewall_rules()</code> and you
                must set it to <code class="literal">PROTECTING</code> again
                explicitly.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This stored procedure registers a MySQL account with the
              firewall and establishes its operational mode. The
              procedure also invokes firewall UDFs as necessary to
              transfer firewall data between the cache and the
              underlying system tables. This procedure may be called
              even if the <code class="literal">mysql_firewall_mode</code> system
              variable is <code class="literal">OFF</code>, although setting the
              mode for an account has no operational effect while the
              firewall is disabled.
            </p><p>
              The <em class="replaceable"><code>user</code></em> argument names the
              affected account, as a string in
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              format.
            </p><p>
              The <em class="replaceable"><code>mode</code></em> is the operational
              mode for the user, as a string. These mode values are
              permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">OFF</code>: Disable the firewall for the
                  account.
                </p></li><li class="listitem"><p>
                  <code class="literal">DETECTING</code>: Intrusion-detection
                  mode: Write suspicious (nonmatching) statements to the
                  error log but do not deny access.
                </p><p>
                  This mode was added in MySQL 5.6.26.
                </p></li><li class="listitem"><p>
                  <code class="literal">PROTECTING</code>: Protect the account by
                  matching incoming statements against the account
                  whitelist.
                </p></li><li class="listitem"><p>
                  <code class="literal">RECORDING</code>: Training mode: Record
                  acceptable statements for the account. Incoming
                  statements that do not immediately fail with a syntax
                  error are recorded to become part of the account
                  whitelist rules.
                </p></li><li class="listitem"><p>
                  <code class="literal">RESET</code>: Clear the account whitelist
                  and set the account mode to <code class="literal">OFF</code>.
</p></li></ul>
</div>
<p>
              Switching the mode for an account to any mode but
              <code class="literal">RECORDING</code> synchronizes the firewall
              cache data to the underlying <code class="literal">mysql</code>
              system database tables for persistent storage. Switching
              the mode from <code class="literal">OFF</code> to
              <code class="literal">RECORDING</code> reloads the whitelist from
              the <code class="literal">mysql.firewall_whitelist</code> table into
              the cache.
            </p><p>
              If an account has an empty whitelist, setting its mode to
              <code class="literal">PROTECTING</code> produces an error message
              that is returned in a result set, but not an SQL error:
            </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('a@b','PROTECTING');</code></strong>
+----------------------------------------------------------------------+
| set_firewall_mode(arg_userhost, arg_mode)                            |
+----------------------------------------------------------------------+
| ERROR: PROTECTING mode requested for a@b but the whitelist is empty. |
+----------------------------------------------------------------------+
1 row in set (0.02 sec)

Query OK, 0 rows affected (0.02 sec)
</pre></li><li class="listitem"><p>
              <code class="literal">mysql_firewall_flush_status()</code>
            </p><p>
              This UDF resets several firewall status variables to 0:
            </p><pre class="programlisting">
Firewall_access_denied
Firewall_access_granted
Firewall_access_suspicious
</pre><p>
              Example:
            </p><pre class="programlisting">
SELECT mysql_firewall_flush_status();
</pre></li><li class="listitem"><p>
              <code class="literal">normalize_statement(<em class="replaceable"><code>stmt</code></em>)</code>
            </p><p>
              This UDF normalizes a SQL statement into the digest form
              used for whitelist rules.
            </p><p>
              Example:
            </p><pre class="programlisting">
SELECT normalize_statement('SELECT * FROM t1 WHERE c1 &gt; 2');
</pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_users(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This aggregate UDF updates the firewall user cache through
              a <code class="literal">SELECT</code> statement on the
              <code class="literal">mysql.firewall_users</code> table.
            </p><p>
              Example:
            </p><pre class="programlisting">
SELECT read_firewall_users('fwuser@localhost', 'RECORDING')
FROM mysql.firewall_users;
</pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_whitelist(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>rule</code></em>)</code>
            </p><p>
              This aggregate UDF updates the recorded statement cache
              through a <code class="literal">SELECT</code> statement on the
              <code class="literal">mysql.firewall_whitelist</code> table.
            </p><p>
              Example:
            </p><pre class="programlisting">
SELECT read_firewall_whitelist('fwuser@localhost', 'RECORDING')
FROM mysql.firewall_whitelist;
</pre></li><li class="listitem"><p>
              <code class="literal">set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This UDF manages the user cache and establishes the user
              operational mode.
            </p><p>
              Example:
            </p><pre class="programlisting">
SELECT set_firewall_mode('fwuser@localhost', 'RECORDING');
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-system-variables"></a>6.3.15.4.3 MySQL Enterprise Firewall System Variables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall supports the following system variables. Use them to
          configure firewall operation. These variables are unavailable
          unless the firewall is installed (see
          <a class="xref" href="security.html#firewall-installation" title="6.3.15.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.3.15.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_mysql_firewall_max_query_size"></a>
              <a class="indexterm" name="idm139737182165104"></a>

              <a class="indexterm" name="idm139737182164000"></a>

              <a class="link" href="security.html#sysvar_mysql_firewall_max_query_size"><code class="literal">mysql_firewall_max_query_size</code></a>
</p>
<div class="informaltable">
<table summary="Options for mysql_firewall_max_query_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.24</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--mysql_firewall_max_query_size=size</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_max_query_size">mysql_firewall_max_query_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4096</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
              The maximum size of a normalized statement that can be
              inserted in the MySQL Enterprise Firewall cache. Normalized statements longer
              than this size are truncated. Truncated statements are
              discarded if the firewall mode for the current user is
              <code class="literal">RECORDING</code> and rejected if the mode is
              <code class="literal">PROTECTING</code>.
            </p><p>
              Prior to MySQL 5.6.26,
              <a class="link" href="server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a> must be
              larger than
              <a class="link" href="security.html#sysvar_mysql_firewall_max_query_size"><code class="literal">mysql_firewall_max_query_size</code></a>
              or normalized statements will be truncated.
            </p></li><li class="listitem"><p><a name="sysvar_mysql_firewall_mode"></a>
              <a class="indexterm" name="idm139737182129376"></a>

              <a class="indexterm" name="idm139737182128336"></a>

              <a class="link" href="security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a>
</p>
<div class="informaltable">
<table summary="Options for mysql_firewall_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.24</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--mysql_firewall_mode={OFF|ON}</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_mode">mysql_firewall_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
              Whether MySQL Enterprise Firewall is enabled (the default) or disabled.
            </p></li><li class="listitem"><p><a name="sysvar_mysql_firewall_trace"></a>
              <a class="indexterm" name="idm139737182102976"></a>

              <a class="indexterm" name="idm139737182101936"></a>

              <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
</p>
<div class="informaltable">
<table summary="Options for mysql_firewall_trace" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.6.24</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--mysql_firewall_trace={OFF|ON}</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_trace">mysql_firewall_trace</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
              Whether the MySQL Enterprise Firewall trace is enabled or disabled (the
              default). When enabled,
              <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> has
              this effect:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  In MySQL 5.6.24, the firewall writes a file named
                  <code class="filename">firewall_trace.txt</code> in the data
                  directory.
                </p></li><li class="listitem"><p>
                  In MySQL 5.6.25 and up, for
                  <code class="literal">PROTECTING</code> mode, the firewall
                  writes rejected statements to the error log.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-status-variables"></a>6.3.15.4.4 MySQL Enterprise Firewall Status Variables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall supports the following status variables. Use them to
          obtain information about firewall operational status. These
          variables are unavailable unless the firewall is installed
          (see <a class="xref" href="security.html#firewall-installation" title="6.3.15.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.3.15.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>). Firewall status
          variables are set to 0 whenever the
          <code class="literal">MYSQL_FIREWALL</code> plugin is installed or the
          server is started. Many of them are reset to zero by the
          <code class="literal">mysql_firewall_flush_status()</code> UDF (see
          <a class="xref" href="security.html#firewall-routines" title="6.3.15.4.2 MySQL Enterprise Firewall Procedures and Functions">Section 6.3.15.4.2, “MySQL Enterprise Firewall Procedures and Functions”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Firewall_access_denied"></a>
              <a class="indexterm" name="idm139737182066288"></a>

              <a class="indexterm" name="idm139737182065248"></a>

              <a class="link" href="security.html#statvar_Firewall_access_denied"><code class="literal">Firewall_access_denied</code></a>
            </p><p>
              The number of statements rejected by MySQL Enterprise Firewall.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_granted"></a>
              <a class="indexterm" name="idm139737182060752"></a>

              <a class="indexterm" name="idm139737182059712"></a>

              <a class="link" href="security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
            </p><p>
              The number of statements accepted by MySQL Enterprise Firewall.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_suspicious"></a>
              <a class="indexterm" name="idm139737182055232"></a>

              <a class="indexterm" name="idm139737182054128"></a>

              <a class="link" href="security.html#statvar_Firewall_access_suspicious"><code class="literal">Firewall_access_suspicious</code></a>
            </p><p>
              The number of statements logged by MySQL Enterprise Firewall as suspicious
              for users who are in <code class="literal">DETECTING</code> mode.
            </p><p>
              This variable was added in MySQL 5.6.26.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_cached_entries"></a>
              <a class="indexterm" name="idm139737182048304"></a>

              <a class="indexterm" name="idm139737182047264"></a>

              <a class="link" href="security.html#statvar_Firewall_cached_entries"><code class="literal">Firewall_cached_entries</code></a>
            </p><p>
              The number of statements recorded by MySQL Enterprise Firewall, including
              duplicates.
</p></li></ul>
</div>

</div>

</div>

</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="server-administration.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="backup-and-recovery.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 5 MySQL Server Administration</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 7 Backup and Recovery</td>
</tr>
</table>
</div>
</body>
</html>
